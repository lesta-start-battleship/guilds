{"version":3,"file":"384.js?_cache=0f379ab9b13a2509a175","mappings":"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","sources":["webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged.ts","webpack://grafana-metricsdrilldown-app/./Menu/AddToExplorationsButton.tsx","webpack://grafana-metricsdrilldown-app/./Menu/PanelMenu.tsx","webpack://grafana-metricsdrilldown-app/./autoQuery/components/AutoVizPanelQuerySelector.tsx","webpack://grafana-metricsdrilldown-app/./autoQuery/components/AutoVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./constants/ui.ts","webpack://grafana-metricsdrilldown-app/./MetricGraphScene.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/PrefixFilterDropdown.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/RelatedListControls.tsx","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/RelatedMetricsScene.tsx","webpack://grafana-metricsdrilldown-app/./ShareTrailButton.tsx","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/baseQuery.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/graphBuilders.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/common.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/default.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/histogram.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/queryGenerators/summary.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/getAutoQueriesForMetric.ts","webpack://grafana-metricsdrilldown-app/./BreakdownLabelSelector.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/AddToFiltersGraphAction.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/utils.ts","webpack://grafana-metricsdrilldown-app/./services/search.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/ByFrameRepeater.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/SearchInput.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/BreakdownSearchScene.tsx","webpack://grafana-metricsdrilldown-app/./services/store.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/types.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/LayoutSwitcher.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/SortByScene.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/yAxisSyncBehavior.ts","webpack://grafana-metricsdrilldown-app/./services/variables.ts","webpack://grafana-metricsdrilldown-app/./StatusWrapper.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/events/EventTimeseriesDataReceived.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/behaviors/syncYAxis.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/addRefId.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/transformations/sliceSeries.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/LabelVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/behaviors/publishTimeseriesData.ts","webpack://grafana-metricsdrilldown-app/./Breakdown/MetricLabelsList/MetricLabelsList.tsx","webpack://grafana-metricsdrilldown-app/./Breakdown/LabelBreakdownScene.tsx","webpack://grafana-metricsdrilldown-app/./MetricActionBar.tsx","webpack://grafana-metricsdrilldown-app/./TrailStore/useBookmarkState.ts","webpack://grafana-metricsdrilldown-app/./Integrations/logs/labelsCrossReference.ts","webpack://grafana-metricsdrilldown-app/./Integrations/logs/lokiRecordingRules.ts","webpack://grafana-metricsdrilldown-app/./RelatedLogs/RelatedLogsOrchestrator.ts","webpack://grafana-metricsdrilldown-app/./RelatedLogs/NoRelatedLogsFound.tsx","webpack://grafana-metricsdrilldown-app/./RelatedLogs/RelatedLogsScene.tsx","webpack://grafana-metricsdrilldown-app/./MetricScene.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.variables.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableActivated.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/SectionTitle.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/helpers/areArraysEqual.ts","webpack://grafana-metricsdrilldown-app/./utils/utils.promql.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/fetchers/fetchAlertingMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/fetchers/fetchDashboardMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/withLifecycleEvents.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged.ts","webpack://grafana-metricsdrilldown-app/./MetricsDrilldownDataSourceVariable.ts","webpack://grafana-metricsdrilldown-app/./PluginInfo/PluginLogo.tsx","webpack://grafana-metricsdrilldown-app/./PluginInfo/PluginInfo.tsx","webpack://grafana-metricsdrilldown-app/./DataTrailSettings.tsx","webpack://grafana-metricsdrilldown-app/./DataTrail.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ShowMoreButton.tsx","webpack://grafana-metricsdrilldown-app/./shared.ts","webpack://grafana-metricsdrilldown-app/./TrailStore/TrailStore.ts","webpack://grafana-metricsdrilldown-app/./TrailStore/utils.tsx","webpack://grafana-metricsdrilldown-app/./services/sorting.ts","webpack://grafana-metricsdrilldown-app/./interactions.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/displayStatus.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.scopes.ts","webpack://grafana-metricsdrilldown-app/./utils.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/localCompare.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/WithUsageDataPreviewPanel.tsx","webpack://grafana-metricsdrilldown-app/./DataTrailCard.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/BookmarksList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariable.ts","webpack://grafana-metricsdrilldown-app/./services/levels.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsList/MetricsList.tsx","webpack://grafana-metricsdrilldown-app/./helpers/MetricDatasourceHelper.ts","webpack://grafana-metricsdrilldown-app/./RelatedMetricsScene/sortRelatedMetrics.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/MetricsVariableSortEngine.ts","webpack://grafana-metricsdrilldown-app/./App/InlineBanner.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableDeactivated.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/QuickSearch/QuickSearch.tsx","webpack://grafana-metricsdrilldown-app/./utils/utils.queries.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/EventMetricsVariableLoaded.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/units.ts","webpack://grafana-metricsdrilldown-app/./utils/utils.datasource.ts","webpack://grafana-metricsdrilldown-app/./autoQuery/buildPrometheusQuery.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/parseMatcher.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/MetricVizPanel.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/panels/buildStatusHistoryPanel.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/panels/buildHeatmapPanel.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/panels/buildTimeseriesPanel.ts","webpack://grafana-metricsdrilldown-app/./App/ErrorView.tsx","webpack://grafana-metricsdrilldown-app/./App/Onboarding.tsx","webpack://grafana-metricsdrilldown-app/./App/useTrail.tsx","webpack://grafana-metricsdrilldown-app/./App/Routes.tsx","webpack://grafana-metricsdrilldown-app/./App/useCatchExceptions.ts","webpack://grafana-metricsdrilldown-app/./utils/utils.plugin.ts","webpack://grafana-metricsdrilldown-app/./App/App.tsx","webpack://grafana-metricsdrilldown-app/./App/useReportAppInitialized.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/LayoutSwitcher.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/MetricsSorter/events/EventSortByChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelsDataSource.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelValuesVariable.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/Labels/LabelsVariable.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/custom-icons/GroupsIcon.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsWithLabelValue/MetricsWithLabelValueDataSource.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/isPrometheusRule.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsWithLabelValue/MetricsWithLabelValueVariable.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsGroupByRow.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/GroupBy/MetricsGroupByList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/ListControls/ListControls.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/EventApplyFunction.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/ApplyAction.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/EventConfigureFunction.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/ConfigureAction.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SceneDrawer.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/metricLabels.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/EventSectionValueChanged.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/CheckboxWithCount.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/CheckBoxList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/MetricsFilterSection/MetricsFilterSection.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeMetricSuffixGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeRulesGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/LabelsBrowser/LabelsList.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/LabelsBrowser/LabelsBrowser.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/sections/Settings.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/SideBarButton.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/custom-icons/RulesIcon.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/SideBar/SideBar.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsReducer.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/helpers/registerRuntimeDataSources.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricVizPanel/actions/SelectAction.tsx","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups.ts","webpack://grafana-metricsdrilldown-app/./WingmanDataTrail/MetricsVariables/FilteredMetricsVariable.ts"],"sourcesContent":["import { BusEventWithPayload } from '@grafana/data';\n\nimport { type MetricFilters } from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\n\nexport interface EventFiltersChangedPayload {\n  type: keyof MetricFilters;\n  filters: string[];\n}\n\nexport class EventFiltersChanged extends BusEventWithPayload<EventFiltersChangedPayload> {\n  public static readonly type = 'filters-changed';\n}\n","import { type DataFrame, type FieldConfig, type FieldConfigSource, type TimeRange } from '@grafana/data';\nimport { usePluginLinks } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  VizPanel,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { type DataQuery, type DataSourceRef } from '@grafana/schema';\nimport { IconButton } from '@grafana/ui';\nimport React from 'react';\n\nimport MimirLogo from 'img/logo.svg';\nimport { findObjectOfType } from 'utils';\n\nimport pluginJson from '../plugin.json';\nimport { VAR_DATASOURCE_EXPR } from '../shared';\nimport { isSceneQueryRunner } from '../utils/utils.queries';\n\nexport const investigationsPluginId = 'grafana-investigations-app';\nexport const extensionPointId = `${pluginJson.id}/investigation/v1`;\nexport const addToExplorationsButtonLabel = 'add panel to exploration';\n\nexport interface AddToExplorationButtonState extends SceneObjectState {\n  frame?: DataFrame;\n  dsUid?: string;\n  labelName?: string;\n  fieldName?: string;\n  context?: ExtensionContext;\n\n  queries: DataQuery[];\n  fieldConfig?: FieldConfigSource;\n}\n\ninterface ExtensionContext {\n  timeRange: TimeRange;\n  queries: DataQuery[];\n  datasource: DataSourceRef;\n  origin: string;\n  url: string;\n  type: string;\n  title: string;\n  id: string;\n  logoPath: string;\n  note?: string;\n  drillDownLabel?: string;\n}\n\nexport class AddToExplorationButton extends SceneObjectBase<AddToExplorationButtonState> {\n  constructor(state: Omit<AddToExplorationButtonState, 'queries'>) {\n    super({ ...state, queries: [] });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate = () => {\n    this._subs.add(\n      this.subscribeToState(() => {\n        this.getQueries();\n        this.getContext();\n      })\n    );\n\n    const datasourceUid = sceneGraph.interpolate(this, VAR_DATASOURCE_EXPR);\n    this.setState({ dsUid: datasourceUid });\n  };\n\n  private readonly getQueries = () => {\n    const data = sceneGraph.getData(this);\n    const queryRunner = sceneGraph.findObject(data, isSceneQueryRunner);\n\n    if (isSceneQueryRunner(queryRunner)) {\n      const filter = this.state.frame ? getFilter(this.state.frame) : null;\n      const queries = queryRunner.state.queries.map((q) => ({\n        ...q,\n        expr: sceneGraph.interpolate(queryRunner, q.expr),\n        legendFormat: filter?.name ? `{{ ${filter.name} }}` : sceneGraph.interpolate(queryRunner, q.legendFormat),\n      }));\n\n      if (JSON.stringify(queries) !== JSON.stringify(this.state.queries)) {\n        this.setState({ queries });\n      }\n    }\n  };\n\n  private getPanelConfigAndDataFrames() {\n    const panel = findObjectOfType(this, (o) => o instanceof VizPanel, VizPanel);\n    const data = sceneGraph.getData(this);\n\n    return {\n      fieldConfig: panel?.state.fieldConfig,\n      frames: data?.state.data?.series,\n    };\n  }\n\n  private readonly updateFieldConfigOverrides = () => {\n    const { fieldConfig, frames } = this.getPanelConfigAndDataFrames();\n\n    if (!fieldConfig || !frames?.length) {\n      return undefined;\n    }\n\n    for (const frame of frames) {\n      for (const field of frame.fields) {\n        const configKeys = Object.keys(field.config);\n        const properties = configKeys.map((key) => ({\n          id: key,\n          value: field.config[key as keyof FieldConfig],\n        }));\n\n        // check if the override already exists\n        const existingOverride = fieldConfig.overrides.find(\n          (o) =>\n            o.matcher.options === (field.config.displayNameFromDS ?? field.config.displayName ?? field.name) &&\n            o.matcher.id === 'byName'\n        );\n\n        if (!existingOverride) {\n          // add as first override\n          fieldConfig.overrides.unshift({\n            matcher: {\n              id: 'byName',\n              options: field.config.displayNameFromDS ?? field.config.displayName ?? field.name,\n            },\n            properties,\n          });\n        }\n\n        if (existingOverride && JSON.stringify(existingOverride.properties) !== JSON.stringify(properties)) {\n          existingOverride.properties = properties;\n        }\n      }\n    }\n\n    return fieldConfig;\n  };\n\n  private readonly getContext = () => {\n    const fieldConfig = this.updateFieldConfigOverrides();\n    const { queries, dsUid, labelName, fieldName } = this.state;\n    const timeRange = sceneGraph.getTimeRange(this);\n\n    if (!timeRange || !queries || !dsUid) {\n      return;\n    }\n    const ctx = {\n      origin: 'Metrics Drilldown',\n      type: 'timeseries',\n      queries,\n      timeRange: { ...timeRange.state.value },\n      datasource: { uid: dsUid },\n      url: window.location.href,\n      id: `${JSON.stringify(queries)}${labelName}${fieldName}`,\n      title: labelName + (fieldName ? ` > ${fieldName}` : ''),\n      logoPath: MimirLogo,\n      drillDownLabel: fieldName,\n      fieldConfig,\n    };\n    if (JSON.stringify(ctx) !== JSON.stringify(this.state.context)) {\n      this.setState({ context: ctx });\n    }\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<AddToExplorationButton>) => {\n    const { context } = model.useState();\n    const { links } = usePluginLinks({ extensionPointId, context, limitPerPlugin: 1 });\n    const link = links.find((link) => link.pluginId === investigationsPluginId);\n\n    if (!link) {\n      return null;\n    }\n\n    return (\n      <IconButton\n        tooltip={link.description}\n        aria-label={addToExplorationsButtonLabel} // this is overriden by the `tooltip`\n        key={link.id}\n        name={link.icon ?? 'panel-add'}\n        onClick={(e) => {\n          if (link.onClick) {\n            link.onClick(e);\n          }\n        }}\n      />\n    );\n  };\n}\n\nconst getFilter = (frame: DataFrame) => {\n  const filterNameAndValueObj = frame.fields[1]?.labels ?? {};\n  const keys = Object.keys(filterNameAndValueObj);\n  if (keys.length !== 1) {\n    return;\n  }\n  const name = keys[0];\n  return { name, value: filterNameAndValueObj[name] };\n};\n","import { type DataFrame, type PanelMenuItem, type PluginExtensionLink } from '@grafana/data';\nimport { config, getObservablePluginLinks } from '@grafana/runtime';\nimport {\n  getExploreURL,\n  sceneGraph,\n  SceneObjectBase,\n  VizPanel,\n  VizPanelMenu,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport React from 'react';\nimport { firstValueFrom } from 'rxjs';\n\nimport { logger } from 'tracking/logger/logger';\n\nimport { AddToExplorationButton, extensionPointId } from './AddToExplorationsButton';\nimport { getQueryRunnerFor } from '../utils/utils.queries';\n\nconst ADD_TO_INVESTIGATION_MENU_TEXT = 'Add to investigation';\nconst ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT = 'investigations_divider'; // Text won't be visible\nconst ADD_TO_INVESTIGATION_MENU_GROUP_TEXT = 'Investigations';\n\ninterface PanelMenuState extends SceneObjectState {\n  body?: VizPanelMenu;\n  frame?: DataFrame;\n  labelName?: string;\n  fieldName?: string;\n  addExplorationsLink?: boolean;\n  explorationsButton?: AddToExplorationButton;\n}\n\n/**\n * @todo the VizPanelMenu interface is overly restrictive, doesn't allow any member functions on this class, so everything is currently inlined\n */\nexport class PanelMenu extends SceneObjectBase<PanelMenuState> implements VizPanelMenu, SceneObject {\n  constructor(state: Partial<PanelMenuState>) {\n    super({ ...state, addExplorationsLink: state.addExplorationsLink ?? true });\n    this.addActivationHandler(() => {\n      let exploreUrl: Promise<string | undefined> | undefined;\n      try {\n        const viz = sceneGraph.getAncestor(this, VizPanel);\n        const panelData = sceneGraph.getData(viz).state.data;\n        if (!panelData) {\n          throw new Error('Cannot get link to explore, no panel data found');\n        }\n        const queryRunner = getQueryRunnerFor(viz);\n        const queries = queryRunner?.state.queries ?? [];\n        queries.forEach((query) => {\n          // removing legendFormat to get verbose legend in Explore\n          delete query.legendFormat;\n        });\n        // 'this' scene object contain the variable for the metric name which is correctly interpolated into the explore url\n        // when used in the metric select scene case,\n        // this will get the explore url with interpolated variables and include the labels __ignore_usage__, this is a known issue\n        // in the metric scene we do not get use the __ignore_usage__ labels in the explore url\n        exploreUrl = getExploreURL(panelData, this, panelData.timeRange, (query) => {\n          // remove __ignore_usage__=\"\" from the query\n          if ('expr' in query && typeof query.expr === 'string' && query.expr.includes('__ignore_usage__')) {\n            return {\n              ...query,\n              expr: query.expr.replace(/,?__ignore_usage__=\"\"/, ''), // also remove leading comma if present\n            };\n          }\n\n          return query;\n        });\n      } catch {}\n\n      // Navigation options (all panels)\n      const items: PanelMenuItem[] = [\n        {\n          text: 'Navigation',\n          type: 'group',\n        },\n        {\n          text: 'Explore',\n          iconClassName: 'compass',\n          onClick: () => exploreUrl?.then((url) => url && window.open(url, '_blank')),\n          shortcut: 'p x',\n        },\n      ];\n\n      this.setState({\n        body: new VizPanelMenu({\n          items,\n        }),\n      });\n\n      const addToExplorationsButton = new AddToExplorationButton({\n        labelName: this.state.labelName,\n        fieldName: this.state.fieldName,\n        frame: this.state.frame,\n      });\n      this._subs.add(\n        addToExplorationsButton?.subscribeToState(async () => {\n          await subscribeToAddToExploration(this);\n        })\n      );\n      this.setState({\n        explorationsButton: addToExplorationsButton,\n      });\n\n      if (this.state.addExplorationsLink) {\n        this.state.explorationsButton?.activate();\n      }\n    });\n  }\n\n  addItem(item: PanelMenuItem): void {\n    if (this.state.body) {\n      this.state.body.addItem(item);\n    }\n  }\n\n  setItems(items: PanelMenuItem[]): void {\n    if (this.state.body) {\n      this.state.body.setItems(items);\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<PanelMenu>) => {\n    const { body } = model.useState();\n\n    if (body) {\n      return <body.Component model={body} />;\n    }\n\n    return <></>;\n  };\n}\n\nconst getInvestigationLink = async (addToExplorations: AddToExplorationButton) => {\n  const context = addToExplorations.state.context;\n\n  // Check if we're running on Grafana v11\n  if (config.buildInfo.version.startsWith('11.')) {\n    try {\n      const runtime = await import('@grafana/runtime');\n      const getPluginLinkExtensions = (runtime as any).getPluginLinkExtensions;\n      if (getPluginLinkExtensions !== undefined) {\n        const links = getPluginLinkExtensions({\n          extensionPointId,\n          context,\n        });\n\n        return links.extensions[0];\n      }\n    } catch (e) {\n      // Ignore import error and fall through to v12 implementation\n      logger.error(e as Error, {message: 'Error importing getPluginLinkExtensions'});\n    }\n  }\n\n  // `getObservablePluginLinks` is introduced in Grafana v12\n  if (typeof getObservablePluginLinks === 'function') {\n    const links: PluginExtensionLink[] = await firstValueFrom(\n      getObservablePluginLinks({\n        extensionPointId,\n        context,\n      })\n    );\n\n    return links[0];\n  }\n\n  return undefined;\n};\n\nasync function subscribeToAddToExploration(menu: PanelMenu) {\n  const addToExplorationButton = menu.state.explorationsButton;\n  if (addToExplorationButton) {\n    const link = await getInvestigationLink(addToExplorationButton);\n\n    const existingMenuItems = menu.state.body?.state.items ?? [];\n\n    const existingAddToExplorationLink = existingMenuItems.find((item) => item.text === ADD_TO_INVESTIGATION_MENU_TEXT);\n\n    if (link) {\n      if (!existingAddToExplorationLink) {\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n          type: 'divider',\n        });\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n          type: 'group',\n        });\n        menu.state.body?.addItem({\n          text: ADD_TO_INVESTIGATION_MENU_TEXT,\n          iconClassName: 'plus-square',\n          onClick: (e) => link.onClick && link.onClick(e),\n        });\n      } else {\n        if (existingAddToExplorationLink) {\n          menu.state.body?.setItems(\n            existingMenuItems.filter(\n              (item) =>\n                [\n                  ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_GROUP_TEXT,\n                  ADD_TO_INVESTIGATION_MENU_TEXT,\n                ].includes(item.text) === false\n            )\n          );\n        }\n      }\n    }\n  }\n}\n","import { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React from 'react';\n\nimport { getMetricSceneFor } from '../../utils';\nimport { type AutoQueryDef } from '../types';\n\ninterface QuerySelectorState extends SceneObjectState {\n  queryDef: AutoQueryDef;\n  onChangeQuery: (variant: string) => void;\n  options?: Array<{\n    label: string;\n    value: string;\n  }>;\n}\n\nexport class AutoVizPanelQuerySelector extends SceneObjectBase<QuerySelectorState> {\n  constructor(state: QuerySelectorState) {\n    super(state);\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    const { autoQuery } = getMetricSceneFor(this).state;\n\n    if (autoQuery.variants.length === 0) {\n      return;\n    }\n\n    this.setState({ options: autoQuery.variants.map((q) => ({ label: q.variant, value: q.variant })) });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<AutoVizPanelQuerySelector>) => {\n    const { options, onChangeQuery, queryDef } = model.useState();\n\n    if (!options) {\n      return null;\n    }\n\n    return <RadioButtonGroup size=\"sm\" options={options} value={queryDef.variant} onChange={onChangeQuery} />;\n  };\n}\n","import {\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type VizPanel,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { getMetricDescription } from 'helpers/MetricDatasourceHelper';\n\nimport { PanelMenu } from '../../Menu/PanelMenu';\nimport { MDP_METRIC_OVERVIEW, trailDS } from '../../shared';\nimport { getMetricSceneFor, getTrailFor } from '../../utils';\nimport { type AutoQueryDef } from '../types';\nimport { AutoVizPanelQuerySelector } from './AutoVizPanelQuerySelector';\n\nexport interface AutoVizPanelState extends SceneObjectState {\n  panel?: VizPanel;\n  metric?: string;\n}\n\nexport class AutoVizPanel extends SceneObjectBase<AutoVizPanelState> {\n  constructor(state: AutoVizPanelState) {\n    super(state);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  public onActivate() {\n    if (!this.state.panel) {\n      const { autoQuery, metric } = getMetricSceneFor(this).state;\n\n      this.getVizPanelFor(autoQuery.main, metric).then((panel) =>\n        this.setState({\n          panel,\n          metric,\n        })\n      );\n    }\n  }\n\n  public onChangeQuery = (variant: string) => {\n    const metricScene = getMetricSceneFor(this);\n\n    const def = metricScene.state.autoQuery.variants.find((q) => q.variant === variant)!;\n\n    this.getVizPanelFor(def).then((panel) => this.setState({ panel }));\n    metricScene.setState({ queryDef: def });\n  };\n\n  private async getVizPanelFor(def: AutoQueryDef, metric?: string) {\n    const trail = getTrailFor(this);\n    const metadata = await trail.getMetricMetadata(metric);\n    const description = getMetricDescription(metadata);\n\n    return def\n      .vizBuilder()\n      .setData(\n        new SceneQueryRunner({\n          datasource: trailDS,\n          maxDataPoints: MDP_METRIC_OVERVIEW,\n          queries: def.queries,\n        })\n      )\n      .setDescription(description)\n      .setHeaderActions([new AutoVizPanelQuerySelector({ queryDef: def, onChangeQuery: this.onChangeQuery })])\n      .setShowMenuAlways(true)\n      .setMenu(new PanelMenu({ labelName: metric ?? this.state.metric }))\n      .build();\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<AutoVizPanel>) => {\n    const { panel } = model.useState();\n\n    if (!panel) {\n      return;\n    }\n    return <panel.Component model={panel} />;\n  };\n}\n","export const UI_TEXT = {\n  SEARCH: {\n    TITLE: 'Search metrics',\n  },\n  METRIC_SELECT_SCENE: {\n    OPEN_EXPLORE_LABEL: 'Open in explore',\n    COPY_URL_LABEL: 'Copy url',\n    BOOKMARK_LABEL: 'Bookmark',\n    SELECT_NEW_METRIC_TOOLTIP: 'Remove existing metric and choose a new metric',\n  },\n};\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  behaviors,\n  SceneFlexItem,\n  SceneFlexLayout,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { MetricActionBar } from 'MetricActionBar';\n\nimport { AutoVizPanel } from './autoQuery/components/AutoVizPanel';\nimport { getTrailFor, getTrailSettings } from './utils';\n\nexport const MAIN_PANEL_MIN_HEIGHT = 280;\nexport const MAIN_PANEL_MAX_HEIGHT = '40%';\nexport const METRIC_AUTOVIZPANEL_KEY = 'metric-graph';\n\nexport interface MetricGraphSceneState extends SceneObjectState {\n  topView: SceneFlexLayout;\n  selectedTab?: SceneObject;\n}\n\nexport class MetricGraphScene extends SceneObjectBase<MetricGraphSceneState> {\n  public constructor(state: Partial<MetricGraphSceneState>) {\n    super({\n      topView: state.topView ?? buildGraphTopView(),\n      ...state,\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricGraphScene>) => {\n    const { topView, selectedTab } = model.useState();\n    const { stickyMainGraph } = getTrailSettings(model).useState();\n    const chromeHeaderHeight = useChromeHeaderHeight();\n    const trail = getTrailFor(model);\n    const styles = useStyles2(getStyles, trail.state.embedded ? 0 : chromeHeaderHeight ?? 0);\n\n    return (\n      <div className={styles.container}>\n        <div className={stickyMainGraph ? styles.sticky : styles.nonSticky} data-testid=\"top-view\">\n          <topView.Component model={topView} />\n        </div>\n        {selectedTab && (\n          <div data-testid=\"tab-content\">\n            <selectedTab.Component model={selectedTab} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2, chromeHeaderHeight: number) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      position: 'relative',\n      flexGrow: 1,\n    }),\n    sticky: css({\n      display: 'flex',\n      flexDirection: 'row',\n      background: theme.isLight ? theme.colors.background.primary : theme.colors.background.canvas,\n      position: 'sticky',\n      paddingTop: theme.spacing(1),\n      marginTop: `-${theme.spacing(1)}`,\n      top: `${chromeHeaderHeight + 70}px`,\n      zIndex: 10,\n    }),\n    nonSticky: css({\n      display: 'flex',\n      flexDirection: 'row',\n    }),\n  };\n}\n\nfunction buildGraphTopView() {\n  return new SceneFlexLayout({\n    direction: 'column',\n    $behaviors: [new behaviors.CursorSync({ key: 'metricCrosshairSync', sync: DashboardCursorSync.Crosshair })],\n    children: [\n      new SceneFlexItem({\n        minHeight: MAIN_PANEL_MIN_HEIGHT,\n        maxHeight: MAIN_PANEL_MAX_HEIGHT,\n        body: new AutoVizPanel({ key: METRIC_AUTOVIZPANEL_KEY }),\n      }),\n      new SceneFlexItem({\n        ySizing: 'content',\n        body: new MetricActionBar({}),\n      }),\n    ],\n  });\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Combobox, Icon, InlineField, InlineLabel, Tooltip, useStyles2, type ComboboxOption } from '@grafana/ui';\nimport React from 'react';\n\nimport { computeMetricPrefixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups';\nimport { VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport { getMultiVariableValues } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { EventFiltersChanged } from 'WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged';\n\ninterface PrefixFilterDropdownState extends SceneObjectState {\n  loading: boolean;\n  error: Error | null;\n  options: ComboboxOption[];\n  value: string;\n}\n\nconst METRIC_PREFIX_ALL_OPTION = {\n  label: 'All metric names',\n  value: 'all',\n};\n\nexport class PrefixFilterDropdown extends SceneObjectBase<PrefixFilterDropdownState> {\n  protected _variableDependency: VariableDependencyConfig<PrefixFilterDropdownState> = new VariableDependencyConfig(\n    this,\n    {\n      variableNames: [VAR_METRICS_VARIABLE],\n      onVariableUpdateCompleted: () => this.parseMetricPrefixes(),\n    }\n  );\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['metricPrefix'] });\n\n  getUrlState() {\n    return { metricPrefix: this.state.value };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    if (typeof values.metricPrefix === 'string') {\n      if (this.state.value !== values.metricPrefix) {\n        this.setState({ value: values.metricPrefix });\n      }\n      return;\n    }\n\n    this.setState({ value: METRIC_PREFIX_ALL_OPTION.value });\n  }\n\n  constructor(state: Partial<PrefixFilterDropdownState>) {\n    super({\n      ...state,\n      key: 'related-prefix-filter',\n      loading: true,\n      error: null,\n      options: [METRIC_PREFIX_ALL_OPTION],\n      value: METRIC_PREFIX_ALL_OPTION.value,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.parseMetricPrefixes();\n  }\n\n  private parseMetricPrefixes() {\n    if (this._variableDependency.hasDependencyInLoadingState()) {\n      this.setState({ error: undefined, loading: true });\n      return;\n    }\n\n    const filteredMetricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MultiValueVariable;\n\n    if (filteredMetricsVariable.state.error) {\n      this.setState({\n        error: filteredMetricsVariable.state.error,\n        loading: false,\n        options: [],\n      });\n      return;\n    }\n\n    const prefixGroups = computeMetricPrefixGroups(\n      getMultiVariableValues(filteredMetricsVariable) as Array<{ label: string; value: string }>\n    );\n\n    const newOptions = [\n      METRIC_PREFIX_ALL_OPTION,\n      ...prefixGroups.map((g) => ({\n        value: g.value,\n        label: `${g.label} (${g.count})`,\n      })),\n    ];\n\n    const { value } = this.state;\n    const newValue = newOptions.find((o) => o.value === value) ? (value as string) : METRIC_PREFIX_ALL_OPTION.value;\n\n    this.setState({\n      error: null,\n      loading: false,\n      options: newOptions,\n    });\n\n    this.selectOption({ value: newValue, label: newValue });\n  }\n\n  private selectOption = (option: ComboboxOption | null) => {\n    const value = option === null ? METRIC_PREFIX_ALL_OPTION.value : option.value;\n\n    this.setState({ value });\n\n    this.publishEvent(\n      new EventFiltersChanged({\n        type: 'prefixes',\n        filters: value === METRIC_PREFIX_ALL_OPTION.value ? [] : [value],\n      }),\n      true\n    );\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<PrefixFilterDropdown>) => {\n    const styles = useStyles2(getStyles);\n    const { loading, options, value, error } = model.useState();\n\n    return (\n      <div className={styles.container} data-testid=\"prefix-filter-selector\">\n        <InlineField\n          disabled={loading}\n          error={error && error.toString()}\n          label={\n            <InlineLabel width=\"auto\" className={styles.label}>\n              <span>View by</span>\n              <Tooltip\n                content=\"View by the metric prefix. A metric prefix is a single word at the beginning of the metric name, relevant to the domain the metric belongs to.\"\n                placement=\"top\"\n              >\n                <Icon className={styles.tooltipIcon} name=\"info-circle\" size=\"sm\" />\n              </Tooltip>\n            </InlineLabel>\n          }\n        >\n          <Combobox value={value} onChange={model.selectOption} options={options} />\n        </InlineField>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css`\n      display: flex;\n\n      & > div {\n        margin: 0;\n      }\n    `,\n\n    label: css`\n      margin-right: 0;\n      background-color: ${theme.colors.background.primary};\n      border: 1px solid ${theme.colors.border.medium};\n      border-right: 0 none;\n      border-top-right-radius: 0;\n      border-bottom-right-radius: 0;\n    `,\n    tooltipIcon: css`\n      margin-left: ${theme.spacing(0.5)};\n    `,\n  };\n}\n","import { css } from '@emotion/css';\nimport { type SelectableValue } from '@grafana/data';\nimport {\n  EmbeddedScene,\n  SceneFlexItem,\n  SceneFlexLayout,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneReactObject,\n  type SceneVariableSet,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { LayoutSwitcher } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\nimport { VAR_FILTERED_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\n\nimport { PrefixFilterDropdown } from './PrefixFilterDropdown';\n\ninterface RelatedListControlsState extends SceneObjectState {\n  $variables?: SceneVariableSet;\n  inputControls?: SceneReactObject;\n  onChange?: (value: SelectableValue<string>) => void; // Keeping for backward compatibility\n}\n\nexport class RelatedListControls extends EmbeddedScene {\n  constructor(state: Partial<RelatedListControlsState>) {\n    super({\n      ...state,\n      key: 'related-list-controls',\n      body: new SceneFlexLayout({\n        direction: 'row',\n        width: '100%',\n        maxHeight: '32px',\n        children: [\n          new SceneFlexItem({\n            width: 'auto',\n            body: new PrefixFilterDropdown({}),\n          }),\n          new SceneFlexItem({\n            body: new QuickSearch({\n              urlSearchParamName: 'gmd-relatedSearchText',\n              targetName: 'related metric',\n              variableNames: {\n                nonFiltered: VAR_METRICS_VARIABLE,\n                filtered: VAR_FILTERED_METRICS_VARIABLE,\n              },\n              displayCounts: true,\n            }),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new LayoutSwitcher(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<RelatedListControls>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div className={styles.headerWrapper} data-testid=\"related-list-controls\">\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    headerWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      '& > div': {\n        display: 'flex',\n        alignItems: 'center',\n        '& > div': {\n          display: 'flex',\n          alignItems: 'center',\n        },\n      },\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventQuickSearchChanged } from 'WingmanDataTrail/ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from 'WingmanDataTrail/ListControls/QuickSearch/QuickSearch';\nimport { MetricsList } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { EventMetricsVariableActivated } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from 'WingmanDataTrail/MetricsVariables/EventMetricsVariableLoaded';\nimport {\n  FilteredMetricsVariable,\n  VAR_FILTERED_METRICS_VARIABLE,\n} from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { MetricsVariable } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport {\n  MetricsVariableFilterEngine,\n  type MetricFilters,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\nimport { MetricsVariableSortEngine } from 'WingmanDataTrail/MetricsVariables/MetricsVariableSortEngine';\nimport { EventFiltersChanged } from 'WingmanDataTrail/SideBar/sections/MetricsFilterSection/EventFiltersChanged';\n\nimport { RelatedListControls } from './RelatedListControls';\n\ninterface RelatedMetricsSceneState extends SceneObjectState {\n  metric: string;\n  body: MetricsList;\n  listControls: RelatedListControls;\n}\n\nexport class RelatedMetricsScene extends SceneObjectBase<RelatedMetricsSceneState> {\n  constructor({ metric }: { metric: RelatedMetricsSceneState['metric'] }) {\n    super({\n      metric,\n      $variables: new SceneVariableSet({\n        variables: [new MetricsVariable(), new FilteredMetricsVariable()],\n      }),\n      key: 'RelatedMetricsScene',\n      body: new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }),\n      listControls: new RelatedListControls({}),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToEvents();\n  }\n\n  private subscribeToEvents() {\n    this.initVariablesFilteringAndSorting();\n  }\n\n  /**\n   * The centralized filtering mechanism implemented here is decoupled via the usage of events.\n   * In order to work, the variables to be filtered/sorted must emit lifecycle events.\n   * This is done via the `withLifecycleEvents` decorator function.\n   *\n   * For example, check the `FilteredMetricsVariable` class.\n   */\n  private initVariablesFilteringAndSorting() {\n    const { metric } = this.state;\n\n    const enginesMap = new Map<\n      string,\n      { filterEngine: MetricsVariableFilterEngine; sortEngine: MetricsVariableSortEngine }\n    >();\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableActivated, (event) => {\n        // register engines\n        const { key } = event.payload;\n        const filteredMetricsVariable = sceneGraph.findByKey(this, key) as QueryVariable;\n\n        enginesMap.set(key, {\n          filterEngine: new MetricsVariableFilterEngine(filteredMetricsVariable),\n          sortEngine: new MetricsVariableSortEngine(filteredMetricsVariable),\n        });\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableDeactivated, (event) => {\n        // unregister engines\n        enginesMap.delete(event.payload.key);\n      })\n    );\n\n    const quickSearch = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch);\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableLoaded, (event) => {\n        // filter  on initial load\n        const { key, options } = event.payload;\n        const { filterEngine, sortEngine } = enginesMap.get(key)!;\n\n        filterEngine.setInitOptions(options);\n\n        const filters: Partial<MetricFilters> = {\n          names: quickSearch.state.value ? [quickSearch.state.value] : [],\n        };\n\n        filterEngine.applyFilters(filters, { forceUpdate: true, notify: false });\n        sortEngine.sort('related', { metric });\n      })\n    );\n\n    /* Filters */\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const { searchText } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of enginesMap) {\n          filterEngine.applyFilters({ names: searchText ? [searchText] : [] });\n          sortEngine.sort('related', { metric });\n        }\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventFiltersChanged, (event) => {\n        const { type, filters } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of enginesMap) {\n          filterEngine.applyFilters({ [type]: filters });\n          sortEngine.sort('related', { metric });\n        }\n      })\n    );\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<RelatedMetricsScene>) => {\n    const styles = useStyles2(getStyles);\n    const { $variables, body, listControls } = model.useState();\n\n    return (\n      <>\n        <div className={styles.listControls}>\n          <listControls.Component model={listControls} />\n        </div>\n        <div className={styles.body}>\n          <div className={styles.list} data-testid=\"panels-list\">\n            <body.Component model={body} />\n          </div>\n        </div>\n        <div className={styles.variables}>\n          {$variables?.state.variables.map((variable) => (\n            <variable.Component key={variable.state.name} model={variable} />\n          ))}\n        </div>\n      </>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    body: css({}),\n    list: css({}),\n    listControls: css({\n      margin: theme.spacing(1, 0, 1.5, 0),\n    }),\n    variables: css({\n      display: 'none',\n    }),\n  };\n}\n","import { config } from '@grafana/runtime';\nimport { ToolbarButton } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { PLUGIN_BASE_URL } from './constants';\nimport { UI_TEXT } from './constants/ui';\nimport { type DataTrail } from './DataTrail';\nimport { reportExploreMetrics } from './interactions';\nimport { getUrlForTrail } from './utils';\n\ninterface ShareTrailButtonState {\n  trail: DataTrail;\n}\n\nconst COPY_LABEL = UI_TEXT.METRIC_SELECT_SCENE.COPY_URL_LABEL;\n\nexport const ShareTrailButton = ({ trail }: ShareTrailButtonState) => {\n  const [tooltip, setTooltip] = useState(COPY_LABEL);\n\n  const onShare = () => {\n    if (navigator.clipboard) {\n      reportExploreMetrics('selected_metric_action_clicked', { action: 'share_url' });\n      const appUrl = config.appUrl.endsWith('/') ? config.appUrl.slice(0, -1) : config.appUrl;\n      const url = `${appUrl}${PLUGIN_BASE_URL}/${getUrlForTrail(trail)}`;\n      navigator.clipboard.writeText(url);\n      setTooltip('Copied!');\n      setTimeout(() => {\n        setTooltip(COPY_LABEL);\n      }, 2000);\n    }\n  };\n\n  return <ToolbarButton variant={'canvas'} icon={'share-alt'} tooltip={tooltip} onClick={onShare} />;\n};\n","import { VAR_FILTERS_EXPR, VAR_METRIC_EXPR } from '../../shared';\n\n// For usual non-utf8-metrics we use filters in the curly braces\n// metric_name{filter_label=\"filter_value\"}\nconst BASE_QUERY_TEMPLATE = `${VAR_METRIC_EXPR}{${VAR_FILTERS_EXPR}}`;\nconst RATE_BASE_QUERY_TEMPLATE = `rate(${BASE_QUERY_TEMPLATE}[$__rate_interval])`;\n\n// For utf8 metrics we need to put the metric name inside curly braces with filters\n// {\"utf8.metric\", filter_label=\"filter_val\"}\nconst BASE_QUERY_UTF8_METRIC_TEMPLATE = `{\"${VAR_METRIC_EXPR}\", ${VAR_FILTERS_EXPR}}`;\nconst RATE_BASE_QUERY_UTF8_METRIC_TEMPLATE = `rate(${BASE_QUERY_UTF8_METRIC_TEMPLATE}[$__rate_interval])`;\n\nexport function generateBaseQuery({\n  isRateQuery = false,\n  groupings = [],\n  isUtf8Metric = false,\n}: {\n  isRateQuery?: boolean;\n  groupings?: string[];\n  isUtf8Metric?: boolean;\n}): string {\n  // Determine base query template\n  let baseQuery;\n\n  if (isUtf8Metric) {\n    baseQuery = isRateQuery ? RATE_BASE_QUERY_UTF8_METRIC_TEMPLATE : BASE_QUERY_UTF8_METRIC_TEMPLATE;\n  } else {\n    baseQuery = isRateQuery ? RATE_BASE_QUERY_TEMPLATE : BASE_QUERY_TEMPLATE;\n  }\n\n  // Apply groupings (e.g., `sum by(le, instance)`)\n  if (groupings.length > 0) {\n    return `sum by(${groupings.join(', ')}) (${baseQuery})`;\n  }\n\n  return `${baseQuery}`;\n}\n","import { PanelBuilders } from '@grafana/scenes';\nimport { SortOrder, TooltipDisplayMode } from '@grafana/schema';\nimport { HeatmapColorMode } from '@grafana/schema/dist/esm/raw/composable/heatmap/panelcfg/x/HeatmapPanelCfg_types.gen';\n\nexport type CommonVizParams = {\n  title: string;\n  unit: string;\n};\n\nexport function simpleGraphBuilder({ title, unit }: CommonVizParams) {\n  return PanelBuilders.timeseries() //\n    .setTitle(title)\n    .setUnit(unit)\n    .setOption('legend', { showLegend: false })\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .setCustomFieldConfig('fillOpacity', 9);\n}\n\nexport function heatmapGraphBuilder({ title, unit }: CommonVizParams) {\n  return PanelBuilders.heatmap() //\n    .setTitle(title)\n    .setUnit(unit)\n    .setOption('calculate', false)\n    .setOption('color', {\n      mode: HeatmapColorMode.Scheme,\n      exponent: 0.5,\n      scheme: 'Spectral',\n      steps: 32,\n      reverse: false,\n    });\n}\n\nexport function percentilesGraphBuilder({ title, unit }: CommonVizParams) {\n  return PanelBuilders.timeseries()\n    .setTitle(title)\n    .setUnit(unit)\n    .setCustomFieldConfig('fillOpacity', 9)\n    .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n    .setOption('legend', { showLegend: false });\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { simpleGraphBuilder } from '../graphBuilders';\nimport { type AutoQueryInfo } from '../types';\n\nexport type CommonQueryInfoParams = {\n  description: string;\n  mainQueryExpr: string;\n  breakdownQueryExpr: string;\n  unit: string;\n};\n\nexport function generateCommonAutoQueryInfo({\n  description,\n  mainQueryExpr,\n  breakdownQueryExpr,\n  unit,\n}: CommonQueryInfoParams): AutoQueryInfo {\n  const common = {\n    title: VAR_METRIC_EXPR,\n    unit,\n  };\n\n  const mainQuery = {\n    refId: 'A',\n    expr: mainQueryExpr,\n    legendFormat: description,\n    fromExploreMetrics: true,\n  };\n\n  const main = {\n    ...common,\n    title: description,\n    queries: [mainQuery],\n    variant: 'main',\n    vizBuilder: () => simpleGraphBuilder({ ...main }),\n  };\n\n  const preview = {\n    ...common,\n    queries: [{ ...mainQuery, legendFormat: description }],\n    vizBuilder: () => simpleGraphBuilder(preview),\n    variant: 'preview',\n  };\n\n  const breakdown = {\n    ...common,\n    queries: [\n      {\n        refId: 'A',\n        expr: breakdownQueryExpr,\n        legendFormat: `{{${VAR_GROUP_BY_EXP}}}`,\n        fromExploreMetrics: true,\n      },\n    ],\n    vizBuilder: () => simpleGraphBuilder(breakdown),\n    variant: 'breakdown',\n  };\n\n  return { preview, main, breakdown, variants: [] };\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { type AutoQueryContext, type AutoQueryInfo } from '../types';\nimport { getPerSecondRateUnit, getUnit } from '../units';\nimport { generateBaseQuery } from './baseQuery';\nimport { generateCommonAutoQueryInfo } from './common';\n\nconst RATE_SUFFIXES = new Set(['count', 'total']);\nconst SPECIFIC_AGGREGATIONS_FOR_SUFFIX: Record<string, string> = {\n  count: 'sum',\n  total: 'sum',\n};\nconst aggLabels: Record<string, string> = {\n  avg: 'average',\n  sum: 'overall',\n};\n\nfunction getAggLabel(agg: string): string {\n  return aggLabels[agg] || agg;\n}\n\nexport function createDefaultMetricQueryDefs(context: AutoQueryContext): AutoQueryInfo {\n  const { metricParts, suffix, isUtf8Metric } = context;\n  const unitSuffix = suffix === 'total' ? metricParts.at(-2) : suffix;\n\n  // Determine query type and unit\n  const isRateQuery = RATE_SUFFIXES.has(suffix);\n  const aggregation = SPECIFIC_AGGREGATIONS_FOR_SUFFIX[suffix] || 'avg';\n  const unit = isRateQuery ? getPerSecondRateUnit(unitSuffix) : getUnit(unitSuffix);\n\n  // Generate base query and descriptions\n  const baseQuery = generateBaseQuery({ isRateQuery, isUtf8Metric });\n  const aggregationDescription = `${getAggLabel(aggregation)}${isRateQuery ? ' per-second rate' : ''}`;\n  const description = `${VAR_METRIC_EXPR} (${aggregationDescription})`;\n\n  // Create query expressions\n  const mainQueryExpr = `${aggregation}(${baseQuery})`;\n  const breakdownQueryExpr = `${aggregation}(${baseQuery})by(${VAR_GROUP_BY_EXP})`;\n\n  return generateCommonAutoQueryInfo({\n    description,\n    mainQueryExpr,\n    breakdownQueryExpr,\n    unit,\n  });\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { heatmapGraphBuilder, percentilesGraphBuilder, simpleGraphBuilder } from '../graphBuilders';\nimport { type AutoQueryContext, type AutoQueryDef } from '../types';\nimport { generateBaseQuery } from './baseQuery';\n\nexport function createHistogramMetricQueryDefs(context: AutoQueryContext) {\n  const { unit, nativeHistogram } = context;\n\n  const common = {\n    title: VAR_METRIC_EXPR,\n    unit,\n  };\n\n  const p50: AutoQueryDef = {\n    ...common,\n    variant: 'p50',\n    queries: [percentileQuery(context, 50)],\n    vizBuilder: () => simpleGraphBuilder(p50),\n  };\n\n  const breakdown: AutoQueryDef = {\n    ...common,\n    variant: 'p50',\n    queries: [percentileQuery(context, 50, [VAR_GROUP_BY_EXP])],\n    vizBuilder: () => simpleGraphBuilder(breakdown),\n  };\n\n  const percentiles: AutoQueryDef = {\n    ...common,\n    variant: 'percentiles',\n    queries: [99, 90, 50].map((p) => percentileQuery(context, p)),\n    vizBuilder: () => percentilesGraphBuilder(percentiles),\n  };\n\n  const heatmap: AutoQueryDef = {\n    ...common,\n    variant: 'heatmap',\n    queries: [\n      {\n        refId: 'Heatmap',\n        expr: generateBaseQuery({\n          isRateQuery: true,\n          isUtf8Metric: context.isUtf8Metric,\n          groupings: nativeHistogram ? [] : ['le'],\n        }),\n        fromExploreMetrics: true,\n        format: 'heatmap',\n      },\n    ],\n    vizBuilder: () => heatmapGraphBuilder(heatmap),\n  };\n\n  return { preview: heatmap, main: heatmap, variants: [percentiles, heatmap], breakdown: breakdown };\n}\n\nfunction percentileQuery(context: AutoQueryContext, percentile: number, groupings: string[] = []) {\n  const percent = percentile / 100;\n\n  let legendFormat = `${percentile}th Percentile`;\n\n  // For the breakdown view, show the label value variable we are grouping by\n  if (groupings[0]) {\n    legendFormat = `{{${groupings[0]}}}`;\n  }\n\n  const query = generateBaseQuery({\n    isRateQuery: true,\n    isUtf8Metric: context.isUtf8Metric,\n    groupings: context.nativeHistogram ? [...groupings] : ['le', ...groupings],\n  });\n\n  return {\n    refId: `Percentile${percentile}`,\n    expr: `histogram_quantile(${percent}, ${query})`,\n    legendFormat,\n    fromExploreMetrics: true,\n  };\n}\n","import { VAR_GROUP_BY_EXP, VAR_METRIC_EXPR } from '../../shared';\nimport { type AutoQueryContext, type AutoQueryInfo } from '../types';\nimport { generateBaseQuery } from './baseQuery';\nimport { generateCommonAutoQueryInfo } from './common';\n\nexport function createSummaryMetricQueryDefs(context: AutoQueryContext): AutoQueryInfo {\n  const { metricParts, isUtf8Metric, unit } = context;\n  const subMetric = metricParts.slice(0, -1).join('_');\n  const description = `${subMetric} (average)`;\n  const baseQuery = generateBaseQuery({ isRateQuery: true, isUtf8Metric });\n  const mainQueryExpr = createMeanExpr(`sum(${baseQuery})`, subMetric);\n  const breakdownQueryExpr = createMeanExpr(`sum(${baseQuery})by(${VAR_GROUP_BY_EXP})`, subMetric);\n\n  return generateCommonAutoQueryInfo({\n    description,\n    mainQueryExpr,\n    breakdownQueryExpr,\n    unit,\n  });\n}\n\nfunction createMeanExpr(expr: string, subMetric: string): string {\n  const numerator = expr.replace(VAR_METRIC_EXPR, `${subMetric}_sum`);\n  const denominator = expr.replace(VAR_METRIC_EXPR, `${subMetric}_count`);\n  return `${numerator}/${denominator}`;\n}\n","import { isValidLegacyName } from '@grafana/prometheus';\n\nimport { createDefaultMetricQueryDefs } from './queryGenerators/default';\nimport { createHistogramMetricQueryDefs } from './queryGenerators/histogram';\nimport { createSummaryMetricQueryDefs } from './queryGenerators/summary';\nimport { type AutoQueryContext, type AutoQueryInfo } from './types';\nimport { getUnit } from './units';\n\nexport function getAutoQueriesForMetric(metric: string, nativeHistogram?: boolean): AutoQueryInfo {\n  const isUtf8Metric = !isValidLegacyName(metric);\n  const metricParts = metric.split('_');\n  const suffix = metricParts.at(-1);\n\n  // If the suffix is null or is in the set of unsupported suffixes, throw an error because the metric should be delegated to a different generator (summary or histogram)\n  if (suffix == null) {\n    throw new Error(`This function does not support a metric suffix of \"${suffix}\"`);\n  }\n\n  const unitSuffix = metricParts.at(-2);\n  const unit = getUnit(unitSuffix);\n  const ctx: AutoQueryContext = {\n    metricParts,\n    isUtf8Metric,\n    suffix,\n    unitSuffix,\n    unit,\n    nativeHistogram,\n  };\n\n  if (suffix === 'sum') {\n    return createSummaryMetricQueryDefs(ctx);\n  }\n\n  if (suffix === 'bucket' || nativeHistogram) {\n    return createHistogramMetricQueryDefs(ctx);\n  }\n\n  return createDefaultMetricQueryDefs(ctx);\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport { Combobox, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype Props = {\n  options: Array<SelectableValue<string>>;\n  value?: string;\n  onChange: (label: string | undefined) => void;\n};\n\nexport function BreakdownLabelSelector({ options, value, onChange }: Readonly<Props>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.select} data-testid=\"breakdown-label-selector\">\n      <Combobox\n        options={options.map((opt) => ({ label: opt.label || '', value: opt.value || '' }))}\n        value={value || ''}\n        onChange={(selected) => onChange(selected?.value)}\n        width={16}\n      />\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    select: css({\n      maxWidth: theme.spacing(16),\n    }),\n  };\n}\n","import { type DataFrame } from '@grafana/data';\nimport { sceneGraph, SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { getTrailFor } from '../utils';\nimport { isAdHocFiltersVariable } from '../utils/utils.variables';\n\nexport interface AddToFiltersGraphActionState extends SceneObjectState {\n  frame: DataFrame;\n}\n\nexport class AddToFiltersGraphAction extends SceneObjectBase<AddToFiltersGraphActionState> {\n  public onClick = () => {\n    const variable = sceneGraph.lookupVariable('filters', this);\n    if (!isAdHocFiltersVariable(variable)) {\n      return;\n    }\n\n    const labels = this.state.frame.fields[1]?.labels ?? {};\n    if (Object.keys(labels).length !== 1) {\n      return;\n    }\n\n    const labelName = Object.keys(labels)[0];\n    reportExploreMetrics('label_filter_changed', { label: labelName, action: 'added', cause: 'breakdown' });\n    const trail = getTrailFor(this);\n    const filter = {\n      key: labelName,\n      operator: '=',\n      value: labels[labelName],\n    };\n\n    trail.addFilterWithoutReportingInteraction(filter);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<AddToFiltersGraphAction>) => {\n    const state = model.useState();\n    const labels = state.frame.fields[1]?.labels || {};\n\n    const canAddToFilters = Object.keys(labels).length !== 0;\n\n    if (!canAddToFilters) {\n      return null;\n    }\n\n    return (\n      <Button variant=\"secondary\" size=\"sm\" fill=\"outline\" onClick={model.onClick}>\n        Add to filters\n      </Button>\n    );\n  };\n}\n","import { type SelectableValue } from '@grafana/data';\nimport { sceneGraph, type QueryVariable, type SceneObject } from '@grafana/scenes';\n\nimport { VAR_FILTERS } from '../shared';\nimport { isAdHocFiltersVariable } from '../utils/utils.variables';\n\nexport function getLabelOptions(scenObject: SceneObject, variable: QueryVariable) {\n  const labelFilters = sceneGraph.lookupVariable(VAR_FILTERS, scenObject);\n  const labelOptions: Array<SelectableValue<string>> = [];\n\n  if (!isAdHocFiltersVariable(labelFilters)) {\n    return [];\n  }\n\n  const filters = labelFilters.state.filters;\n\n  for (const option of variable.getOptionsForSelect()) {\n    const filterExists = filters.find((f) => f.key === option.value);\n\n    if (option.label === 'le') {\n      // Do not show the \"le\" label\n      continue;\n    }\n    if (filterExists) {\n      continue;\n    }\n    labelOptions.push({ label: option.label, value: String(option.value) });\n  }\n\n  return labelOptions;\n}\n\ninterface Type<T> extends Function {\n  new (...args: any[]): T;\n}\nexport function findSceneObjectByType<T extends SceneObject>(scene: SceneObject, sceneType: Type<T>) {\n  const targetScene = sceneGraph.findObject(scene, (obj) => obj instanceof sceneType);\n\n  if (targetScene instanceof sceneType) {\n    return targetScene;\n  }\n\n  return null;\n}\n\nexport function findSceneObjectsByType<T extends SceneObject>(scene: SceneObject, sceneType: Type<T>) {\n  function isSceneType(scene: SceneObject): scene is T {\n    return scene instanceof sceneType;\n  }\n\n  const targetScenes = sceneGraph.findAllObjects(scene, isSceneType);\n  return targetScenes.filter(isSceneType);\n}\n","import uFuzzy from '@leeoniya/ufuzzy';\nimport { debounce as debounceLodash } from 'lodash';\n\nconst uf = new uFuzzy({\n  intraMode: 1,\n  intraIns: 1,\n  intraSub: 1,\n  intraTrn: 1,\n  intraDel: 1,\n});\n\nexport function fuzzySearch(haystack: string[], query: string, callback: (data: string[][]) => void) {\n  const [idxs, info, order] = uf.search(haystack, query, 0, 1e5);\n\n  let haystackOrder: string[] = [];\n  let matchesSet: Set<string> = new Set();\n  if (idxs && order) {\n    /**\n     * get the fuzzy matches for highlighting\n     * @param part\n     * @param matched\n     */\n    const mark = (part: string, matched: boolean) => {\n      if (matched) {\n        matchesSet.add(part);\n      }\n    };\n\n    // Iterate to create the order of needles(queries) and the matches\n    for (let i = 0; i < order.length; i++) {\n      let infoIdx = order[i];\n\n      /** Evaluate the match, get the matches for highlighting */\n      uFuzzy.highlight(haystack[info.idx[infoIdx]], info.ranges[infoIdx], mark);\n      /** Get the order */\n      haystackOrder.push(haystack[info.idx[infoIdx]]);\n    }\n\n    callback([haystackOrder, [...matchesSet]]);\n  } else if (!query) {\n    callback([]);\n  }\n}\n\nexport const debouncedFuzzySearch = debounceLodash(fuzzySearch, 300);\n","import { css } from '@emotion/css';\nimport { LoadingState, type DataFrame, type PanelData } from '@grafana/data';\nimport {\n  SceneDataNode,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  type SceneByFrameRepeater,\n  type SceneComponentProps,\n  type SceneLayout,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Alert, Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { BreakdownSearchReset } from './BreakdownSearchScene';\nimport { type LabelBreakdownSortingOption } from './SortByScene';\nimport { findSceneObjectsByType } from './utils';\nimport { getLabelValueFromDataFrame } from '../services/levels';\nimport { fuzzySearch } from '../services/search';\nimport { sortSeries } from '../services/sorting';\n\ninterface ByFrameRepeaterState extends SceneObjectState {\n  body: SceneLayout;\n\n  getLayoutChild(data: PanelData, frame: DataFrame, frameIndex: number): SceneFlexItem;\n}\n\ntype FrameFilterCallback = (frame: DataFrame) => boolean;\ntype FrameIterateCallback = (frames: DataFrame[], seriesIndex: number) => void;\n\nexport class ByFrameRepeater extends SceneObjectBase<ByFrameRepeaterState> {\n  private unfilteredChildren: SceneFlexItem[] = [];\n  private sortBy: LabelBreakdownSortingOption;\n  private sortedSeries: DataFrame[] = [];\n  private getFilter: () => string;\n\n  public constructor({\n    sortBy,\n    getFilter,\n    ...state\n  }: ByFrameRepeaterState & { sortBy: LabelBreakdownSortingOption; getFilter: () => string }) {\n    super(state);\n\n    this.sortBy = sortBy;\n    this.getFilter = getFilter;\n\n    this.addActivationHandler(() => {\n      const data = sceneGraph.getData(this);\n\n      this._subs.add(\n        data.subscribeToState((newState, oldState) => {\n          if (newState.data === undefined) {\n            return;\n          }\n\n          const newData = newState.data;\n\n          if (newState.data?.state !== oldState.data?.state) {\n            findSceneObjectsByType(this, SceneDataNode).forEach((dataNode) => {\n              dataNode.setState({ data: { ...dataNode.state.data, state: newData.state } });\n            });\n          }\n          if (newData.state === LoadingState.Done) {\n            this.performRepeat(newData);\n          }\n        })\n      );\n\n      if (data.state.data) {\n        this.performRepeat(data.state.data);\n      }\n    });\n  }\n\n  public sort = (sortBy: LabelBreakdownSortingOption) => {\n    const data = sceneGraph.getData(this);\n    this.sortBy = sortBy;\n    if (data.state.data) {\n      this.performRepeat(data.state.data);\n    }\n  };\n\n  private performRepeat(data: PanelData) {\n    const newChildren: SceneFlexItem[] = [];\n    const sortedSeries = sortSeries(data.series, this.sortBy);\n\n    for (let seriesIndex = 0; seriesIndex < sortedSeries.length; seriesIndex++) {\n      const layoutChild = this.state.getLayoutChild(data, sortedSeries[seriesIndex], seriesIndex);\n      newChildren.push(layoutChild);\n    }\n\n    this.sortedSeries = sortedSeries;\n    this.unfilteredChildren = newChildren;\n\n    if (this.getFilter()) {\n      this.state.body.setState({ children: [] });\n      this.filterByString(this.getFilter());\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  }\n\n  filterByString = (filter: string) => {\n    let haystack: string[] = [];\n\n    this.iterateFrames((frames, seriesIndex) => {\n      const labelValue = getLabelValue(frames[seriesIndex]);\n      haystack.push(labelValue);\n    });\n    fuzzySearch(haystack, filter, (data) => {\n      if (data && data[0]) {\n        // We got search results\n        this.filterFrames((frame: DataFrame) => {\n          const label = getLabelValue(frame);\n          return data[0].includes(label);\n        });\n      } else {\n        // reset search\n        this.filterFrames(() => true);\n      }\n    });\n  };\n\n  public iterateFrames = (callback: FrameIterateCallback) => {\n    const data = sceneGraph.getData(this).state.data;\n    if (!data) {\n      return;\n    }\n    for (let seriesIndex = 0; seriesIndex < this.sortedSeries.length; seriesIndex++) {\n      callback(this.sortedSeries, seriesIndex);\n    }\n  };\n\n  public filterFrames = (filterFn: FrameFilterCallback) => {\n    const newChildren: SceneFlexItem[] = [];\n    this.iterateFrames((frames, seriesIndex) => {\n      if (filterFn(frames[seriesIndex])) {\n        newChildren.push(this.unfilteredChildren[seriesIndex]);\n      }\n    });\n\n    if (newChildren.length === 0) {\n      this.state.body.setState({ children: [buildNoResultsScene(this.getFilter(), this.clearFilter)] });\n    } else {\n      this.state.body.setState({ children: newChildren });\n    }\n  };\n\n  public clearFilter = () => {\n    this.publishEvent(new BreakdownSearchReset(), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SceneByFrameRepeater>) => {\n    const { body } = model.useState();\n    return <body.Component model={body} />;\n  };\n}\n\nfunction buildNoResultsScene(filter: string, clearFilter: () => void) {\n  return new SceneFlexLayout({\n    direction: 'row',\n    children: [\n      new SceneFlexItem({\n        body: new SceneReactObject({\n          reactNode: (\n            <div className={styles.alertContainer}>\n              <Alert title=\"\" severity=\"info\" className={styles.noResultsAlert}>\n                No values found matching: {filter}\n                <Button className={styles.clearButton} onClick={clearFilter}>\n                  Clear filter\n                </Button>\n              </Alert>\n            </div>\n          ),\n        }),\n      }),\n    ],\n  });\n}\n\nconst styles = {\n  alertContainer: css({\n    flexGrow: 1,\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n  }),\n  noResultsAlert: css({\n    minWidth: '30vw',\n    flexGrow: 0,\n  }),\n  clearButton: css({\n    marginLeft: '1.5rem',\n  }),\n};\n\nfunction getLabelValue(frame: DataFrame) {\n  return getLabelValueFromDataFrame(frame) ?? 'No labels';\n}\n","import { css } from '@emotion/css';\nimport { Icon, Input } from '@grafana/ui';\nimport React, { type HTMLProps } from 'react';\n\ninterface Props extends Omit<HTMLProps<HTMLInputElement>, 'width'> {\n  onClear(): void;\n}\n\nexport const SearchInput = ({ value, onChange, placeholder, onClear, ...rest }: Props) => {\n  return (\n    <Input\n      value={value}\n      onChange={onChange}\n      suffix={\n        value ? <Icon onClick={onClear} title={'Clear search'} name=\"times\" className={styles.clearIcon} /> : undefined\n      }\n      prefix={<Icon name=\"search\" />}\n      placeholder={placeholder}\n      {...rest}\n    />\n  );\n};\n\nconst styles = {\n  clearIcon: css({\n    cursor: 'pointer',\n  }),\n};\n","import { BusEventBase } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport React, { type ChangeEvent } from 'react';\n\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { SearchInput } from './SearchInput';\n\nexport class BreakdownSearchReset extends BusEventBase {\n  public static readonly type = 'breakdown-search-reset';\n}\n\nexport interface BreakdownSearchSceneState extends SceneObjectState {\n  filter?: string;\n}\n\nconst recentFilters: Record<string, string> = {};\n\nexport class BreakdownSearchScene extends SceneObjectBase<BreakdownSearchSceneState> {\n  private cacheKey: string;\n\n  constructor(cacheKey: string) {\n    super({\n      filter: recentFilters[cacheKey] ?? '',\n    });\n    this.cacheKey = cacheKey;\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<BreakdownSearchScene>) => {\n    const { filter } = model.useState();\n    return (\n      <SearchInput\n        value={filter}\n        onChange={model.onValueFilterChange}\n        onClear={model.clearValueFilter}\n        placeholder=\"Search for value\"\n      />\n    );\n  };\n\n  public onValueFilterChange = (event: ChangeEvent<HTMLInputElement>) => {\n    this.setState({ filter: event.target.value });\n    this.filterValues(event.target.value);\n  };\n\n  public clearValueFilter = () => {\n    this.setState({ filter: '' });\n    this.filterValues('');\n  };\n\n  public reset = () => {\n    this.setState({ filter: '' });\n    recentFilters[this.cacheKey] = '';\n  };\n\n  private filterValues(filter: string) {\n    if (this.parent instanceof LabelBreakdownScene) {\n      recentFilters[this.cacheKey] = filter;\n      const body = this.parent.state.body;\n      body?.forEachChild((child) => {\n        if (child instanceof ByFrameRepeater && child.state.body.isActive) {\n          child.filterByString(filter);\n        }\n      });\n    }\n  }\n}\n","import { type LabelBreakdownSortingOption } from 'Breakdown/SortByScene';\n\nimport { TRAIL_BREAKDOWN_SORT_KEY, TRAIL_BREAKDOWN_VIEW_KEY } from '../shared';\n\nexport function getVewByPreference() {\n  return localStorage.getItem(TRAIL_BREAKDOWN_VIEW_KEY) ?? 'grid';\n}\n\nexport function setVewByPreference(value?: string) {\n  return localStorage.setItem(TRAIL_BREAKDOWN_VIEW_KEY, value ?? 'grid');\n}\n\nexport function getSortByPreference(\n  target: string,\n  defaultSortBy: LabelBreakdownSortingOption\n): { sortBy: LabelBreakdownSortingOption; direction?: string } {\n  const preference = localStorage.getItem(`${TRAIL_BREAKDOWN_SORT_KEY}.${target}.by`) ?? '';\n  const parts = preference.split('.');\n  if (!parts[0] || !parts[1]) {\n    return { sortBy: defaultSortBy };\n  }\n  return { sortBy: parts[0] as LabelBreakdownSortingOption, direction: parts[1] };\n}\n\nexport function setSortByPreference(target: string, sortBy: LabelBreakdownSortingOption) {\n  // Prevent storing empty values\n  if (sortBy) {\n    localStorage.setItem(`${TRAIL_BREAKDOWN_SORT_KEY}.${target}.by`, `${sortBy}`);\n  }\n}\n","const BREAKDOWN_LAYOUT_TYPES = ['single', 'grid', 'rows'] as const;\n\nexport type BreakdownLayoutType = (typeof BREAKDOWN_LAYOUT_TYPES)[number];\n\nexport function isBreakdownLayoutType(\n  breakdownLayoutType: string | null | undefined\n): breakdownLayoutType is BreakdownLayoutType {\n  return BREAKDOWN_LAYOUT_TYPES.includes(breakdownLayoutType as BreakdownLayoutType);\n}\n\nexport type BreakdownLayoutChangeCallback = (newBreakdownLayout: BreakdownLayoutType) => void;\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n  type SceneObjectWithUrlSync,\n} from '@grafana/scenes';\nimport { RadioButtonGroup, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { getVewByPreference, setVewByPreference } from '../services/store';\nimport { type MakeOptional } from '../shared';\nimport { isBreakdownLayoutType, type BreakdownLayoutChangeCallback, type BreakdownLayoutType } from './types';\n\nexport interface LayoutSwitcherState extends SceneObjectState {\n  activeBreakdownLayout: BreakdownLayoutType;\n  breakdownLayouts: SceneObject[];\n  breakdownLayoutOptions: Array<SelectableValue<BreakdownLayoutType>>;\n  onBreakdownLayoutChange: BreakdownLayoutChangeCallback;\n}\n\nexport class LayoutSwitcher extends SceneObjectBase<LayoutSwitcherState> implements SceneObjectWithUrlSync {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['breakdownLayout'] });\n\n  public constructor(state: MakeOptional<LayoutSwitcherState, 'activeBreakdownLayout'>) {\n    const storedBreakdownLayout = getVewByPreference();\n    super({\n      activeBreakdownLayout: isBreakdownLayoutType(storedBreakdownLayout) ? storedBreakdownLayout : 'grid',\n      ...state,\n    });\n  }\n\n  getUrlState() {\n    return { breakdownLayout: this.state.activeBreakdownLayout };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const newBreakdownLayout = values.breakdownLayout;\n    if (typeof newBreakdownLayout === 'string' && isBreakdownLayoutType(newBreakdownLayout)) {\n      if (this.state.activeBreakdownLayout !== newBreakdownLayout) {\n        this.setState({ activeBreakdownLayout: newBreakdownLayout });\n      }\n    }\n  }\n\n  public Selector({ model }: { model: LayoutSwitcher }) {\n    const { activeBreakdownLayout, breakdownLayoutOptions } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Layout switcher\"\n        options={breakdownLayoutOptions}\n        value={activeBreakdownLayout}\n        onChange={model.onLayoutChange}\n      />\n    );\n  }\n\n  public onLayoutChange = (active: BreakdownLayoutType) => {\n    if (this.state.activeBreakdownLayout === active) {\n      return;\n    }\n\n    reportExploreMetrics('breakdown_layout_changed', { layout: active });\n    setVewByPreference(active);\n    this.setState({ activeBreakdownLayout: active });\n    this.state.onBreakdownLayoutChange(active);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<LayoutSwitcher>) => {\n    const { breakdownLayouts, breakdownLayoutOptions, activeBreakdownLayout } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const index = breakdownLayoutOptions.findIndex((o) => o.value === activeBreakdownLayout);\n    if (index === -1) {\n      return null;\n    }\n\n    const layout = breakdownLayouts[index];\n\n    return (\n      <div className={styles.container}>\n        <layout.Component model={layout} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'row',\n      flexGrow: 1,\n      paddingTop: theme.spacing(0),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { BusEventBase, type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Combobox, Field, IconButton, useStyles2, type ComboboxOption } from '@grafana/ui';\nimport React from 'react';\n\nimport { getSortByPreference, setSortByPreference } from '../services/store';\n\nexport interface SortBySceneState extends SceneObjectState {\n  target: 'fields' | 'labels';\n  sortBy: LabelBreakdownSortingOption;\n}\n\nexport class SortCriteriaChanged extends BusEventBase {\n  constructor(public target: 'fields' | 'labels', public sortBy: LabelBreakdownSortingOption) {\n    super();\n  }\n\n  public static readonly type = 'sort-criteria-changed';\n}\n\nexport type LabelBreakdownSortingOption = 'outliers' | 'alphabetical' | 'alphabetical-reversed';\n\nconst sortingOptions: Array<ComboboxOption<LabelBreakdownSortingOption>> = [\n  {\n    value: 'outliers',\n    label: 'Outlying series',\n    description: 'Prioritizes values that show distinct behavior from others within the same label',\n  },\n  {\n    value: 'alphabetical',\n    label: 'Name [A-Z]',\n    description: 'Alphabetical order',\n  },\n  {\n    value: 'alphabetical-reversed',\n    label: 'Name [Z-A]',\n    description: 'Reversed alphabetical order',\n  },\n];\n\nexport class SortByScene extends SceneObjectBase<SortBySceneState> {\n  constructor(state: Pick<SortBySceneState, 'target'>) {\n    const { sortBy } = getSortByPreference(state.target, 'outliers');\n    super({\n      target: state.target,\n      sortBy,\n    });\n  }\n\n  public onCriteriaChange = (criteria: ComboboxOption<LabelBreakdownSortingOption> | null) => {\n    if (!criteria?.value) {\n      return;\n    }\n    this.setState({ sortBy: criteria.value });\n    setSortByPreference(this.state.target, criteria.value);\n    this.publishEvent(new SortCriteriaChanged(this.state.target, criteria.value), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SortByScene>) => {\n    const styles = useStyles2(getStyles);\n    const { sortBy } = model.useState();\n    const value = sortingOptions.find((option) => option.value === sortBy);\n    return (\n      <Field\n        htmlFor=\"sort-by-criteria\"\n        label={\n          <div className={styles.sortByTooltip}>\n            Sort by\n            <IconButton\n              name={'info-circle'}\n              size=\"sm\"\n              variant={'secondary'}\n              tooltip=\"Sorts values using standard or smart time series calculations.\"\n            />\n          </div>\n        }\n      >\n        <Combobox\n          id=\"sort-by-criteria\"\n          value={value}\n          width={20}\n          options={sortingOptions}\n          placeholder={'Choose criteria'}\n          onChange={model.onCriteriaChange}\n          isClearable={false}\n        />\n      </Field>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    sortByTooltip: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n    }),\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\nimport {\n  FieldConfigBuilders,\n  sceneGraph,\n  VizPanel,\n  type SceneCSSGridItem,\n  type SceneDataProvider,\n  type SceneStatelessBehavior,\n} from '@grafana/scenes';\n\nimport { LabelBreakdownScene } from './LabelBreakdownScene';\nimport { findSceneObjectsByType } from './utils';\n\nexport class BreakdownAxisChangeEvent extends BusEventWithPayload<{ min: number; max: number }> {\n  public static readonly type = 'selected-metric-query-results-event';\n}\n\nexport const yAxisSyncBehavior: SceneStatelessBehavior = (sceneObject: SceneCSSGridItem) => {\n  const breakdownScene = sceneGraph.getAncestor(sceneObject, LabelBreakdownScene);\n\n  // Handle query runners from vizPanels that haven't been activated yet\n  findSceneObjectsByType(sceneObject, VizPanel).forEach((vizPanel) => {\n    if (vizPanel.isActive) {\n      registerDataProvider(vizPanel.state.$data);\n    } else {\n      vizPanel.addActivationHandler(() => {\n        registerDataProvider(vizPanel.state.$data);\n      });\n    }\n  });\n\n  // Register the data providers of all present vizpanels\n  findSceneObjectsByType(sceneObject, VizPanel).forEach((vizPanel) => registerDataProvider(vizPanel.state.$data));\n\n  function registerDataProvider(dataProvider?: SceneDataProvider) {\n    if (!dataProvider) {\n      return;\n    }\n\n    if (!dataProvider.isActive) {\n      dataProvider.addActivationHandler(() => {\n        // Call this function again when the dataprovider is activated\n        registerDataProvider(dataProvider);\n      });\n    }\n\n    // Report the panel data if it is already populated\n    if (dataProvider.state.data) {\n      breakdownScene.reportBreakdownPanelData(dataProvider.state.data);\n    }\n\n    // Report the panel data whenever it is updated\n    dataProvider.subscribeToState(({ data }) => {\n      breakdownScene.reportBreakdownPanelData(data);\n    });\n  }\n\n  const axisChangeSubscription = breakdownScene.subscribeToEvent(BreakdownAxisChangeEvent, (event) => {\n    if (!sceneObject.isActive) {\n      axisChangeSubscription.unsubscribe();\n      return;\n    }\n\n    const fieldConfig = FieldConfigBuilders.timeseries()\n      .setCustomFieldConfig('axisSoftMin', event.payload.min)\n      .setCustomFieldConfig('axisSoftMax', event.payload.max)\n      .build();\n\n    findSceneObjectsByType(sceneObject, VizPanel).forEach((vizPanel) => {\n      function update() {\n        vizPanel.onFieldConfigChange(fieldConfig);\n      }\n\n      if (vizPanel.isActive) {\n        // Update axis for panels that are already active\n        update();\n      } else {\n        // Update inactive panels once they become active.\n        vizPanel.addActivationHandler(update);\n      }\n    });\n  });\n};\n","export const ALL_VARIABLE_VALUE = '$__all';\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { LoadingPlaceholder, useStyles2 } from '@grafana/ui';\nimport React, { type ReactNode } from 'react';\n\ntype Props = {\n  blockingMessage?: string;\n  isLoading?: boolean;\n  children?: ReactNode;\n};\n\nexport function StatusWrapper({ blockingMessage, isLoading, children }: Readonly<Props>) {\n  const styles = useStyles2(getStyles);\n\n  if (isLoading && !blockingMessage) {\n    blockingMessage = 'Loading...';\n  }\n\n  if (isLoading) {\n    return <LoadingPlaceholder className={styles.statusMessage} text={blockingMessage} />;\n  }\n\n  if (!blockingMessage) {\n    return <>{children}</>;\n  }\n\n  return <div className={styles.statusMessage}>{blockingMessage}</div>;\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    statusMessage: css({\n      fontStyle: 'italic',\n      marginTop: theme.spacing(7),\n      textAlign: 'center',\n      width: '100%',\n    }),\n  };\n}\n","import { BusEventWithPayload, type DataFrame } from '@grafana/data';\n\ninterface EventTimeseriesDataReceivedPayload {\n  series?: DataFrame[];\n}\n\nexport class EventTimeseriesDataReceived extends BusEventWithPayload<EventTimeseriesDataReceivedPayload> {\n  public static readonly type = 'timeseries-data-received';\n}\n","import { sceneGraph, VizPanel, type SceneObject, type SceneObjectState } from '@grafana/scenes';\nimport { cloneDeep, merge } from 'lodash';\n\nimport { EventTimeseriesDataReceived } from 'Breakdown/MetricLabelsList/events/EventTimeseriesDataReceived';\n\n/**\n * Synchronizes the Y-axis ranges across children timeseries panels by listening to data updates from publishTimeseriesData.\n * When new data arrives, it calculates the global min/max values and updates all children panels to use the same scale.\n */\nexport function syncYAxis() {\n  return (vizPanelsParent: SceneObject<SceneObjectState>) => {\n    let max = Number.NEGATIVE_INFINITY;\n    let min = Number.POSITIVE_INFINITY;\n\n    const timeRangeSub = sceneGraph.getTimeRange(vizPanelsParent).subscribeToState(() => {\n      max = Number.NEGATIVE_INFINITY;\n      min = Number.POSITIVE_INFINITY;\n    });\n\n    const eventSub = vizPanelsParent.subscribeToEvent(EventTimeseriesDataReceived, (event) => {\n      const series = event.payload.series || [];\n      let newMax = max;\n      let newMin = min;\n\n      for (const s of series) {\n        const values = s.fields[1]?.values.filter(Boolean);\n\n        if (values) {\n          newMax = Math.max(newMax, ...values);\n          newMin = Math.min(newMin, ...values);\n        }\n      }\n\n      if (\n        newMax !== newMin &&\n        newMax !== Number.NEGATIVE_INFINITY &&\n        newMin !== Number.POSITIVE_INFINITY &&\n        (newMax !== max || newMin !== min)\n      ) {\n        [max, min] = [newMax, newMin];\n        updateTimeseriesAxis(vizPanelsParent, max, min);\n      }\n    });\n\n    return () => {\n      eventSub.unsubscribe();\n      timeRangeSub.unsubscribe();\n    };\n  };\n}\n\nfunction updateTimeseriesAxis(vizPanelsParent: SceneObject, max: number, min: number) {\n  // findAllObjects searches down the full scene graph\n  const timeseries = sceneGraph.findAllObjects(\n    vizPanelsParent,\n    (o) => o instanceof VizPanel && o.state.pluginId === 'timeseries'\n  ) as VizPanel[];\n\n  for (const t of timeseries) {\n    t.clearFieldConfigCache(); // required for the fieldConfig update below\n\n    t.setState({\n      fieldConfig: merge(cloneDeep(t.state.fieldConfig), { defaults: { min, max } }),\n    });\n  }\n}\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const addRefId = () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) =>\n      data?.map((d, i) => {\n        d.refId = `${d.refId}-${i}`;\n        return d;\n      })\n    )\n  );\n","import { type DataFrame } from '@grafana/data';\nimport { map, type Observable } from 'rxjs';\n\nexport const SERIES_COUNT_STATS_NAME = 'seriesCount';\n\nexport const sliceSeries = (start: number, end: number) => () => (source: Observable<DataFrame[]>) =>\n  source.pipe(\n    map((data: DataFrame[]) =>\n      // eslint-disable-next-line sonarjs/no-nested-functions\n      data?.slice(start, end).map((d) => {\n        d.meta = { ...d.meta };\n        d.meta.stats ||= [];\n        d.meta.stats.unshift({ displayName: SERIES_COUNT_STATS_NAME, value: data.length });\n        return d;\n      })\n    )\n  );\n","import { css } from '@emotion/css';\nimport { FieldMatcherID, LoadingState, type DataFrame } from '@grafana/data';\nimport {\n  PanelBuilders,\n  SceneDataTransformer,\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type VizPanel,\n} from '@grafana/scenes';\nimport { SortOrder } from '@grafana/schema';\nimport { TooltipDisplayMode, useStyles2 } from '@grafana/ui';\nimport { merge } from 'lodash';\nimport React from 'react';\n\nimport { SelectLabelAction } from 'Breakdown/LabelBreakdownScene';\nimport { PanelMenu } from 'Menu/PanelMenu';\nimport { MDP_METRIC_PREVIEW, trailDS } from 'shared';\nimport { getColorByIndex } from 'utils';\n\nimport { publishTimeseriesData } from './behaviors/publishTimeseriesData';\nimport { addRefId } from './transformations/addRefId';\nimport { SERIES_COUNT_STATS_NAME, sliceSeries } from './transformations/sliceSeries';\n\ninterface LabelVizPanelState extends SceneObjectState {\n  metric: string;\n  label: string;\n  query: string;\n  unit: string;\n  startColorIndex: number;\n  body: VizPanel;\n}\n\nconst MAX_SERIES_TO_RENDER = 20;\nexport const LABELS_VIZ_PANEL_HEIGHT = '220px';\n\nexport class LabelVizPanel extends SceneObjectBase<LabelVizPanelState> {\n  constructor({\n    metric,\n    label,\n    query,\n    unit,\n    startColorIndex,\n  }: {\n    metric: LabelVizPanelState['label'];\n    label: LabelVizPanelState['label'];\n    query: LabelVizPanelState['query'];\n    unit: LabelVizPanelState['unit'];\n    startColorIndex: LabelVizPanelState['startColorIndex'];\n  }) {\n    super({\n      key: `label-viz-panel-${label}`,\n      metric,\n      label,\n      query,\n      unit,\n      startColorIndex,\n      body: LabelVizPanel.buildVizPanel({ metric, label, query, unit }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private static buildVizPanel({\n    metric,\n    label,\n    query,\n    unit,\n  }: {\n    metric: LabelVizPanelState['label'];\n    label: LabelVizPanelState['label'];\n    query: LabelVizPanelState['query'];\n    unit: LabelVizPanelState['unit'];\n  }) {\n    const data = new SceneDataTransformer({\n      $data: new SceneQueryRunner({\n        datasource: trailDS,\n        maxDataPoints: MDP_METRIC_PREVIEW,\n        queries: [\n          {\n            refId: `${metric}-${label}`,\n            expr: query,\n            legendFormat: `{{${label}}}`,\n            fromExploreMetrics: true,\n          },\n        ],\n      }),\n      // addRefId is required for setting the overrides below\n      transformations: [sliceSeries(0, MAX_SERIES_TO_RENDER), addRefId],\n    });\n\n    const vizPanel = PanelBuilders.timeseries()\n      .setTitle(label)\n      .setUnit(unit)\n      .setData(data)\n      // publishTimeseriesData is required for the syncYAxis behavior (see MetricLabelsList)\n      .setBehaviors([publishTimeseriesData()])\n      .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n      .setHeaderActions([new SelectLabelAction({ labelName: label })])\n      .setMenu(new PanelMenu({ labelName: label }))\n      .setShowMenuAlways(true)\n      .build();\n\n    return vizPanel;\n  }\n\n  private onActivate() {\n    const { body } = this.state;\n\n    this._subs.add(\n      (body.state.$data as SceneQueryRunner).subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n\n        const { series } = newState.data;\n\n        if (series?.length) {\n          const config = this.getAllValuesConfig(series);\n\n          body.setState(merge({}, body.state, config));\n        }\n      })\n    );\n  }\n\n  getAllValuesConfig(series: DataFrame[]) {\n    const { label } = this.state;\n\n    const seriesCountStats = series[0].meta?.stats?.find((s) => s.displayName === SERIES_COUNT_STATS_NAME);\n    const seriesCount = seriesCountStats ? seriesCountStats.value : series.length;\n    const description =\n      series.length < seriesCount\n        ? `Showing only ${series.length} series out of ${seriesCount} to keep the data easy to read. Click on \"Select\" on this panel to view a breakdown of all the \"${label}\" label's values.`\n        : '';\n\n    return {\n      title: `${label} (${seriesCount})`,\n      description,\n      fieldConfig: {\n        overrides: this.getOverrides(series),\n      },\n    };\n  }\n\n  getOverrides(series: DataFrame[]) {\n    const { label, startColorIndex } = this.state;\n\n    return series.map((s, i) => {\n      return {\n        matcher: { id: FieldMatcherID.byFrameRefID, options: s.refId },\n        properties: [\n          {\n            id: 'displayName',\n            value: s.fields[1]?.labels?.[label] || `<unspecified ${label}>`,\n          },\n          {\n            id: 'color',\n            value: { mode: 'fixed', fixedColor: getColorByIndex(startColorIndex + i) },\n          },\n        ],\n      };\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelVizPanel>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    container: css({\n      height: LABELS_VIZ_PANEL_HEIGHT,\n    }),\n  };\n}\n","import { LoadingState } from '@grafana/data';\nimport { type SceneDataProvider, type VizPanel } from '@grafana/scenes';\n\nimport { EventTimeseriesDataReceived } from '../events/EventTimeseriesDataReceived';\n\n/**\n * Publishes timeseries data events when new data arrives from the VizPanel data provider.\n * These events are used by other behaviors like syncYAxis to coordinate updates across multiple panels.\n */\nexport function publishTimeseriesData() {\n  return (vizPanel: VizPanel) => {\n    (vizPanel.state.$data as SceneDataProvider).subscribeToState((newState, prevState) => {\n      if (newState.data?.state === LoadingState.Done && newState.data?.series !== prevState.data?.series) {\n        vizPanel.publishEvent(new EventTimeseriesDataReceived({ series: newState.data.series }), true);\n      }\n    });\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport { utf8Support } from '@grafana/prometheus';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { getAutoQueriesForMetric } from 'autoQuery/getAutoQueriesForMetric';\nimport { syncYAxis } from 'Breakdown/MetricLabelsList/behaviors/syncYAxis';\nimport { VAR_GROUP_BY, VAR_GROUP_BY_EXP } from 'shared';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { LABELS_VIZ_PANEL_HEIGHT, LabelVizPanel } from './LabelVizPanel';\n\ninterface MetricLabelsListState extends SceneObjectState {\n  metric: string;\n  layoutSwitcher: LayoutSwitcher;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricLabelsList extends SceneObjectBase<MetricLabelsListState> {\n  constructor({ metric }: { metric: MetricLabelsListState['metric'] }) {\n    const queryDef = getAutoQueriesForMetric(metric).breakdown;\n    const { expr } = queryDef.queries[0];\n    const unit = queryDef.unit;\n\n    super({\n      key: 'metric-labels-list',\n      metric,\n      // TODO: we add the layout switcher here for now to keep the changes in the LabelBreakdownScene component minimal\n      // but we should refactor further and move it to LabelBreakdownScene\n      layoutSwitcher: new LayoutSwitcher(),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_GROUP_BY,\n        initialPageSize: 60,\n        pageSizeIncrement: 9,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: LABELS_VIZ_PANEL_HEIGHT,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n            syncYAxis(),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No labels found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading labels!\" error={error} />,\n          }),\n        getLayoutChild: (option, startColorIndex) => {\n          const query = expr.replaceAll(VAR_GROUP_BY_EXP, utf8Support(String(option.value)));\n\n          return new SceneCSSGridItem({\n            body: new LabelVizPanel({\n              metric,\n              label: option.value as string,\n              query,\n              unit,\n              startColorIndex,\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state); // ensure layout when landing on the page\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public Selector({ model }: { model: MetricLabelsList }) {\n    const { layoutSwitcher } = model.useState();\n    return <layoutSwitcher.Component model={layoutSwitcher} />;\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricLabelsList>) => {\n    const { body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const variable = sceneGraph.lookupVariable(VAR_GROUP_BY, model) as MultiValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"labels-list\">\n        <div className={styles.container}>\n          <body.Component model={body} />\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label=\"label\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({ width: '100%' }),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n  };\n}\n","import init from '@bsull/augurs/outlier';\nimport { css } from '@emotion/css';\nimport { FieldType, type DataFrame, type GrafanaTheme2, type PanelData, type SelectableValue } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport {\n  PanelBuilders,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneDataNode,\n  SceneFlexItem,\n  SceneFlexLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  SceneReactObject,\n  VariableDependencyConfig,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type VizPanel,\n} from '@grafana/scenes';\nimport { SortOrder, TooltipDisplayMode } from '@grafana/schema';\nimport { Button, Field, LoadingPlaceholder, useStyles2 } from '@grafana/ui';\nimport { isNumber, max, min, throttle } from 'lodash';\nimport React from 'react';\n\nimport { logger } from 'tracking/logger/logger';\nimport { METRICS_VIZ_PANEL_HEIGHT } from 'WingmanDataTrail/MetricVizPanel/MetricVizPanel';\n\nimport { getAutoQueriesForMetric } from '../autoQuery/getAutoQueriesForMetric';\nimport { type AutoQueryDef } from '../autoQuery/types';\nimport { BreakdownLabelSelector } from '../BreakdownLabelSelector';\nimport { reportExploreMetrics } from '../interactions';\nimport { MetricScene } from '../MetricScene';\nimport { AddToFiltersGraphAction } from './AddToFiltersGraphAction';\nimport { BreakdownSearchReset, BreakdownSearchScene } from './BreakdownSearchScene';\nimport { ByFrameRepeater } from './ByFrameRepeater';\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { SortByScene, SortCriteriaChanged } from './SortByScene';\nimport { type BreakdownLayoutChangeCallback } from './types';\nimport { getLabelOptions } from './utils';\nimport { BreakdownAxisChangeEvent, yAxisSyncBehavior } from './yAxisSyncBehavior';\nimport { PanelMenu } from '../Menu/PanelMenu';\nimport { getSortByPreference } from '../services/store';\nimport { ALL_VARIABLE_VALUE } from '../services/variables';\nimport { MDP_METRIC_PREVIEW, RefreshMetricsEvent, trailDS, VAR_FILTERS, VAR_GROUP_BY } from '../shared';\nimport { StatusWrapper } from '../StatusWrapper';\nimport { getColorByIndex, getTrailFor } from '../utils';\nimport { isQueryVariable } from '../utils/utils.variables';\nimport { MetricLabelsList } from './MetricLabelsList/MetricLabelsList';\n\nexport interface LabelBreakdownSceneState extends SceneObjectState {\n  body?: LayoutSwitcher | MetricLabelsList;\n  search: BreakdownSearchScene;\n  sortBy: SortByScene;\n  labels: Array<SelectableValue<string>>;\n  value?: string;\n  loading?: boolean;\n  error?: string;\n  blockingMessage?: string;\n}\n\nexport class LabelBreakdownScene extends SceneObjectBase<LabelBreakdownSceneState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_FILTERS],\n    onReferencedVariableValueChanged: this.onReferencedVariableValueChanged.bind(this),\n  });\n\n  constructor(state: Partial<LabelBreakdownSceneState>) {\n    super({\n      ...state,\n      labels: state.labels ?? [],\n      sortBy: new SortByScene({ target: 'labels' }),\n      search: new BreakdownSearchScene('labels'),\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _query?: AutoQueryDef;\n\n  private _onActivate() {\n    // eslint-disable-next-line no-console\n    init().then(() => logger.debug('Grafana ML initialized'));\n\n    const variable = this.getVariable();\n\n    if (config.featureToggles.enableScopesInMetricsExplore) {\n      this._subs.add(\n        this.subscribeToEvent(RefreshMetricsEvent, () => {\n          this.updateBody(this.getVariable());\n        })\n      );\n    }\n\n    variable.subscribeToState((newState, oldState) => {\n      if (\n        newState.options !== oldState.options ||\n        newState.value !== oldState.value ||\n        newState.loading !== oldState.loading\n      ) {\n        this.updateBody(variable);\n      }\n    });\n\n    this._subs.add(\n      this.subscribeToEvent(BreakdownSearchReset, () => {\n        this.state.search.clearValueFilter();\n      })\n    );\n    this._subs.add(this.subscribeToEvent(SortCriteriaChanged, this.handleSortByChange));\n\n    const metricScene = sceneGraph.getAncestor(this, MetricScene);\n    const metric = metricScene.state.metric;\n    this._query = getAutoQueriesForMetric(metric).breakdown;\n\n    // The following state changes (and conditions) will each result in a call to `clearBreakdownPanelAxisValues`.\n    // By clearing the axis, subsequent calls to `reportBreakdownPanelData` will adjust to an updated axis range.\n    // These state changes coincide with the panels having their data updated, making a call to `reportBreakdownPanelData`.\n    // If the axis was not cleared by `clearBreakdownPanelAxisValues` any calls to `reportBreakdownPanelData` which result\n    // in the same axis will result in no updates to the panels.\n\n    const trail = getTrailFor(this);\n    trail.state.$timeRange?.subscribeToState(() => {\n      // The change in time range will cause a refresh of panel values.\n      this.clearBreakdownPanelAxisValues();\n    });\n\n    this.updateBody(variable);\n  }\n\n  private breakdownPanelMaxValue: number | undefined;\n  private breakdownPanelMinValue: number | undefined;\n\n  public reportBreakdownPanelData(data: PanelData | undefined) {\n    if (!data) {\n      return;\n    }\n\n    let newMin = this.breakdownPanelMinValue;\n    let newMax = this.breakdownPanelMaxValue;\n\n    data.series.forEach((dataFrame) => {\n      dataFrame.fields.forEach((breakdownData) => {\n        if (breakdownData.type !== FieldType.number) {\n          return;\n        }\n        const values = breakdownData.values.filter(isNumber);\n\n        const maxValue = max(values);\n        const minValue = min(values);\n\n        newMax = max([newMax, maxValue].filter(isNumber));\n        newMin = min([newMin, minValue].filter(isNumber));\n      });\n    });\n\n    if (newMax === undefined || newMin === undefined || !Number.isFinite(newMax + newMin)) {\n      return;\n    }\n\n    if (this.breakdownPanelMaxValue === newMax && this.breakdownPanelMinValue === newMin) {\n      return;\n    }\n\n    this.breakdownPanelMaxValue = newMax;\n    this.breakdownPanelMinValue = newMin;\n\n    this._triggerAxisChangedEvent();\n  }\n\n  private _triggerAxisChangedEvent = throttle(() => {\n    const { breakdownPanelMinValue, breakdownPanelMaxValue } = this;\n    if (breakdownPanelMinValue !== undefined && breakdownPanelMaxValue !== undefined) {\n      this.publishEvent(new BreakdownAxisChangeEvent({ min: breakdownPanelMinValue, max: breakdownPanelMaxValue }));\n    }\n  }, 1000);\n\n  private clearBreakdownPanelAxisValues() {\n    this.breakdownPanelMaxValue = undefined;\n    this.breakdownPanelMinValue = undefined;\n  }\n\n  private getVariable(): QueryVariable {\n    const variable = sceneGraph.lookupVariable(VAR_GROUP_BY, this)!;\n    if (!isQueryVariable(variable)) {\n      throw new Error('Group by variable not found');\n    }\n\n    return variable;\n  }\n\n  private handleSortByChange = (event: SortCriteriaChanged) => {\n    if (event.target !== 'labels') {\n      return;\n    }\n\n    reportExploreMetrics('sorting_changed', { from: 'label-breakdown', sortBy: event.sortBy });\n\n    if (this.state.body instanceof LayoutSwitcher) {\n      this.state.body.state.breakdownLayouts.forEach((layout) => {\n        if (layout instanceof ByFrameRepeater) {\n          layout.sort(event.sortBy);\n        }\n      });\n    }\n  };\n\n  private onReferencedVariableValueChanged() {\n    const variable = this.getVariable();\n    variable.changeValueTo(ALL_VARIABLE_VALUE);\n    this.updateBody(variable);\n  }\n\n  private updateBody(variable: QueryVariable) {\n    const options = getLabelOptions(this, variable);\n\n    const stateUpdate: Partial<LabelBreakdownSceneState> = {\n      loading: variable.state.loading,\n      value: String(variable.state.value),\n      labels: options,\n      error: variable.state.error,\n      blockingMessage: undefined,\n    };\n\n    if (!variable.state.loading && variable.state.options.length) {\n      const metricScene = sceneGraph.getAncestor(this, MetricScene);\n\n      stateUpdate.body = variable.hasAllValue()\n        ? new MetricLabelsList({ metric: metricScene.state.metric })\n        : buildNormalLayout(this._query!, this.onBreakdownLayoutChange, this.state.search);\n    } else if (!variable.state.loading) {\n      stateUpdate.body = undefined;\n      stateUpdate.blockingMessage = 'There are no labels found for this metric.';\n    }\n\n    this.clearBreakdownPanelAxisValues();\n    // Setting the new panels will gradually end up calling reportBreakdownPanelData to update the new min & max\n    this.setState(stateUpdate);\n  }\n\n  public onBreakdownLayoutChange = () => {\n    this.clearBreakdownPanelAxisValues();\n  };\n\n  public onChange = (value?: string) => {\n    if (!value) {\n      return;\n    }\n\n    reportExploreMetrics('label_selected', { label: value, cause: 'selector' });\n    const variable = this.getVariable();\n\n    variable.changeValueTo(value);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelBreakdownScene>) => {\n    const { labels, body, search, sortBy, loading, value, blockingMessage } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    return (\n      <div className={styles.container}>\n        <StatusWrapper {...{ isLoading: loading, blockingMessage }}>\n          <div className={styles.controls}>\n            {!loading && labels.length > 0 && (\n              <Field label={'By label'}>\n                <BreakdownLabelSelector options={labels} value={value} onChange={model.onChange} />\n              </Field>\n            )}\n\n            {value !== ALL_VARIABLE_VALUE && (\n              <>\n                <Field label=\"Search\" className={styles.searchField}>\n                  <search.Component model={search} />\n                </Field>\n                <sortBy.Component model={sortBy} />\n              </>\n            )}\n            {body instanceof LayoutSwitcher && (\n              <Field label=\"View\">\n                <body.Selector model={body} />\n              </Field>\n            )}\n            {body instanceof MetricLabelsList && (\n              <Field label=\"View\">\n                <body.Selector model={body} />\n              </Field>\n            )}\n          </div>\n          <div data-testid=\"panels-list\">\n            {body instanceof LayoutSwitcher && <body.Component model={body} />}\n            {body instanceof MetricLabelsList && <body.Component model={body} />}\n          </div>\n        </StatusWrapper>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      minHeight: '100%',\n      flexDirection: 'column',\n      paddingTop: theme.spacing(1),\n    }),\n    searchField: css({\n      flexGrow: 1,\n    }),\n    controls: css({\n      flexGrow: 0,\n      display: 'flex',\n      alignItems: 'flex-end',\n      gap: theme.spacing(2),\n      justifyContent: 'space-between',\n    }),\n  };\n}\n\nconst GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\n\nfunction buildNormalLayout(\n  queryDef: AutoQueryDef,\n  onBreakdownLayoutChange: BreakdownLayoutChangeCallback,\n  searchScene: BreakdownSearchScene\n) {\n  const unit = queryDef.unit;\n\n  function getLayoutChild(data: PanelData, frame: DataFrame, frameIndex: number): SceneFlexItem {\n    const vizPanel: VizPanel = queryDef\n      .vizBuilder()\n      .setTitle(getLabelValue(frame))\n      .setData(new SceneDataNode({ data: { ...data, series: [frame] } }))\n      .setColor({ mode: 'fixed', fixedColor: getColorByIndex(frameIndex) })\n      .setHeaderActions([new AddToFiltersGraphAction({ frame })])\n      .setShowMenuAlways(true)\n      .setMenu(new PanelMenu({ labelName: getLabelValue(frame) }))\n      .setUnit(unit)\n      .build();\n\n    // Find a frame that has at more than one point.\n    const isHidden = frame.length <= 1;\n\n    const item: SceneCSSGridItem = new SceneCSSGridItem({\n      $behaviors: [yAxisSyncBehavior],\n      body: vizPanel,\n      isHidden,\n    });\n\n    return item;\n  }\n\n  const { sortBy } = getSortByPreference('labels', 'outliers');\n  const getFilter = () => searchScene.state.filter ?? '';\n\n  return new LayoutSwitcher({\n    $data: new SceneQueryRunner({\n      datasource: trailDS,\n      maxDataPoints: MDP_METRIC_PREVIEW,\n      queries: queryDef.queries,\n    }),\n    breakdownLayoutOptions: [\n      { value: 'single', label: 'Single' },\n      { value: 'grid', label: 'Grid' },\n      { value: 'rows', label: 'Rows' },\n    ],\n    onBreakdownLayoutChange,\n    breakdownLayouts: [\n      new SceneFlexLayout({\n        direction: 'column',\n        children: [\n          new SceneFlexItem({\n            minHeight: 300,\n            body: PanelBuilders.timeseries()\n              .setOption('tooltip', { mode: TooltipDisplayMode.Multi, sort: SortOrder.Descending })\n              .setOption('legend', { showLegend: false })\n              .setTitle('$metric')\n              .build(),\n          }),\n        ],\n      }),\n      new ByFrameRepeater({\n        body: new SceneCSSGridLayout({\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: METRICS_VIZ_PANEL_HEIGHT,\n          children: [\n            new SceneFlexItem({\n              body: new SceneReactObject({\n                reactNode: <LoadingPlaceholder text=\"Loading...\" />,\n              }),\n            }),\n          ],\n        }),\n        getLayoutChild,\n        sortBy,\n        getFilter,\n      }),\n      new ByFrameRepeater({\n        body: new SceneCSSGridLayout({\n          templateColumns: '1fr',\n          autoRows: METRICS_VIZ_PANEL_HEIGHT,\n          children: [],\n        }),\n        getLayoutChild,\n        sortBy,\n        getFilter,\n      }),\n    ],\n  });\n}\n\nfunction getLabelValue(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels || {};\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return '<unspecified>';\n  }\n\n  return labels[keys[0]];\n}\n\ninterface SelectLabelActionState extends SceneObjectState {\n  labelName: string;\n}\n\nexport class SelectLabelAction extends SceneObjectBase<SelectLabelActionState> {\n  public onClick = () => {\n    const label = this.state.labelName;\n\n    reportExploreMetrics('label_selected', { label, cause: 'breakdown_panel' });\n    getBreakdownSceneFor(this).onChange(label);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<AddToFiltersGraphAction>) => {\n    return (\n      <Button variant=\"secondary\" size=\"sm\" fill=\"outline\" onClick={model.onClick}>\n        Select\n      </Button>\n    );\n  };\n}\n\nfunction getBreakdownSceneFor(model: SceneObject): LabelBreakdownScene {\n  if (model instanceof LabelBreakdownScene) {\n    return model;\n  }\n\n  if (model.parent) {\n    return getBreakdownSceneFor(model.parent);\n  }\n\n  throw new Error('Unable to find breakdown scene');\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  getExploreURL,\n  sceneGraph,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Box, Icon, LinkButton, Stack, Tab, TabsBar, ToolbarButton, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { AutoVizPanel } from 'autoQuery/components/AutoVizPanel';\nimport { UI_TEXT } from 'constants/ui';\nimport { reportExploreMetrics } from 'interactions';\nimport { METRIC_AUTOVIZPANEL_KEY } from 'MetricGraphScene';\nimport { MetricScene } from 'MetricScene';\nimport { RelatedMetricsScene } from 'RelatedMetricsScene/RelatedMetricsScene';\nimport { MetricSelectedEvent } from 'shared';\nimport { ShareTrailButton } from 'ShareTrailButton';\nimport { useBookmarkState } from 'TrailStore/useBookmarkState';\nimport { getTrailFor, getUrlForTrail } from 'utils';\n\nimport { LabelBreakdownScene } from './Breakdown/LabelBreakdownScene';\n\nexport const actionViews = {\n  breakdown: 'breakdown',\n  related: 'related',\n  relatedLogs: 'logs',\n} as const;\n\nexport type ActionViewType = (typeof actionViews)[keyof typeof actionViews];\n\ninterface ActionViewDefinition {\n  displayName: string;\n  value: ActionViewType;\n  description?: string;\n  getScene: (metricScene: MetricScene) => SceneObject<SceneObjectState>;\n}\n\nexport const actionViewsDefinitions: ActionViewDefinition[] = [\n  {\n    displayName: 'Breakdown',\n    value: actionViews.breakdown,\n    getScene: () => new LabelBreakdownScene({}),\n  },\n  {\n    displayName: 'Related metrics',\n    value: actionViews.related,\n    getScene: (metricScene: MetricScene) => new RelatedMetricsScene({ metric: metricScene.state.metric }),\n    description: 'Relevant metrics based on current label filters',\n  },\n  {\n    displayName: 'Related logs',\n    value: actionViews.relatedLogs,\n    getScene: (metricScene: MetricScene) => metricScene.createRelatedLogsScene(),\n    description: 'Relevant logs based on current label filters and time range',\n  },\n];\n\ninterface MetricActionBarState extends SceneObjectState {}\n\nexport class MetricActionBar extends SceneObjectBase<MetricActionBarState> {\n  public getLinkToExplore = async () => {\n    const metricScene = sceneGraph.getAncestor(this, MetricScene);\n    const autoVizPanel = sceneGraph.findByKeyAndType(this, METRIC_AUTOVIZPANEL_KEY, AutoVizPanel);\n    const panelData =\n      typeof autoVizPanel.state.panel !== 'undefined'\n        ? sceneGraph.getData(autoVizPanel.state.panel).state.data\n        : undefined;\n\n    if (!panelData) {\n      throw new Error('Cannot get link to explore, no panel data found');\n    }\n\n    return getExploreURL(panelData, metricScene, panelData.timeRange);\n  };\n\n  public openExploreLink = async () => {\n    reportExploreMetrics('selected_metric_action_clicked', { action: 'open_in_explore' });\n    this.getLinkToExplore().then((link) => {\n      // We use window.open instead of a Link or <a> because we want to compute the explore link when clicking,\n      // if we precompute it we have to keep track of a lot of dependencies\n      window.open(link, '_blank');\n    });\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricActionBar>) => {\n    const metricScene = sceneGraph.getAncestor(model, MetricScene);\n    const styles = useStyles2(getStyles);\n    const trail = getTrailFor(model);\n    const [isBookmarked, toggleBookmark] = useBookmarkState(trail);\n    const { actionView } = metricScene.useState();\n\n    return (\n      <Box paddingY={1} data-testid=\"action-bar\">\n        <div className={styles.actions}>\n          <Stack gap={1}>\n            <ToolbarButton\n              variant={'canvas'}\n              tooltip={UI_TEXT.METRIC_SELECT_SCENE.SELECT_NEW_METRIC_TOOLTIP}\n              onClick={() => {\n                reportExploreMetrics('selected_metric_action_clicked', { action: 'unselect' });\n                trail.publishEvent(new MetricSelectedEvent(undefined));\n              }}\n            >\n              Select new metric\n            </ToolbarButton>\n            <ToolbarButton\n              variant={'canvas'}\n              icon=\"compass\"\n              tooltip={UI_TEXT.METRIC_SELECT_SCENE.OPEN_EXPLORE_LABEL}\n              onClick={model.openExploreLink}\n            />\n            <ShareTrailButton trail={trail} />\n            <ToolbarButton\n              variant={'canvas'}\n              icon={\n                isBookmarked ? (\n                  <Icon name={'favorite'} type={'mono'} size={'lg'} />\n                ) : (\n                  <Icon name={'star'} type={'default'} size={'lg'} />\n                )\n              }\n              tooltip={UI_TEXT.METRIC_SELECT_SCENE.BOOKMARK_LABEL}\n              onClick={toggleBookmark}\n            />\n            {trail.state.embedded && (\n              <LinkButton\n                href={getUrlForTrail(trail)}\n                variant={'secondary'}\n                onClick={() => reportExploreMetrics('selected_metric_action_clicked', { action: 'open_from_embedded' })}\n              >\n                Open\n              </LinkButton>\n            )}\n          </Stack>\n        </div>\n\n        <TabsBar className={styles.customTabsBar}>\n          {actionViewsDefinitions.map((tab, index) => {\n            const label = tab.displayName;\n            const counter = tab.value === actionViews.relatedLogs ? metricScene.state.relatedLogsCount : undefined;\n            const isActive = actionView === tab.value;\n\n            const tabRender = (\n              <Tab\n                key={index}\n                label={label}\n                counter={counter}\n                active={isActive}\n                onChangeTab={() => {\n                  if (isActive) {\n                    return;\n                  }\n\n                  reportExploreMetrics('metric_action_view_changed', {\n                    view: tab.value,\n                    related_logs_count: metricScene.relatedLogsOrchestrator.checkConditionsMetForRelatedLogs()\n                      ? counter\n                      : undefined,\n                  });\n\n                  metricScene.setActionView(tab.value);\n                }}\n              />\n            );\n\n            if (tab.description) {\n              return (\n                <Tooltip key={index} content={tab.description} placement=\"top\" theme=\"info\">\n                  {tabRender}\n                </Tooltip>\n              );\n            }\n            return tabRender;\n          })}\n        </TabsBar>\n      </Box>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    actions: css({\n      [theme.breakpoints.up(theme.breakpoints.values.md)]: {\n        position: 'absolute',\n        right: 0,\n        top: 16,\n        zIndex: 2,\n      },\n    }),\n    customTabsBar: css({\n      paddingBottom: theme.spacing(1),\n    }),\n  };\n}\n","import { SceneObjectStateChangedEvent } from '@grafana/scenes';\nimport { useEffect, useState } from 'react';\n\nimport { type DataTrail } from '../DataTrail';\nimport { reportExploreMetrics } from '../interactions';\nimport { getTrailStore } from './TrailStore';\n\nexport function useBookmarkState(trail: DataTrail) {\n  // Note that trail object may stay the same, but the state used by `getBookmarkIndex` result may\n  // differ for each re-render of this hook\n  const getBookmarkIndex = () => getTrailStore().getBookmarkIndex(trail);\n\n  const indexOnRender = getBookmarkIndex();\n\n  const [bookmarkIndex, setBookmarkIndex] = useState(indexOnRender);\n\n  useEffect(() => {\n    const sub = trail.subscribeToEvent(SceneObjectStateChangedEvent, () => {\n      setBookmarkIndex(getTrailStore().getBookmarkIndex(trail));\n    });\n    return () => sub.unsubscribe();\n  }, [trail]);\n\n  // Check if index changed and force a re-render\n  if (indexOnRender !== bookmarkIndex) {\n    setBookmarkIndex(indexOnRender);\n  }\n\n  const isBookmarked = bookmarkIndex != null;\n\n  const toggleBookmark = () => {\n    reportExploreMetrics('bookmark_changed', { action: isBookmarked ? 'toggled_off' : 'toggled_on' });\n    if (isBookmarked) {\n      let indexToRemove = getBookmarkIndex();\n      while (indexToRemove != null) {\n        // This loop will remove all indices that have an equivalent bookmark key\n        getTrailStore().removeBookmark(indexToRemove);\n        indexToRemove = getBookmarkIndex();\n      }\n    } else {\n      getTrailStore().addBookmark(trail);\n    }\n    setBookmarkIndex(getBookmarkIndex());\n  };\n\n  const result: [typeof isBookmarked, typeof toggleBookmark] = [isBookmarked, toggleBookmark];\n  return result;\n}\n","import { type AdHocVariableFilter, type TimeRange } from '@grafana/data';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { createMetricsLogsConnector, type FoundLokiDataSource } from './base';\nimport { VAR_FILTERS } from '../../shared';\nimport { getTrailFor } from '../../utils';\nimport { getDataSourceFetcher } from '../../utils/utils.datasource';\nimport { isAdHocFiltersVariable } from '../../utils/utils.variables';\n\nconst knownLabelNameDiscrepancies = {\n  job: 'service_name', // `service.name` is `job` in Mimir and `service_name` in Loki\n  instance: 'service_instance_id', // `service.instance.id` is `instance` in Mimir and `service_instance_id` in Loki\n} as const;\n\nfunction isLabelNameThatShouldBeReplaced(x: string): x is keyof typeof knownLabelNameDiscrepancies {\n  return x in knownLabelNameDiscrepancies;\n}\n\nfunction replaceKnownLabelNames(labelName: string): string {\n  if (isLabelNameThatShouldBeReplaced(labelName)) {\n    return knownLabelNameDiscrepancies[labelName];\n  }\n\n  return labelName;\n}\n\n/**\n * Checks if a Loki data source has labels matching the current filters\n */\nasync function hasMatchingLabels(datasourceUid: string, filters: AdHocVariableFilter[], timeRange?: TimeRange) {\n  const ds = await getDataSourceSrv().get(datasourceUid);\n\n  // Get all available label keys for this data source\n  const labelKeys = await ds.getTagKeys?.({\n    timeRange,\n    filters: filters.map(({ key, operator, value }) => ({\n      key: replaceKnownLabelNames(key),\n      operator,\n      value,\n    })),\n  });\n\n  if (!Array.isArray(labelKeys)) {\n    return false;\n  }\n\n  const availableLabels = new Set(labelKeys.map((key) => key.text));\n\n  // Early return if none of our filter labels exist in this data source\n  const mappedFilterLabels = filters.map((f) => replaceKnownLabelNames(f.key));\n  const hasRequiredLabels = mappedFilterLabels.every((label) => availableLabels.has(label));\n  if (!hasRequiredLabels) {\n    return false;\n  }\n\n  // Check if each filter's value exists for its label\n  const results = await Promise.all(\n    filters.map(async (filter) => {\n      const lokiLabelName = replaceKnownLabelNames(filter.key);\n      const values = await ds.getTagValues?.({\n        key: lokiLabelName,\n        timeRange,\n        filters,\n      });\n\n      if (!Array.isArray(values)) {\n        return false;\n      }\n\n      return values.some((v) => v.text === filter.value);\n    })\n  );\n\n  // If any of the filters have no matching values, return false\n  return results.every(Boolean);\n}\n\nexport const createLabelsCrossReferenceConnector = (scene: SceneObject) => {\n  // In this connector, conditions have been met for related logs when label filters have been applied\n  let conditionsMetForRelatedLogs = false;\n\n  return createMetricsLogsConnector({\n    name: 'labelsCrossReference',\n    checkConditionsMetForRelatedLogs: () => conditionsMetForRelatedLogs,\n    async getDataSources(): Promise<FoundLokiDataSource[]> {\n      const trail = getTrailFor(scene);\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail);\n\n      if (!isAdHocFiltersVariable(filtersVariable) || !filtersVariable.state.filters.length) {\n        conditionsMetForRelatedLogs = false;\n        return [];\n      }\n\n      conditionsMetForRelatedLogs = true;\n      const filters = filtersVariable.state.filters.map(({ key, operator, value }) => ({ key, operator, value }));\n\n      // Get current time range if available\n      const timeRange = scene.state.$timeRange?.state.value;\n\n      const lokiDataSources = await getDataSourceFetcher().getHealthyDataSources('loki');\n      const results = await Promise.all(\n        lokiDataSources.map(async ({ uid, name }) => {\n          const hasLabels = await hasMatchingLabels(uid, filters, timeRange);\n          return hasLabels ? { uid, name } : null;\n        })\n      );\n\n      return results.filter((ds): ds is FoundLokiDataSource => ds !== null);\n    },\n    getLokiQueryExpr(): string {\n      const trail = getTrailFor(scene);\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail);\n\n      if (!isAdHocFiltersVariable(filtersVariable) || !filtersVariable.state.filters.length) {\n        return '';\n      }\n\n      const labelValuePairs = filtersVariable.state.filters.map(\n        (filter) => `${replaceKnownLabelNames(filter.key)}${filter.operator}\"${filter.value}\"`\n      );\n\n      return `{${labelValuePairs.join(',')}}`; // e.g. `{environment=\"dev\",region=\"us-west-1\"}`\n    },\n  });\n};\n","import { type DataSourceInstanceSettings, type DataSourceJsonData } from '@grafana/data';\nimport { MetricExpr, parser, PipelineExpr, Selector } from '@grafana/lezer-logql';\nimport { getBackendSrv, type BackendSrvRequest, type FetchResponse } from '@grafana/runtime';\nimport { type SyntaxNode } from '@lezer/common';\nimport { lastValueFrom } from 'rxjs';\n\nimport { createMetricsLogsConnector, type FoundLokiDataSource } from './base';\nimport { logger } from '../../tracking/logger/logger';\nimport { getDataSourceFetcher } from '../../utils/utils.datasource';\n\nexport interface RecordingRuleGroup {\n  name: string;\n  rules: RecordingRule[];\n}\n\nexport interface RecordingRule {\n  name: string;\n  query: string;\n  type: 'recording' | 'alerting' | string;\n  labels?: Record<string, string>;\n}\n\nexport interface ExtractedRecordingRule extends RecordingRule {\n  datasource: FoundLokiDataSource;\n  hasMultipleOccurrences?: boolean;\n}\n\nexport interface ExtractedRecordingRules {\n  [dataSourceUID: string]: ExtractedRecordingRule[];\n}\n\n/**\n * Fetch Loki recording rule groups from the specified datasource.\n *\n * @param datasourceSettings - The settings of the datasource instance.\n * @returns A promise that resolves to an array of recording rule groups.\n */\nasync function fetchRecordingRuleGroups(datasourceSettings: DataSourceInstanceSettings<DataSourceJsonData>) {\n  const recordingRuleUrl = `api/prometheus/${datasourceSettings.uid}/api/v1/rules`;\n  const recordingRules: BackendSrvRequest = { url: recordingRuleUrl, showErrorAlert: false, showSuccessAlert: false };\n  const res = await lastValueFrom<\n    FetchResponse<{\n      data: { groups: RecordingRuleGroup[] };\n    }>\n  >(getBackendSrv().fetch(recordingRules));\n\n  if (!res.ok) {\n    logger.warn(`Failed to fetch recording rules from Loki data source: ${datasourceSettings.name}`);\n    return [];\n  }\n\n  return res.data.data.groups;\n}\n\n/**\n * Extract recording rules from the provided rule groups and associate them with the given data source.\n *\n * @param ruleGroups - An array of recording rule groups to extract rules from.\n * @param ds - The data source instance settings to associate with the extracted rules.\n * @returns An array of extracted recording rules, each associated with the provided data source.\n */\nexport function extractRecordingRulesFromRuleGroups(\n  ruleGroups: RecordingRuleGroup[],\n  ds: DataSourceInstanceSettings<DataSourceJsonData>\n): ExtractedRecordingRule[] {\n  if (ruleGroups.length === 0) {\n    return [];\n  }\n\n  // We only want to return the first matching rule when there are multiple rules with same name\n  const extractedRules = new Map<string, ExtractedRecordingRule>();\n  ruleGroups.forEach((rg) => {\n    rg.rules\n      .filter((r) => r.type === 'recording')\n      .forEach(({ type, name, query }) => {\n        const isExist = extractedRules.has(name);\n        if (isExist) {\n          // We already have the rule.\n          const existingRule = extractedRules.get(name);\n          if (existingRule) {\n            existingRule.hasMultipleOccurrences = true;\n            extractedRules.set(name, existingRule);\n          }\n        } else {\n          extractedRules.set(name, {\n            type,\n            name,\n            query,\n            datasource: {\n              name: ds.name,\n              uid: ds.uid,\n            },\n            hasMultipleOccurrences: false,\n          });\n        }\n      });\n  });\n\n  return Array.from(extractedRules.values());\n}\n\n/**\n * Retrieve an array of Loki data sources that contain recording rules with the specified metric name.\n *\n * @param metricName - The name of the metric to search for within the recording rules.\n * @param extractedRecordingRules - An object containing extracted recording rules, where each key is a string and the value is an array of recording rules.\n * @returns An array of `FoundLokiDataSource` objects that contain recording rules with the specified metric name.\n */\nexport function getDataSourcesWithRecordingRulesContainingMetric(\n  metricName: string,\n  extractedRecordingRules: ExtractedRecordingRules\n): FoundLokiDataSource[] {\n  const foundLokiDataSources: FoundLokiDataSource[] = [];\n  Object.values(extractedRecordingRules).forEach((recRules) => {\n    recRules\n      .filter((rr) => rr.name === metricName)\n      .forEach((rr) => {\n        foundLokiDataSources.push(rr.datasource);\n      });\n  });\n\n  return foundLokiDataSources;\n}\n\n/**\n * Generate a Loki query string for a related metric based on the provided metric name, data source ID,\n * and extracted recording rules.\n *\n * @param metricName - The name of the metric for which to generate the Loki query.\n * @param dataSourceUid - The UID of the data source containing the recording rules.\n * @param extractedRecordingRules - An object containing recording rules, indexed by data source UID.\n * @returns The generated Loki query string, or an empty string if the data source UID or metric name is not found.\n */\nexport function getLokiQueryForRelatedMetric(\n  metricName: string,\n  dataSourceUid: string,\n  extractedRecordingRules: ExtractedRecordingRules\n): string {\n  if (!dataSourceUid || !extractedRecordingRules[dataSourceUid]) {\n    return '';\n  }\n  const targetRule = extractedRecordingRules[dataSourceUid].find((rule) => rule.name === metricName);\n  if (!targetRule) {\n    return '';\n  }\n  const lokiQuery = getLogQueryFromMetricsQuery(targetRule.query);\n\n  return lokiQuery;\n}\n\n/**\n * Fetch and extract Loki recording rules from all Loki data sources.\n *\n * @returns {Promise<ExtractedRecordingRules>} A promise that resolves to an object containing\n * the extracted recording rules, keyed by data source UID.\n *\n * @throws Will log a warning if fetching or extracting rules fails for any data source.\n */\nexport async function fetchAndExtractLokiRecordingRules() {\n  const lokiDataSources = await getDataSourceFetcher().getHealthyDataSources('loki');\n  const extractedRecordingRules: ExtractedRecordingRules = {};\n  await Promise.all(\n    lokiDataSources.map(async (dataSource) => {\n      try {\n        const ruleGroups: RecordingRuleGroup[] = await fetchRecordingRuleGroups(dataSource);\n        const extractedRules = extractRecordingRulesFromRuleGroups(ruleGroups, dataSource);\n        extractedRecordingRules[dataSource.uid] = extractedRules;\n      } catch (err) {\n        logger.warn(err);\n      }\n    })\n  );\n\n  return extractedRecordingRules;\n}\n\nexport const createLokiRecordingRulesConnector = () => {\n  let lokiRecordingRules: ExtractedRecordingRules = {};\n\n  // In this connector, conditions have been met for related logs\n  // when we find at least one data source with recording rules\n  // containing the selected metric\n  let conditionsMetForRelatedLogs = false;\n\n  return createMetricsLogsConnector({\n    name: 'lokiRecordingRules',\n    checkConditionsMetForRelatedLogs: () => conditionsMetForRelatedLogs,\n    async getDataSources(selectedMetric: string): Promise<FoundLokiDataSource[]> {\n      lokiRecordingRules = await fetchAndExtractLokiRecordingRules();\n      const lokiDataSources = getDataSourcesWithRecordingRulesContainingMetric(selectedMetric, lokiRecordingRules);\n      conditionsMetForRelatedLogs = Boolean(lokiDataSources.length);\n\n      return lokiDataSources;\n    },\n    getLokiQueryExpr(selectedMetric: string, datasourceUid: string): string {\n      return getLokiQueryForRelatedMetric(selectedMetric, datasourceUid, lokiRecordingRules);\n    },\n  });\n};\n\n/**\n * Returns whether the given query is a logs query (not a metrics query)\n * A query that's at least 3 characters long and doesn't contain a MetricExpr node is considered a logs query\n */\nfunction isLogsQuery(query: string): boolean {\n  if (query.trim().length <= 2) {\n    return false;\n  }\n\n  let hasMetricExpr = false;\n  const tree = parser.parse(query);\n\n  tree.iterate({\n    enter: ({ type }): false | void => {\n      if (type.id === MetricExpr) {\n        hasMetricExpr = true;\n        return false;\n      }\n    },\n  });\n\n  return !hasMetricExpr;\n}\n\n/**\n * Gets a node of the specified type from a LogQL query string\n * Returns undefined if no node of that type is found\n */\nfunction getNodeFromQuery(query: string, nodeType: number): SyntaxNode | undefined {\n  let foundNode: SyntaxNode | undefined;\n  const tree = parser.parse(query);\n\n  tree.iterate({\n    enter: (node): false | void => {\n      if (node.type.id === nodeType) {\n        foundNode = node.node;\n        return false;\n      }\n    },\n  });\n\n  return foundNode;\n}\n\n/**\n * Extracts the underlying log query from a metrics query\n * For metrics queries, it returns the selector and pipeline parts\n * For logs queries, it returns the original query unchanged\n * Returns an empty string if no valid query can be extracted\n *\n * @example\n * // Returns '{foo=\"bar\"} |= \"error\"'\n * getLogQueryFromMetricsQuery('rate({foo=\"bar\"} |= \"error\"[5m])')\n *\n * // Returns '{foo=\"bar\"}'\n * getLogQueryFromMetricsQuery('sum(rate({foo=\"bar\"}[5m]))')\n *\n * // Returns original query unchanged\n * getLogQueryFromMetricsQuery('{foo=\"bar\"} |= \"error\"')\n */\nexport function getLogQueryFromMetricsQuery(query: string): string {\n  // If it's already a logs query, return as-is\n  if (isLogsQuery(query)) {\n    return query;\n  }\n\n  // Get the selector node which contains the log query matchers\n  const selectorNode = getNodeFromQuery(query, Selector);\n  if (!selectorNode) {\n    return '';\n  }\n\n  const selector = query.substring(selectorNode.from, selectorNode.to);\n\n  // Get the pipeline expression node if it exists (contains filters, parsers etc.)\n  const pipelineExprNode = getNodeFromQuery(query, PipelineExpr);\n  const pipelineExpr = pipelineExprNode ? query.substring(pipelineExprNode.from, pipelineExprNode.to) : '';\n\n  // Combine selector with pipeline expression if it exists\n  return `${selector} ${pipelineExpr}`.trim();\n}\n","import { LoadingState } from '@grafana/data';\nimport { SceneQueryRunner } from '@grafana/scenes';\n\nimport { type MetricsLogsConnector } from '../Integrations/logs/base';\nimport { createLabelsCrossReferenceConnector } from '../Integrations/logs/labelsCrossReference';\nimport { createLokiRecordingRulesConnector } from '../Integrations/logs/lokiRecordingRules';\nimport { type MetricScene } from '../MetricScene';\nimport pluginJson from '../plugin.json';\nimport { getDataSourceFetcher, type DataSource } from '../utils/utils.datasource';\n\n/**\n * Manager class that handles the orchestration of related logs functionality.\n * This centralizes logs-related logic that was previously spread across multiple components.\n */\nexport class RelatedLogsOrchestrator {\n  private readonly _logsConnectors: MetricsLogsConnector[];\n  private readonly _metricScene: MetricScene;\n  private readonly _dataSourceFetcher = getDataSourceFetcher();\n  private readonly _changeHandlers = {\n    lokiDataSources: [] as Array<(dataSources: DataSource[]) => void>,\n    relatedLogsCount: [] as Array<(count: number) => void>,\n  };\n  /**\n   * Internal state that powers public properties defined by getters and setters.\n   */\n  private readonly _internalState = {\n    relatedLogsCount: 0,\n    lokiDataSources: [] as DataSource[],\n  };\n\n  constructor(metricScene: MetricScene) {\n    this._metricScene = metricScene;\n    this._logsConnectors = [createLokiRecordingRulesConnector(), createLabelsCrossReferenceConnector(metricScene)];\n  }\n\n  get lokiDataSources() {\n    return this._internalState.lokiDataSources;\n  }\n\n  set lokiDataSources(dataSources: DataSource[]) {\n    const currentDataSourcesSignature = this._internalState.lokiDataSources.map((ds) => ds.uid).join(',');\n    const newDataSourcesSignature = dataSources.map((ds) => ds.uid).join(',');\n\n    if (currentDataSourcesSignature && currentDataSourcesSignature === newDataSourcesSignature) {\n      return;\n    }\n\n    this._internalState.lokiDataSources = dataSources;\n    this._changeHandlers.lokiDataSources.forEach((handler) => handler(this._internalState.lokiDataSources));\n  }\n\n  set relatedLogsCount(count: number) {\n    this._internalState.relatedLogsCount = count;\n    this._changeHandlers.relatedLogsCount.forEach((handler) => handler(this._internalState.relatedLogsCount));\n  }\n\n  /**\n   * Add a listener that will be called when the lokiDataSources change.\n   */\n  addLokiDataSourcesChangeHandler(handler: (dataSources: DataSource[]) => void) {\n    this._changeHandlers.lokiDataSources.push(handler);\n  }\n\n  /**\n   * Add a listener that will be called when the relatedLogsCount changes.\n   */\n  addRelatedLogsCountChangeHandler(handler: (count: number) => void) {\n    this._changeHandlers.relatedLogsCount.push(handler);\n  }\n\n  /**\n   * Called when filters change to re-check for logs in datasources.\n   */\n  public handleFiltersChange(): void {\n    if (!this.lokiDataSources) {\n      return;\n    }\n\n    // When filters change, we need to reset our state to trigger updates in listeners\n    // Setting to empty array (vs undefined) signals we're actively checking\n    this.lokiDataSources = [];\n    this.relatedLogsCount = 0;\n\n    // Check all available datasources for logs after filter changes\n    this.findAndCheckAllDatasources();\n  }\n\n  /**\n   * Find all available datasources and check them for logs.\n   * This is used when filters change to ensure we're checking all possible datasources.\n   */\n  public async findAndCheckAllDatasources(): Promise<void> {\n    // Get all available Loki datasources\n    const allLokiDatasources = await this._dataSourceFetcher.getHealthyDataSources('loki');\n\n    // Check all datasources for logs\n    if (allLokiDatasources.length > 0) {\n      this.checkLogsInDataSources(allLokiDatasources);\n    } else {\n      // No datasources available\n      this.lokiDataSources = [];\n      this.relatedLogsCount = 0;\n    }\n  }\n\n  /**\n   * Get the Loki queries for a given datasource.\n   */\n  public getLokiQueries(\n    datasourceUid: string,\n    maxLines = 100\n  ): Array<{ refId: string; expr: string; maxLines: number }> {\n    const { metric } = this._metricScene.state;\n    const queriesByConnector = this._logsConnectors.reduce<Record<string, string>>((acc, connector, idx) => {\n      const lokiExpr = connector.getLokiQueryExpr(metric, datasourceUid);\n      if (lokiExpr) {\n        acc[connector.name ?? `connector-${idx}`] = lokiExpr;\n      }\n      return acc;\n    }, {});\n\n    const queries = Object.keys(queriesByConnector).map((connectorName) => ({\n      refId: `RelatedLogs-${connectorName}`,\n      expr: queriesByConnector[connectorName],\n      maxLines,\n      supportingQueryType: pluginJson.id,\n    }));\n\n    return queries;\n  }\n\n  /**\n   * Check each datasource for logs, then update the datasources and relatedLogsCount accordingly.\n   */\n  private checkLogsInDataSources(datasources: DataSource[]): void {\n    // Check each datasource for logs\n    const datasourcesWithLogs: DataSource[] = [];\n    let totalLogsCount = 0;\n    let totalChecked = 0;\n\n    // If no datasources to check, update immediately\n    if (datasources.length === 0) {\n      this.lokiDataSources = [];\n      this.relatedLogsCount = 0;\n      return;\n    }\n\n    // Check each datasource for logs\n    datasources.forEach((datasource) => {\n      const queryRunner = new SceneQueryRunner({\n        datasource: { uid: datasource.uid },\n        queries: [],\n        key: `related_logs_check_${datasource.uid}`,\n      });\n\n      // Build and set queries\n      queryRunner.setState({\n        queries: this.getLokiQueries(datasource.uid),\n      });\n\n      // Subscribe to results\n      queryRunner.subscribeToState((state) => {\n        if (state.data?.state === LoadingState.Done) {\n          totalChecked++;\n\n          // Check if we found logs in this datasource\n          if (state.data?.series) {\n            const rowCount = state.data.series.reduce((sum: number, frame) => sum + frame.length, 0);\n            if (rowCount > 0) {\n              // This datasource has logs\n              datasourcesWithLogs.push(datasource);\n              totalLogsCount += rowCount;\n            }\n          }\n\n          // When all datasources have been checked\n          if (totalChecked === datasources.length) {\n            // Update state with our findings\n            this.lokiDataSources = datasourcesWithLogs;\n            this.relatedLogsCount = totalLogsCount;\n          }\n        }\n      });\n\n      // Activate query\n      queryRunner.activate();\n    });\n  }\n\n  /**\n   * Returns true if any of the connectors have conditions met for related logs to be shown.\n   */\n  public checkConditionsMetForRelatedLogs(): boolean {\n    return this._logsConnectors.some((connector) => connector.checkConditionsMetForRelatedLogs());\n  }\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Alert, Stack, Text, TextLink, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport function NoRelatedLogs() {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <Stack direction=\"column\" gap={2}>\n      <Alert title=\"No related logs found\" severity=\"info\">\n        We couldn&apos;t find any logs related to the current metric with your selected filters.\n      </Alert>\n      <Text>\n        To find related logs, try the following:\n        <ul className={styles.list}>\n          <li>Adjust your label filters to include labels that exist in both the current metric and your logs</li>\n          <li>\n            Select a metric created by a{' '}\n            <TextLink external href=\"https://grafana.com/docs/loki/latest/alert/#recording-rules\">\n              Loki Recording Rule\n            </TextLink>\n          </li>\n          <li>Broaden the time range to include more data</li>\n        </ul>\n      </Text>\n      <Text variant=\"bodySmall\" color=\"secondary\">\n        Note: Related logs is an experimental feature.\n      </Text>\n    </Stack>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    list: css({\n      paddingLeft: theme.spacing(2),\n      marginTop: theme.spacing(1),\n    }),\n  };\n}\n","import { LoadingState } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport {\n  CustomVariable,\n  PanelBuilders,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneQueryRunner,\n  SceneReactObject,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  VariableValueSelectors,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneVariable,\n} from '@grafana/scenes';\nimport { LinkButton, Stack } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { VAR_FILTERS, VAR_LOGS_DATASOURCE, VAR_LOGS_DATASOURCE_EXPR } from '../shared';\nimport { NoRelatedLogs } from './NoRelatedLogsFound';\nimport { type RelatedLogsOrchestrator } from './RelatedLogsOrchestrator';\nimport { isCustomVariable } from '../utils/utils.variables';\n\ninterface RelatedLogsSceneProps {\n  orchestrator: RelatedLogsOrchestrator;\n}\n\nexport interface RelatedLogsSceneState extends SceneObjectState, RelatedLogsSceneProps {\n  controls: SceneObject[];\n  body: SceneCSSGridLayout;\n}\n\nconst LOGS_PANEL_CONTAINER_KEY = 'related_logs/logs_panel_container';\nconst RELATED_LOGS_QUERY_KEY = 'related_logs/logs_query';\n\nexport class RelatedLogsScene extends SceneObjectBase<RelatedLogsSceneState> {\n  private _queryRunner?: SceneQueryRunner;\n\n  constructor(props: RelatedLogsSceneProps) {\n    super({\n      controls: [],\n      body: new SceneCSSGridLayout({\n        templateColumns: '1fr',\n        autoRows: 'minmax(300px, 1fr)',\n        children: [\n          new SceneCSSGridItem({\n            key: LOGS_PANEL_CONTAINER_KEY,\n            body: undefined,\n          }),\n        ],\n      }),\n      orchestrator: props.orchestrator,\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    // Register handler for future changes to lokiDataSources\n    this.state.orchestrator.addLokiDataSourcesChangeHandler(() => this.setupLogsPanel());\n\n    // If data sources have already been loaded, we don't need to fetch them again\n    if (!this.state.orchestrator.lokiDataSources.length) {\n      this.state.orchestrator.findAndCheckAllDatasources();\n    } else {\n      this.setupLogsPanel();\n    }\n  }\n\n  private showNoLogsFound() {\n    const logsPanelContainer = sceneGraph.findByKeyAndType(this, LOGS_PANEL_CONTAINER_KEY, SceneCSSGridItem);\n    logsPanelContainer.setState({\n      body: new SceneReactObject({ component: NoRelatedLogs }),\n    });\n    this.setState({\n      controls: undefined,\n    });\n    this.state.orchestrator.relatedLogsCount = 0;\n  }\n\n  private setupLogsPanel(): void {\n    if (!this.state.orchestrator.lokiDataSources.length) {\n      this.showNoLogsFound();\n      return;\n    }\n\n    // Clean up existing query runner if it exists\n    if (this._queryRunner) {\n      this._queryRunner.setState({ queries: [] });\n      this._queryRunner = undefined;\n    }\n\n    // Initialize query runner\n    this._queryRunner = new SceneQueryRunner({\n      datasource: { uid: VAR_LOGS_DATASOURCE_EXPR },\n      queries: [],\n      key: RELATED_LOGS_QUERY_KEY,\n    });\n\n    // Set up subscription to query results\n    this._subs.add(\n      this._queryRunner.subscribeToState((state) => {\n        // Only process completed query results\n        if (state.data?.state === LoadingState.Done) {\n          const totalRows = state.data.series\n            ? state.data.series.reduce((sum: number, frame) => sum + frame.length, 0)\n            : 0;\n\n          // Show NoRelatedLogs if no logs found\n          if (totalRows === 0 || !state.data.series?.length) {\n            this.showNoLogsFound();\n          }\n        }\n      })\n    );\n\n    // Set up UI for logs panel\n    const logsPanelContainer = sceneGraph.findByKeyAndType(this, LOGS_PANEL_CONTAINER_KEY, SceneCSSGridItem);\n    logsPanelContainer.setState({\n      body: PanelBuilders.logs().setTitle('Logs').setData(this._queryRunner).build(),\n    });\n\n    // Set up variables for datasource selection\n    const logsDataSourceVariable = new CustomVariable({\n      name: VAR_LOGS_DATASOURCE,\n      label: 'Logs data source',\n      query: this.state.orchestrator.lokiDataSources.map((ds) => `${ds.name} : ${ds.uid}`).join(','),\n    });\n    this.setState({\n      $variables: new SceneVariableSet({ variables: [logsDataSourceVariable] }),\n      controls: [new VariableValueSelectors({ layout: 'vertical' })],\n    });\n    this._subs.add(\n      logsDataSourceVariable.subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          reportExploreMetrics('related_logs_action_clicked', { action: 'logs_data_source_changed' });\n        }\n      })\n    );\n\n    // Update Loki query\n    this.updateLokiQuery();\n  }\n\n  /**\n   * Updates the Loki query based on the configured connectors, selected datasource, and current filters.\n   * This function is called when the selected datasource or filters change.\n   */\n  private updateLokiQuery() {\n    if (!this._queryRunner) {\n      return;\n    }\n\n    const selectedDatasourceVar = sceneGraph.lookupVariable(VAR_LOGS_DATASOURCE, this);\n\n    let selectedDatasourceUid: string | undefined = undefined;\n\n    if (isCustomVariable(selectedDatasourceVar)) {\n      selectedDatasourceUid = selectedDatasourceVar.getValue() as string;\n    }\n\n    if (!selectedDatasourceUid) {\n      return;\n    }\n\n    const queries = this.state.orchestrator.getLokiQueries(selectedDatasourceUid);\n\n    // If no queries were generated, show the NoRelatedLogsScene\n    if (queries.length === 0) {\n      this.showNoLogsFound();\n      return;\n    }\n\n    // Update queries - this will trigger the query runner to fetch new data\n    // The query results will be processed in the subscription handler\n    this._queryRunner.setState({ queries });\n  }\n\n  // Handle variable changes\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_LOGS_DATASOURCE, VAR_FILTERS],\n    onReferencedVariableValueChanged: (variable: SceneVariable) => {\n      if (variable.state.name === VAR_FILTERS) {\n        this.state.orchestrator.handleFiltersChange();\n      } else if (variable.state.name === VAR_LOGS_DATASOURCE) {\n        this.updateLokiQuery();\n      }\n    },\n  });\n\n  static readonly Component = ({ model }: SceneComponentProps<RelatedLogsScene>) => {\n    const { controls, body } = model.useState();\n\n    return (\n      <Stack gap={1} direction={'column'} grow={1}>\n        <Stack gap={1} direction={'row'} justifyContent={'space-between'} alignItems={'start'}>\n          <Stack gap={1}>\n            {controls?.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n          </Stack>\n\n          <LinkButton\n            href={`${config.appSubUrl}/a/grafana-lokiexplore-app`} // We prefix with the appSubUrl for environments that don't host grafana at the root.\n            target=\"_blank\"\n            tooltip=\"Navigate to the Logs Drilldown app\"\n            variant=\"secondary\"\n            size=\"sm\"\n            onClick={() => reportExploreMetrics('related_logs_action_clicked', { action: 'open_logs_drilldown' })}\n          >\n            Open Logs Drilldown\n          </LinkButton>\n        </Stack>\n        <body.Component model={body} />\n      </Stack>\n    );\n  };\n}\n","import { config } from '@grafana/runtime';\nimport {\n  QueryVariable,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { actionViews, actionViewsDefinitions, type ActionViewType } from 'MetricActionBar';\n\nimport { getAutoQueriesForMetric } from './autoQuery/getAutoQueriesForMetric';\nimport { type AutoQueryDef, type AutoQueryInfo } from './autoQuery/types';\nimport { MAIN_PANEL_MAX_HEIGHT, MAIN_PANEL_MIN_HEIGHT, MetricGraphScene } from './MetricGraphScene';\nimport { RelatedLogsOrchestrator } from './RelatedLogs/RelatedLogsOrchestrator';\nimport { RelatedLogsScene } from './RelatedLogs/RelatedLogsScene';\nimport {\n  getVariablesWithMetricConstant,\n  RefreshMetricsEvent,\n  trailDS,\n  VAR_FILTERS,\n  VAR_GROUP_BY,\n  VAR_METRIC_EXPR,\n  type MakeOptional,\n} from './shared';\n\nexport interface MetricSceneState extends SceneObjectState {\n  body: MetricGraphScene;\n  metric: string;\n  autoQuery: AutoQueryInfo;\n  nativeHistogram?: boolean;\n  actionView?: ActionViewType;\n  queryDef?: AutoQueryDef;\n  relatedLogsCount?: number;\n}\n\nexport class MetricScene extends SceneObjectBase<MetricSceneState> {\n  public readonly relatedLogsOrchestrator = new RelatedLogsOrchestrator(this);\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['actionView'] });\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_FILTERS],\n    onReferencedVariableValueChanged: () => {\n      // When filters change, we need to re-check for related logs\n\n      this.relatedLogsOrchestrator.handleFiltersChange();\n    },\n  });\n\n  public constructor(state: MakeOptional<MetricSceneState, 'body' | 'autoQuery'>) {\n    const autoQuery = state.autoQuery ?? getAutoQueriesForMetric(state.metric, state.nativeHistogram);\n    super({\n      $variables: state.$variables ?? getVariableSet(state.metric),\n      body: state.body ?? new MetricGraphScene({}),\n      autoQuery,\n      queryDef: state.queryDef ?? autoQuery.main,\n      ...state,\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    if (this.state.actionView === undefined) {\n      this.setActionView(actionViews.breakdown);\n    }\n\n    this.relatedLogsOrchestrator.findAndCheckAllDatasources();\n    this.relatedLogsOrchestrator.addRelatedLogsCountChangeHandler((count) => {\n      this.setState({ relatedLogsCount: count });\n    });\n\n    if (config.featureToggles.enableScopesInMetricsExplore) {\n      // Push the scopes change event to the tabs\n      // The event is not propagated because the tabs are not part of the scene graph\n      this._subs.add(\n        this.subscribeToEvent(RefreshMetricsEvent, (event) => {\n          this.state.body.state.selectedTab?.publishEvent(event);\n        })\n      );\n    }\n  }\n\n  getUrlState() {\n    return { actionView: this.state.actionView };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    if (typeof values.actionView === 'string') {\n      if (this.state.actionView !== values.actionView) {\n        const actionViewDef = actionViewsDefinitions.find((v) => v.value === values.actionView);\n        if (actionViewDef) {\n          this.setActionView(actionViewDef.value);\n        }\n      }\n    } else if (values.actionView === null) {\n      this.setActionView(null);\n    }\n  }\n\n  public setActionView(actionViewType: ActionViewType | null) {\n    const { body } = this.state;\n    const actionViewDef = actionViewType ? actionViewsDefinitions.find((v) => v.value === actionViewType) : null;\n\n    if (actionViewDef && actionViewDef.value !== this.state.actionView) {\n      // reduce max height for main panel to reduce height flicker\n      body.state.topView.state.children[0].setState({ maxHeight: MAIN_PANEL_MIN_HEIGHT });\n      body.setState({ selectedTab: actionViewDef.getScene(this) });\n      this.setState({ actionView: actionViewDef.value });\n    } else {\n      // restore max height\n      body.state.topView.state.children[0].setState({ maxHeight: MAIN_PANEL_MAX_HEIGHT });\n      body.setState({ selectedTab: undefined });\n      this.setState({ actionView: undefined });\n    }\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MetricScene>) => {\n    const { body } = model.useState();\n    return (\n      <div data-testid=\"metric-scene\">\n        <body.Component model={body} />\n      </div>\n    );\n  };\n\n  public createRelatedLogsScene(): SceneObject<SceneObjectState> {\n    return new RelatedLogsScene({\n      orchestrator: this.relatedLogsOrchestrator,\n    });\n  }\n}\n\nfunction getVariableSet(metric: string) {\n  return new SceneVariableSet({\n    variables: [\n      ...getVariablesWithMetricConstant(metric),\n      new QueryVariable({\n        name: VAR_GROUP_BY,\n        label: 'Group by',\n        datasource: trailDS,\n        includeAll: true,\n        defaultToAll: true,\n        query: { query: `label_names(${VAR_METRIC_EXPR})`, refId: 'A' },\n        value: '',\n        text: '',\n      }),\n    ],\n  });\n}\n","import {\n  type AdHocFiltersVariable,\n  type ConstantVariable,\n  type CustomVariable,\n  type QueryVariable,\n  type SceneVariable,\n} from '@grafana/scenes';\n\ntype MaybeVariable = SceneVariable | null | undefined;\n\nexport function isConstantVariable(variable: MaybeVariable): variable is ConstantVariable {\n  return variable !== null && variable?.state.type === 'constant';\n}\n\nexport function isAdHocFiltersVariable(variable: MaybeVariable): variable is AdHocFiltersVariable {\n  return variable !== null && variable?.state.type === 'adhoc';\n}\n\nexport function isCustomVariable(variable: MaybeVariable): variable is CustomVariable {\n  return variable !== null && variable?.state.type === 'custom';\n}\n\nexport function isQueryVariable(variable: MaybeVariable): variable is QueryVariable {\n  return variable !== null && variable?.state.type === 'query';\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventMetricsVariableActivatedPayload {\n  key: string;\n}\n\nexport class EventMetricsVariableActivated extends BusEventWithPayload<EventMetricsVariableActivatedPayload> {\n  public static readonly type = 'metrics-variable-activated';\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Icon, Tooltip, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\ntype SectionTitleProps = {\n  title: string;\n  description: string;\n};\n\nexport function SectionTitle({ title, description }: Readonly<SectionTitleProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <h6 className={styles.title}>\n      <span>{title}</span>\n      <Tooltip content={description} placement=\"top\">\n        <Icon name=\"info-circle\" size=\"sm\" className={styles.infoIcon} />\n      </Tooltip>\n    </h6>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    title: css({\n      fontSize: '15px',\n      fontWeight: theme.typography.fontWeightLight,\n      borderBottom: `1px solid ${theme.colors.border.weak}`,\n      paddingBottom: theme.spacing(0.5),\n    }),\n    infoIcon: css({\n      marginLeft: theme.spacing(1),\n      cursor: 'pointer',\n      color: theme.colors.text.secondary,\n      position: 'relative',\n      top: '-4px',\n    }),\n  };\n}\n","import { isEqual } from 'lodash';\n\nexport const areArraysEqual = (array1: any[], array2: any[]) =>\n  array1.length === array2.length && isEqual(array1, array2);\n","import { parser } from '@prometheus-io/lezer-promql';\n\n/**\n * Extracts all metric names from a PromQL expression\n * @param {string} promqlExpression - The PromQL expression to parse\n * @returns {string[]} An array of unique metric names found in the expression\n */\nexport function extractMetricNames(promqlExpression: string): string[] {\n  const tree = parser.parse(promqlExpression);\n  const metricNames = new Set<string>();\n  const cursor = tree.cursor();\n\n  do {\n    // have we found a VectorSelector?\n    if (!cursor.type.is('VectorSelector')) {\n      continue;\n    }\n\n    // does it have a first child?\n    if (!cursor.firstChild()) {\n      continue;\n    }\n\n    do {\n      // ...let's look for any Identifier node\n      if (cursor.type.is('Identifier')) {\n        const metricName = promqlExpression.slice(cursor.from, cursor.to);\n        if (metricName) {\n          metricNames.add(metricName);\n        }\n      }\n    } while (cursor.nextSibling());\n\n    cursor.parent();\n  } while (cursor.next());\n\n  return Array.from(metricNames);\n}\n","import { getBackendSrv, type BackendSrvRequest } from '@grafana/runtime';\n\nimport { logger } from '../../../../tracking/logger/logger';\nimport { extractMetricNames } from '../../../../utils/utils.promql';\n\ninterface AlertingRule {\n  id: number;\n  uid: string;\n  title: string;\n  data: Array<{\n    refId: string;\n    queryType: string;\n    datasourceUid: string;\n    model: {\n      expr?: string;\n      expression?: string;\n      type?: string;\n      datasource?: {\n        type: string;\n        uid: string;\n      };\n    };\n  }>;\n}\n\nconst usageRequestOptions: Partial<BackendSrvRequest> = {\n  showSuccessAlert: false,\n  showErrorAlert: false,\n} as const;\n\n/**\n * Fetches metric usage data from alerting rules\n * @returns A record mapping metric names to their occurrence count in alerting rules\n */\nexport async function fetchAlertingMetrics(): Promise<Record<string, number>> {\n  try {\n    const alertingRules = await getBackendSrv().get<AlertingRule[]>(\n      '/api/v1/provisioning/alert-rules',\n      undefined,\n      'grafana-metricsdrilldown-app-alert-rule-metric-usage',\n      usageRequestOptions\n    );\n\n    return parseAlertingRules(alertingRules);\n  } catch (err) {\n    const error = typeof err === 'string' ? new Error(err) : (err as Error);\n    logger.error(error, {\n      message: 'Failed to fetch alerting rules',\n    });\n    // Return empty object when fetch fails\n    return {};\n  }\n}\n\nfunction parseAlertingRules(alertingRules: AlertingRule[]): Record<string, number> {\n  // Create a map to count metric occurrences\n  const metricCounts: Record<string, number> = {};\n\n  const relevantRules = alertingRules.filter((rule) => rule?.data.length > 0);\n\n  for (const rule of relevantRules) {\n    // Skip non-Prometheus queries or expression queries (like threshold or reduce expressions)\n    const prometheusQueries = rule.data.filter(\n      (query) => typeof query.model?.expr === 'string' && query.datasourceUid !== '__expr__'\n    );\n\n    for (const query of prometheusQueries) {\n      try {\n        // Extract metrics from the PromQL expression\n        const metrics = extractMetricNames(query.model.expr as string);\n\n        // Count each metric occurrence\n        for (const metric of metrics) {\n          metricCounts[metric] = (metricCounts[metric] || 0) + 1;\n        }\n      } catch (error) {\n        // Log parsing errors but continue processing other expressions\n        logger.warn(error, {\n          message: `Failed to parse PromQL expression in alert rule ${rule.title}`,\n        });\n      }\n    }\n  }\n\n  return metricCounts;\n}\n","import { getBackendSrv, type BackendSrvRequest } from '@grafana/runtime';\nimport { type Dashboard, type Panel } from '@grafana/schema';\nimport { limitFunction } from 'p-limit';\n\nimport { logger } from '../../../../tracking/logger/logger';\nimport { isPrometheusDataSource } from '../../../../utils/utils.datasource';\nimport { extractMetricNames } from '../../../../utils/utils.promql';\n\ninterface DashboardSearchItem {\n  id: number;\n  uid: string;\n  title: string;\n  url: string;\n  folderTitle?: string;\n  folderUid?: string;\n  tags: string[];\n  isStarred: boolean;\n}\n\nconst usageRequestOptions: Partial<BackendSrvRequest> = {\n  showSuccessAlert: false,\n  showErrorAlert: false,\n} as const;\n\nconst dashboardRequestMap = new Map<string, Promise<Dashboard | null>>();\n\nconst getDashboardLimited = limitFunction(\n  async (dashboardUid: string, dashboardRequestsFailedCount: number) => {\n    let promise = dashboardRequestMap.get(dashboardUid);\n\n    if (!promise) {\n      promise = getBackendSrv()\n        .get<{ dashboard: Dashboard }>(\n          `/api/dashboards/uid/${dashboardUid}`,\n          undefined,\n          `grafana-metricsdrilldown-app-dashboard-metric-usage-${dashboardUid}`,\n          usageRequestOptions\n        )\n        .then(({ dashboard }) => dashboard)\n        .catch((error) => {\n          // Prevent excessive noise\n          if (dashboardRequestsFailedCount <= 5) {\n            logger.error(error, { dashboardUid });\n          }\n\n          dashboardRequestsFailedCount++;\n          return Promise.resolve(null);\n        })\n        .finally(() => {\n          dashboardRequestMap.delete(dashboardUid);\n        });\n      dashboardRequestMap.set(dashboardUid, promise);\n    }\n\n    return promise;\n  },\n  { concurrency: 50 }\n);\n\n/**\n * Fetches metric usage data from dashboards\n * @returns A record mapping metric names to their occurrence count in dashboards\n */\nexport async function fetchDashboardMetrics(): Promise<Record<string, number>> {\n  try {\n    const dashboards = await getBackendSrv().get<DashboardSearchItem[]>(\n      '/api/search',\n      {\n        type: 'dash-db',\n        limit: 500,\n      },\n      'grafana-metricsdrilldown-app-dashboard-search',\n      usageRequestOptions\n    );\n\n    let dashboardRequestsFailedCount = 0;\n\n    const metricCounts = await Promise.all(\n      dashboards.map(({ uid: dashboardUid }) => getDashboardLimited(dashboardUid, dashboardRequestsFailedCount))\n    ).then(parseDashboardSearchResponse);\n\n    return metricCounts;\n  } catch (err) {\n    const error = typeof err === 'string' ? new Error(err) : (err as Error);\n    logger.error(error, {\n      message: 'Failed to fetch dashboard metrics',\n    });\n    return {};\n  }\n}\n\nfunction parseDashboardSearchResponse(dashboardSearchResponse: Array<Dashboard | null>): Record<string, number> {\n  // Create a map to count metric occurrences\n  const counts: Record<string, number> = {};\n\n  const relevantDashboards = dashboardSearchResponse.filter(\n    (dashboard) => dashboard && dashboard?.panels?.length\n  ) as Array<Dashboard & { panels: NonNullable<Panel[]> }>;\n\n  for (const dashboard of relevantDashboards) {\n    // Skip panels with non-Prometheus data sources\n    const relevantPanels = dashboard.panels.filter(\n      (panel) => isPrometheusDataSource(panel.datasource) && 'targets' in panel && panel.targets?.length\n    ) as Array<Panel & { targets: NonNullable<Panel['targets']> }>;\n\n    for (const panel of relevantPanels) {\n      for (const target of panel.targets) {\n        const expr = typeof target.expr === 'string' ? target.expr : '';\n\n        const metrics = extractMetricNames(expr);\n\n        // Count each metric occurrence\n        for (const metric of metrics) {\n          counts[metric] = (counts[metric] || 0) + 1;\n        }\n      }\n    }\n  }\n\n  return counts;\n}\n","import { fetchAlertingMetrics } from './fetchers/fetchAlertingMetrics';\nimport { fetchDashboardMetrics } from './fetchers/fetchDashboardMetrics';\n\ninterface MetricsUsageState {\n  metrics: Record<string, number>;\n  metricsPromise: Promise<Record<string, number>> | undefined;\n  fetcher: () => Promise<Record<string, number>>;\n}\n\nexport type MetricUsageType = 'dashboard-usage' | 'alerting-usage';\n\nexport class MetricUsageFetcher {\n  private _usageState: Record<MetricUsageType, MetricsUsageState> = {\n    'dashboard-usage': {\n      metrics: {},\n      metricsPromise: undefined,\n      fetcher: fetchDashboardMetrics,\n    },\n    'alerting-usage': {\n      metrics: {},\n      metricsPromise: undefined,\n      fetcher: fetchAlertingMetrics,\n    },\n  };\n\n  public getUsageMetrics(usageType: MetricUsageType): Promise<Record<string, number>> {\n    const hasExistingMetrics =\n      this._usageState[usageType].metrics && Object.keys(this._usageState[usageType].metrics).length > 0;\n\n    if (hasExistingMetrics) {\n      return Promise.resolve(this._usageState[usageType].metrics);\n    }\n\n    if (!this._usageState[usageType].metricsPromise) {\n      this._usageState[usageType].metricsPromise = this._usageState[usageType].fetcher().then((metrics) => {\n        this._usageState[usageType].metrics = metrics;\n        this._usageState[usageType].metricsPromise = undefined;\n        return metrics;\n      });\n    }\n\n    return this._usageState[usageType].metricsPromise;\n  }\n\n  public getUsageForMetric(metricName: string, usageType: MetricUsageType): Promise<number> {\n    return this.getUsageMetrics(usageType).then((metrics) => metrics[metricName] ?? 0);\n  }\n}\n","import {\n  CustomVariable,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  VariableValueSelectors,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type VariableValueOption,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nimport { EventSortByChanged } from './events/EventSortByChanged';\nimport { MetricUsageFetcher, type MetricUsageType } from './MetricUsageFetcher';\nimport { logger } from '../../../tracking/logger/logger';\nexport type SortingOption = 'default' | 'dashboard-usage' | 'alerting-usage';\n\nconst RECENT_METRICS_STORAGE_KEY = 'metrics-drilldown-recent-metrics/v1';\nconst MAX_RECENT_METRICS = 6;\nconst RECENT_METRICS_EXPIRY_DAYS = 30;\n\ninterface RecentMetric {\n  name: string;\n  timestamp: number;\n}\n\n/**\n * Adds a metric to the recent metrics list in localStorage\n * @param metricName The name of the metric to add\n */\nexport function addRecentMetric(metricName: string): void {\n  try {\n    const recentMetrics = getRecentMetrics();\n    const now = Date.now();\n\n    // Remove the metric if it already exists and add it with new timestamp\n    const filteredMetrics = recentMetrics.filter((m) => m.name !== metricName);\n    filteredMetrics.unshift({ name: metricName, timestamp: now });\n\n    // Keep only the most recent metrics\n    const updatedMetrics = filteredMetrics.slice(0, MAX_RECENT_METRICS);\n    localStorage.setItem(RECENT_METRICS_STORAGE_KEY, JSON.stringify(updatedMetrics));\n  } catch (error) {\n    const errorObject = error instanceof Error ? error : new Error(String(error));\n\n    logger.error(errorObject, {\n      ...(errorObject.cause || {}),\n      metricName,\n    });\n  }\n}\n\n/**\n * Gets the list of recent metrics from localStorage, removing expired ones\n * @returns Array of recent metric names\n */\nexport function getRecentMetrics(): RecentMetric[] {\n  try {\n    const stored = localStorage.getItem(RECENT_METRICS_STORAGE_KEY);\n    if (!stored) {\n      return [];\n    }\n\n    const recentMetrics: RecentMetric[] = JSON.parse(stored);\n    const now = Date.now();\n    const thirtyDaysAgo = now - RECENT_METRICS_EXPIRY_DAYS * 24 * 60 * 60 * 1000;\n\n    // Filter out expired metrics\n    const validMetrics = recentMetrics.filter((metric) => metric.timestamp > thirtyDaysAgo);\n\n    // If any metrics were removed, update storage\n    if (validMetrics.length !== recentMetrics.length) {\n      localStorage.setItem(RECENT_METRICS_STORAGE_KEY, JSON.stringify(validMetrics));\n    }\n\n    return validMetrics;\n  } catch (error) {\n    logger.error(error as Error, {message: 'Failed to get recent metrics:'});\n    return [];\n  }\n}\n\ninterface MetricsSorterState extends SceneObjectState {\n  $variables: SceneVariableSet;\n  inputControls: SceneObject;\n}\n\nexport const sortByOptions: VariableValueOption[] = [\n  { label: 'Default', value: 'default' },\n  { label: 'Dashboard Usage', value: 'dashboard-usage' },\n  { label: 'Alerting Usage', value: 'alerting-usage' },\n];\n\nexport const VAR_WINGMAN_SORT_BY = 'metrics-reducer-sort-by';\n\nexport class MetricsSorter extends SceneObjectBase<MetricsSorterState> {\n  initialized = false;\n  supportedSortByOptions = new Set<SortingOption>(['default', 'dashboard-usage', 'alerting-usage']);\n  private usageFetcher = new MetricUsageFetcher();\n\n  constructor(state: Partial<MetricsSorterState>) {\n    super({\n      ...state,\n      key: 'metrics-sorter',\n      $variables: new SceneVariableSet({\n        variables: [\n          new CustomVariable({\n            name: VAR_WINGMAN_SORT_BY,\n            label: 'Sort by',\n            value: 'default',\n            query: sortByOptions.map((option) => `${option.label} : ${option.value}`).join(','),\n            description:\n              'Sort metrics by default (alphabetically, with recently-selected metrics first), by prevalence in dashboard panel queries, or by prevalence in alerting rules',\n          }),\n        ],\n      }),\n      inputControls: new VariableValueSelectors({ layout: 'horizontal' }),\n    });\n\n    this.addActivationHandler(() => this.activationHandler());\n  }\n\n  private activationHandler() {\n    const sortByVar = sceneGraph.getVariables(this).getByName(VAR_WINGMAN_SORT_BY) as CustomVariable;\n\n    if (!this.supportedSortByOptions.has(sortByVar.getValue() as SortingOption)) {\n      // Migration for the old sortBy values\n      sortByVar.changeValueTo('default');\n    }\n\n    this._subs.add(\n      sortByVar.subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.publishEvent(new EventSortByChanged({ sortBy: newState.value as SortingOption }), true);\n        }\n      })\n    );\n  }\n\n  public getUsageForMetric(metricName: string, usageType: MetricUsageType): Promise<number> {\n    return this.usageFetcher.getUsageForMetric(metricName, usageType);\n  }\n\n  public getUsageMetrics(usageType: MetricUsageType): Promise<Record<string, number>> {\n    return this.usageFetcher.getUsageMetrics(usageType);\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsSorter>) => {\n    const { inputControls } = model.useState();\n\n    return (\n      <div data-testid=\"sort-by-select\">\n        <inputControls.Component model={inputControls} />\n      </div>\n    );\n  };\n}\n\n/**\n * Sort metrics by an arbitrary count (descending)\n * @param metrics Array of metric names\n * @param counts A record mapping metric names to an arbitrary count\n * @returns Sorted array of metric names\n */\nexport function sortMetricsByCount(metrics: string[], counts: Record<string, number>): string[] {\n  return [...metrics].sort((a, b) => {\n    const scoreA = counts[a] || 0;\n    const scoreB = counts[b] || 0;\n\n    // Primary sort by score (descending)\n    if (scoreB !== scoreA) {\n      return scoreB - scoreA;\n    }\n\n    // Secondary sort alphabetically for metrics with the same score\n    return localeCompare(a, b);\n  });\n}\n\n/**\n * Sort metrics in alphabetical order\n * @param metrics Array of metric names\n * @returns Sorted array of metric names in alphabetical order\n */\nexport function sortMetricsAlphabetically(metrics: string[]): string[] {\n  return [...metrics].sort((a, b) => localeCompare(a, b));\n}\n\n/**\n * Sort metrics with recent metrics first (by recency), then alphabetically\n * @param metrics Array of metric names\n * @returns Sorted array of metric names\n */\nexport function sortMetricsWithRecentFirst(metrics: string[]): string[] {\n  const allRecentMetrics = getRecentMetrics().map((m) => m.name);\n  const allRecentMetricsSet = new Set(allRecentMetrics);\n  const [recent, nonRecent] = metrics.reduce<[string[], string[]]>(\n    ([recent, nonRecent], metric) => {\n      if (allRecentMetricsSet.has(metric)) {\n        recent.push(metric);\n      } else {\n        nonRecent.push(metric);\n      }\n      return [recent, nonRecent];\n    },\n    [[], []]\n  );\n  const sortedNonRecent = sortMetricsAlphabetically(nonRecent);\n  // `recentMetrics` are already sorted by recency, so we just need to filter them\n  const sortedRecent = allRecentMetrics.filter((m) => recent.includes(m));\n\n  return [...sortedRecent, ...sortedNonRecent];\n}\n","import { type MultiValueVariable, type MultiValueVariableState } from '@grafana/scenes';\n\nimport { EventMetricsVariableActivated } from './EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from './EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from './EventMetricsVariableLoaded';\n\n/**\n * Adds the publication of lifecycle events to a metrics variable:\n *\n * - `EventMetricsVariableActivated`\n * - `EventMetricsVariableDeactivated`\n * - `EventMetricsVariableLoaded`\n *\n * This is particularly useful for filtering and sorting the variable options, while keeping the\n * different pieces of code decoupled.\n *\n * The filtering and sorting logic is centralized in the `MetricsReducer` class.\n */\nexport function withLifecycleEvents<T extends MultiValueVariable>(variable: T): T {\n  const key = variable.state.key as string;\n\n  if (!key) {\n    throw new TypeError(\n      `Variable \"${variable.state.name}\" has no key. Please provide a key in order to publish its lifecycle events.`\n    );\n  }\n\n  variable.addActivationHandler(() => {\n    variable.publishEvent(new EventMetricsVariableActivated({ key }), true);\n\n    variable.subscribeToState((newState: MultiValueVariableState, prevState: MultiValueVariableState) => {\n      if (!newState.loading && prevState.loading) {\n        variable.publishEvent(new EventMetricsVariableLoaded({ key, options: newState.options }), true);\n      }\n    });\n\n    return () => {\n      variable.publishEvent(new EventMetricsVariableDeactivated({ key }), true);\n    };\n  });\n\n  return variable;\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventQuickSearchChangedPayload {\n  searchText: string;\n}\n\nexport class EventQuickSearchChanged extends BusEventWithPayload<EventQuickSearchChangedPayload> {\n  public static readonly type = 'quick-search-changed';\n}\n","import { config } from '@grafana/runtime';\nimport { DataSourceVariable } from '@grafana/scenes';\n\nimport { VAR_DATASOURCE } from 'shared';\nimport { logger } from 'tracking/logger/logger';\nimport { isPrometheusDataSource } from 'utils/utils.datasource';\n\nexport class MetricsDrilldownDataSourceVariable extends DataSourceVariable {\n  private static LOCAL_STORAGE_KEY = 'metricsDrilldownDataSource';\n\n  constructor({ initialDS }: { initialDS?: string }) {\n    super({\n      key: VAR_DATASOURCE,\n      name: VAR_DATASOURCE,\n      pluginId: 'prometheus',\n      label: 'Data source',\n      description: 'Only prometheus data sources are supported',\n      // if no initialDS is passed to the constructor, we bypass Scenes native behaviour by determining the data source ourselves (see getCurrentDataSource())...\n      skipUrlSync: !initialDS,\n      // ... by doing this, we make sure that we'll always have a data source when the \"var-ds\" URL search param is missing, incorrect, etc.\n      value: initialDS || MetricsDrilldownDataSourceVariable.getCurrentDataSource(),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.setState({ skipUrlSync: false }); // restore URL sync\n\n    this.subscribeToState((newState, prevState) => {\n      if (newState.value && newState.value !== prevState.value) {\n        // store the new value for future visits\n        localStorage.setItem(MetricsDrilldownDataSourceVariable.LOCAL_STORAGE_KEY, newState.value as string);\n      }\n    });\n  }\n\n  private static getCurrentDataSource(): string {\n    const prometheusDataSources = Object.values(config.datasources).filter((ds) => isPrometheusDataSource(ds));\n\n    const uidFromUrl = new URL(window.location.href).searchParams.get(`var-${VAR_DATASOURCE}`);\n    const uidFromLocalStorage = localStorage.getItem(MetricsDrilldownDataSourceVariable.LOCAL_STORAGE_KEY);\n\n    const currentDataSource =\n      prometheusDataSources.find((ds) => ds.uid === uidFromUrl) ||\n      prometheusDataSources.find((ds) => ds.uid === uidFromLocalStorage) ||\n      prometheusDataSources.find((ds) => ds.isDefault) ||\n      prometheusDataSources[0];\n\n    if (!currentDataSource) {\n      logger.warn('Cannot find any Prometheus data source!');\n      return 'no-data-source-configured';\n    }\n\n    return currentDataSource.uid;\n  }\n}\n","import { css, cx } from '@emotion/css';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { memo } from 'react';\n\ntype PluginLogoProps = {\n  size: 'small' | 'large';\n};\n\nexport const PluginLogo = memo(function PluginLogoComponent({ size }: PluginLogoProps) {\n  const styles = useStyles2(getStyles);\n  return <img className={cx(styles.logo, size)} src=\"public/plugins/grafana-metricsdrilldown-app/img/logo.svg\" />;\n});\n\nconst getStyles = () => ({\n  logo: css`\n    &.small {\n      width: 24px;\n      height: 24px;\n      margin-right: 4px;\n      position: relative;\n      top: -2px;\n    }\n\n    &.large {\n      width: 40px;\n      height: 40px;\n    }\n  `,\n});\n","import { css } from '@emotion/css';\nimport { usePluginContext, type GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { Button, Dropdown, Menu, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { PluginLogo } from './PluginLogo';\nimport { GIT_COMMIT } from '../version';\n\nconst pluginCommitSha: string = GIT_COMMIT;\nconst pluginCommitURL = `https://github.com/grafana/metrics-drilldown/commit/${pluginCommitSha}`;\n\nconst { buildInfo: grafanaBuildInfo } = config;\n\nfunction InfoMenuHeader() {\n  const styles = useStyles2(getStyles);\n\n  const {\n    meta: {\n      info: { version, updated },\n    },\n  } = usePluginContext() || { meta: { info: { version: '?.?.?', updated: '?' } } };\n\n  return (\n    <div className={styles.menuHeader}>\n      <h5>\n        <PluginLogo size=\"small\" />\n        Grafana Metrics Drilldown v{version}\n      </h5>\n      <div className={styles.subTitle}>Last update: {updated}</div>\n    </div>\n  );\n}\n\nfunction InfoMenu() {\n  const isDev = pluginCommitSha === 'dev';\n  const shortCommitSha = isDev ? pluginCommitSha : pluginCommitSha.slice(0, 8);\n\n  return (\n    <Menu header={<InfoMenuHeader />}>\n      <Menu.Item\n        label={`Commit SHA: ${shortCommitSha}`}\n        icon=\"github\"\n        onClick={() => window.open(pluginCommitURL)}\n        disabled={isDev}\n      />\n      <Menu.Item\n        label=\"Changelog\"\n        icon=\"list-ul\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/blob/main/CHANGELOG.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Contribute\"\n        icon=\"external-link-alt\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/blob/main/docs/contributing.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Documentation\"\n        icon=\"document-info\"\n        onClick={() =>\n          window.open(\n            'https://grafana.com/docs/grafana/latest/explore/simplified-exploration/metrics',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Item\n        label=\"Report an issue\"\n        icon=\"bug\"\n        onClick={() =>\n          window.open(\n            'https://github.com/grafana/metrics-drilldown/issues/new?template=bug_report.md',\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n      <Menu.Divider />\n      <Menu.Item\n        label={`Grafana ${grafanaBuildInfo.edition} v${grafanaBuildInfo.version} (${grafanaBuildInfo.env})`}\n        icon=\"grafana\"\n        onClick={() =>\n          window.open(\n            `https://github.com/grafana/grafana/commit/${grafanaBuildInfo.commit}`,\n            '_blank',\n            'noopener,noreferrer'\n          )\n        }\n      />\n    </Menu>\n  );\n}\n\nexport function PluginInfo() {\n  return (\n    <Dropdown overlay={() => <InfoMenu />} placement=\"bottom-end\">\n      <Button\n        icon=\"info-circle\"\n        variant=\"secondary\"\n        tooltip=\"Plugin info\"\n        tooltipPlacement=\"top\"\n        title=\"Plugin info\"\n        data-testid=\"plugin-info-button\"\n      />\n    </Dropdown>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  button: css`\n    position: relative;\n    display: flex;\n    align-items: center;\n    width: 32px;\n    height: 32px;\n    line-height: 30px;\n    border: 1px solid ${theme.colors.border.weak};\n    border-radius: 2px;\n    border-left: 0;\n    color: ${theme.colors.text.primary};\n    background: ${theme.colors.background.secondary};\n\n    &:hover {\n      border-color: ${theme.colors.border.medium};\n      background-color: ${theme.colors.background.canvas};\n    }\n  `,\n  menuHeader: css`\n    padding: ${theme.spacing(0.5, 1)};\n    white-space: nowrap;\n  `,\n  subTitle: css`\n    color: ${theme.colors.text.secondary};\n    font-size: ${theme.typography.bodySmall.fontSize};\n  `,\n});\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Dropdown, Switch, ToolbarButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from './interactions';\nimport { MetricScene } from './MetricScene';\nimport { getTrailFor } from './utils';\n\nexport interface DataTrailSettingsState extends SceneObjectState {\n  stickyMainGraph?: boolean;\n  isOpen?: boolean;\n}\n\nexport class DataTrailSettings extends SceneObjectBase<DataTrailSettingsState> {\n  constructor(state: Partial<DataTrailSettingsState>) {\n    super({\n      stickyMainGraph: state.stickyMainGraph ?? true,\n      isOpen: state.isOpen ?? false,\n    });\n  }\n\n  public onToggleStickyMainGraph = () => {\n    const stickyMainGraph = !this.state.stickyMainGraph;\n    reportExploreMetrics('settings_changed', { stickyMainGraph });\n    this.setState({ stickyMainGraph });\n  };\n\n  public onToggleOpen = (isOpen: boolean) => {\n    this.setState({ isOpen });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<DataTrailSettings>) => {\n    const { stickyMainGraph, isOpen } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const trail = getTrailFor(model);\n    const { topScene } = trail.useState();\n\n    const isButtonVisible = topScene instanceof MetricScene;\n\n    if (!isButtonVisible) {\n      return null;\n    }\n\n    const renderPopover = () => {\n      return (\n        <div className={styles.popover} onClick={(evt) => evt.stopPropagation()}>\n          <div className={styles.heading}>Settings</div>\n          {topScene instanceof MetricScene && (\n            <div className={styles.options}>\n              <div>Always keep selected metric graph in-view</div>\n              <Switch value={stickyMainGraph} onChange={model.onToggleStickyMainGraph} />\n            </div>\n          )}\n        </div>\n      );\n    };\n\n    return (\n      <Dropdown overlay={renderPopover} placement=\"bottom\" onVisibleChange={model.onToggleOpen}>\n        <ToolbarButton icon=\"cog\" variant=\"canvas\" isOpen={isOpen} data-testid=\"settings-button\" />\n      </Dropdown>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    popover: css({\n      display: 'flex',\n      padding: theme.spacing(2),\n      flexDirection: 'column',\n      background: theme.colors.background.primary,\n      boxShadow: theme.shadows.z3,\n      borderRadius: theme.shape.radius.default,\n      border: `1px solid ${theme.colors.border.weak}`,\n      zIndex: 1,\n      marginRight: theme.spacing(2),\n    }),\n    heading: css({\n      fontWeight: theme.typography.fontWeightMedium,\n      paddingBottom: theme.spacing(2),\n    }),\n    options: css({\n      display: 'grid',\n      gridTemplateColumns: '1fr 50px',\n      rowGap: theme.spacing(1),\n      columnGap: theme.spacing(2),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { VariableHide, type AdHocVariableFilter, type GrafanaTheme2 } from '@grafana/data';\nimport { utf8Support, type PromQuery } from '@grafana/prometheus';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  AdHocFiltersVariable,\n  SceneControlsSpacer,\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  SceneReactObject,\n  SceneRefreshPicker,\n  SceneTimePicker,\n  SceneTimeRange,\n  SceneVariableSet,\n  UrlSyncContextProvider,\n  VariableDependencyConfig,\n  VariableValueSelectors,\n  type SceneComponentProps,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n  type SceneObjectWithUrlSync,\n  type SceneQueryRunner,\n  type SceneVariable,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useEffect } from 'react';\n\nimport { MetricsDrilldownDataSourceVariable } from 'MetricsDrilldownDataSourceVariable';\nimport { PluginInfo } from 'PluginInfo/PluginInfo';\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\n\nimport { DataTrailSettings } from './DataTrailSettings';\nimport { MetricDatasourceHelper } from './helpers/MetricDatasourceHelper';\nimport { reportChangeInLabelFilters } from './interactions';\nimport { MetricScene } from './MetricScene';\nimport { MetricSelectedEvent, trailDS, VAR_DATASOURCE, VAR_FILTERS } from './shared';\nimport { getTrailStore } from './TrailStore/TrailStore';\nimport { limitAdhocProviders } from './utils';\nimport { isSceneQueryRunner } from './utils/utils.queries';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport interface DataTrailState extends SceneObjectState {\n  topScene?: SceneObject;\n  embedded?: boolean;\n  controls: SceneObject[];\n  settings: DataTrailSettings;\n  pluginInfo: SceneReactObject;\n  createdAt: number;\n\n  // wingman\n  dashboardMetrics?: Record<string, number>;\n  alertingMetrics?: Record<string, number>;\n\n  // just for the starting data source\n  initialDS?: string;\n  initialFilters?: AdHocVariableFilter[];\n\n  // Synced with url\n  metric?: string;\n  metricSearch?: string;\n\n  histogramsLoaded: boolean;\n  nativeHistograms: string[];\n  nativeHistogramMetric: string;\n\n  trailActivated: boolean; // this indicates that the trail has been updated by metric or filter selected\n}\n\nexport class DataTrail extends SceneObjectBase<DataTrailState> implements SceneObjectWithUrlSync {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: ['metric', 'metricSearch', 'nativeHistogramMetric'],\n  });\n\n  public constructor(state: Partial<DataTrailState>) {\n    super({\n      $timeRange: state.$timeRange ?? new SceneTimeRange({}),\n      $variables: state.$variables ?? getVariableSet(state.initialDS, state.metric, state.initialFilters),\n      controls: state.controls ?? [\n        new VariableValueSelectors({ layout: 'vertical' }),\n        new SceneControlsSpacer(),\n        new SceneTimePicker({}),\n        new SceneRefreshPicker({}),\n      ],\n      settings: state.settings ?? new DataTrailSettings({}),\n      pluginInfo: new SceneReactObject({ component: PluginInfo }),\n      createdAt: state.createdAt ?? new Date().getTime(),\n      dashboardMetrics: {},\n      alertingMetrics: {},\n      nativeHistograms: state.nativeHistograms ?? [],\n      histogramsLoaded: state.histogramsLoaded ?? false,\n      nativeHistogramMetric: state.nativeHistogramMetric ?? '',\n      trailActivated: state.trailActivated ?? false,\n      ...state,\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  public _onActivate() {\n    this.setState({ trailActivated: true });\n\n    if (!this.state.topScene) {\n      this.setState({ topScene: getTopSceneFor(this.state.metric) });\n    }\n\n    // Some scene elements publish this\n    this.subscribeToEvent(MetricSelectedEvent, this._handleMetricSelectedEvent.bind(this));\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      this._subs.add(\n        filtersVariable?.subscribeToState((newState, prevState) => {\n          if (!this._addingFilterWithoutReportingInteraction) {\n            reportChangeInLabelFilters(newState.filters, prevState.filters);\n          }\n        })\n      );\n    }\n\n    // Save the current trail as a recent (if the browser closes or reloads) if user selects a metric OR applies filters to metric select view\n    const saveRecentTrail = () => {\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n      const hasFilters = isAdHocFiltersVariable(filtersVariable) && filtersVariable.state.filters.length > 0;\n      if (this.state.metric || hasFilters) {\n        getTrailStore().setRecentTrail(this);\n      }\n    };\n    window.addEventListener('unload', saveRecentTrail);\n\n    return () => {\n      if (!this.state.embedded) {\n        saveRecentTrail();\n      }\n      window.removeEventListener('unload', saveRecentTrail);\n    };\n  }\n\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE],\n    onReferencedVariableValueChanged: async (variable: SceneVariable) => {\n      const { name } = variable.state;\n\n      if (name === VAR_DATASOURCE) {\n        this.datasourceHelper.reset();\n\n        // reset native histograms\n        this.resetNativeHistograms();\n      }\n    },\n  });\n\n  /**\n   * Assuming that the change in filter was already reported with a cause other than `'adhoc_filter'`,\n   * this will modify the adhoc filter variable and prevent the automatic reporting which would\n   * normally occur through the call to `reportChangeInLabelFilters`.\n   */\n  public addFilterWithoutReportingInteraction(filter: AdHocVariableFilter) {\n    const variable = sceneGraph.lookupVariable('filters', this);\n    if (!isAdHocFiltersVariable(variable)) {\n      return;\n    }\n\n    this._addingFilterWithoutReportingInteraction = true;\n    variable.setState({ filters: [...variable.state.filters, filter] });\n    this._addingFilterWithoutReportingInteraction = false;\n  }\n\n  private _addingFilterWithoutReportingInteraction = false;\n  private datasourceHelper = new MetricDatasourceHelper(this);\n\n  public getMetricMetadata(metric?: string) {\n    return this.datasourceHelper.getMetadataForMetric(metric);\n  }\n\n  public isNativeHistogram(metric: string) {\n    return this.datasourceHelper.isNativeHistogram(metric);\n  }\n\n  // use this to initialize histograms in all scenes\n  public async initializeHistograms() {\n    if (!this.state.histogramsLoaded) {\n      try {\n        await this.datasourceHelper.initializeHistograms();\n      } catch {\n        displayWarning(['Error while initializing histograms!']);\n      }\n\n      this.setState({\n        nativeHistograms: this.listNativeHistograms(),\n        histogramsLoaded: true,\n      });\n    }\n  }\n\n  public listNativeHistograms() {\n    return this.datasourceHelper.listNativeHistograms() ?? [];\n  }\n\n  private resetNativeHistograms() {\n    this.setState({\n      histogramsLoaded: false,\n      nativeHistograms: [],\n    });\n  }\n\n  public getCurrentMetricMetadata() {\n    return this.getMetricMetadata(this.state.metric);\n  }\n\n  private async _handleMetricSelectedEvent(evt: MetricSelectedEvent) {\n    const metric = evt.payload ?? '';\n\n    // from the metric preview panel we have the info loaded to determine that a metric is a native histogram\n    let nativeHistogramMetric = false;\n    if (this.isNativeHistogram(metric)) {\n      nativeHistogramMetric = true;\n    }\n\n    this._urlSync.performBrowserHistoryAction(() => {\n      this.setState(this.getSceneUpdatesForNewMetricValue(metric, nativeHistogramMetric));\n    });\n\n    // Add metric to adhoc filters baseFilter\n    const filterVar = sceneGraph.lookupVariable(VAR_FILTERS, this);\n    if (isAdHocFiltersVariable(filterVar)) {\n      filterVar.setState({\n        baseFilters: getBaseFiltersForMetric(evt.payload),\n      });\n    }\n  }\n\n  private getSceneUpdatesForNewMetricValue(metric: string | undefined, nativeHistogramMetric?: boolean) {\n    const stateUpdate: Partial<DataTrailState> = {};\n    stateUpdate.metric = metric;\n    // refactoring opportunity? Or do we pass metric knowledge all the way down?\n    // must pass this native histogram prometheus knowledge deep into\n    // the topscene set on the trail > MetricScene > getAutoQueriesForMetric() > createHistogramMetricQueryDefs();\n    stateUpdate.nativeHistogramMetric = nativeHistogramMetric ? '1' : '';\n    stateUpdate.topScene = getTopSceneFor(metric, nativeHistogramMetric);\n\n    return stateUpdate;\n  }\n\n  getUrlState(): SceneObjectUrlValues {\n    const { metric, metricSearch, nativeHistogramMetric } = this.state;\n    return {\n      metric,\n      metricSearch,\n      // store the native histogram knowledge in url for the metric scene\n      nativeHistogramMetric,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<DataTrailState> = {};\n\n    if (typeof values.metric === 'string') {\n      if (this.state.metric !== values.metric) {\n        // if we have a metric and we have stored in the url that it is a native histogram\n        // we can pass that info into the metric scene to generate the appropriate queries\n        let nativeHistogramMetric = false;\n        if (values.nativeHistogramMetric === '1') {\n          nativeHistogramMetric = true;\n        }\n\n        Object.assign(stateUpdate, this.getSceneUpdatesForNewMetricValue(values.metric, nativeHistogramMetric));\n      }\n    } else if (values.metric == null) {\n      stateUpdate.metric = undefined;\n      stateUpdate.topScene = new MetricsReducer();\n    }\n\n    if (typeof values.metricSearch === 'string') {\n      stateUpdate.metricSearch = values.metricSearch;\n    } else if (values.metric == null) {\n      stateUpdate.metricSearch = undefined;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  public getQueries(): PromQuery[] {\n    // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n    const sqrs = sceneGraph.findAllObjects(this, (b) => isSceneQueryRunner(b)) as SceneQueryRunner[];\n\n    return sqrs.reduce<PromQuery[]>((acc, sqr) => {\n      acc.push(\n        ...sqr.state.queries.map((q) => ({\n          ...q,\n          expr: sceneGraph.interpolate(sqr, q.expr),\n        }))\n      );\n\n      return acc;\n    }, []);\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<DataTrail>) => {\n    const { controls, topScene, settings, pluginInfo, embedded } = model.useState();\n\n    const chromeHeaderHeight = useChromeHeaderHeight();\n    const styles = useStyles2(getStyles, embedded ? 0 : chromeHeaderHeight ?? 0);\n    // need to initialize this here and not on activate because it requires the data source helper to be fully initialized first\n    model.initializeHistograms();\n\n    useEffect(() => {\n      const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, model);\n      const datasourceHelper = model.datasourceHelper;\n      limitAdhocProviders(model, filtersVariable, datasourceHelper);\n    }, [model]);\n\n    return (\n      <div className={styles.container}>\n        {controls && (\n          <div className={styles.controls} data-testid=\"app-controls\">\n            {controls.map((control) => (\n              <control.Component key={control.state.key} model={control} />\n            ))}\n            <div className={styles.settingsInfo}>\n              <settings.Component model={settings} />\n              <pluginInfo.Component model={pluginInfo} />\n            </div>\n          </div>\n        )}\n        {topScene && (\n          <UrlSyncContextProvider scene={topScene} createBrowserHistorySteps={true} updateUrlOnInit={true}>\n            <div className={styles.body}>{topScene && <topScene.Component model={topScene} />}</div>\n          </UrlSyncContextProvider>\n        )}\n      </div>\n    );\n  };\n}\n\nexport function getTopSceneFor(metric?: string, nativeHistogram?: boolean) {\n  if (metric) {\n    return new MetricScene({ metric: metric, nativeHistogram: nativeHistogram ?? false });\n  } else {\n    return new MetricsReducer();\n  }\n}\n\nfunction getVariableSet(initialDS?: string, metric?: string, initialFilters?: AdHocVariableFilter[]) {\n  return new SceneVariableSet({\n    variables: [\n      new MetricsDrilldownDataSourceVariable({ initialDS }),\n      new AdHocFiltersVariable({\n        key: VAR_FILTERS,\n        name: VAR_FILTERS,\n        label: 'Filters',\n        addFilterButtonText: 'Add label',\n        datasource: trailDS,\n        hide: VariableHide.dontHide,\n        layout: 'combobox',\n        filters: initialFilters ?? [],\n        baseFilters: getBaseFiltersForMetric(metric),\n        applyMode: 'manual',\n        allowCustomValue: true,\n        expressionBuilder: (filters: AdHocVariableFilter[]) => {\n          // remove any filters that include __name__ key in the expression\n          // to prevent the metric name from being set twice in the query and causing an error.\n          const filtersWithoutMetricName = filters.filter((filter) => filter.key !== '__name__');\n          return [...getBaseFiltersForMetric(metric), ...filtersWithoutMetricName]\n            .map((filter) => `${utf8Support(filter.key)}${filter.operator}\"${filter.value}\"`)\n            .join(',');\n        },\n      }),\n    ],\n  });\n}\n\nfunction getStyles(theme: GrafanaTheme2, chromeHeaderHeight: number) {\n  return {\n    container: css({\n      flexGrow: 1,\n      display: 'flex',\n      gap: theme.spacing(1),\n      flexDirection: 'column',\n      background: theme.isLight ? theme.colors.background.primary : theme.colors.background.canvas,\n      padding: theme.spacing(1, 2),\n    }),\n    body: css({\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n    }),\n    controls: css({\n      display: 'flex',\n      gap: theme.spacing(1),\n      padding: theme.spacing(1, 0),\n      alignItems: 'flex-end',\n      flexWrap: 'wrap',\n      position: 'sticky',\n      background: theme.isDark ? theme.colors.background.canvas : theme.colors.background.primary,\n      zIndex: theme.zIndex.navbarFixed,\n      top: chromeHeaderHeight,\n    }),\n    settingsInfo: css({\n      display: 'flex',\n      gap: theme.spacing(0.5),\n    }),\n  };\n}\n\nfunction getBaseFiltersForMetric(metric?: string): AdHocVariableFilter[] {\n  if (metric) {\n    return [{ key: '__name__', operator: '=', value: metric }];\n  }\n  return [];\n}\n","import { Button } from '@grafana/ui';\nimport React, { type MouseEventHandler } from 'react';\n\ntype ShowMoreButtonProps = {\n  label: string;\n  batchSizes: {\n    increment: number;\n    current: number;\n    total: number;\n  };\n  onClick: MouseEventHandler<HTMLButtonElement>;\n  tooltip?: string;\n};\n\nexport function ShowMoreButton({ label, batchSizes, onClick, tooltip }: Readonly<ShowMoreButtonProps>) {\n  return (\n    <Button variant=\"secondary\" fill=\"outline\" onClick={onClick} tooltip={tooltip} tooltipPlacement=\"top\">\n      Show {batchSizes.increment} more {batchSizes.increment === 1 ? label : `${label}s`} ({batchSizes.current}/\n      {batchSizes.total})\n    </Button>\n  );\n}\n","import { BusEventBase, BusEventWithPayload } from '@grafana/data';\nimport { ConstantVariable } from '@grafana/scenes';\nimport { VariableHide } from '@grafana/schema';\n\nexport const TRAILS_ROUTE = '/explore/metrics/trail';\nexport const HOME_ROUTE = '/explore/metrics';\n\nexport const VAR_FILTERS = 'filters';\nexport const VAR_FILTERS_EXPR = '${filters}';\nexport const VAR_METRIC = 'metric';\nexport const VAR_METRIC_EXPR = '${metric}';\nexport const VAR_GROUP_BY = 'groupby';\nexport const VAR_GROUP_BY_EXP = '${groupby}';\nexport const VAR_DATASOURCE = 'ds';\nexport const VAR_DATASOURCE_EXPR = '${ds}';\nexport const VAR_LOGS_DATASOURCE = 'logsDs';\nexport const VAR_LOGS_DATASOURCE_EXPR = '${logsDs}';\nexport const VAR_OTHER_METRIC_FILTERS = 'other_metric_filters';\n\nexport const LOGS_METRIC = '$__logs__';\nexport const KEY_SQR_METRIC_VIZ_QUERY = 'sqr-metric-viz-query';\n\nexport const trailDS = { uid: VAR_DATASOURCE_EXPR };\n\n// Local storage keys\nexport const RECENT_TRAILS_KEY = 'grafana.trails.recent';\nexport const TRAIL_BOOKMARKS_KEY = 'grafana.trails.bookmarks';\nexport const TRAIL_BREAKDOWN_VIEW_KEY = 'grafana.trails.breakdown.view';\nexport const TRAIL_BREAKDOWN_SORT_KEY = 'grafana.trails.breakdown.sort';\n\nexport const MDP_METRIC_PREVIEW = 250;\nexport const MDP_METRIC_OVERVIEW = 500;\n\nexport type MakeOptional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\nexport function getVariablesWithMetricConstant(metric: string) {\n  return [\n    new ConstantVariable({\n      name: VAR_METRIC,\n      value: metric,\n      hide: VariableHide.hideVariable,\n    }),\n  ];\n}\n\nexport class MetricSelectedEvent extends BusEventWithPayload<string | undefined> {\n  public static readonly type = 'metric-selected-event';\n}\n\nexport class RefreshMetricsEvent extends BusEventBase {\n  public static readonly type = 'refresh-metrics-event';\n}\n","import { urlUtil } from '@grafana/data';\nimport { sceneUtils, type SceneObject, type SceneObjectRef, type SceneObjectUrlValues } from '@grafana/scenes';\nimport { debounce, isEqual } from 'lodash';\n\nimport { createBookmarkSavedNotification } from './utils';\nimport { DataTrail } from '../DataTrail';\n// import { type TrailStepType } from '../DataTrailsHistory';\nimport { RECENT_TRAILS_KEY, TRAIL_BOOKMARKS_KEY } from '../shared';\nimport { newMetricsTrail } from '../utils';\n\nconst MAX_RECENT_TRAILS = 20;\n\n// Added when removing history to replace serialized trail history with only URL values\nexport interface UrlSerializedTrail {\n  urlValues: SceneObjectUrlValues;\n}\n\n// used in the migration for old history format\nexport interface SerializedTrail {\n  history: SerializedTrailHistory[];\n  currentStep?: number; // Assume last step in history if not specified\n  createdAt?: number;\n}\n\n// used in the migration for old history format\nexport interface SerializedTrailHistory {\n  urlValues: SceneObjectUrlValues;\n  description: string;\n}\n\nexport interface DataTrailBookmark {\n  urlValues: SceneObjectUrlValues;\n  createdAt: number;\n}\n\nexport class TrailStore {\n  private _recent: Array<SceneObjectRef<DataTrail>> = [];\n  private _bookmarks: DataTrailBookmark[] = [];\n  private _save: () => void;\n  private _lastModified: number;\n\n  constructor() {\n    this.load();\n    this._lastModified = Date.now();\n    const doSave = () => {\n      const serializedRecent = this._recent\n        .slice(0, MAX_RECENT_TRAILS)\n        .map((trail) => this._serializeTrail(trail.resolve()));\n      localStorage.setItem(RECENT_TRAILS_KEY, JSON.stringify(serializedRecent));\n      localStorage.setItem(TRAIL_BOOKMARKS_KEY, JSON.stringify(this._bookmarks));\n      this._lastModified = Date.now();\n    };\n\n    this._save = debounce(doSave, 1000);\n\n    window.addEventListener('beforeunload', () => {\n      // Before closing or reloading the page, we want to remove the debounce from `_save` so that\n      // any calls to is on event `unload` are actualized. Debouncing would cause a delay until after the page has been unloaded.\n      this._save = doSave;\n    });\n  }\n\n  private _loadRecentTrailsFromStorage() {\n    const list: Array<SceneObjectRef<DataTrail>> = [];\n    const storageItem = localStorage.getItem(RECENT_TRAILS_KEY);\n    if (storageItem) {\n      const serializedTrails: SerializedTrail[] = JSON.parse(storageItem);\n      for (const t of serializedTrails) {\n        const trail = this._deserializeTrail(t);\n        list.push(trail.getRef());\n      }\n    }\n    return list;\n  }\n\n  private _loadBookmarksFromStorage() {\n    const storageItem = localStorage.getItem(TRAIL_BOOKMARKS_KEY);\n\n    const list: Array<DataTrailBookmark | SerializedTrail> = storageItem ? JSON.parse(storageItem) : [];\n\n    return list.map((item) => {\n      if (isSerializedTrail(item)) {\n        // Take the legacy SerializedTrail implementation of bookmark storage, and extract a DataTrailBookmark\n        const step = item.currentStep != null ? item.currentStep : item.history.length - 1;\n        const bookmark: DataTrailBookmark = {\n          urlValues: item.history[step].urlValues,\n          createdAt: item.createdAt || Date.now(),\n        };\n        return bookmark;\n      }\n      return item;\n    });\n  }\n\n  private _deserializeTrail(t: SerializedTrail | UrlSerializedTrail): DataTrail {\n    // reconstruct the trail based on the serialized history\n    const trail = new DataTrail({});\n\n    const isSerializedTrail = 'history' in t;\n    const urlSerializedTrail = 'urlValues' in t;\n    if (isSerializedTrail) {\n      t.history.forEach((step) => {\n        // will go through all steps until the last one and load the most recent one\n        this._loadFromUrl(trail, step.urlValues);\n      });\n    } else if (urlSerializedTrail) {\n      this._loadFromUrl(trail, t.urlValues);\n    }\n    trail.setState(sceneUtils.cloneSceneObjectState(trail.state, {}));\n\n    return trail;\n  }\n\n  private _serializeTrail(trail: DataTrail): UrlSerializedTrail {\n    const urlValues = sceneUtils.getUrlState(trail);\n    return { urlValues };\n  }\n\n  public getTrailForBookmarkIndex(index: number) {\n    const bookmark = this._bookmarks[index];\n    if (!bookmark) {\n      // Create a blank trail\n      return newMetricsTrail();\n    }\n    return this.getTrailForBookmark(bookmark);\n  }\n\n  public getTrailForBookmark(bookmark: DataTrailBookmark) {\n    const key = getBookmarkKey(bookmark);\n    // Match for recent trails that have the exact same state as the current step\n    for (const recent of this._recent) {\n      const trail = recent.resolve();\n      if (getBookmarkKey(trail) === key) {\n        return trail;\n      }\n    }\n    // Just create a new trail with that state\n    const trail = new DataTrail({});\n    this._loadFromUrl(trail, bookmark.urlValues);\n    return trail;\n  }\n\n  private _loadFromUrl(node: SceneObject, urlValues: SceneObjectUrlValues) {\n    const urlState = urlUtil.renderUrl('', urlValues);\n    sceneUtils.syncStateFromSearchParams(node, new URLSearchParams(urlState));\n  }\n\n  // Recent Trails\n  get recent() {\n    return this._recent;\n  }\n\n  // Last updated metric\n  get lastModified() {\n    return this._lastModified;\n  }\n\n  load() {\n    this._recent = this._loadRecentTrailsFromStorage();\n    this._bookmarks = this._loadBookmarksFromStorage();\n    this._refreshBookmarkIndexMap();\n    this._lastModified = Date.now();\n  }\n\n  setRecentTrail(recentTrail: DataTrail) {\n    const notActivated = !recentTrail.state.trailActivated;\n\n    if (notActivated) {\n      // We do not set an uninitialized trail, or a RECENT single node \"start\" trail\n      return;\n    }\n\n    // Remove the `recentTrail` from the list if it already exists there\n    this._recent = this._recent.filter((t) => t !== recentTrail.getRef());\n\n    // Check if any existing \"recent\" entries have equivalent urlState to the new recentTrail\n    const recentUrlState = getUrlStateForComparison(recentTrail);\n\n    this._recent = this._recent.filter((t) => {\n      // Use the current step urlValues to filter out equivalent states\n      const urlState = getUrlStateForComparison(t.resolve());\n      // Only keep trails with sufficiently unique urlValues on their current step\n      return !isEqual(recentUrlState, urlState);\n    });\n\n    this._recent.unshift(recentTrail.getRef());\n    this._save();\n  }\n\n  // Bookmarked Trails\n  get bookmarks() {\n    return this._bookmarks;\n  }\n\n  addBookmark(trail: DataTrail) {\n    const urlState = sceneUtils.getUrlState(trail);\n\n    const bookmarkState: DataTrailBookmark = {\n      urlValues: urlState,\n      createdAt: Date.now(),\n    };\n\n    this._bookmarks.unshift(bookmarkState);\n    this._refreshBookmarkIndexMap();\n    this._save();\n    createBookmarkSavedNotification();\n  }\n\n  removeBookmark(index: number) {\n    if (index < this._bookmarks.length) {\n      this._bookmarks.splice(index, 1);\n      this._refreshBookmarkIndexMap();\n      this._save();\n    }\n  }\n\n  getBookmarkIndex(trail: DataTrail) {\n    const bookmarkKey = getBookmarkKey(trail);\n    const bookmarkIndex = this._bookmarkIndexMap.get(bookmarkKey);\n    return bookmarkIndex;\n  }\n\n  private _bookmarkIndexMap = new Map<string, number>();\n\n  private _refreshBookmarkIndexMap() {\n    this._bookmarkIndexMap.clear();\n    this._bookmarks.forEach((bookmarked, index) => {\n      const key = getBookmarkKey(bookmarked);\n      // If there are duplicate bookmarks, the latest index will be kept\n      this._bookmarkIndexMap.set(key, index);\n    });\n  }\n}\n\nfunction getUrlStateForComparison(trail: DataTrail) {\n  const urlState = sceneUtils.getUrlState(trail);\n  // Make a few corrections\n  correctUrlStateForComparison(urlState);\n\n  return urlState;\n}\n\nfunction correctUrlStateForComparison(urlState: SceneObjectUrlValues) {\n  // Omit some URL parameters that are not useful for state comparison,\n  // as they can change in the URL without creating new steps\n  delete urlState.actionView;\n  delete urlState.layout;\n  delete urlState.metricSearch;\n  delete urlState.refresh;\n\n  // Populate defaults\n  if (urlState['var-groupby'] === '' || urlState['var-groupby'] === undefined) {\n    urlState['var-groupby'] = '$__all';\n  }\n\n  if (typeof urlState['var-filters'] !== 'string') {\n    urlState['var-filters'] = urlState['var-filters']?.filter((filter) => filter !== '');\n  }\n\n  return urlState;\n}\n\nexport function getBookmarkKey(trail: DataTrail | DataTrailBookmark) {\n  if (trail instanceof DataTrail) {\n    return JSON.stringify(getUrlStateForComparison(trail));\n  }\n  return JSON.stringify(correctUrlStateForComparison({ ...trail.urlValues }));\n}\n\nlet store: TrailStore | undefined;\nexport function getTrailStore(): TrailStore {\n  if (!store) {\n    store = new TrailStore();\n  }\n\n  return store;\n}\n\nfunction isSerializedTrail(serialized: unknown): serialized is SerializedTrail {\n  return serialized != null && typeof serialized === 'object' && 'history' in serialized;\n}\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\nimport { LinkButton, Stack } from '@grafana/ui';\nimport React from 'react';\n\nimport { ROUTES } from '../constants';\nimport { HOME_ROUTE } from '../shared';\nimport { currentPathIncludes } from '../utils';\n\nexport function createBookmarkSavedNotification() {\n  const appEvents = getAppEvents();\n  const isSidebarView = currentPathIncludes(ROUTES.Drilldown);\n\n  const infoText = !isSidebarView ? <i>Drilldown &gt; Metrics</i> : <i>the Metrics Reducer sidebar</i>;\n\n  appEvents.publish({\n    type: AppEvents.alertSuccess.name,\n    payload: [\n      'Bookmark created',\n      <Stack gap={2} direction=\"row\" key=\"bookmark-notification\">\n        <div>You can view bookmarks under {infoText}</div>\n        {!isSidebarView && (\n          <LinkButton fill=\"solid\" variant=\"secondary\" href={HOME_ROUTE}>\n            View bookmarks\n          </LinkButton>\n        )}\n      </Stack>,\n    ],\n  });\n}\n","import { OutlierDetector, type OutlierOutput } from '@bsull/augurs/outlier';\nimport {\n  doStandardCalcs,\n  fieldReducers,\n  FieldType,\n  outerJoinDataFrames,\n  ReducerID,\n  type DataFrame,\n} from '@grafana/data';\nimport { memoize } from 'lodash';\n\nimport { logger } from 'tracking/logger/logger';\n\nimport { reportExploreMetrics } from '../interactions';\nimport { getLabelValueFromDataFrame } from './levels';\n\nexport const sortSeries = memoize(\n  (series: DataFrame[], sortBy: string, direction = 'asc') => {\n    if (sortBy === 'alphabetical') {\n      return sortSeriesByName(series, 'asc');\n    }\n\n    if (sortBy === 'alphabetical-reversed') {\n      return sortSeriesByName(series, 'desc');\n    }\n\n    if (sortBy === 'outliers') {\n      initOutlierDetector(series);\n    }\n\n    const reducer = (dataFrame: DataFrame) => {\n      try {\n        if (sortBy === 'outliers') {\n          return calculateOutlierValue(series, dataFrame);\n        }\n      } catch (e) {\n        logger.error(e as Error, { message: 'ML sorting panicked, fallback to stdDev' });\n        // ML sorting panicked, fallback to stdDev\n        sortBy = ReducerID.stdDev;\n      }\n      const fieldReducer = fieldReducers.get(sortBy);\n      const value =\n        fieldReducer.reduce?.(dataFrame.fields[1], true, true) ?? doStandardCalcs(dataFrame.fields[1], true, true);\n      return value[sortBy] ?? 0;\n    };\n\n    const seriesCalcs = series.map((dataFrame) => ({\n      value: reducer(dataFrame),\n      dataFrame: dataFrame,\n    }));\n\n    seriesCalcs.sort((a, b) => {\n      if (a.value !== undefined && b.value !== undefined) {\n        return b.value - a.value;\n      }\n      return 0;\n    });\n\n    if (direction === 'asc') {\n      seriesCalcs.reverse();\n    }\n\n    return seriesCalcs.map(({ dataFrame }) => dataFrame);\n  },\n  (series: DataFrame[], sortBy: string, direction = 'asc') => {\n    const firstTimestamp = seriesIsNotEmpty(series) ? series[0].fields[0].values[0] : 0;\n    const lastTimestamp = seriesIsNotEmpty(series)\n      ? series[series.length - 1].fields[0].values[series[series.length - 1].fields[0].values.length - 1]\n      : 0;\n    const firstValue = series.length > 0 ? getLabelValueFromDataFrame(series[0]) : '';\n    const lastValue = series.length > 0 ? getLabelValueFromDataFrame(series[series.length - 1]) : '';\n    const key = `${firstValue}_${lastValue}_${firstTimestamp}_${lastTimestamp}_${series.length}_${sortBy}_${direction}`;\n    return key;\n  }\n);\n\nfunction seriesIsNotEmpty(series: DataFrame[]) {\n  return series.length > 0 && series[0].fields.length > 0 && series[0].fields[0].values.length > 0;\n}\n\nconst initOutlierDetector = (series: DataFrame[]) => {\n  if (!wasmSupported()) {\n    return;\n  }\n\n  // Combine all frames into one by joining on time.\n  const joined = outerJoinDataFrames({ frames: series });\n  if (!joined) {\n    return;\n  }\n\n  // Get number fields: these are our series.\n  const joinedSeries = joined.fields.filter((f) => f.type === FieldType.number);\n  const points = joinedSeries.map((series) => new Float64Array(series.values));\n\n  try {\n    const detector = OutlierDetector.dbscan({ sensitivity: 0.4 }).preprocess(points);\n    outliers = detector.detect();\n  } catch (e) {\n    logger.error(e as Error, { message: 'Error initializing outlier detector' });\n    outliers = undefined;\n  }\n};\n\nlet outliers: OutlierOutput | undefined = undefined;\n\nexport const calculateOutlierValue = (series: DataFrame[], data: DataFrame): number => {\n  if (!wasmSupported()) {\n    throw new Error('WASM not supported, fall back to stdDev');\n  }\n  if (!outliers) {\n    throw new Error('Initialize outlier detector first');\n  }\n\n  const index = series.indexOf(data);\n  if (outliers.seriesResults[index].isOutlier) {\n    return -outliers.seriesResults[index].outlierIntervals.length;\n  }\n\n  return 0;\n};\n\nexport const sortSeriesByName = (series: DataFrame[], direction: string) => {\n  const sortedSeries = [...series];\n  sortedSeries.sort((a, b) => {\n    const valueA = getLabelValueFromDataFrame(a);\n    const valueB = getLabelValueFromDataFrame(b);\n    if (!valueA || !valueB) {\n      return 0;\n    }\n    return valueA?.localeCompare(valueB) ?? 0;\n  });\n  if (direction === 'desc') {\n    sortedSeries.reverse();\n  }\n  return sortedSeries;\n};\n\nexport const wasmSupported = () => {\n  const support = typeof WebAssembly === 'object';\n\n  if (!support) {\n    reportExploreMetrics('wasm_not_supported', {});\n  }\n\n  return support;\n};\n","import { type AdHocVariableFilter } from '@grafana/data';\nimport { config, reportInteraction } from '@grafana/runtime';\n\nimport { type LabelBreakdownSortingOption as BreakdownSortByOption } from 'Breakdown/SortByScene';\nimport { type ActionViewType } from 'MetricActionBar';\nimport { type SortingOption as MetricsReducerSortByOption } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\n\nimport { type BreakdownLayoutType } from './Breakdown/types';\nimport { PLUGIN_ID } from './constants';\nimport { GIT_COMMIT } from './version';\n\nexport type ViewName = 'metrics-reducer' | 'metric-details';\n\ntype Interactions = {\n  // User selected a label to view its breakdown.\n  label_selected: {\n    label: string;\n    cause: // By clicking the \"select\" button on that label's breakdown panel\n    | 'breakdown_panel'\n      // By clicking on the label selector at the top of the breakdown\n      | 'selector';\n  };\n  // User changed a label filter\n  label_filter_changed: {\n    label: string;\n    action: 'added' | 'removed' | 'changed';\n    cause: 'breakdown' | 'adhoc_filter';\n  };\n  // User changed the breakdown layout\n  breakdown_layout_changed: { layout: BreakdownLayoutType };\n  // A metric exploration has started due to one of the following causes\n  exploration_started: {\n    cause: 'bookmark_clicked';\n  };\n  // A user has changed a bookmark\n  bookmark_changed: {\n    action: // Toggled on or off from the bookmark icon\n    | 'toggled_on'\n      | 'toggled_off'\n      // Deleted from the sidebar bookmarks list\n      | 'deleted';\n  };\n  // User changes metric explore settings\n  settings_changed: { stickyMainGraph?: boolean };\n  // User clicks on tab to change the action view\n  metric_action_view_changed: {\n    view: ActionViewType;\n\n    // The number of related logs\n    related_logs_count?: number;\n  };\n  // User clicks on one of the action buttons associated with a selected metric\n  selected_metric_action_clicked: {\n    action: // Opens the metric queries in Explore\n    | 'open_in_explore'\n      // Clicks on the share URL button\n      | 'share_url'\n      // Deselects the current selected metrics by clicking the \"Select new metric\" button\n      | 'unselect'\n      // When in embedded mode, clicked to open the exploration from the embedded view\n      | 'open_from_embedded';\n  };\n  // User clicks on one of the action buttons associated with related logs\n  related_logs_action_clicked: {\n    action: // Opens Logs Drilldown\n    | 'open_logs_drilldown'\n      // Logs data source changed\n      | 'logs_data_source_changed';\n  };\n  // User selects a metric\n  metric_selected: {\n    from: // By clicking \"Select\" on a metric panel when on the no-metric-selected metrics list view\n    | 'metric_list'\n      // By clicking \"Select\" on a metric panel when on the related metrics tab\n      | 'related_metrics';\n    // The number of search terms activated when the selection was made\n    searchTermCount: number | null;\n  };\n  // User opens/closes the prefix filter dropdown\n  prefix_filter_clicked: {\n    from: // By clicking \"Select\" on a metric panel when on the no-metric-selected metrics list view\n    | 'metric_list'\n      // By clicking \"Select\" on a metric panel when on the related metrics tab\n      | 'related_metrics';\n    action: // Opens the dropdown\n    | 'open'\n      // Closes the dropdown\n      | 'close';\n  };\n  // User types in the quick search bar\n  quick_search_used: {};\n  sorting_changed:\n    | {\n        // By clicking on the sort by variable in the metrics reducer\n        from: 'metrics-reducer';\n        // The sort by option selected\n        sortBy: MetricsReducerSortByOption;\n      }\n    | {\n        // By clicking on the sort by component in the label breakdown\n        from: 'label-breakdown';\n        // The sort by option selected\n        sortBy: BreakdownSortByOption;\n      };\n  wasm_not_supported: {};\n  native_histogram_examples_closed: {};\n  native_histogram_example_clicked: {\n    metric: string;\n  };\n  // User toggles the Wingman sidebar\n  metrics_sidebar_toggled: {\n    action: // Opens the sidebar section\n    | 'opened'\n      // Closes the sidebar section\n      | 'closed';\n    section?: string;\n  };\n  // User clicks into the prefix filter section of the sidebar\n  sidebar_prefix_filter_section_clicked: {};\n  // User applies any prefix filter from the sidebar\n  sidebar_prefix_filter_applied: {\n    // Number of prefix filters applied (optional)\n    filter_count?: number;\n  };\n  // User clicks into the suffix filter section of the sidebar\n  sidebar_suffix_filter_section_clicked: {};\n  // User applies any suffix filter from the sidebar\n  sidebar_suffix_filter_applied: {\n    // Number of suffix filters applied (optional)\n    filter_count?: number;\n  };\n  // User selects a rules filter from the Wingman sidebar\n  sidebar_rules_filter_selected: {\n    filter_type: 'non_rules_metrics' | 'recording_rules';\n  };\n  // User applies a label filter from the sidebar\n  sidebar_group_by_label_filter_applied: {\n    label: string;\n  };\n  app_initialized: {\n    view: ViewName;\n  };\n};\n\nconst INTERACTION_NAME_PREFIX = 'grafana_explore_metrics_';\n\nexport function reportExploreMetrics<E extends keyof Interactions, P extends Interactions[E]>(event: E, payload: P) {\n  reportInteraction(`${INTERACTION_NAME_PREFIX}${event}`, {\n    ...payload,\n    meta: {\n      // same naming as Faro (see src/tracking/faro/faro.ts)\n      appRelease: config.apps[PLUGIN_ID].version,\n      appVersion: GIT_COMMIT,\n    },\n  });\n}\n\n/**\n * Reports a single label filter change event\n */\nfunction reportLabelFilterChange(label: string, action: 'added' | 'removed' | 'changed') {\n  reportExploreMetrics('label_filter_changed', {\n    label,\n    action,\n    cause: 'adhoc_filter',\n  });\n}\n\n/**\n * Detects and reports changes to an existing filter\n */\nfunction detectChangedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const oldFilter of oldFilters) {\n    for (const newFilter of newFilters) {\n      if (oldFilter.key === newFilter.key && oldFilter.value !== newFilter.value) {\n        reportLabelFilterChange(oldFilter.key, 'changed');\n      }\n    }\n  }\n}\n\n/**\n * Detects and reports removed filters\n */\nfunction detectRemovedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const oldFilter of oldFilters) {\n    const stillExists = newFilters.some((newFilter) => newFilter.key === oldFilter.key);\n    if (!stillExists) {\n      reportLabelFilterChange(oldFilter.key, 'removed');\n    }\n  }\n}\n\n/**\n * Detects and reports added filters\n */\nfunction detectAddedFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  for (const newFilter of newFilters) {\n    const isNew = !oldFilters.some((oldFilter) => oldFilter.key === newFilter.key);\n    if (isNew) {\n      reportLabelFilterChange(newFilter.key, 'added');\n    }\n  }\n}\n\n/** Detect the single change in filters and report the event, assuming it came from manipulating the adhoc filter */\nexport function reportChangeInLabelFilters(newFilters: AdHocVariableFilter[], oldFilters: AdHocVariableFilter[]) {\n  if (newFilters.length === oldFilters.length) {\n    // Same number of filters - check for changed values\n    detectChangedFilters(newFilters, oldFilters);\n  } else if (newFilters.length < oldFilters.length) {\n    // Filters were removed\n    detectRemovedFilters(newFilters, oldFilters);\n  } else {\n    // Filters were added\n    detectAddedFilters(newFilters, oldFilters);\n  }\n}\n","import { AppEvents } from '@grafana/data';\nimport { getAppEvents } from '@grafana/runtime';\n\nimport { logger } from 'tracking/logger/logger';\n\nexport function displayError(error: Error, msgs: string[]) {\n  const context = msgs.reduce((acc, msg, i) => ({ ...acc, [`info${i + 1}`]: msg }), { handheldBy: 'displayError' });\n\n  logger.error(error, context);\n\n  getAppEvents().publish({\n    type: AppEvents.alertError.name,\n    payload: msgs,\n  });\n}\n\nexport function displayWarning(msgs: string[]) {\n  logger.warn(msgs);\n\n  getAppEvents().publish({\n    type: AppEvents.alertWarning.name,\n    payload: msgs,\n  });\n}\n\nexport function displaySuccess(msgs: string[]) {\n  getAppEvents().publish({\n    type: AppEvents.alertSuccess.name,\n    payload: msgs,\n  });\n}\n","import {\n  MultiValueVariable,\n  sceneGraph,\n  SceneObjectBase,\n  VariableDependencyConfig,\n  type SceneComponentProps,\n  type SceneLayout,\n  type SceneObject,\n  type SceneObjectState,\n  type VariableValueOption,\n} from '@grafana/scenes';\nimport React from 'react';\n\nimport { logger } from 'tracking/logger/logger';\n\n/**\n * This component has been borrowd from Scenes v5,41,1, which is the version Metrics Drilldown currently use.\n *\n * The main purpose of this new component is to create a Scene object that has the capabilities of the original SceneByVariableRepeater and\n * that also to provide:\n *\n *   1. lazy loading/pagination\n *   2. configurable loading/error/empty states\n *   4. minor details (like calling getLayoutChild() and passing an index for multi coloring timeseries)\n *\n *\n */\ninterface SceneByVariableRepeaterState extends SceneObjectState {\n  variableName: string;\n  body: SceneLayout;\n  getLayoutChild(option: VariableValueOption, index: number, options: VariableValueOption[]): SceneObject | null;\n  getLayoutLoading?: () => SceneObject;\n  getLayoutError?: (error: Error) => SceneObject;\n  getLayoutEmpty?: () => SceneObject;\n  currentBatchSize: number;\n  initialPageSize: number;\n  pageSizeIncrement: number;\n  loadingLayout?: SceneObject;\n  errorLayout?: SceneObject;\n  emptyLayout?: SceneObject;\n}\n\nconst DEFAULT_INITIAL_PAGE_SIZE = 6;\nconst DEFAULT_PAGE_SIZE_INCREMENT = 9;\n\nexport class SceneByVariableRepeater extends SceneObjectBase<SceneByVariableRepeaterState> {\n  protected _variableDependency: VariableDependencyConfig<SceneByVariableRepeaterState> = new VariableDependencyConfig(\n    this,\n    {\n      variableNames: [this.state.variableName],\n      onVariableUpdateCompleted: () => this.performRepeat(),\n    }\n  );\n\n  public constructor({\n    variableName,\n    body,\n    getLayoutChild,\n    getLayoutLoading,\n    getLayoutError,\n    getLayoutEmpty,\n    initialPageSize,\n    pageSizeIncrement,\n  }: {\n    variableName: SceneByVariableRepeaterState['variableName'];\n    body: SceneByVariableRepeaterState['body'];\n    getLayoutChild: SceneByVariableRepeaterState['getLayoutChild'];\n    getLayoutLoading?: SceneByVariableRepeaterState['getLayoutLoading'];\n    getLayoutError?: SceneByVariableRepeaterState['getLayoutError'];\n    getLayoutEmpty?: SceneByVariableRepeaterState['getLayoutEmpty'];\n    initialPageSize?: SceneByVariableRepeaterState['initialPageSize'];\n    pageSizeIncrement?: SceneByVariableRepeaterState['pageSizeIncrement'];\n  }) {\n    super({\n      variableName,\n      body,\n      getLayoutChild,\n      getLayoutLoading,\n      getLayoutError,\n      getLayoutEmpty,\n      currentBatchSize: 0,\n      initialPageSize: initialPageSize || DEFAULT_INITIAL_PAGE_SIZE,\n      pageSizeIncrement: pageSizeIncrement || DEFAULT_PAGE_SIZE_INCREMENT,\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n    });\n\n    this.addActivationHandler(() => this.performRepeat());\n  }\n\n  private performRepeat() {\n    if (this._variableDependency.hasDependencyInLoadingState()) {\n      this.setState({\n        loadingLayout: this.state.getLayoutLoading?.(),\n        errorLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this);\n    if (!(variable instanceof MultiValueVariable)) {\n      const error = new Error('SceneByVariableRepeater: variable is not a MultiValueVariable!');\n      logger.error(error);\n      return;\n    }\n\n    if (variable.state.error) {\n      this.setState({\n        errorLayout: this.state.getLayoutError?.(variable.state.error),\n        loadingLayout: undefined,\n        emptyLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    const values = getMultiVariableValues(variable);\n\n    if (!values.length) {\n      this.setState({\n        emptyLayout: this.state.getLayoutEmpty?.(),\n        errorLayout: undefined,\n        loadingLayout: undefined,\n        currentBatchSize: 0,\n      });\n      return;\n    }\n\n    this.setState({\n      loadingLayout: undefined,\n      errorLayout: undefined,\n      emptyLayout: undefined,\n      currentBatchSize: this.state.initialPageSize,\n    });\n\n    const newChildren: SceneObject[] = values\n      .slice(0, this.state.initialPageSize)\n      .map((option, index) => this.state.getLayoutChild(option, index, values))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: newChildren,\n    });\n  }\n\n  public increaseBatchSize() {\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this) as MultiValueVariable;\n    const values = getMultiVariableValues(variable);\n\n    const newBatchSize = this.state.currentBatchSize + this.state.pageSizeIncrement;\n\n    const newChildren: SceneObject[] = values\n      .slice(this.state.currentBatchSize, newBatchSize)\n      .map((option, index) => this.state.getLayoutChild(option, this.state.currentBatchSize + index, values))\n      .filter(Boolean) as SceneObject[];\n\n    this.state.body.setState({\n      children: [...this.state.body.state.children, ...newChildren],\n    });\n\n    this.setState({\n      currentBatchSize: newBatchSize,\n    });\n  }\n\n  public useSizes() {\n    const { currentBatchSize, pageSizeIncrement } = this.useState();\n    const variable = sceneGraph.lookupVariable(this.state.variableName, this);\n    const total = (variable as MultiValueVariable).state.options.length;\n    const remaining = total - currentBatchSize;\n    const increment = remaining < pageSizeIncrement ? remaining : pageSizeIncrement;\n    return {\n      increment,\n      current: currentBatchSize,\n      total,\n    };\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SceneByVariableRepeater>) => {\n    const { body, loadingLayout, errorLayout, emptyLayout } = model.useState();\n\n    if (loadingLayout) {\n      return <loadingLayout.Component model={loadingLayout} />;\n    }\n\n    if (errorLayout) {\n      return <errorLayout.Component model={errorLayout} />;\n    }\n\n    if (emptyLayout) {\n      return <emptyLayout.Component model={emptyLayout} />;\n    }\n\n    return <body.Component model={body} />;\n  };\n}\n\nexport function getMultiVariableValues(variable: MultiValueVariable): VariableValueOption[] {\n  const { value, text, options } = variable.state;\n\n  if (variable.hasAllValue()) {\n    return options;\n  }\n\n  if (Array.isArray(value) && Array.isArray(text)) {\n    return value.map((v, i) => ({ value: v, label: text[i] as string }));\n  }\n\n  return [{ value: value as string, label: text as string }];\n}\n","import { type Scope } from '@grafana/data';\nimport { SceneObjectBase, type SceneObjectState } from '@grafana/scenes';\n\nexport function getSelectedScopes(): Scope[] {\n  return [];\n}\n\nexport function getClosestScopesFacade(): ScopesFacade {\n  return new ScopesFacade();\n}\n\ninterface SelectedScope {\n  scope: Scope;\n  path: string[];\n}\n\ninterface ScopesFacadeState extends SceneObjectState {\n  // A callback that will be executed when new scopes are set\n  handler?: (facade: ScopesFacade) => void;\n  // The render count is a workaround to force the URL sync manager to update the URL with the latest scopes\n  // Basically it starts at 0, and it is increased with every scopes value update\n  renderCount?: number;\n}\n\nexport class ScopesFacade extends SceneObjectBase<ScopesFacadeState> {\n  private selectedScopes: SelectedScope[] = [];\n  private onScopesChangeCallbacks: Array<(scopes: SelectedScope[]) => void> = [];\n\n  constructor() {\n    super({});\n  }\n\n  public getSelectedScopes(): SelectedScope[] {\n    return this.selectedScopes;\n  }\n\n  public getSelectedScopesNames(): string[] {\n    return this.selectedScopes.map(({ scope }) => scope.metadata.name);\n  }\n\n  public setSelectedScopes(scopes: SelectedScope[]) {\n    this.selectedScopes = scopes;\n    this.notifySubscribers();\n  }\n\n  public onScopesChange(callback: (scopes: SelectedScope[]) => void) {\n    this.onScopesChangeCallbacks.push(callback);\n    return () => {\n      this.onScopesChangeCallbacks = this.onScopesChangeCallbacks.filter((cb) => cb !== callback);\n    };\n  }\n\n  private notifySubscribers() {\n    for (const callback of this.onScopesChangeCallbacks) {\n      callback(this.selectedScopes);\n    }\n  }\n\n  public get value() {\n    return getSelectedScopes();\n  }\n}\n\nexport function ScopesSelector(): null {\n  return null;\n}\n","import {\n  scopeFilterOperatorMap,\n  urlUtil,\n  type AdHocVariableFilter,\n  type GetTagResponse,\n  type MetricFindValue,\n  type RawTimeRange,\n  type Scope,\n  type ScopeSpecFilter,\n} from '@grafana/data';\nimport { getPrometheusTime } from '@grafana/prometheus';\nimport { config, getBackendSrv, getDataSourceSrv, type FetchResponse } from '@grafana/runtime';\nimport {\n  sceneGraph,\n  SceneTimeRange,\n  sceneUtils,\n  type AdHocFiltersVariable,\n  type SceneObject,\n  type SceneObjectState,\n  type SceneVariable,\n  type SceneVariableState,\n} from '@grafana/scenes';\nimport { lastValueFrom } from 'rxjs';\n\nimport { logger } from 'tracking/logger/logger';\n\nimport { ROUTES } from './constants';\nimport { DataTrail } from './DataTrail';\nimport { type DataTrailSettings } from './DataTrailSettings';\nimport { type MetricDatasourceHelper } from './helpers/MetricDatasourceHelper';\nimport { MetricScene } from './MetricScene';\nimport { LOGS_METRIC, VAR_DATASOURCE_EXPR } from './shared';\nimport { getTrailStore } from './TrailStore/TrailStore';\nimport { getClosestScopesFacade } from './utils/utils.scopes';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport function getTrailFor(model: SceneObject): DataTrail {\n  return sceneGraph.getAncestor(model, DataTrail);\n}\n\nexport function getTrailSettings(model: SceneObject): DataTrailSettings {\n  return sceneGraph.getAncestor(model, DataTrail).state.settings;\n}\n\nexport function newMetricsTrail(initialDS?: string): DataTrail {\n  return new DataTrail({\n    initialDS,\n    $timeRange: new SceneTimeRange({ from: 'now-1h', to: 'now' }),\n    embedded: false,\n  });\n}\n\nexport function getUrlForTrail(trail: DataTrail) {\n  const params = sceneUtils.getUrlState(trail);\n  return urlUtil.renderUrl(ROUTES.Drilldown, params);\n}\n\nexport function getCurrentPath(): Location['pathname'] {\n  return window.location.pathname;\n}\n\nexport function currentPathIncludes(path: string) {\n  return getCurrentPath().includes(path);\n}\n\nexport function getMetricSceneFor(model: SceneObject): MetricScene {\n  if (model instanceof MetricScene) {\n    return model;\n  }\n\n  if (model.parent) {\n    return getMetricSceneFor(model.parent);\n  }\n  const error = new Error('Unable to find graph view for model');\n  logger.error(error, { model: model.toString(), message: 'Unable to find graph view for model' });\n\n  throw error;\n}\n\nexport function getDataSource(trail: DataTrail) {\n  return sceneGraph.interpolate(trail, VAR_DATASOURCE_EXPR);\n}\n\nexport function getDataSourceName(dataSourceUid: string) {\n  return getDataSourceSrv().getInstanceSettings(dataSourceUid)?.name || dataSourceUid;\n}\n\nexport function getMetricName(metric?: string) {\n  if (!metric) {\n    return 'All metrics';\n  }\n\n  if (metric === LOGS_METRIC) {\n    return 'Logs';\n  }\n\n  return metric;\n}\n\nexport function getDatasourceForNewTrail(): string | undefined {\n  const prevTrail = getTrailStore().recent[0];\n  if (prevTrail) {\n    const prevDataSource = sceneGraph.interpolate(prevTrail.resolve(), VAR_DATASOURCE_EXPR);\n    if (prevDataSource.length > 0) {\n      return prevDataSource;\n    }\n  }\n  const promDatasources = getDataSourceSrv().getList({ type: 'prometheus' });\n  if (promDatasources.length > 0) {\n    const defaultDatasource = promDatasources.find((mds) => mds.isDefault);\n\n    return defaultDatasource?.uid ?? promDatasources[0].uid;\n  }\n  return undefined;\n}\n\nexport function getColorByIndex(index: number) {\n  const visTheme = config.theme2.visualization;\n  return visTheme.getColorByName(visTheme.palette[index % 8]);\n}\n\nexport type SceneTimeRangeState = SceneObjectState & {\n  from: string;\n  to: string;\n  timeZone?: string;\n};\n\nexport function getFilters(scene: SceneObject) {\n  const filters = sceneGraph.lookupVariable('filters', scene);\n  if (isAdHocFiltersVariable(filters)) {\n    return filters.state.filters;\n  }\n  return null;\n}\n\n// frontend hardening limit\nconst MAX_ADHOC_VARIABLE_OPTIONS = 10000;\n\n/**\n * Add custom providers for the adhoc filters variable that limit the responses for labels keys and label values.\n * Currently hard coded to 10000.\n *\n * The current provider functions for adhoc filter variables are the functions getTagKeys and getTagValues in the data source.\n * This function still uses these functions from inside the data source helper.\n *\n * @param dataTrail\n * @param limitedFilterVariable this is the filters variable\n * @param datasourceHelper\n */\nexport function limitAdhocProviders(\n  dataTrail: DataTrail,\n  limitedFilterVariable: SceneVariable<SceneVariableState> | null,\n  datasourceHelper: MetricDatasourceHelper\n) {\n  if (!isAdHocFiltersVariable(limitedFilterVariable)) {\n    return;\n  }\n\n  limitedFilterVariable.setState({\n    getTagKeysProvider: async (): Promise<{\n      replace?: boolean;\n      values: GetTagResponse | MetricFindValue[];\n    }> => {\n      // For the Prometheus label names endpoint, '/api/v1/labels'\n      // get the previously selected filters from the variable\n      // to use in the query to filter the response\n      // using filters, e.g. {previously_selected_label:\"value\"},\n      // as the series match[] parameter in Prometheus labels endpoint\n      const filters = limitedFilterVariable.state.filters;\n      // call getTagKeys and truncate the response\n      // we're passing the queries so we get the labels that adhere to the queries\n      // we're also passing the scopes so we get the labels that adhere to the scopes filters\n\n      const opts = {\n        filters,\n        scopes: getClosestScopesFacade()?.value,\n        queries: dataTrail.getQueries(),\n      };\n\n      // if there are too many queries it takes to much time to process the requests.\n      // In this case we favour responsiveness over reducing the number of options.\n      if (opts.queries.length > 20) {\n        opts.queries = [];\n      }\n\n      let values = (await datasourceHelper.getTagKeys(opts)).slice(0, MAX_ADHOC_VARIABLE_OPTIONS);\n\n      // use replace: true to override the default lookup in adhoc filter variable\n      return { replace: true, values };\n    },\n    getTagValuesProvider: async (\n      _: AdHocFiltersVariable,\n      filter: AdHocVariableFilter\n    ): Promise<{\n      replace?: boolean;\n      values: GetTagResponse | MetricFindValue[];\n    }> => {\n      // For the Prometheus label values endpoint, /api/v1/label/${interpolatedName}/values\n      // get the previously selected filters from the variable\n      // to use in the query to filter the response\n      // using filters, e.g. {previously_selected_label:\"value\"},\n      // as the series match[] parameter in Prometheus label values endpoint\n      const filtersValues = limitedFilterVariable.state.filters;\n      // remove current selected filter if updating a chosen filter\n      const filters = filtersValues.filter((f) => f.key !== filter.key);\n      // call getTagValues and truncate the response\n      // we're passing the queries so we get the label values that adhere to the queries\n      // we're also passing the scopes so we get the label values that adhere to the scopes filters\n\n      const opts = {\n        key: filter.key,\n        filters,\n        scopes: getClosestScopesFacade()?.value,\n        queries: dataTrail.getQueries(),\n      };\n\n      // if there are too many queries it takes to much time to process the requests.\n      // In this case we favour responsiveness over reducing the number of options.\n      if (opts.queries.length > 20) {\n        opts.queries = [];\n      }\n\n      const values = (await datasourceHelper.getTagValues(opts)).slice(0, MAX_ADHOC_VARIABLE_OPTIONS);\n      // use replace: true to override the default lookup in adhoc filter variable\n      return { replace: true, values };\n    },\n  });\n}\n\nexport type SuggestionsResponse = {\n  data: string[];\n  status: 'success' | 'error';\n  error?: 'string';\n  warnings?: string[];\n};\n\n// Suggestions API is an API that receives adhoc filters, scopes and queries and returns the labels or label values that match the provided parameters\n// Under the hood it does exactly what the label and label values API where doing but the processing is done in the BE rather than in the FE\nexport async function callSuggestionsApi(\n  dataSourceUid: string,\n  timeRange: RawTimeRange,\n  scopes: Scope[],\n  adHocVariableFilters: AdHocVariableFilter[],\n  labelName: string | undefined,\n  limit: number | undefined,\n  requestId: string\n): Promise<FetchResponse<SuggestionsResponse>> {\n  return await lastValueFrom(\n    getBackendSrv().fetch<SuggestionsResponse>({\n      url: `/api/datasources/uid/${dataSourceUid}/resources/suggestions`,\n      data: {\n        labelName,\n        queries: [],\n        scopes: scopes.reduce<ScopeSpecFilter[]>((acc, scope) => {\n          acc.push(...scope.spec.filters);\n\n          return acc;\n        }, []),\n        adhocFilters: adHocVariableFilters.map((filter) => ({\n          key: filter.key,\n          operator: scopeFilterOperatorMap[filter.operator],\n          value: filter.value,\n          values: filter.values,\n        })),\n        start: getPrometheusTime(timeRange.from, false).toString(),\n        end: getPrometheusTime(timeRange.to, true).toString(),\n        limit,\n      },\n      requestId,\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    })\n  );\n}\n\ninterface SceneType<T> extends Function {\n  new (...args: never[]): T;\n}\n\nexport function findObjectOfType<T extends SceneObject>(\n  scene: SceneObject,\n  check: (obj: SceneObject) => boolean,\n  returnType: SceneType<T>\n) {\n  const obj = sceneGraph.findObject(scene, check);\n  if (obj instanceof returnType) {\n    return obj;\n  } else if (obj !== null) {\n    logger.warn(`invalid return type: ${returnType.toString()}`);\n  }\n\n  return null;\n}\n","export const localeCompare = new Intl.Collator('en', { sensitivity: 'base' }).compare;\n","import { SceneVariableValueChangedEvent, type QueryVariable, type VariableValueOption } from '@grafana/scenes';\nimport { cloneDeep, isEqual } from 'lodash';\n\nimport { type MetricOptions } from './MetricsVariable';\n\nexport type MetricFilters = {\n  categories: string[];\n  prefixes: string[];\n  suffixes: string[];\n  names: string[];\n};\n\nexport class MetricsVariableFilterEngine {\n  private variable: QueryVariable;\n  private initOptions: VariableValueOption[] = [];\n  private filters: MetricFilters = {\n    categories: [],\n    prefixes: [],\n    suffixes: [],\n    names: [],\n  };\n\n  constructor(variable: QueryVariable) {\n    this.variable = variable;\n  }\n\n  public setInitOptions(options: VariableValueOption[]) {\n    this.initOptions = cloneDeep(options);\n  }\n\n  /**\n   * Get a copy of the current filters\n   */\n  public getFilters(): MetricFilters {\n    return this.filters;\n  }\n\n  /**\n   * Compute options based on filters.\n   * @param options The options to filter\n   * @param filters The filters to apply\n   * @returns Filtered options\n   */\n  public static getFilteredOptions(options: VariableValueOption[], filters: MetricFilters): MetricOptions {\n    let filteredOptions = options as MetricOptions;\n\n    if (filters.categories.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyCategoryFilters(filteredOptions, filters.categories);\n    }\n\n    if (filters.prefixes.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyPrefixFilters(filteredOptions, filters.prefixes);\n    }\n\n    if (filters.suffixes.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applySuffixFilters(filteredOptions, filters.suffixes);\n    }\n\n    if (filters.names.length > 0) {\n      filteredOptions = MetricsVariableFilterEngine.applyNameFilters(filteredOptions, filters.names);\n    }\n\n    return filteredOptions;\n  }\n\n  public applyFilters(filters: Partial<MetricFilters> = this.filters, settings = { forceUpdate: false, notify: true }) {\n    const updatedFilters: MetricFilters = {\n      ...this.filters,\n      ...filters,\n    };\n\n    if (!settings.forceUpdate && isEqual(this.filters, updatedFilters)) {\n      return;\n    }\n\n    if (\n      !updatedFilters.categories.length &&\n      !updatedFilters.prefixes.length &&\n      !updatedFilters.suffixes.length &&\n      !updatedFilters.names.length\n    ) {\n      this.filters = updatedFilters;\n\n      this.variable.setState({ options: this.initOptions });\n\n      if (settings.notify) {\n        this.notifyUpdate();\n      }\n\n      return;\n    }\n\n    this.filters = updatedFilters;\n\n    const filteredOptions = MetricsVariableFilterEngine.getFilteredOptions(this.initOptions, this.filters);\n\n    this.variable.setState({ options: filteredOptions });\n\n    if (settings.notify) {\n      this.notifyUpdate();\n    }\n  }\n\n  private static applyCategoryFilters(options: MetricOptions, categories: string[]): MetricOptions {\n    let filteredOptions: MetricOptions = [];\n\n    for (const category of categories) {\n      const categoryRegex = MetricsVariableFilterEngine.buildRegex(category, 'i'); // see e.g. computeRulesGroups (could apply to other categories in the future)\n      filteredOptions = filteredOptions.concat(options.filter((option) => categoryRegex.test(option.value)));\n    }\n\n    return filteredOptions;\n  }\n\n  private static applyPrefixFilters(options: MetricOptions, prefixes: string[]): MetricOptions {\n    const pattern = prefixes\n      .map((prefix) => {\n        // Multi-value support (see computeMetricPrefixGroups)\n        if (prefix.includes('|')) {\n          return `${prefix\n            .split('|')\n            .map((p) => `^${p}([^a-z0-9]|$)`)\n            .join('|')}`;\n        }\n\n        return `^${prefix}([^a-z0-9]|$)`;\n      })\n      .join('|');\n\n    const prefixesRegex = MetricsVariableFilterEngine.buildRegex(`(${pattern})`);\n\n    const filteredOptions = options.filter((option) => prefixesRegex.test(option.value as string));\n\n    return filteredOptions;\n  }\n\n  private static applySuffixFilters(options: MetricOptions, suffixes: string[]): MetricOptions {\n    const pattern = suffixes\n      .map((suffix) => {\n        // Multi-value support (see computeMetricSuffixGroups)\n        if (suffix.includes('|')) {\n          return `${suffix\n            .split('|')\n            .map((s) => `(^|[^a-z0-9])${s}$`)\n            .join('|')}`;\n        }\n\n        return `(^|[^a-z0-9])${suffix}$`;\n      })\n      .join('|');\n\n    const suffixesRegex = MetricsVariableFilterEngine.buildRegex(`(${pattern})`);\n\n    const filteredOptions = options.filter((option) => suffixesRegex.test(option.value as string));\n\n    return filteredOptions;\n  }\n\n  private static applyNameFilters(options: MetricOptions, names: string[]): MetricOptions {\n    const [namePatterns] = names;\n\n    const regexes = namePatterns\n      .split(',')\n      .map((p) => p.trim())\n      .filter(Boolean)\n      .map((r) => {\n        try {\n          return new RegExp(r);\n        } catch {\n          return null;\n        }\n      })\n      .filter(Boolean) as RegExp[];\n\n    return options.filter((option) => regexes.some((regex) => regex.test(option.value as string)));\n  }\n\n  private static buildRegex(pattern: string, flags?: string) {\n    try {\n      return new RegExp(pattern, flags);\n    } catch {\n      return new RegExp('.*');\n    }\n  }\n\n  private notifyUpdate() {\n    // hack to force SceneByVariableRepeater to re-render\n    this.variable.publishEvent(new SceneVariableValueChangedEvent(this.variable), true);\n  }\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Icon, Tooltip, useStyles2, type IconName } from '@grafana/ui';\nimport React from 'react';\n\nimport { logger } from 'tracking/logger/logger';\nimport { isCustomVariable } from 'utils/utils.variables';\nimport {\n  MetricsSorter,\n  VAR_WINGMAN_SORT_BY,\n  type SortingOption,\n} from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\nimport { type MetricUsageType } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\nimport { VAR_FILTERED_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport {\n  METRICS_VIZ_PANEL_HEIGHT,\n  METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW,\n  type MetricVizPanel,\n} from 'WingmanDataTrail/MetricVizPanel/MetricVizPanel';\n\ntype SortBy = Exclude<SortingOption, 'related'>;\n\ntype WithUsageDataPreviewPanelState = SceneObjectState & {\n  [key in MetricUsageType]: number;\n} & {\n  vizPanelInGridItem: MetricVizPanel;\n  metric: string;\n  sortBy: SortBy;\n};\n\nexport class WithUsageDataPreviewPanel extends SceneObjectBase<WithUsageDataPreviewPanelState> {\n  constructor(state: Pick<WithUsageDataPreviewPanelState, 'vizPanelInGridItem' | 'metric'>) {\n    super({\n      ...state,\n      sortBy: 'default',\n      'alerting-usage': 0,\n      'dashboard-usage': 0,\n    });\n\n    this.addActivationHandler(this._onActivate.bind(this));\n  }\n\n  private _onActivate() {\n    let metricsReducer;\n\n    try {\n      metricsReducer = sceneGraph.getAncestor(this, MetricsReducer);\n    } catch {\n      return;\n    }\n\n    const filteredMetricsEngine = metricsReducer.state.enginesMap.get(VAR_FILTERED_METRICS_VARIABLE);\n    if (!filteredMetricsEngine) {\n      return;\n    }\n\n    const metricsSorter = sceneGraph.findByKeyAndType(this, 'metrics-sorter', MetricsSorter);\n    const sortByVar = sceneGraph.getVariables(metricsSorter).getByName(VAR_WINGMAN_SORT_BY);\n\n    if (isCustomVariable(sortByVar)) {\n      this.updateSortBy(metricsSorter, sortByVar.getValue() as SortBy);\n\n      this._subs.add(\n        sortByVar.subscribeToState(({ value }) => {\n          this.updateSortBy(metricsSorter, value as SortBy);\n        })\n      );\n    }\n  }\n\n  private updateSortBy(metricsSorter: MetricsSorter, sortBy: SortBy) {\n    this.setState({ sortBy });\n\n    const gridLayout = sceneGraph.getAncestor(this, SceneCSSGridLayout);\n    const currentGridLayoutHeight = gridLayout?.state.autoRows;\n\n    switch (sortBy) {\n      case 'dashboard-usage':\n      case 'alerting-usage':\n        metricsSorter.getUsageForMetric(this.state.metric, sortBy).then((usage) => {\n          this.setState({\n            [sortBy]: usage,\n          });\n        });\n        if (currentGridLayoutHeight !== METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW) {\n          gridLayout.setState({ autoRows: METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW });\n        }\n        break;\n      default:\n        if (currentGridLayoutHeight !== METRICS_VIZ_PANEL_HEIGHT) {\n          gridLayout.setState({ autoRows: METRICS_VIZ_PANEL_HEIGHT });\n        }\n        break;\n    }\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<WithUsageDataPreviewPanel>) => {\n    const {\n      vizPanelInGridItem,\n      sortBy,\n      'alerting-usage': metricUsedInAlertingRulesCount,\n      'dashboard-usage': metricUsedInDashboardsCount,\n    } = model.useState();\n\n    if (!vizPanelInGridItem) {\n      logger.log('no viz panel');\n      return;\n    }\n\n    if (sortBy === 'default') {\n      return (\n        <div data-testid=\"with-usage-data-preview-panel\">\n          <vizPanelInGridItem.Component model={vizPanelInGridItem} />\n        </div>\n      );\n    }\n\n    const usageDetails: Record<MetricUsageType, Omit<UsageSectionProps, 'usageType'>> = {\n      'dashboard-usage': {\n        usageCount: metricUsedInDashboardsCount,\n        singularUsageType: 'dashboard panel query',\n        pluralUsageType: 'dashboard panel queries',\n        icon: 'apps',\n      },\n      'alerting-usage': {\n        usageCount: metricUsedInAlertingRulesCount,\n        singularUsageType: 'alert rule',\n        pluralUsageType: 'alert rules',\n        icon: 'bell',\n      },\n    };\n\n    return (\n      <div data-testid=\"with-usage-data-preview-panel\">\n        <vizPanelInGridItem.Component model={vizPanelInGridItem} />\n        <UsageData\n          usageType={sortBy}\n          usageCount={usageDetails[sortBy].usageCount}\n          singularUsageType={usageDetails[sortBy].singularUsageType}\n          pluralUsageType={usageDetails[sortBy].pluralUsageType}\n          icon={usageDetails[sortBy].icon as IconName}\n        />\n      </div>\n    );\n  };\n}\n\ninterface UsageSectionProps {\n  usageType: MetricUsageType;\n  usageCount: number;\n  singularUsageType: string;\n  pluralUsageType: string;\n  icon: IconName;\n}\n\nfunction UsageData({ usageType, usageCount, singularUsageType, pluralUsageType, icon }: Readonly<UsageSectionProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.usageContainer} data-testid=\"usage-data-panel\">\n      <Tooltip\n        content={`Metric is used in ${usageCount} ${usageCount === 1 ? singularUsageType : pluralUsageType}`}\n        placement=\"top\"\n      >\n        <span className={styles.usageItem} data-testid={usageType}>\n          <Icon name={icon} /> {usageCount}\n        </span>\n      </Tooltip>\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    usageContainer: css({\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'flex-start',\n      gap: '17px',\n      padding: '8px 12px',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderTopWidth: 0,\n      backgroundColor: theme.colors.background.primary,\n      alignItems: 'center',\n    }),\n    usageItem: css({\n      display: 'flex',\n      alignItems: 'center',\n      gap: '4px',\n      color: theme.colors.text.secondary,\n      opacity: '65%',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { dateTimeFormat, type GrafanaTheme2 } from '@grafana/data';\nimport { sceneGraph } from '@grafana/scenes';\nimport { Card, IconButton, useStyles2 } from '@grafana/ui';\nimport React, { useMemo } from 'react';\n\nimport { type DataTrail } from './DataTrail';\nimport { VAR_FILTERS } from './shared';\nimport { getTrailStore, type DataTrailBookmark } from './TrailStore/TrailStore';\nimport { getMetricName } from './utils';\nimport { isAdHocFiltersVariable } from './utils/utils.variables';\n\nexport type Props = {\n  trail?: DataTrail;\n  bookmark?: DataTrailBookmark;\n  onSelect: () => void;\n  onDelete?: () => void;\n  wide?: boolean;\n  compactHeight?: boolean;\n};\n\n// Helper function to truncate the value for a single key:value pair\nconst truncateValue = (key: string, value: string, maxLength: number) => {\n  const combinedLength = key.length + 2 + value.length; // 2 for \": \"\n  if (combinedLength > maxLength) {\n    return value.substring(0, maxLength - key.length - 5) + '...'; // 5 for \": \" and \"...\"\n  }\n  return value;\n};\n\nexport function DataTrailCard(props: Readonly<Props>) {\n  const { onSelect, onDelete, bookmark } = props;\n  const styles = useStyles2(getStyles);\n\n  const values = useMemo(() => {\n    let trail = props.trail || (bookmark && getTrailStore().getTrailForBookmark(bookmark));\n\n    if (!trail) {\n      return null;\n    }\n\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, trail)!;\n    if (!isAdHocFiltersVariable(filtersVariable)) {\n      return null;\n    }\n\n    const createdAt = bookmark?.createdAt || trail.state.createdAt;\n\n    return {\n      filters: filtersVariable.state.filters,\n      metric: trail.state.metric,\n      createdAt,\n    };\n  }, [props.trail, bookmark]);\n\n  if (!values) {\n    return null;\n  }\n\n  const { filters, metric, createdAt } = values;\n\n  const heading = truncateValue('', getMetricName(metric), 27);\n  const cardHeightClassName = `${props.compactHeight && filters.length > 0 ? styles.cardTall : ''}`;\n  const cardClassName = `${styles.card} ${props.wide ? styles.cardWide : ''} ${cardHeightClassName}`;\n  return (\n    <article data-testid={`data-trail-card ${heading}`}>\n      <Card onClick={onSelect} className={cardClassName}>\n        <Card.Heading>\n          <div className={styles.metricValue}>{heading}</div>\n        </Card.Heading>\n        <Card.Meta className={styles.meta}>\n          {filters.map((f) => (\n            <span key={f.key}>\n              <div className={styles.secondaryFont}>{f.key}: </div>\n              <div className={styles.primaryFont}>{truncateValue(f.key, f.value, 44)}</div>\n            </span>\n          ))}\n        </Card.Meta>\n        <div className={styles.deleteButton}>\n          {onDelete && (\n            <Card.SecondaryActions>\n              <IconButton\n                key=\"delete\"\n                name=\"trash-alt\"\n                className={styles.secondary}\n                tooltip=\"Remove bookmark\"\n                onClick={onDelete}\n                data-testid=\"deleteButton\"\n              />\n            </Card.SecondaryActions>\n          )}\n        </div>\n      </Card>\n      <div className={styles.date}>\n        <div className={styles.secondaryFont}>Date created: </div>\n        <div className={styles.primaryFont}>{createdAt > 0 && dateTimeFormat(createdAt, { format: 'YYYY-MM-DD' })}</div>\n      </div>\n    </article>\n  );\n}\n\nexport function getStyles(theme: GrafanaTheme2) {\n  return {\n    metricValue: css({\n      display: 'inline',\n      color: theme.colors.text.primary,\n      fontWeight: 500,\n      wordBreak: 'break-all',\n    }),\n    card: css({\n      position: 'relative',\n      width: '318px',\n      padding: `12px ${theme.spacing(2)} ${theme.spacing(1)} ${theme.spacing(2)}`,\n      alignItems: 'start',\n      marginBottom: 0,\n      borderTop: `1px solid ${theme.colors.border.weak}`,\n      borderRight: `1px solid ${theme.colors.border.weak}`,\n      borderLeft: `1px solid ${theme.colors.border.weak}`,\n      borderBottom: 'none', // Remove the bottom border\n      borderRadius: '2px 2px 0 0', // Top-left and top-right corners are 2px, bottom-left and bottom-right are 0; cannot use theme.shape.radius.default because need bottom corners to be 0\n    }),\n    cardWide: css({\n      width: '100%',\n    }),\n    cardTall: css({\n      height: '110px',\n    }),\n    secondary: css({\n      color: theme.colors.text.secondary,\n      fontSize: '12px',\n    }),\n    date: css({\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: '0 0 2px 2px',\n      padding: `${theme.spacing(1)} ${theme.spacing(2)}`,\n      backgroundColor: theme.colors.background.primary,\n    }),\n    meta: css({\n      flexWrap: 'wrap',\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      maxHeight: '36px', // 2 lines * 18px line-height\n      margin: 0,\n      gridArea: 'Meta',\n      color: theme.colors.text.secondary,\n      whiteSpace: 'nowrap',\n    }),\n    primaryFont: css({\n      display: 'inline',\n      color: theme.colors.text.primary,\n      fontSize: '12px',\n      fontWeight: '500',\n      letterSpacing: '0.018px',\n    }),\n    secondaryFont: css({\n      display: 'inline',\n      color: theme.colors.text.secondary,\n      fontSize: '12px',\n      fontWeight: '400',\n      lineHeight: '18px' /* 150% */,\n      letterSpacing: '0.018px',\n    }),\n    deleteButton: css({\n      position: 'absolute',\n      bottom: theme.spacing(1),\n      right: theme.spacing(1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { SectionTitle } from './SectionTitle';\nimport { type SideBarSectionState } from './types';\nimport { DataTrailCard } from '../../../DataTrailCard';\nimport { reportExploreMetrics } from '../../../interactions';\nimport { getBookmarkKey, getTrailStore } from '../../../TrailStore/TrailStore';\n\n// Create a simple event-based system to avoid circular dependencies\nexport const navigationEvents = {\n  listeners: new Set<(trail: any) => void>(),\n  emit: function (trail: any) {\n    this.listeners.forEach((listener) => listener(trail));\n  },\n  subscribe: function (listener: (trail: any) => void) {\n    this.listeners.add(listener);\n    return () => {\n      this.listeners.delete(listener);\n      return undefined; // Explicitly return void\n    };\n  },\n};\n\n// Simple function to navigate to a trail without using MetricsContext\nfunction goToUrlForTrail(trail: any) {\n  navigationEvents.emit(trail);\n}\n\nexport interface BookmarksListState extends SideBarSectionState {}\n\nexport class BookmarksList extends SceneObjectBase<BookmarksListState> {\n  constructor({\n    key,\n    title,\n    description,\n    icon,\n    disabled,\n  }: {\n    key: BookmarksListState['key'];\n    title: BookmarksListState['title'];\n    description: BookmarksListState['description'];\n    icon: BookmarksListState['icon'];\n    disabled?: BookmarksListState['disabled'];\n  }) {\n    super({\n      key,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {}\n\n  public static readonly Component = ({ model }: SceneComponentProps<BookmarksList>) => {\n    const styles = useStyles2(getStyles);\n    const { title, description } = model.useState();\n    const { bookmarks } = getTrailStore();\n    const [, setLastDelete] = useState(Date.now());\n\n    const onSelect = (index: number) => {\n      reportExploreMetrics('exploration_started', { cause: 'bookmark_clicked' });\n      const trail = getTrailStore().getTrailForBookmarkIndex(index);\n      getTrailStore().setRecentTrail(trail);\n      goToUrlForTrail(trail);\n    };\n\n    const onDelete = (index: number) => {\n      reportExploreMetrics('bookmark_changed', { action: 'deleted' });\n      getTrailStore().removeBookmark(index);\n      setLastDelete(Date.now()); // trigger re-render\n    };\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} data-testid=\"bookmarks-list-sidebar\" />\n        {bookmarks.length > 0 ? (\n          <div className={styles.bookmarksList}>\n            {bookmarks.map((bookmark, index) => (\n              <DataTrailCard\n                key={getBookmarkKey(bookmark)}\n                bookmark={bookmark}\n                onSelect={() => onSelect(index)}\n                onDelete={() => onDelete(index)}\n                wide={true}\n                compactHeight={true}\n              />\n            ))}\n          </div>\n        ) : (\n          <div className={styles.emptyState}>No bookmarks yet</div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n    }),\n    bookmarksList: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1.5),\n      overflowY: 'auto',\n      paddingRight: theme.spacing(1),\n    }),\n    emptyState: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      height: '100px',\n      color: theme.colors.text.secondary,\n      fontStyle: 'italic',\n    }),\n  };\n}\n","import { VariableHide, VariableRefresh, VariableSort } from '@grafana/data';\nimport { QueryVariable, type SceneObjectState } from '@grafana/scenes';\n\nimport { trailDS, VAR_FILTERS } from 'shared';\n\nexport const VAR_METRICS_VARIABLE = 'metrics-wingman';\n\nexport type MetricOptions = Array<{ label: string; value: string }>;\n\ninterface MetricsVariableState extends SceneObjectState {\n  key: string;\n  name?: string;\n  label?: string;\n}\n\nexport class MetricsVariable extends QueryVariable {\n  constructor(state?: MetricsVariableState) {\n    super({\n      key: VAR_METRICS_VARIABLE,\n      name: VAR_METRICS_VARIABLE,\n      label: 'Metrics',\n      ...state,\n      datasource: trailDS,\n      query: `label_values({$${VAR_FILTERS}}, __name__)`,\n      includeAll: true,\n      value: '$__all',\n      skipUrlSync: true,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      sort: VariableSort.alphabeticalAsc,\n      hide: VariableHide.hideVariable,\n    });\n  }\n}\n","import { type DataFrame } from '@grafana/data';\n\nexport function getLabelValueFromDataFrame(frame: DataFrame) {\n  const labels = frame.fields[1]?.labels;\n\n  if (!labels) {\n    return null;\n  }\n\n  const keys = Object.keys(labels);\n  if (keys.length === 0) {\n    return null;\n  }\n\n  return labels[keys[0]];\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { DashboardCursorSync } from '@grafana/schema';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { VAR_FILTERS } from 'shared';\nimport { getColorByIndex, getTrailFor } from 'utils';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { METRICS_VIZ_PANEL_HEIGHT, MetricVizPanel } from 'WingmanDataTrail/MetricVizPanel/MetricVizPanel';\nimport { WithUsageDataPreviewPanel } from 'WingmanDataTrail/MetricVizPanel/WithUsageDataPreviewPanel';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nexport const GRID_TEMPLATE_COLUMNS = 'repeat(auto-fit, minmax(400px, 1fr))';\nexport const GRID_TEMPLATE_ROWS = '1fr';\n\ninterface MetricsListState extends SceneObjectState {\n  variableName: string;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsList extends SceneObjectBase<MetricsListState> {\n  constructor({ variableName }: { variableName: MetricsListState['variableName'] }) {\n    super({\n      key: 'metrics-list',\n      variableName,\n      body: new SceneByVariableRepeater({\n        variableName,\n        initialPageSize: 120,\n        pageSizeIncrement: 9,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: METRICS_VIZ_PANEL_HEIGHT,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No metrics found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={error} />,\n          }),\n        getLayoutChild: (option, colorIndex) => {\n          const trail = getTrailFor(this);\n          const isNativeHistogram = trail.isNativeHistogram(option.value as string);\n\n          // get the VAR_FILTERS variable to pass in the correct matchers for the functions\n          const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n          const matchers = isAdHocFiltersVariable(filtersVariable)\n            ? filtersVariable.state.filters.map((filter) => `${filter.key}${filter.operator}${filter.value}`)\n            : [];\n\n          return new SceneCSSGridItem({\n            body: new WithUsageDataPreviewPanel({\n              vizPanelInGridItem: new MetricVizPanel({\n                metricName: option.value as string,\n                color: getColorByIndex(colorIndex),\n                isNativeHistogram,\n                matchers,\n              }),\n              metric: option.value as string,\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state); // ensure layout when landing on the page\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsList>) => {\n    const { variableName, body } = model.useState();\n    const styles = useStyles2(getStyles);\n\n    const variable = sceneGraph.lookupVariable(variableName, model) as MultiValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"metrics-list\">\n        <div className={styles.container}>\n          <body.Component model={body} />\n        </div>\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label=\"metric\" batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({}),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(4),\n\n      '& button': {\n        height: '40px',\n        borderRadius: '8px',\n      },\n    }),\n  };\n}\n","import {\n  type DataSourceGetTagKeysOptions,\n  type DataSourceGetTagValuesOptions,\n  type MetricFindValue,\n  type TimeRange,\n} from '@grafana/data';\nimport {\n  type PrometheusDatasource,\n  type PromMetricsMetadata,\n  type PromMetricsMetadataItem,\n  type PromQuery,\n} from '@grafana/prometheus';\nimport { getDataSourceSrv } from '@grafana/runtime';\nimport { sceneGraph, type DataSourceVariable, type SceneObject } from '@grafana/scenes';\n\nimport { displayError } from 'WingmanDataTrail/helpers/displayStatus';\n\nimport { type DataTrail } from '../DataTrail';\nimport { VAR_DATASOURCE, VAR_DATASOURCE_EXPR } from '../shared';\nimport { isPrometheusDataSource } from '../utils/utils.datasource';\n\nexport class MetricDatasourceHelper {\n  constructor(trail: DataTrail) {\n    this._trail = trail;\n  }\n\n  public reset() {\n    this._datasource = undefined;\n    this._metricsMetadata = undefined;\n    this._classicHistograms = {};\n    this._nativeHistograms = [];\n  }\n\n  private _trail: DataTrail;\n\n  private _datasource?: PrometheusDatasource;\n\n  private async getDatasource() {\n    if (this._datasource) {\n      return this._datasource;\n    }\n\n    const ds = await getDataSourceSrv().get(VAR_DATASOURCE_EXPR, { __sceneObject: { value: this._trail } });\n\n    if (isPrometheusDataSource(ds)) {\n      this._datasource = ds;\n    }\n\n    return this._datasource;\n  }\n\n  // store metadata in a more easily accessible form\n  _metricsMetadata?: PromMetricsMetadata;\n\n  private async _ensureMetricsMetadata(): Promise<void> {\n    if (this._metricsMetadata) {\n      return;\n    }\n\n    await this._getMetricsMetadata();\n  }\n\n  private async _getMetricsMetadata(): Promise<void> {\n    const ds = await this.getDatasource();\n\n    if (!ds) {\n      return;\n    }\n\n    const queryMetadata =\n      typeof ds.languageProvider.queryMetricsMetadata === 'function'\n        ? ds.languageProvider.queryMetricsMetadata\n        : () => Promise.resolve(ds.languageProvider.metricsMetadata); // eslint-disable-line sonarjs/deprecation\n\n    const loadMetadata =\n      typeof ds.languageProvider.retrieveMetricsMetadata === 'function'\n        ? () => Promise.resolve(ds.languageProvider.retrieveMetricsMetadata())\n        : () => (ds.languageProvider.loadMetricsMetadata() as unknown as Promise<void>).then(queryMetadata); // eslint-disable-line sonarjs/deprecation\n\n    let metadata = await queryMetadata();\n\n    if (!metadata) {\n      metadata = await loadMetadata();\n    }\n\n    this._metricsMetadata = metadata;\n  }\n\n  public async getMetadataForMetric(metric?: string) {\n    if (!metric) {\n      return undefined;\n    }\n    await this._ensureMetricsMetadata();\n\n    return this._metricsMetadata?.[metric];\n  }\n\n  private _classicHistograms: Record<string, number> = {};\n  private _nativeHistograms: string[] = [];\n\n  public listNativeHistograms() {\n    return this._nativeHistograms;\n  }\n\n  /**\n   * Identify native histograms by 2 strategies.\n   * 1. querying classic histograms and all metrics,\n   * then comparing the results and build the collection of native histograms.\n   * 2. querying all metrics and checking if the metric is a histogram type and dies not have the bucket suffix.\n   *\n   * classic histogram = test_metric_bucket\n   * native histogram = test_metric\n   */\n  public async initializeHistograms() {\n    const ds = await this.getDatasource();\n    if (ds && Object.keys(this._classicHistograms).length === 0) {\n      const classicHistogramsCall = ds.metricFindQuery('metrics(.*_bucket)');\n      const allMetricsCall = ds.metricFindQuery('metrics(.+)');\n\n      const [classicHistograms, allMetrics] = await Promise.all([classicHistogramsCall, allMetricsCall]);\n\n      classicHistograms.forEach((m) => {\n        this._classicHistograms[m.text] = 1;\n      });\n\n      await this._ensureMetricsMetadata();\n\n      allMetrics.forEach((m) => {\n        if (this.isNativeHistogram(m.text)) {\n          // Build the collection of native histograms.\n          this.addNativeHistogram(m.text);\n        }\n      });\n    }\n  }\n\n  /**\n   * Identify native histograms by 2 strategies.\n   * 1. querying classic histograms and all metrics,\n   * then comparing the results and build the collection of native histograms.\n   * 2. querying all metrics and checking if the metric is a histogram type and dies not have the bucket suffix.\n   *\n   * classic histogram = test_metric_bucket\n   * native histogram = test_metric\n   *\n   * @param metric\n   * @returns boolean\n   */\n  public isNativeHistogram(metric: string): boolean {\n    if (!metric) {\n      return false;\n    }\n\n    // check when fully migrated, we only have metadata, and there are no more classic histograms\n    const metadata = this._metricsMetadata;\n    // suffix is not 'bucket' and type is histogram\n    const suffix: string = metric.split('_').pop() ?? '';\n    // the string is not equal to bucket\n    const notClassic = suffix !== 'bucket';\n    if (metadata?.[metric]?.type === 'histogram' && notClassic) {\n      return true;\n    }\n\n    // check for comparison when there is overlap between native and classic histograms\n    return this._classicHistograms[`${metric}_bucket`] > 0;\n  }\n\n  private addNativeHistogram(metric: string) {\n    if (!this._nativeHistograms.includes(metric)) {\n      this._nativeHistograms.push(metric);\n    }\n  }\n\n  /**\n   * Used for additional filtering for adhoc vars labels in Metrics Drilldown.\n   * @param options\n   * @returns\n   */\n  public async getTagKeys(options: DataSourceGetTagKeysOptions<PromQuery>): Promise<MetricFindValue[]> {\n    const ds = await this.getDatasource();\n\n    if (!ds) {\n      return [];\n    }\n\n    const keys = await ds.getTagKeys(options);\n    return keys;\n  }\n\n  /**\n   * Used for additional filtering for adhoc vars label values in Metrics Drilldown.\n   * @param options\n   * @returns\n   */\n  public async getTagValues(options: DataSourceGetTagValuesOptions<PromQuery>) {\n    const ds = await this.getDatasource();\n\n    if (!ds) {\n      return [];\n    }\n\n    options.key = unwrapQuotes(options.key);\n    const keys = await ds.getTagValues(options);\n    return keys;\n  }\n\n  /**\n   * Check if the datasource uses time range in language provider methods.\n   * @param ds\n   * @returns boolean\n   * @remarks\n   * This is a hack to check if the datasource uses time range in language provider methods.\n   * It will be removed when we upgrade the Grafana dependency to 12.0.0.\n   * For more details, see https://github.com/grafana/metrics-drilldown/issues/370.\n   */\n  public static datasourceUsesTimeRangeInLanguageProviderMethods(ds: PrometheusDatasource): boolean {\n    // This works because the `fetchLabelValues` method happens to have changed in a way that\n    // can be used as a heuristic to check if the runtime datasource uses the G12-style\n    // language provider methods introduced in https://github.com/grafana/grafana/pull/101889.\n    return ds.languageProvider.fetchLabelValues.length > 1; // eslint-disable-line sonarjs/deprecation\n  }\n\n  /**\n   * Fetches available labels from a Prometheus datasource with version compatibility.\n   *\n   * This method abstracts the complexity of supporting multiple versions of `@grafana/prometheus`\n   * spanning from 11.6.0 up to the latest 12.x versions. It detects which API style the current\n   * datasource supports and calls the appropriate method with the correct signature.\n   * It handles three different `@grafana/prometheus` API styles:\n   *\n   * 1. **(12.1.0+)**: Uses the modern `queryLabelKeys` method\n   * 2. **(12.0.0)**: Uses `fetchLabelsWithMatch` with timeRange parameter\n   * 3. **(11.6.0-11.x)**: Uses `fetchLabelsWithMatch` without timeRange parameter\n   *\n   * @param params - Configuration object containing datasource, time range, and matcher\n   * @param params.ds - The Prometheus datasource instance\n   * @param params.timeRange - Time range for the query\n   * @param params.matcher - PromQL matcher string to filter labels (e.g., '{job=\"prometheus\"}')\n   * @returns Promise that resolves to an array of available label keys\n   *\n   * @example\n   * ```typescript\n   * const labels = await MetricDatasourceHelper.fetchLabels({\n   *   ds: prometheusDatasource,\n   *   timeRange: { from: 'now-1h', to: 'now' },\n   *   matcher: '{job=\"prometheus\"}'\n   * });\n   * ```\n   */\n  public static fetchLabels(params: FetchLabelsOptions): Promise<string[]> {\n    const { ds, timeRange, matcher } = params;\n\n    if (typeof ds.languageProvider.queryLabelKeys === 'function') {\n      return ds.languageProvider.queryLabelKeys(timeRange, matcher);\n    }\n\n    if (MetricDatasourceHelper.datasourceUsesTimeRangeInLanguageProviderMethods(ds)) {\n      // eslint-disable-next-line sonarjs/deprecation\n      return ds.languageProvider.fetchLabelsWithMatch(timeRange, matcher).then((labels) => Object.keys(labels));\n    }\n\n    // @ts-expect-error: Ignoring type error due to breaking change in fetchLabelsWithMatch signature\n    return ds.languageProvider.fetchLabelsWithMatch(matcher).then((labels) => Object.keys(labels)); // eslint-disable-line sonarjs/deprecation\n  }\n\n  /**\n   * Fetches available values for a specific label from a Prometheus datasource with version compatibility.\n   *\n   * This method abstracts the complexity of supporting multiple versions of `@grafana/prometheus`\n   * spanning from 11.6.0 up to the latest 12.x versions. It detects which API style the current\n   * datasource supports and calls the appropriate method with the correct signature.\n   * It handles three different `@grafana/prometheus` API styles:\n   *\n   * 1. **(12.1.0+)**: Uses the modern `queryLabelValues` method\n   * 2. **(12.0.0)**: Uses `fetchLabelValues` or `fetchSeriesValuesWithMatch` with timeRange parameter\n   * 3. **(11.6.0-11.x)**: Uses `fetchLabelValues` or `fetchSeriesValuesWithMatch` without timeRange parameter\n   *\n   * @param params - Configuration object containing datasource, label name, time range, and optional matcher\n   * @param params.ds - The Prometheus datasource instance\n   * @param params.labelName - The name of the label to fetch values for (e.g., 'job', 'instance')\n   * @param params.timeRange - Time range for the query\n   * @param params.matcher - Optional PromQL matcher string to filter results (e.g., '{job=\"prometheus\"}')\n   * @returns Promise that resolves to an array of available values for the specified label\n   *\n   * @example\n   * ```typescript\n   * const jobValues = await MetricDatasourceHelper.fetchLabelValues({\n   *   ds: prometheusDatasource,\n   *   labelName: 'job',\n   *   timeRange: { from: 'now-1h', to: 'now' },\n   *   matcher: '{__name__=~\".*_total\"}'\n   * });\n   * ```\n   */\n  public static fetchLabelValues(params: FetchLabelValuesOptions) {\n    const { ds, labelName, timeRange, matcher } = params;\n\n    if (typeof ds.languageProvider.queryLabelValues === 'function') {\n      return ds.languageProvider.queryLabelValues(timeRange, labelName, matcher);\n    }\n\n    // If a matcher isn't provided, use the simpler `fetchLabelValues` method.\n    const fetchLabelValuesWithOptionalMatcher = matcher\n      ? ds.languageProvider.fetchSeriesValuesWithMatch // eslint-disable-line sonarjs/deprecation\n      : ds.languageProvider.fetchLabelValues; // eslint-disable-line sonarjs/deprecation\n\n    if (MetricDatasourceHelper.datasourceUsesTimeRangeInLanguageProviderMethods(ds)) {\n      return fetchLabelValuesWithOptionalMatcher(timeRange, labelName, matcher);\n    }\n\n    // @ts-expect-error: Ignoring type error due to breaking change in fetchSeriesValuesWithMatch signature\n    return fetchLabelValuesWithOptionalMatcher(labelName, matcher);\n  }\n\n  public static async getPrometheusDataSourceForScene(\n    sceneObject: SceneObject\n  ): Promise<PrometheusDatasource | undefined> {\n    try {\n      const dsVariable = sceneGraph.findByKey(sceneObject, VAR_DATASOURCE) as DataSourceVariable;\n      const uid = (dsVariable?.state.value as string) ?? '';\n      const ds = await getDataSourceSrv().get({ uid });\n\n      return ds as unknown as PrometheusDatasource; // we trust that VAR_DATASOURCE has been set to a Prometheus datasource\n    } catch (error) {\n      displayError(error as Error, ['Error while getting the Prometheus data source!']);\n      return undefined;\n    }\n  }\n}\n\ninterface FetchLabelsOptions {\n  ds: PrometheusDatasource;\n  timeRange: TimeRange;\n  matcher: string;\n}\n\ninterface FetchLabelValuesOptions {\n  ds: PrometheusDatasource;\n  timeRange: TimeRange;\n  labelName: string;\n  matcher?: string;\n}\n\nexport function getMetricDescription(metadata?: PromMetricsMetadataItem) {\n  if (!metadata) {\n    return undefined;\n  }\n\n  const { type, help, unit } = metadata;\n\n  const lines = [\n    help, //\n    type && `**Type:** *${type}*`,\n    unit && `**Unit:** ${unit}`,\n  ];\n\n  return lines.join('\\n\\n');\n}\n\nfunction unwrapQuotes(value: string): string {\n  if (value === '' || !isWrappedInQuotes(value)) {\n    return value;\n  }\n  return value.slice(1, -1);\n}\n\nfunction isWrappedInQuotes(value: string): boolean {\n  const wrappedInQuotes = /^\".*\"$/;\n  return wrappedInQuotes.test(value);\n}\n","import leven from 'leven';\n\nexport function sortRelatedMetrics(metricList: string[], metric: string) {\n  return metricList.sort((aValue, bValue) => {\n    const a = getLevenDistances(aValue, metric);\n    const b = getLevenDistances(bValue, metric);\n\n    return a.halfLeven + a.wholeLeven - (b.halfLeven + b.wholeLeven);\n  });\n}\n\ntype LevenDistances = { halfLeven: number; wholeLeven: number };\ntype TargetToLevenDistances = Map<string, LevenDistances>;\n\nconst metricToTargetLevenDistances = new Map<string, TargetToLevenDistances>();\n\n// Provides the Levenshtein distance between a metric to be sorted\n// and a targetMetric compared to which all other metrics are being sorted\n// There are two distances: once for the first half and once for the whole string.\n// This operation is not expected to be symmetric; order of parameters matters\n// since only `metric` is split.\nfunction getLevenDistances(metric: string, targetMetric: string) {\n  let targetToDistances: TargetToLevenDistances | undefined = metricToTargetLevenDistances.get(metric);\n  if (!targetToDistances) {\n    targetToDistances = new Map<string, LevenDistances>();\n    metricToTargetLevenDistances.set(metric, targetToDistances);\n  }\n\n  let distances: LevenDistances | undefined = targetToDistances.get(targetMetric);\n  if (!distances) {\n    const metricSplit = metric.split('_');\n    const metricHalf = metricSplit.slice(0, metricSplit.length / 2).join('_');\n\n    const halfLeven = leven(metricHalf, targetMetric!) || 0;\n    const wholeLeven = leven(metric, targetMetric!) || 0;\n\n    distances = { halfLeven, wholeLeven };\n    targetToDistances.set(targetMetric, distances);\n  }\n\n  return distances;\n}\n","import { sceneGraph, SceneVariableValueChangedEvent, type QueryVariable } from '@grafana/scenes';\n\nimport { sortRelatedMetrics } from 'RelatedMetricsScene/sortRelatedMetrics';\nimport { logger } from 'tracking/logger/logger';\nimport {\n  MetricsSorter,\n  sortMetricsByCount,\n  sortMetricsWithRecentFirst,\n  type SortingOption,\n} from 'WingmanDataTrail/ListControls/MetricsSorter/MetricsSorter';\nimport { type MetricUsageType } from 'WingmanDataTrail/ListControls/MetricsSorter/MetricUsageFetcher';\n\nimport { areArraysEqual } from './helpers/areArraysEqual';\n\nexport class MetricsVariableSortEngine {\n  private variable: QueryVariable;\n  private lastMetrics: string[];\n  private sortBy?: SortingOption | 'related';\n\n  constructor(variable: QueryVariable) {\n    this.variable = variable;\n    this.sortBy = undefined;\n    this.lastMetrics = [];\n  }\n\n  public async sort(sortBy = this.sortBy, options: Record<string, any> = {}) {\n    const metrics = this.variable.state.options.map((option) => option.value as string);\n\n    if (sortBy === this.sortBy && areArraysEqual(metrics, this.lastMetrics)) {\n      return;\n    }\n\n    let sortedMetrics: string[];\n\n    switch (sortBy) {\n      case 'dashboard-usage':\n      case 'alerting-usage':\n        sortedMetrics = await this.sortByUsage(metrics, sortBy);\n        break;\n\n      case 'related':\n        sortedMetrics = sortRelatedMetrics(metrics, options.metric);\n        break;\n\n      default:\n        sortedMetrics = sortMetricsWithRecentFirst(metrics);\n        break;\n    }\n\n    this.sortBy = sortBy;\n    this.lastMetrics = sortedMetrics;\n\n    this.variable.setState({\n      options: sortedMetrics.map((metricName) => ({\n        label: metricName,\n        value: metricName,\n      })),\n    });\n\n    this.notifyUpdate();\n  }\n\n  private async sortByUsage(metrics: string[], usageType: MetricUsageType) {\n    try {\n      const metricsSorter = sceneGraph.findByKeyAndType(this.variable, 'metrics-sorter', MetricsSorter);\n      if (!metricsSorter) {\n        logger.warn('Metrics sorter not found. Returning unsorted metrics.', { usageType });\n        return metrics;\n      }\n      const usageMetrics = await metricsSorter.getUsageMetrics(usageType);\n      return sortMetricsByCount(metrics, usageMetrics);\n    } catch (err) {\n      const error = typeof err === 'string' ? new Error(err) : (err as Error);\n      logger.error(error, {\n        usageType,\n      });\n      return metrics;\n    }\n  }\n\n  private notifyUpdate() {\n    // hack to force SceneByVariableRepeater to re-render\n    this.variable.publishEvent(new SceneVariableValueChangedEvent(this.variable), true);\n  }\n}\n","import { Alert, type AlertVariant } from '@grafana/ui';\nimport React from 'react';\n\nimport { logger, type ErrorContext } from '../tracking/logger/logger';\n\ntype InlineBannerProps = {\n  severity: AlertVariant;\n  title: string;\n  message?: string | React.ReactNode;\n  error?: Error;\n  errorContext?: ErrorContext;\n  children?: React.ReactNode;\n};\n\nexport function InlineBanner({ severity, title, message, error, errorContext, children }: Readonly<InlineBannerProps>) {\n  let errorObject;\n\n  if (error) {\n    errorObject = typeof error === 'string' ? new Error(error) : error;\n\n    logger.error(errorObject, {\n      ...(errorObject.cause || {}),\n      ...errorContext,\n      bannerTitle: title,\n    });\n  }\n\n  return (\n    <Alert title={title} severity={severity}>\n      {errorObject && (\n        <>\n          {errorObject.message || errorObject.toString()}\n          <br />\n        </>\n      )}\n      {message}\n      {children}\n    </Alert>\n  );\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventMetricsVariableDeactivatedPayload {\n  key: string;\n}\n\nexport class EventMetricsVariableDeactivated extends BusEventWithPayload<EventMetricsVariableDeactivatedPayload> {\n  public static readonly type = 'metrics-variable-deactivated';\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type MultiValueVariable,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { IconButton, Input, Tag, Tooltip, useStyles2 } from '@grafana/ui';\nimport { debounce } from 'lodash';\nimport React, { type KeyboardEvent } from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { VAR_DATASOURCE } from 'shared';\nimport { areArraysEqual } from 'WingmanDataTrail/MetricsVariables/helpers/areArraysEqual';\n\nimport { EventQuickSearchChanged } from './EventQuickSearchChanged';\ninterface QuickSearchState extends SceneObjectState {\n  urlSearchParamName: string;\n  targetName: string;\n  variableNames: {\n    nonFiltered: string;\n    filtered: string;\n  };\n  value: string;\n  counts: { current: number; total: number };\n  displayCounts: boolean;\n}\n\nexport class QuickSearch extends SceneObjectBase<QuickSearchState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_DATASOURCE],\n    onReferencedVariableValueChanged: () => {\n      this.setState({ value: '' });\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, {\n    keys: [this.state.urlSearchParamName],\n  });\n\n  getUrlState() {\n    return { [this.state.urlSearchParamName]: this.state.value };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const newValue = (values[this.state.urlSearchParamName] as string) || '';\n\n    if (newValue !== this.state.value) {\n      this.setState({ value: newValue });\n    }\n  }\n\n  public constructor({\n    urlSearchParamName,\n    targetName,\n    variableNames,\n    displayCounts,\n  }: {\n    urlSearchParamName: QuickSearchState['urlSearchParamName'];\n    targetName: QuickSearchState['targetName'];\n    variableNames: QuickSearchState['variableNames'];\n    displayCounts?: QuickSearchState['displayCounts'];\n  }) {\n    super({\n      key: 'quick-search',\n      urlSearchParamName,\n      targetName,\n      variableNames,\n      value: '',\n      counts: {\n        current: 0,\n        total: 0,\n      },\n      displayCounts: Boolean(displayCounts),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const { variableNames } = this.state;\n\n    const filteredVariable = sceneGraph.lookupVariable(variableNames.filtered, this) as MultiValueVariable;\n    const nonFilteredVariable = sceneGraph.lookupVariable(variableNames.nonFiltered, this) as MultiValueVariable;\n\n    this._subs.add(\n      filteredVariable.subscribeToState((newState, prevState) => {\n        if (!newState.loading && !prevState.loading && !areArraysEqual(newState.options, prevState.options)) {\n          this.setState({\n            counts: {\n              current: newState.options.length,\n              total: nonFilteredVariable.state.options.length,\n            },\n          });\n        }\n      })\n    );\n\n    this._subs.add(\n      nonFilteredVariable.subscribeToState((newState, prevState) => {\n        if (!areArraysEqual(newState.options, prevState.options)) {\n          this.setState({\n            counts: {\n              current: filteredVariable.state.options.length,\n              total: newState.options.length,\n            },\n          });\n        }\n      })\n    );\n  }\n\n  public toggleCountsDisplay(displayCounts: boolean) {\n    this.setState({ displayCounts });\n  }\n\n  private notifyValueChange = debounce((value: string) => {\n    this.publishEvent(new EventQuickSearchChanged({ searchText: value }), true);\n  }, 250);\n\n  private updateValue(value: string) {\n    const wasEmpty = this.state.value === '';\n    const isNewSearch = wasEmpty && value !== '';\n\n    if (isNewSearch) {\n      reportExploreMetrics('quick_search_used', {});\n    }\n\n    this.setState({ value });\n    this.notifyValueChange(value);\n  }\n\n  private onChange = (e: React.FormEvent<HTMLInputElement>) => {\n    this.updateValue(e.currentTarget.value);\n  };\n\n  private clear = () => {\n    this.updateValue('');\n  };\n\n  private onKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === 'Escape') {\n      e.preventDefault();\n      this.clear();\n    }\n  };\n\n  private getHumanFriendlyCountsMessage() {\n    const { targetName, counts, displayCounts } = this.state;\n\n    if (!displayCounts) {\n      return {\n        tagName: '',\n        tooltipContent: '',\n      };\n    }\n\n    if (counts.current === counts.total) {\n      return {\n        tagName: `${counts.current}`,\n        tooltipContent: counts.current !== 1 ? `${counts.current} ${targetName}s in total` : `1 ${targetName} in total`,\n      };\n    }\n\n    return {\n      tagName: `${counts.current}/${counts.total}`,\n      tooltipContent:\n        counts.current !== 1\n          ? `${counts.current} out of ${counts.total} ${targetName}s in total`\n          : `1 out of ${counts.total} ${targetName}s in total`,\n    };\n  }\n\n  static readonly Component = ({ model }: { model: QuickSearch }) => {\n    const styles = useStyles2(getStyles);\n    const { targetName, value } = model.useState();\n    const { tagName, tooltipContent } = model.getHumanFriendlyCountsMessage();\n\n    return (\n      <Input\n        value={value}\n        onChange={model.onChange}\n        onKeyDown={model.onKeyDown}\n        placeholder={`Quick search ${targetName}s`}\n        prefix={<i className=\"fa fa-search\" />}\n        suffix={\n          <>\n            {tagName && (\n              <Tooltip content={tooltipContent} placement=\"top\">\n                <Tag className={styles.counts} name={tagName} colorIndex={9} />\n              </Tooltip>\n            )}\n            <IconButton\n              name=\"times\"\n              variant=\"secondary\"\n              tooltip=\"Clear search\"\n              onClick={model.clear}\n              disabled={!value}\n            />\n          </>\n        }\n      />\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  counts: css`\n    margin-right: ${theme.spacing(1)};\n    border-radius: 11px;\n    padding: 2px ${theme.spacing(1)};\n    color: ${theme.colors.text.primary};\n    background-color: ${theme.colors.background.secondary};\n  `,\n});\n","import { type SceneDataTransformer, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\n\nexport function getQueryRunnerFor(sceneObject: SceneObject | undefined): SceneQueryRunner | undefined {\n  if (!sceneObject) {\n    return undefined;\n  }\n\n  const dataProvider = sceneObject.state.$data ?? sceneObject.parent?.state.$data;\n\n  if (isSceneQueryRunner(dataProvider)) {\n    return dataProvider;\n  }\n\n  if (isSceneDataTransformer(dataProvider)) {\n    return getQueryRunnerFor(dataProvider);\n  }\n\n  return undefined;\n}\n\nexport function isSceneQueryRunner(input: SceneObject | null | undefined): input is SceneQueryRunner {\n  return typeof input !== 'undefined' && input !== null && 'state' in input && 'runQueries' in input;\n}\n\nexport function isSceneDataTransformer(input: SceneObject | null | undefined): input is SceneDataTransformer {\n  return typeof input !== 'undefined' && input !== null && 'state' in input && 'transformations' in input.state;\n}\n","import { BusEventWithPayload } from '@grafana/data';\nimport { type VariableValueOption } from '@grafana/scenes';\n\nexport interface EventMetricsVariableLoadedPayload {\n  key: string;\n  options: VariableValueOption[];\n}\n\nexport class EventMetricsVariableLoaded extends BusEventWithPayload<EventMetricsVariableLoadedPayload> {\n  public static readonly type = 'metrics-variable-loaded';\n}\n","export const DEFAULT_UNIT = 'none';\nexport const DEFAULT_RATE_UNIT = 'cps'; // Count per second\n\n// Unit constants\nexport const UNIT_BYTES = 'bytes';\nexport const UNIT_SECONDS = 'seconds';\nexport const UNIT_PERCENT = 'percent';\nexport const UNIT_COUNT = 'count';\n\n// Rate unit constants\nexport const RATE_BYTES_PER_SECOND = 'Bps';\nexport const RATE_BITS_PER_SECOND = 'bps';\n\nconst UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: UNIT_BYTES,\n  [UNIT_SECONDS]: 's',\n  [UNIT_PERCENT]: UNIT_PERCENT,\n  [UNIT_COUNT]: DEFAULT_UNIT,\n};\n\nconst UNIT_LIST = Object.keys(UNIT_MAP); // used to check if a metric name contains any of the supported units\n\nconst RATE_UNIT_MAP: Record<string, string> = {\n  [UNIT_BYTES]: RATE_BYTES_PER_SECOND,\n  // seconds per second is unitless\n  [UNIT_SECONDS]: DEFAULT_UNIT,\n  [UNIT_COUNT]: DEFAULT_RATE_UNIT,\n  [UNIT_PERCENT]: UNIT_PERCENT,\n};\n\n// Get unit from metric name (e.g. \"go_gc_duration_seconds\" -> \"seconds\")\nexport function getUnitFromMetric(metric: string) {\n  if (!metric) {\n    return null;\n  }\n\n  // Get last two parts of the metric name and check if they are valid units\n  const metricParts = metric.toLowerCase().split('_').slice(-2);\n  for (let i = metricParts.length - 1; i >= Math.max(0, metricParts.length - 2); i--) {\n    const part = metricParts[i];\n    if (UNIT_LIST.includes(part)) {\n      return part;\n    }\n  }\n\n  return null;\n}\n\n// Get Grafana unit for a panel (e.g. \"go_gc_duration_seconds\" -> \"s\")\nexport function getUnit(metricName: string | undefined) {\n  if (!metricName) {\n    return DEFAULT_UNIT;\n  }\n\n  const metricPart = getUnitFromMetric(metricName);\n  return (metricPart && UNIT_MAP[metricPart.toLowerCase()]) || DEFAULT_UNIT;\n}\n\nexport function getPerSecondRateUnit(metricName: string | undefined) {\n  if (!metricName) {\n    return DEFAULT_RATE_UNIT;\n  }\n\n  const metricPart = getUnitFromMetric(metricName);\n\n  return (metricPart && RATE_UNIT_MAP[metricPart]) || DEFAULT_RATE_UNIT;\n}\n","import { type DataSourceInstanceSettings, type DataSourceJsonData } from '@grafana/data';\nimport { type PrometheusDatasource } from '@grafana/prometheus';\nimport { getBackendSrv, getDataSourceSrv } from '@grafana/runtime';\n\nimport { logger } from '../tracking/logger/logger';\nexport type DataSource = DataSourceInstanceSettings<DataSourceJsonData>;\n\n// This regex matches Grafana developed Prometheus data sources that are compatible with the vanilla Prometheus data source\nconst PROMETHEUS_DATA_SOURCE_REGEX = /^grafana-[0-9a-z]+prometheus-datasource$/;\n\n/**\n * Helper function to determine if a datasource is a Prometheus datasource\n */\nexport function isPrometheusDataSource(input: unknown): input is PrometheusDatasource {\n  return (\n    typeof input === 'object' &&\n    input !== null &&\n    'type' in input &&\n    typeof input.type === 'string' &&\n    (input.type === 'prometheus' || PROMETHEUS_DATA_SOURCE_REGEX.test(input.type)) &&\n    'uid' in input &&\n    typeof input.uid === 'string'\n  );\n}\n\ntype DataSourceType = 'prometheus' | 'loki';\n\n/**\n * Fetches and caches healthy data sources\n */\nexport class DataSourceFetcher {\n  private readonly pendingRequests = new Map<DataSourceType, Promise<DataSource[]>>();\n  private readonly cache = new Map<DataSourceType, DataSource[]>();\n\n  /**\n   * Retrieves healthy data sources of the specified type\n   * Results are cached indefinitely until the `DataSourceFetcher` is destroyed\n   *\n   * @param type - The type of data source to retrieve ('prometheus' or loki)\n   * @returns Array of healthy data sources\n   */\n  public async getHealthyDataSources(type: DataSourceType): Promise<DataSource[]> {\n    // Check if we have cached results\n    const cachedDataSources = this.cache.get(type);\n    if (cachedDataSources?.length) {\n      return cachedDataSources;\n    }\n\n    // If there's already a pending request for this type, wait for it\n    let pendingRequest = this.pendingRequests.get(type);\n    if (!pendingRequest) {\n      pendingRequest = this.fetchHealthyDataSources(type).finally(() => {\n        // Clean up the pending request after it completes\n        this.pendingRequests.delete(type);\n      });\n      this.pendingRequests.set(type, pendingRequest);\n    }\n\n    // Wait for the request to complete and update cache\n    const dataSources = await pendingRequest;\n    this.cache.set(type, dataSources);\n\n    return dataSources;\n  }\n\n  /**\n   * Fetches healthy data sources of the specified type\n   */\n  private async fetchHealthyDataSources(type: DataSourceType): Promise<DataSource[]> {\n    const allDataSourcesOfType = getDataSourceSrv().getList({\n      logs: true,\n      type,\n      filter: (ds) => ds.uid !== 'grafana',\n    });\n\n    const healthyDataSources: DataSource[] = [];\n    const unhealthyDataSources: DataSource[] = [];\n\n    await Promise.all(\n      allDataSourcesOfType.map(async (ds) => {\n        try {\n          const health = await getBackendSrv().get(`/api/datasources/uid/${ds.uid}/health`, undefined, undefined, {\n            showSuccessAlert: false,\n            showErrorAlert: false,\n          });\n\n          if (health?.status === 'OK') {\n            healthyDataSources.push(ds);\n          } else {\n            unhealthyDataSources.push(ds);\n          }\n        } catch {\n          unhealthyDataSources.push(ds);\n        }\n      })\n    );\n\n    if (unhealthyDataSources.length > 0) {\n      logger.warn(\n        `Found ${unhealthyDataSources.length} unhealthy ${type} data sources: ${unhealthyDataSources\n          .map((ds) => ds.name)\n          .join(', ')}`\n      );\n    }\n\n    return healthyDataSources;\n  }\n}\n\nlet dataSourceFetcherSingleton: DataSourceFetcher | undefined;\n\nexport function getDataSourceFetcher(): DataSourceFetcher {\n  if (!dataSourceFetcherSingleton) {\n    dataSourceFetcherSingleton = new DataSourceFetcher();\n  }\n\n  return dataSourceFetcherSingleton;\n}\n","import { type AdHocVariableFilter } from '@grafana/data';\nimport { isValidLegacyName, utf8Support } from '@grafana/prometheus';\nimport { Expression, MatchingOperator, promql } from 'tsqtsq';\n\nexport type NonRateQueryFunction = 'avg' | 'min' | 'max';\nexport const DEFAULT_NON_RATE_QUERY_FUNCTION: NonRateQueryFunction = 'avg';\n\nexport interface BuildPrometheusQueryParams {\n  metric: string;\n  filters: AdHocVariableFilter[];\n  isRateQuery: boolean;\n  groupings?: string[];\n  ignoreUsage?: boolean;\n  nonRateQueryFunction?: NonRateQueryFunction;\n}\n\nexport function getPromqlFunction(\n  isRateQuery: boolean,\n  nonRateQueryFunction: NonRateQueryFunction = DEFAULT_NON_RATE_QUERY_FUNCTION\n): NonRateQueryFunction | 'sum' {\n  return isRateQuery ? 'sum' : nonRateQueryFunction; // eslint-disable-line sonarjs/no-selector-parameter\n}\n\nexport function buildPrometheusQuery({\n  metric,\n  filters,\n  isRateQuery,\n  groupings,\n  ignoreUsage = false,\n  nonRateQueryFunction = DEFAULT_NON_RATE_QUERY_FUNCTION,\n}: BuildPrometheusQueryParams): string {\n  // Check if metric name contains UTF-8 characters\n  const isUtf8Metric = !isValidLegacyName(metric);\n\n  const expr = new Expression({\n    metric: isUtf8Metric ? '' : metric,\n    values: {},\n    defaultOperator: MatchingOperator.equal,\n    defaultSelectors: [\n      ...(isUtf8Metric ? [{ label: utf8Support(metric), operator: MatchingOperator.equal, value: '__REMOVE__' }] : []),\n      ...(ignoreUsage ? [{ label: '__ignore_usage__', operator: MatchingOperator.equal, value: '' }] : []),\n      ...filters\n        .filter((filter) => filter.key !== '__name__')\n        .map(({ key, value, operator }) => ({\n          label: utf8Support(key),\n          operator: operator as MatchingOperator,\n          value,\n        })),\n    ],\n  });\n\n  let metricPartString = expr.toString();\n\n  // Hack to have the UTF-8 metric name in braces alongside labels,\n  // but without extra quotes associated with an empty label value\n  if (isUtf8Metric) {\n    metricPartString = metricPartString.replace('=\"__REMOVE__\"', '');\n  }\n\n  // Add rate if needed\n  if (isRateQuery) {\n    metricPartString = promql.rate({ expr: metricPartString, interval: '$__rate_interval' });\n  }\n\n  // Build final query using tsqtsq\n  // native histograms will not get `sum by (le)` here because they are not identified as rate queries in `determineProperties` function because they don't have the suffix bucket. The `rate` function is defined much earlier for them in `MetricVizPanel.buildQueryRunner` and is passed here as the `nonRateQueryFunction`.\n  return promql[getPromqlFunction(isRateQuery, nonRateQueryFunction)]({\n    expr: metricPartString,\n    ...(groupings?.length ? { by: groupings } : {}),\n  });\n}\n","type Filter = {\n  key: string;\n  operator: '=' | '!=' | '=~' | '!~' | '<' | '>';\n  value: string;\n};\n\nconst LABEL_REGEX = '[a-zA-Z_]\\\\w*'; // see https://prometheus.io/docs/concepts/data_model/#metric-names-and-labels\nconst OPERATOR_REGEX = '>|<|!~|=~|!=|=';\nconst VALUE_REGEX = '.+';\n\nconst MATCHER_REGEX = new RegExp(`(${LABEL_REGEX})(${OPERATOR_REGEX})(${VALUE_REGEX})`);\n\nexport function parseMatcher(matcher: string): Filter {\n  // eslint-disable-next-line sonarjs/slow-regex\n  const [, rawKey, rawOperator, rawValue] = matcher.match(MATCHER_REGEX) || [, '', '', ''];\n  return {\n    key: rawKey.trim(),\n    value: rawValue.replace(/['\" ]/g, ''),\n    operator: rawOperator.trim() as Filter['operator'],\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { FieldMatcherID, LoadingState, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneObjectBase,\n  SceneQueryRunner,\n  type SceneComponentProps,\n  type SceneDataQuery,\n  type SceneObject,\n  type SceneObjectState,\n  type VizPanel,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { buildPrometheusQuery, getPromqlFunction, type NonRateQueryFunction } from 'autoQuery/buildPrometheusQuery';\nimport { getUnit } from 'autoQuery/units';\nimport { trailDS } from 'shared';\n\nimport { type PrometheusFn } from './actions/ConfigureAction';\nimport { SelectAction } from './actions/SelectAction';\nimport { buildHeatmapPanel } from './panels/buildHeatmapPanel';\nimport { buildStatusHistoryPanel } from './panels/buildStatusHistoryPanel';\nimport { buildTimeseriesPanel } from './panels/buildTimeseriesPanel';\nimport { parseMatcher } from './parseMatcher';\n\ninterface MetricVizPanelProps {\n  metricName: string;\n  color: string;\n  isNativeHistogram: boolean;\n  headerActions?: SceneObject[];\n  height?: string;\n  hideLegend?: boolean;\n  highlight?: boolean;\n  matchers?: string[];\n  prometheusFunction?: PrometheusFn;\n  title?: string;\n}\n\ninterface MetricVizPanelState\n  extends SceneObjectState,\n    Pick<\n      Required<MetricVizPanelProps>,\n      'isNativeHistogram' | 'headerActions' | 'height' | 'hideLegend' | 'highlight' | 'prometheusFunction'\n    > {\n  body: VizPanel;\n}\n\nexport const METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW = '260px';\nexport const METRICS_VIZ_PANEL_HEIGHT = '220px';\nexport const METRICS_VIZ_PANEL_HEIGHT_SMALL = '160px';\nconst rateQueryMetricSuffixes = new Set(['count', 'total', 'sum', 'bucket']);\n\nexport class MetricVizPanel extends SceneObjectBase<MetricVizPanelState> {\n  private static readonly MAX_DATA_POINTS = 250;\n\n  constructor(props: MetricVizPanelProps) {\n    const { isRateQuery } = MetricVizPanel.determineQueryProperties(props.metricName, props.isNativeHistogram);\n    const stateWithDefaults = {\n      ...props,\n      prometheusFunction: props.prometheusFunction ?? (getPromqlFunction(isRateQuery) as PrometheusFn),\n      isNativeHistogram: props.isNativeHistogram,\n      matchers: props.matchers || [],\n      title: props.title || props.metricName,\n      height: props.height || METRICS_VIZ_PANEL_HEIGHT,\n      hideLegend: Boolean(props.hideLegend),\n      highlight: Boolean(props.highlight),\n      headerActions: [...(props.headerActions || [new SelectAction({ metricName: props.metricName })])],\n    };\n\n    super({\n      key: `metric-viz-panel-${stateWithDefaults.metricName}`,\n      ...stateWithDefaults,\n      body: MetricVizPanel.buildVizPanel({\n        ...stateWithDefaults,\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const { body, prometheusFunction } = this.state;\n\n    this._subs.add(\n      (body.state.$data as SceneQueryRunner).subscribeToState((newState) => {\n        if (newState.data?.state !== LoadingState.Done) {\n          return;\n        }\n\n        const { series } = newState.data;\n\n        if (series?.length) {\n          body.setState({\n            fieldConfig: {\n              defaults: body.state.fieldConfig.defaults,\n              overrides: [\n                {\n                  matcher: { id: FieldMatcherID.byFrameRefID, options: series[0].refId },\n                  properties: [\n                    {\n                      id: 'displayName',\n                      value: prometheusFunction,\n                    },\n                  ],\n                },\n              ],\n            },\n          });\n        }\n      })\n    );\n  }\n\n  private static buildVizPanel({\n    metricName,\n    title,\n    highlight,\n    color,\n    hideLegend,\n    prometheusFunction,\n    matchers,\n    headerActions,\n    isNativeHistogram = false,\n  }: Required<Omit<MetricVizPanelProps, 'prometheusFunction'>> & {\n    prometheusFunction?: MetricVizPanelProps['prometheusFunction'];\n  }) {\n    const panelTitle = highlight ? `${title} (current)` : title;\n    const unit = getUnit(metricName);\n\n    // check if metric is a histogram (either classic or native)\n    const isHistogram = metricName.endsWith('_bucket') || isNativeHistogram;\n\n    const isUptime = metricName === 'up' || metricName.endsWith('_up');\n    if (isUptime) {\n      // For uptime metrics, use a status history panel which is better for binary states\n      return buildStatusHistoryPanel({\n        panelTitle,\n        headerActions,\n        // TODO: custom uptime query runner to prevent if/else in buildPrometheusQuery() (see below)\n        queryRunner: MetricVizPanel.buildQueryRunner({\n          metricName,\n          matchers,\n          prometheusFunction: 'min',\n          isHistogram,\n        }),\n      })\n        .setUnit(unit) // Set the appropriate unit for status history panel as well\n        .build();\n    }\n\n    if (isHistogram) {\n      return buildHeatmapPanel({\n        panelTitle,\n        headerActions,\n        hideLegend,\n        queryRunner: MetricVizPanel.buildQueryRunner({\n          metricName,\n          matchers,\n          prometheusFunction: 'rate',\n          isHistogram,\n          queryOptions: {\n            format: 'heatmap',\n          },\n        }),\n      })\n        .setUnit(unit)\n        .build();\n    }\n\n    // Default settings for non-uptime metrics - use timeseries\n    return buildTimeseriesPanel({\n      panelTitle,\n      headerActions,\n      color,\n      hideLegend,\n      queryRunner: MetricVizPanel.buildQueryRunner({\n        metricName,\n        matchers,\n        prometheusFunction,\n        isHistogram,\n      }),\n    })\n      .setUnit(unit) // Set the appropriate unit\n      .build();\n  }\n\n  private static buildQueryRunner({\n    metricName,\n    matchers,\n    isHistogram,\n    prometheusFunction,\n    queryOptions = {},\n  }: {\n    metricName: string;\n    matchers: string[];\n    isHistogram: boolean;\n    prometheusFunction?: PrometheusFn;\n    queryOptions?: Partial<SceneDataQuery>;\n  }): SceneQueryRunner {\n    const filters = matchers.map(parseMatcher);\n    const { isRateQuery, groupings } = MetricVizPanel.determineQueryProperties(metricName, isHistogram);\n    const expr = buildPrometheusQuery({\n      metric: metricName,\n      filters,\n      isRateQuery,\n      ignoreUsage: true,\n      groupings,\n      ...(prometheusFunction ? { nonRateQueryFunction: prometheusFunction as NonRateQueryFunction } : {}),\n    });\n\n    return new SceneQueryRunner({\n      datasource: trailDS,\n      maxDataPoints: MetricVizPanel.MAX_DATA_POINTS,\n      queries: [\n        {\n          ...queryOptions,\n          refId: metricName,\n          expr,\n          fromExploreMetrics: true,\n        },\n      ],\n    });\n  }\n\n  static determineQueryProperties(metricName: string, isHistogram: boolean) {\n    const parts = metricName.split('_');\n    const suffix = parts.at(-1);\n\n    // Determine if this is a rate query based on metric suffix\n    const isRateQuery = rateQueryMetricSuffixes.has(suffix || '');\n\n    // Determine groupings based on metric suffix and native histogram status\n    let groupings: string[] | undefined;\n\n    if (isHistogram) {\n      groupings = ['le'];\n    }\n\n    return { isRateQuery, groupings };\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricVizPanel>) => {\n    const { body, height, highlight, isNativeHistogram } = model.useState();\n    const styles = useStyles2(getStyles, height);\n\n    return (\n      <div className={cx(styles.container, highlight && styles.highlight, isNativeHistogram && styles.nativeHistogram)}>\n        {body && <body.Component model={body} />}\n      </div>\n    );\n  };\n}\n\n// TODO: don't export only to use it in PreviewPanel.tsx\n// instead, use only MetricVizPanel across the whole app\nexport const nativeHistogramStyles = (theme: GrafanaTheme2) => {\n  const nativeHistogramBadgeWidth = 116;\n\n  return css({\n    '[class$=\"-panel-header\"]': {\n      position: 'relative',\n      paddingLeft: `${nativeHistogramBadgeWidth + 4}px`,\n    },\n    '[class$=\"-panel-title\"]::before': {\n      content: '\"Native Histogram\"',\n      fontSize: '12px',\n      color: 'rgb(158, 193, 247)',\n      position: 'absolute',\n      left: '8px',\n      top: '7px',\n      display: 'inline-flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      width: `${nativeHistogramBadgeWidth}px`,\n      height: '22px',\n      padding: 0,\n      border: `1px solid ${theme.colors.info.text}`,\n      borderRadius: theme.shape.radius.pill,\n      background: theme.colors.info.transparent,\n      cursor: 'auto',\n    },\n  });\n};\n\nfunction getStyles(theme: GrafanaTheme2, height: string) {\n  return {\n    container: css({\n      height,\n    }),\n    highlight: css({\n      border: `2px solid ${theme.colors.primary.main}`,\n    }),\n    nativeHistogram: nativeHistogramStyles(theme),\n  };\n}\n","import { PanelBuilders, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\nimport { MappingType, ThresholdsMode, VisibilityMode } from '@grafana/schema';\n\ninterface PanelProps {\n  panelTitle: string;\n  headerActions: SceneObject[];\n  queryRunner: SceneQueryRunner;\n}\n\nexport function buildStatusHistoryPanel({ panelTitle, headerActions, queryRunner }: PanelProps) {\n  queryRunner.setState({ maxDataPoints: 100 });\n\n  return (\n    PanelBuilders.statushistory()\n      .setTitle(panelTitle)\n      // we clone to prevent Scenes warnings \"SceneObject already has a parent set that is different from the new parent. You cannot share the same SceneObject instance in multiple scenes or in multiple different places of the same scene graph. Use SceneObject.clone() to duplicate a SceneObject or store a state key reference and use sceneGraph.findObject to locate it.\"\n      .setHeaderActions(headerActions.map((action) => action.clone()))\n      .setData(queryRunner)\n      .setColor({ mode: 'thresholds' }) // Set color mode to enable threshold coloring\n      .setMappings([\n        {\n          type: MappingType.ValueToText,\n          options: {\n            '0': {\n              color: 'red',\n              text: 'down',\n            },\n            '1': {\n              color: 'green',\n              text: 'up',\n            },\n          },\n        },\n      ])\n      .setThresholds({\n        mode: ThresholdsMode.Absolute,\n        steps: [\n          { value: 0, color: 'red' },\n          { value: 1, color: 'green' },\n        ],\n      })\n      // Hide the threshold annotations\n      .setOption('legend', { showLegend: false })\n      .setOption('showValue', VisibilityMode.Never)\n  );\n}\n","import { PanelBuilders, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\nimport { HeatmapColorMode } from '@grafana/schema/dist/esm/raw/composable/heatmap/panelcfg/x/HeatmapPanelCfg_types.gen';\n\ninterface PanelProps {\n  panelTitle: string;\n  queryRunner: SceneQueryRunner;\n  hideLegend: boolean;\n  headerActions: SceneObject[];\n}\n\nexport function buildHeatmapPanel({ panelTitle, queryRunner, headerActions, hideLegend }: PanelProps) {\n  return (\n    PanelBuilders.heatmap()\n      .setTitle(panelTitle)\n      .setData(queryRunner)\n      .setOption('calculate', false)\n      .setOption('color', {\n        mode: HeatmapColorMode.Scheme,\n        exponent: 0.5,\n        scheme: 'Spectral',\n        steps: 32,\n        reverse: false,\n      })\n      // we clone to prevent Scenes warnings \"SceneObject already has a parent set that is different from the new parent. You cannot share the same SceneObject instance in multiple scenes or in multiple different places of the same scene graph. Use SceneObject.clone() to duplicate a SceneObject or store a state key reference and use sceneGraph.findObject to locate it.\"\n      .setHeaderActions(headerActions.map((action) => action.clone()))\n      .setOption('legend', { show: !hideLegend })\n  );\n}\n","import { PanelBuilders, type SceneObject, type SceneQueryRunner } from '@grafana/scenes';\n\ninterface PanelProps {\n  panelTitle: string;\n  color: string;\n  queryRunner: SceneQueryRunner;\n  hideLegend: boolean;\n  headerActions: SceneObject[];\n}\n\nexport function buildTimeseriesPanel({ panelTitle, queryRunner, color, headerActions, hideLegend }: PanelProps) {\n  return (\n    PanelBuilders.timeseries()\n      .setTitle(panelTitle)\n      .setData(queryRunner)\n      .setColor({ mode: 'fixed', fixedColor: color })\n      .setCustomFieldConfig('fillOpacity', 9)\n      .setCustomFieldConfig('pointSize', 1)\n      // we clone to prevent Scenes warnings \"SceneObject already has a parent set that is different from the new parent. You cannot share the same SceneObject instance in multiple scenes or in multiple different places of the same scene graph. Use SceneObject.clone() to duplicate a SceneObject or store a state key reference and use sceneGraph.findObject to locate it.\"\n      .setHeaderActions(headerActions.map((action) => action.clone()))\n      .setOption('legend', { showLegend: !hideLegend })\n  );\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { TextLink, useStyles2 } from '@grafana/ui';\nimport React, { useCallback } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\n\nimport { InlineBanner } from './InlineBanner';\n\ntype ErrorViewProps = { error: Error };\n\nexport function ErrorView({ error }: Readonly<ErrorViewProps>) {\n  const styles = useStyles2(getStyles);\n\n  const navigate = useNavigate();\n  const { pathname, search } = useLocation();\n\n  const onClickReload = useCallback(() => {\n    const searchParams = new URLSearchParams(search);\n    const newSearchParams = new URLSearchParams();\n\n    // these are safe keys to keep\n    ['from', 'to', 'timezone']\n      .filter((key) => searchParams.has(key))\n      .forEach((key) => newSearchParams.set(key, searchParams.get(key)!));\n\n    navigate({ pathname, search: newSearchParams.toString() });\n    window.location.reload();\n  }, [navigate, pathname, search]);\n\n  return (\n    <div className={styles.container}>\n      <InlineBanner\n        severity=\"error\"\n        title=\"Fatal error!\"\n        message={\n          <>\n            Please{' '}\n            <TextLink href=\"#\" onClick={onClickReload}>\n              try reloading the page\n            </TextLink>{' '}\n            or, if the problem persists, contact your organization admin. Sorry for the inconvenience.\n          </>\n        }\n        error={error}\n        errorContext={{ handheldBy: 'React error boundary' }}\n      />\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      margin: theme.spacing(2),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { locationUtil, type GrafanaTheme2 } from '@grafana/data';\nimport { useStyles2, useTheme2 } from '@grafana/ui';\nimport React from 'react';\nimport SVG from 'react-inlinesvg';\n\nexport function Onboarding() {\n  const styles = useStyles2(getStyles);\n  const theme = useTheme2();\n  return (\n    <div className={styles.wrap}>\n      <div className={styles.graphicContainer}>\n        <SVG\n          src={\n            // eslint-disable-next-line sonarjs/no-all-duplicated-branches\n            theme.isDark\n              ? `/public/plugins/grafana-metricsdrilldown-app/img/logo.svg`\n              : `/public/plugins/grafana-metricsdrilldown-app/img/logo.svg`\n          }\n        />\n      </div>\n      <div className={styles.text}>\n        <h3 className={styles.title}>Welcome to Grafana Metrics Drilldown</h3>\n\n        <p>\n          We noticed there is no Prometheus datasource configured.\n          <br />\n          Add a{' '}\n          <a className=\"external-link\" href={locationUtil.assureBaseUrl('/connections/datasources/new')}>\n            Prometheus datasource\n          </a>{' '}\n          to view metrics.\n        </p>\n\n        <br />\n\n        <p>\n          Check{' '}\n          <a\n            href=\"https://grafana.com/docs/grafana/latest/explore/simplified-exploration/metrics/\"\n            target=\"_blank\"\n            className=\"external-link\"\n            rel=\"noreferrer\"\n          >\n            our docs\n          </a>{' '}\n          to learn more or\n          <br />\n          <a\n            href=\"https://play.grafana.org/a/grafana-metricsdrilldown-app/drilldown\"\n            target=\"_blank\"\n            className=\"external-link\"\n            rel=\"noreferrer\"\n          >\n            try it online\n          </a>{' '}\n          in Grafana Play!\n        </p>\n      </div>\n    </div>\n  );\n}\n\nconst getStyles = (theme: GrafanaTheme2) => {\n  return {\n    graphicContainer: css({\n      [theme.breakpoints.up('md')]: {\n        alignSelf: 'flex-end',\n        height: 'auto',\n        padding: theme.spacing(1),\n        width: '300px',\n      },\n      [theme.breakpoints.up('lg')]: {\n        alignSelf: 'flex-end',\n        height: 'auto',\n        padding: theme.spacing(1),\n        width: '400px',\n      },\n      display: 'flex',\n      height: '250px',\n      justifyContent: 'center',\n      margin: '0 auto',\n      padding: theme.spacing(1),\n      width: '200px',\n    }),\n\n    text: css({\n      alignItems: 'center',\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center',\n    }),\n    title: css({\n      marginBottom: '1.5rem',\n    }),\n    wrap: css({\n      [theme.breakpoints.up('md')]: {\n        flexDirection: 'row',\n        margin: '4rem auto auto auto',\n      },\n      alignItems: 'center',\n      display: 'flex',\n      flexDirection: 'column',\n      margin: '0 auto auto auto',\n      padding: '2rem',\n      textAlign: 'center',\n    }),\n  };\n};\n","import { locationService } from '@grafana/runtime';\nimport { createContext, useEffect, useState } from 'react';\n\nimport { type DataTrail } from 'DataTrail';\nimport { getUrlForTrail, newMetricsTrail } from 'utils';\n\nimport { navigationEvents } from '../WingmanDataTrail/SideBar/sections/BookmarksList';\n\ninterface MetricsAppContext {\n  trail: DataTrail;\n  goToUrlForTrail: (trail: DataTrail) => void;\n}\n\nexport const MetricsContext = createContext<MetricsAppContext>({\n  trail: newMetricsTrail(),\n  goToUrlForTrail: () => {},\n});\n\nexport function useTrail() {\n  const [trail, setTrail] = useState<DataTrail>(newMetricsTrail());\n\n  const goToUrlForTrail = (trail: DataTrail) => {\n    locationService.push(getUrlForTrail(trail));\n    setTrail(trail);\n  };\n\n  // Subscribe to navigation events from BookmarksList\n  useEffect(() => {\n    const handleNavigation = (trail: DataTrail) => {\n      goToUrlForTrail(trail);\n    };\n\n    // Subscribe to navigation events\n    const unsubscribe = navigationEvents.subscribe(handleNavigation);\n\n    // Clean up subscription\n    return () => unsubscribe();\n  }, []);\n\n  return { trail, goToUrlForTrail };\n}\n","import React, { lazy, useContext } from 'react';\nimport { Navigate, Route, Routes, useLocation } from 'react-router-dom';\n\nimport { ROUTES } from '../constants';\nimport { MetricsContext } from './useTrail';\n\nconst Wingman = lazy(() => import('../pages/TrailWingman'));\n\n// For /trail links, redirect to /drilldown with the same search params\nconst TrailRedirect = () => {\n  const location = useLocation();\n  return <Navigate to={`${ROUTES.Drilldown}${location.search}`} replace />;\n};\n\nexport const AppRoutes = () => {\n  const { trail } = useContext(MetricsContext);\n\n  return (\n    <Routes>\n      <Route path={ROUTES.Drilldown} element={<Wingman trail={trail} />} />\n      <Route path={ROUTES.Trail} element={<TrailRedirect />} />\n      {/* catch-all route */}\n      <Route path=\"*\" element={<Navigate to={ROUTES.Drilldown} replace />} />\n    </Routes>\n  );\n};\n","import { useEffect, useState } from 'react';\n\nfunction ensureErrorObject(error: any, defaultMessage: string): Error {\n  if (error instanceof Error) {\n    return error;\n  }\n  if (typeof error === 'string') {\n    return new Error(error);\n  }\n  if (typeof error.message === 'string') {\n    return new Error(error.message);\n  }\n  return new Error(defaultMessage);\n}\n\nexport function useCatchExceptions(): [Error | undefined, React.Dispatch<React.SetStateAction<Error | undefined>>] {\n  const [error, setError] = useState<Error>();\n\n  // even though we wrap the app in an ErrorBoundary, some errors are not caught,\n  // so we have to set global handlers to catch these (e.g. error thrown from some click handlers)\n  useEffect(() => {\n    const onError = (errorEvent: ErrorEvent) => {\n      setError(ensureErrorObject(errorEvent.error, 'Uncaught exception!'));\n    };\n\n    const onUnHandledRejection = (event: PromiseRejectionEvent) => {\n      // TODO: remove me when we remove MetricSelectScene\n      // indeed, it seems there's always  a cancelled request when landing on the view :man_shrug:\n      // Ideally, the code in DataTrail should handle the cancellation but we do it here because it's easier\n      if (event.reason.type === 'cancelled') {\n        setError(undefined);\n        return;\n      }\n\n      setError(ensureErrorObject(event.reason, 'Unhandled rejection!'));\n    };\n\n    window.addEventListener('error', onError);\n    window.addEventListener('unhandledrejection', onUnHandledRejection);\n    return () => {\n      window.removeEventListener('unhandledrejection', onUnHandledRejection);\n      window.removeEventListener('error', onError);\n    };\n  }, []);\n\n  return [error, setError];\n}\n","import { type AppRootProps } from '@grafana/data';\nimport { createContext, useContext } from 'react';\n\n// This is used to be able to retrieve the root plugin props anywhere inside the app.\nexport const PluginPropsContext = createContext<AppRootProps | null>(null);\n\nexport const usePluginProps = () => {\n  const pluginProps = useContext(PluginPropsContext);\n\n  return pluginProps;\n};\n\nexport const usePluginMeta = () => {\n  const pluginProps = usePluginProps();\n\n  return pluginProps?.meta;\n};\n","import { css } from '@emotion/css';\nimport { type AppRootProps, type GrafanaTheme2 } from '@grafana/data';\nimport { config } from '@grafana/runtime';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { initFaro } from 'tracking/faro/faro';\n\nimport { ErrorView } from './ErrorView';\nimport { Onboarding } from './Onboarding';\nimport { AppRoutes } from './Routes';\nimport { useCatchExceptions } from './useCatchExceptions';\nimport { useReportAppInitialized } from './useReportAppInitialized';\nimport { MetricsContext, useTrail } from './useTrail';\nimport { isPrometheusDataSource } from '../utils/utils.datasource';\nimport { PluginPropsContext } from '../utils/utils.plugin';\n\ninitFaro();\n\nconst prometheusDatasources = Object.values(config.datasources).filter(isPrometheusDataSource);\n\nexport default function App(props: Readonly<AppRootProps>) {\n  const styles = useStyles2(getStyles);\n  const [error] = useCatchExceptions();\n  const { trail, goToUrlForTrail } = useTrail();\n\n  useReportAppInitialized();\n\n  if (error) {\n    return (\n      <div className={styles.appContainer} data-testid=\"metrics-drilldown-app\">\n        <ErrorView error={error} />\n      </div>\n    );\n  }\n\n  if (!prometheusDatasources.length) {\n    return <Onboarding />;\n  }\n\n  return (\n    <div className={styles.appContainer} data-testid=\"metrics-drilldown-app\">\n      <PluginPropsContext.Provider value={props}>\n        <MetricsContext.Provider value={{ trail, goToUrlForTrail }}>\n          <AppRoutes />\n        </MetricsContext.Provider>\n      </PluginPropsContext.Provider>\n    </div>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    appContainer: css({\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100%',\n      backgroundColor: theme.colors.background.primary,\n    }),\n  };\n}\n","import { useEffect, useRef } from 'react';\n\nimport { reportExploreMetrics, type ViewName } from 'interactions';\n\nexport function useReportAppInitialized() {\n  const initRef = useRef(false);\n\n  useEffect(() => {\n    if (!initRef.current) {\n      initRef.current = true;\n\n      const view: ViewName = new URL(window.location.href).searchParams.get('metric')\n        ? 'metric-details'\n        : 'metrics-reducer';\n\n      reportExploreMetrics('app_initialized', { view });\n    }\n  }, []);\n}\n","import {\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { RadioButtonGroup } from '@grafana/ui';\nimport React from 'react';\n\nexport enum LayoutType {\n  GRID = 'grid',\n  ROWS = 'rows',\n}\n\nexport interface LayoutSwitcherState extends SceneObjectState {\n  layout: LayoutType;\n  onChange?: (layout: LayoutType) => void;\n}\n\nexport class LayoutSwitcher extends SceneObjectBase<LayoutSwitcherState> {\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: ['layout'] });\n\n  static readonly OPTIONS = [\n    { label: 'Grid', value: LayoutType.GRID },\n    { label: 'Rows', value: LayoutType.ROWS },\n  ];\n\n  static readonly DEFAULT_LAYOUT = LayoutType.GRID;\n\n  constructor() {\n    super({\n      key: 'layout-switcher',\n      layout: LayoutSwitcher.DEFAULT_LAYOUT,\n    });\n  }\n\n  getUrlState() {\n    return {\n      layout: this.state.layout,\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<LayoutSwitcherState> = {};\n\n    if (typeof values.layout === 'string' && values.layout !== this.state.layout) {\n      stateUpdate.layout = Object.values(LayoutType).includes(values.layout as LayoutType)\n        ? (values.layout as LayoutType)\n        : LayoutSwitcher.DEFAULT_LAYOUT;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  onChange = (layout: LayoutType) => {\n    this.setState({ layout });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<LayoutSwitcher>) => {\n    const { layout } = model.useState();\n\n    return (\n      <RadioButtonGroup\n        aria-label=\"Layout switcher\"\n        options={LayoutSwitcher.OPTIONS}\n        value={layout}\n        onChange={model.onChange}\n        fullWidth={false}\n      />\n    );\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nimport { type SortingOption } from '../MetricsSorter';\n\nexport interface EventSortByChangedPayload {\n  sortBy: SortingOption;\n}\n\nexport class EventSortByChanged extends BusEventWithPayload<EventSortByChangedPayload> {\n  public static readonly type = 'sort-by-changed';\n}\n","import {\n  FieldType,\n  LoadingState,\n  type DataQueryResponse,\n  type LegacyMetricFindQueryOptions,\n  type MetricFindValue,\n  type TestDataSourceResponse,\n} from '@grafana/data';\nimport { type PrometheusDatasource } from '@grafana/prometheus';\nimport { RuntimeDataSource, sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { MetricDatasourceHelper } from 'helpers/MetricDatasourceHelper';\nimport { VAR_FILTERS } from 'shared';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\nimport { displayWarning } from 'WingmanDataTrail/helpers/displayStatus';\n\nimport { localeCompare } from '../helpers/localCompare';\n\n// TODO can we get rid of it and use e.g. undefined or an empty string?\nexport const NULL_GROUP_BY_VALUE = '(none)';\n\nexport class LabelsDataSource extends RuntimeDataSource {\n  static readonly uid = 'grafana-prometheus-labels-datasource';\n\n  constructor() {\n    super(LabelsDataSource.uid, LabelsDataSource.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(matcher: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as SceneObject;\n\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    const [, labelName] = matcher.match(/valuesOf\\((.+)\\)/) ?? [];\n    if (labelName) {\n      const labelValues = await LabelsDataSource.fetchLabelValues(labelName, sceneObject);\n      return labelValues.map((value) => ({ value, text: value }));\n    }\n\n    let labelOptions: MetricFindValue[] = [];\n\n    try {\n      labelOptions = await this.fetchLabels(ds, sceneObject, matcher);\n    } catch (error) {\n      displayWarning(['Error while fetching labels! Defaulting to an empty array.', (error as Error).toString()]);\n    }\n\n    return [{ value: NULL_GROUP_BY_VALUE, text: '(none)' }, ...labelOptions] as MetricFindValue[];\n  }\n\n  private async fetchLabels(ds: PrometheusDatasource, sceneObject: SceneObject, matcher: string) {\n    // there is probably a more graceful way to implement this, but this is what the DS offers us.\n    // if a DS does not support the labels match API, we need getTagKeys to handle the empty matcher\n    if (!LabelsDataSource.getLabelsMatchAPISupport(ds)) {\n      // the Prometheus series endpoint cannot accept an empty matcher\n      // when there are no filters, we cannot send the matcher passed to this function because Prometheus evaluates it as empty and returns an error\n      const filters = LabelsDataSource.getFiltersFromVariable(sceneObject);\n      const response = await ds.getTagKeys(filters);\n\n      return this.processLabelOptions(\n        response.map(({ text }) => ({\n          value: text,\n          text,\n        }))\n      );\n    }\n\n    const response = await MetricDatasourceHelper.fetchLabels({\n      ds,\n      timeRange: sceneGraph.getTimeRange(sceneObject).state.value,\n      matcher,\n    });\n\n    return this.processLabelOptions(\n      response.map((label) => ({\n        value: label,\n        text: label,\n      }))\n    );\n  }\n\n  private static getLabelsMatchAPISupport(ds: PrometheusDatasource) {\n    try {\n      return ds.hasLabelsMatchAPISupport();\n    } catch (error) {\n      displayWarning([\n        'Error while checking if the current data source supports the labels match API! Defaulting to false.',\n        (error as Error).toString(),\n      ]);\n      return false;\n    }\n  }\n\n  private static getFiltersFromVariable(sceneObject: SceneObject): { filters: any[] } {\n    const filtersVariable = sceneGraph.lookupVariable(VAR_FILTERS, sceneObject);\n\n    if (isAdHocFiltersVariable(filtersVariable)) {\n      return { filters: filtersVariable.state.filters };\n    }\n\n    return { filters: [] };\n  }\n\n  private processLabelOptions(options: Array<{ value: string; text: string }>): Array<{ value: string; text: string }> {\n    return options.filter(({ value }) => !value.startsWith('__')).sort((a, b) => localeCompare(a.value, b.value));\n  }\n\n  static async fetchLabelValues(labelName: string, sceneObject: SceneObject): Promise<string[]> {\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    try {\n      return await MetricDatasourceHelper.fetchLabelValues({\n        ds,\n        labelName,\n        timeRange: sceneGraph.getTimeRange(sceneObject).state.value,\n      });\n      // const args = MetricDatasourceHelper.datasourceUsesTimeRangeInLanguageProviderMethods(ds)\n      //   ? [sceneGraph.getTimeRange(sceneObject).state.value, labelName]\n      //   : [labelName];\n\n      // // @ts-expect-error: Ignoring type error due to breaking change in fetchLabelValues signature\n      // return await ds.languageProvider.fetchLabelValues(...args); // eslint-disable-line sonarjs/deprecation\n    } catch (error) {\n      displayWarning([\n        `Error while retrieving label \"${labelName}\" values! Defaulting to an empty array.`,\n        (error as Error).toString(),\n      ]);\n      return [];\n    }\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","import { VariableHide, VariableRefresh } from '@grafana/data';\nimport { QueryVariable } from '@grafana/scenes';\nimport React from 'react';\n\nimport { LabelsDataSource } from './LabelsDataSource';\n\nexport const VAR_LABEL_VALUES = 'wingmanLabelValues';\n\nexport class LabelValuesVariable extends QueryVariable {\n  constructor({ labelName }: { labelName: string }) {\n    super({\n      name: VAR_LABEL_VALUES,\n      datasource: { uid: LabelsDataSource.uid },\n      // just some syntax we make up so that the data source can decide what to fetch\n      query: `valuesOf(${labelName})`,\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n      // BOTH \"value\" and \"includeAll\" below ensure the repetition in SceneByVariableRepeater\n      // // (if not set, it'll render only the 1st variable option)\n      value: '$__all',\n      includeAll: true,\n    });\n  }\n\n  public static readonly Component = () => {\n    return <></>;\n  };\n}\n","import { css } from '@emotion/css';\nimport { VariableHide, VariableRefresh, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  DataSourceVariable,\n  QueryVariable,\n  sceneGraph,\n  type MultiValueVariable,\n  type SceneComponentProps,\n} from '@grafana/scenes';\nimport { Label, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_DATASOURCE, VAR_FILTERS, VAR_FILTERS_EXPR } from 'shared';\n\nimport { LabelsDataSource, NULL_GROUP_BY_VALUE } from './LabelsDataSource';\n\nexport const VAR_WINGMAN_GROUP_BY = 'labelsWingman';\n\nexport class LabelsVariable extends QueryVariable {\n  constructor() {\n    super({\n      name: VAR_WINGMAN_GROUP_BY,\n      label: 'Group by label',\n      placeholder: 'Group by label...',\n      datasource: { uid: LabelsDataSource.uid },\n      query: '',\n      includeAll: false,\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  onActivate() {\n    this._subs.add(\n      this.subscribeToState((newState, prevState) => {\n        if (newState.query !== prevState.query) {\n          // preserve the value from the URL search param when landing\n          if (prevState.query) {\n            this.setState({ value: NULL_GROUP_BY_VALUE });\n          }\n\n          this.refreshOptions();\n        }\n      })\n    );\n\n    this._subs.add(\n      sceneGraph.findByKeyAndType(this, VAR_DATASOURCE, DataSourceVariable).subscribeToState((newState, prevState) => {\n        if (newState.value !== prevState.value) {\n          this.setState({ value: NULL_GROUP_BY_VALUE });\n          this.refreshOptions();\n        }\n      })\n    );\n\n    this._subs.add(\n      sceneGraph.findByKeyAndType(this, VAR_FILTERS, AdHocFiltersVariable).subscribeToState((newState, prevState) => {\n        if (newState.filterExpression !== prevState.filterExpression) {\n          this.updateQuery();\n        }\n      })\n    );\n\n    // hack to ensure that labels are loaded when landing: sometimes filters are not interpolated and fetching labels give no results\n    this.updateQuery();\n  }\n\n  private updateQuery() {\n    const filterExpression = sceneGraph.interpolate(this, VAR_FILTERS_EXPR, {});\n    this.setState({ query: `{__name__=~\".+\",${filterExpression}}` });\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MultiValueVariable>) => {\n    const styles = useStyles2(getStyles);\n    const { label } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <Label className={styles.label}>{label}</Label>\n        <QueryVariable.Component model={model} />\n      </div>\n    );\n  };\n}\n\nconst getStyles = (theme: GrafanaTheme2) => ({\n  container: css`\n    display: flex;\n    align-items: center;\n    gap: 0;\n\n    [class*='input-wrapper'] {\n      width: 240px;\n    }\n  `,\n  label: css`\n    height: 32px;\n    white-space: nowrap;\n    margin: 0;\n    background-color: ${theme.colors.background.primary};\n    padding: ${theme.spacing(1)};\n    border-radius: ${theme.shape.radius.default};\n    border: 1px solid ${theme.colors.border.weak};\n    border-right: none;\n  `,\n});\n","import React from 'react';\n\nexport function GroupsIcon() {\n  return (\n    <svg stroke=\"currentColor\" width=\"17\" height=\"16\" viewBox=\"0 0 17 16\" fill=\"none\">\n      <circle cx=\"8.92688\" cy=\"3.63132\" r=\"2.375\" strokeWidth=\"1.5\" />\n      <path d=\"M13.6469 4.37965C14.6813 4.76699 15.3235 7.03139 14.9362 8.06582\" strokeWidth=\"1.5\" />\n      <path d=\"M4.35309 4.37965C3.31866 4.76699 2.67651 7.03139 3.06384 8.06582\" strokeWidth=\"1.5\" />\n      <path d=\"M10.3408 14.2531C9.75237 14.8415 8.11813 14.7799 7.50903 14.1708\" strokeWidth=\"1.5\" />\n      <circle cx=\"4.00195\" cy=\"12.251\" r=\"2.375\" strokeWidth=\"1.5\" />\n      <circle cx=\"13.8478\" cy=\"12.251\" r=\"2.375\" strokeWidth=\"1.5\" />\n    </svg>\n  );\n}\n","import {\n  FieldType,\n  LoadingState,\n  type DataQueryResponse,\n  type LegacyMetricFindQueryOptions,\n  type MetricFindValue,\n  type TestDataSourceResponse,\n} from '@grafana/data';\nimport { RuntimeDataSource, sceneGraph, type SceneObject } from '@grafana/scenes';\n\nimport { MetricDatasourceHelper } from 'helpers/MetricDatasourceHelper';\nimport { isPrometheusRule } from 'WingmanDataTrail/helpers/isPrometheusRule';\n\nexport class MetricsWithLabelValueDataSource extends RuntimeDataSource {\n  static readonly uid = 'grafana-prometheus-metrics-with-label-values-datasource';\n\n  constructor() {\n    super(MetricsWithLabelValueDataSource.uid, MetricsWithLabelValueDataSource.uid);\n  }\n\n  async query(): Promise<DataQueryResponse> {\n    return {\n      state: LoadingState.Done,\n      data: [\n        {\n          name: 'Labels',\n          fields: [\n            {\n              name: null,\n              type: FieldType.other,\n              values: [],\n              config: {},\n            },\n          ],\n          length: 0,\n        },\n      ],\n    };\n  }\n\n  async metricFindQuery(query: string, options: LegacyMetricFindQueryOptions): Promise<MetricFindValue[]> {\n    const sceneObject = options.scopedVars?.__sceneObject?.valueOf() as SceneObject;\n\n    const ds = await MetricDatasourceHelper.getPrometheusDataSourceForScene(sceneObject);\n    if (!ds) {\n      return [];\n    }\n\n    const timeRange = sceneGraph.getTimeRange(sceneObject).state.value;\n    let metricsList: string[] = [];\n\n    const removeRules = query.startsWith('removeRules');\n    const matcher = removeRules ? query.replace('removeRules', '') : query;\n\n    metricsList = await MetricDatasourceHelper.fetchLabelValues({\n      ds,\n      labelName: '__name__',\n      matcher,\n      timeRange,\n    });\n\n    if (removeRules) {\n      metricsList = metricsList.filter((metricName) => !isPrometheusRule(metricName));\n    }\n\n    return metricsList.map((metricName) => ({ value: metricName, text: metricName }));\n  }\n\n  async testDatasource(): Promise<TestDataSourceResponse> {\n    return {\n      status: 'success',\n      message: 'OK',\n    };\n  }\n}\n","export const isPrometheusRule = (metricName: string) =>\n  metricName === 'ALERTS' || metricName === 'ALERTS_FOR_STATE' || metricName.includes(':');\n","import { VariableHide, VariableRefresh } from '@grafana/data';\nimport { QueryVariable, sceneGraph } from '@grafana/scenes';\n\nimport { VAR_FILTERS, VAR_FILTERS_EXPR } from 'shared';\nimport { withLifecycleEvents } from 'WingmanDataTrail/MetricsVariables/withLifecycleEvents';\n\nimport { MetricsWithLabelValueDataSource } from './MetricsWithLabelValueDataSource';\n\nexport const VAR_METRIC_WITH_LABEL_VALUE = 'metrics-with-label-value';\n\nexport class MetricsWithLabelValueVariable extends QueryVariable {\n  constructor({\n    labelName,\n    labelValue,\n    removeRules,\n  }: {\n    labelName: string;\n    labelValue: string;\n    removeRules?: boolean;\n  }) {\n    super({\n      key: `${VAR_METRIC_WITH_LABEL_VALUE}-${labelName}-${labelValue}`,\n      name: VAR_METRIC_WITH_LABEL_VALUE,\n      datasource: { uid: MetricsWithLabelValueDataSource.uid },\n      query: MetricsWithLabelValueVariable.buildQuery(labelName, labelValue, removeRules),\n      isMulti: false,\n      allowCustomValue: false,\n      refresh: VariableRefresh.onTimeRangeChanged,\n      hide: VariableHide.hideVariable,\n      skipUrlSync: true,\n      // BOTH \"value\" and \"includeAll\" below ensure the repetition in SceneByVariableRepeater\n      // // (if not set, it'll render only the 1st variable option)\n      value: '$__all',\n      includeAll: true,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this, labelName, labelValue, removeRules));\n\n    // required for filtering and sorting\n    return withLifecycleEvents<MetricsWithLabelValueVariable>(this);\n  }\n\n  protected onActivate(labelName: string, labelValue: string, removeRules?: boolean) {\n    const adHocFiltersVariable = sceneGraph.lookupVariable(VAR_FILTERS, this);\n\n    if (adHocFiltersVariable?.state.hide !== VariableHide.hideVariable) {\n      this.setState({\n        query: MetricsWithLabelValueVariable.buildQuery(labelName, labelValue, removeRules),\n      });\n    }\n  }\n\n  private static buildQuery(labelName: string, labelValue: string, removeRules?: boolean) {\n    return removeRules\n      ? `removeRules{${labelName}=\"${labelValue}\",${VAR_FILTERS_EXPR}}`\n      : `{${labelName}=\"${labelValue}\",${VAR_FILTERS_EXPR}}`;\n  }\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneReactObject,\n  SceneVariableSet,\n  type AdHocFiltersVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Button, CollapsableSection, Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useState } from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { VAR_FILTERS } from 'shared';\nimport { getColorByIndex, getTrailFor } from 'utils';\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { VAR_WINGMAN_GROUP_BY, type LabelsVariable } from 'WingmanDataTrail/Labels/LabelsVariable';\nimport { LayoutSwitcher, LayoutType, type LayoutSwitcherState } from 'WingmanDataTrail/ListControls/LayoutSwitcher';\nimport { GRID_TEMPLATE_COLUMNS, GRID_TEMPLATE_ROWS } from 'WingmanDataTrail/MetricsList/MetricsList';\nimport { SelectAction } from 'WingmanDataTrail/MetricVizPanel/actions/SelectAction';\nimport {\n  METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW,\n  MetricVizPanel,\n} from 'WingmanDataTrail/MetricVizPanel/MetricVizPanel';\nimport { WithUsageDataPreviewPanel } from 'WingmanDataTrail/MetricVizPanel/WithUsageDataPreviewPanel';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\nimport { GroupsIcon } from 'WingmanDataTrail/SideBar/custom-icons/GroupsIcon';\n\nimport {\n  MetricsWithLabelValueVariable,\n  VAR_METRIC_WITH_LABEL_VALUE,\n} from './MetricsWithLabelValue/MetricsWithLabelValueVariable';\n\nexport interface MetricsGroupByRowState extends SceneObjectState {\n  index: number;\n  labelName: string;\n  labelValue: string;\n  labelCardinality: number;\n  $variables: SceneVariableSet;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsGroupByRow extends SceneObjectBase<MetricsGroupByRowState> {\n  public constructor({\n    index,\n    labelName,\n    labelValue,\n    labelCardinality,\n  }: {\n    index: MetricsGroupByRowState['index'];\n    labelName: MetricsGroupByRowState['labelName'];\n    labelValue: MetricsGroupByRowState['labelValue'];\n    labelCardinality: MetricsGroupByRowState['labelCardinality'];\n  }) {\n    super({\n      index,\n      labelName,\n      labelValue,\n      labelCardinality,\n      key: `${labelName || ''}-${labelValue || ''}`,\n      $variables: new SceneVariableSet({\n        variables: [new MetricsWithLabelValueVariable({ labelName, labelValue })],\n      }),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_METRIC_WITH_LABEL_VALUE,\n        initialPageSize: 3,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: GRID_TEMPLATE_COLUMNS,\n          autoRows: METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW,\n          $behaviors: [\n            new behaviors.CursorSync({\n              key: 'metricCrosshairSync',\n              sync: DashboardCursorSync.Crosshair,\n            }),\n          ],\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No metrics found for the current filters and time range.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: <InlineBanner severity=\"error\" title=\"Error while loading metrics!\" error={error} />,\n          }),\n        getLayoutChild: (option, colorIndex) => {\n          const trail = getTrailFor(this);\n          const isNativeHistogram = trail.isNativeHistogram(option.value as string);\n\n          return new SceneCSSGridItem({\n            body: new WithUsageDataPreviewPanel({\n              vizPanelInGridItem: new MetricVizPanel({\n                metricName: option.value as string,\n                color: getColorByIndex(colorIndex),\n                matchers: [`${labelName}=\"${labelValue}\"`],\n                headerActions: [new SelectAction({ metricName: option.value as string })],\n                isNativeHistogram,\n              }),\n              metric: option.value as string,\n            }),\n          });\n        },\n      }),\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    this.subscribeToLayoutChange();\n  }\n\n  private subscribeToLayoutChange() {\n    const layoutSwitcher = sceneGraph.findByKeyAndType(this, 'layout-switcher', LayoutSwitcher);\n    const body = this.state.body.state.body as SceneCSSGridLayout;\n\n    const onChangeState = (newState: LayoutSwitcherState, prevState?: LayoutSwitcherState) => {\n      if (newState.layout !== prevState?.layout) {\n        body.setState({\n          templateColumns: newState.layout === LayoutType.ROWS ? GRID_TEMPLATE_ROWS : GRID_TEMPLATE_COLUMNS,\n        });\n      }\n    };\n\n    onChangeState(layoutSwitcher.state); // ensure layout when landing on the page\n\n    this._subs.add(layoutSwitcher.subscribeToState(onChangeState));\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsGroupByRow>) => {\n    const [isCollapsed, setIsCollapsed] = useState(false);\n    const styles = useStyles2(getStyles);\n\n    const { index, labelName, labelValue, labelCardinality, $variables, body } = model.useState();\n\n    const variable = $variables.state.variables[0] as MetricsWithLabelValueVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    const onClickSelect = () => {\n      const adHocFiltersVariable = sceneGraph.lookupVariable(VAR_FILTERS, model) as AdHocFiltersVariable;\n\n      adHocFiltersVariable.setState({\n        // TOOD: keep unique filters\n        filters: [...adHocFiltersVariable.state.filters, { key: labelName, operator: '=', value: labelValue }],\n      });\n\n      (sceneGraph.lookupVariable(VAR_WINGMAN_GROUP_BY, model) as LabelsVariable)?.changeValueTo(NULL_GROUP_BY_VALUE);\n    };\n\n    return (\n      <div className={styles.container} data-testid={`${labelName}-${labelValue}-metrics-group`}>\n        <div className={styles.containerHeader}>\n          <div className={styles.headerButtons}>\n            <Button\n              className={styles.selectButton}\n              variant=\"secondary\"\n              onClick={onClickSelect}\n              tooltip={`See metrics with ${labelName}=${labelValue}`}\n              tooltipPlacement=\"top\"\n            >\n              Select\n            </Button>\n          </div>\n        </div>\n\n        {\n          <CollapsableSection\n            isOpen={!isCollapsed}\n            onToggle={() => setIsCollapsed(!isCollapsed)}\n            label={\n              <div className={styles.groupName}>\n                <GroupsIcon />\n                <div className={styles.labelValue}>{labelValue}</div>\n                {labelCardinality > 1 && (\n                  <div className={styles.index}>\n                    ({index + 1}/{labelCardinality})\n                  </div>\n                )}\n              </div>\n            }\n          >\n            <div className={styles.collapsableSectionBody}>\n              <body.Component model={body} />\n            </div>\n\n            {shouldDisplayShowMoreButton && (\n              <div className={styles.footer}>\n                <ShowMoreButton\n                  label=\"metric\"\n                  batchSizes={batchSizes}\n                  onClick={onClickShowMore}\n                  tooltip={`Show more metrics for ${labelName}=\"${labelValue}\"`}\n                />\n              </div>\n            )}\n          </CollapsableSection>\n        }\n\n        {/* required to trigger its activation handlers */}\n        <div className={styles.variable}>\n          <variable.Component key={variable.state.name} model={variable} />\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      background: theme.colors.background.canvas,\n      margin: theme.spacing(1, 0, 0, 0),\n\n      '& div:focus-within': {\n        boxShadow: 'none !important',\n      },\n    }),\n    containerHeader: css({\n      display: 'flex',\n      alignItems: 'center',\n      gap: '8px',\n      marginBottom: '-36px',\n      paddingBottom: theme.spacing(1.5),\n      borderBottom: `1px solid ${theme.colors.border.medium}`,\n    }),\n    headerButtons: css({\n      position: 'relative',\n      top: '3px',\n      marginLeft: 'auto',\n      marginRight: '30px',\n      zIndex: 100,\n    }),\n    selectButton: css({\n      height: '28px',\n    }),\n    collapsableSectionBody: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: '24px',\n      padding: theme.spacing(1),\n    }),\n    groupName: css({\n      display: 'flex',\n      alignItems: 'center',\n      fontSize: '1.3rem',\n      lineHeight: '1.3rem',\n    }),\n    labelValue: css({\n      fontSize: '16px',\n      marginLeft: '8px',\n    }),\n    index: css({\n      fontSize: '12px',\n      color: theme.colors.text.secondary,\n      marginLeft: '8px',\n    }),\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      marginTop: theme.spacing(1),\n\n      '& button': {\n        height: '40px',\n      },\n    }),\n    variable: css({\n      display: 'none',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  SceneObjectBase,\n  SceneReactObject,\n  SceneVariableSet,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { Spinner, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { InlineBanner } from 'App/InlineBanner';\nimport { LabelValuesVariable, VAR_LABEL_VALUES } from 'WingmanDataTrail/Labels/LabelValuesVariable';\nimport { SceneByVariableRepeater } from 'WingmanDataTrail/SceneByVariableRepeater/SceneByVariableRepeater';\nimport { ShowMoreButton } from 'WingmanDataTrail/ShowMoreButton';\n\nimport { MetricsGroupByRow } from './MetricsGroupByRow';\n\ninterface MetricsGroupByListState extends SceneObjectState {\n  labelName: string;\n  $variables: SceneVariableSet;\n  body: SceneByVariableRepeater;\n}\n\nexport class MetricsGroupByList extends SceneObjectBase<MetricsGroupByListState> {\n  constructor({ labelName }: { labelName: MetricsGroupByListState['labelName'] }) {\n    super({\n      key: 'metrics-group-list',\n      labelName,\n      $variables: new SceneVariableSet({\n        variables: [new LabelValuesVariable({ labelName })],\n      }),\n      body: new SceneByVariableRepeater({\n        variableName: VAR_LABEL_VALUES,\n        initialPageSize: 20,\n        pageSizeIncrement: 10,\n        body: new SceneCSSGridLayout({\n          children: [],\n          isLazy: true,\n          templateColumns: '1fr',\n          autoRows: 'auto',\n          rowGap: 1,\n        }),\n        getLayoutLoading: () =>\n          new SceneReactObject({\n            reactNode: <Spinner inline />,\n          }),\n        getLayoutEmpty: () =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner title=\"\" severity=\"info\">\n                No label values found for label &quot;{labelName}&quot;.\n              </InlineBanner>\n            ),\n          }),\n        getLayoutError: (error: Error) =>\n          new SceneReactObject({\n            reactNode: (\n              <InlineBanner severity=\"error\" title={`Error while loading label \"${labelName}\" values!`} error={error} />\n            ),\n          }),\n        getLayoutChild: (option, index, options) => {\n          return new SceneCSSGridItem({\n            body: new MetricsGroupByRow({\n              index,\n              labelName,\n              labelValue: option.value as string,\n              labelCardinality: options.length,\n            }),\n          });\n        },\n      }),\n    });\n  }\n\n  static readonly Component = ({ model }: SceneComponentProps<MetricsGroupByList>) => {\n    const styles = useStyles2(getStyles);\n    const { body, $variables, labelName } = model.useState();\n\n    const variable = $variables.state.variables[0] as LabelValuesVariable;\n    const { loading, error } = variable.useState();\n\n    const batchSizes = body.useSizes();\n    const shouldDisplayShowMoreButton =\n      !loading && !error && batchSizes.total > 0 && batchSizes.current < batchSizes.total;\n\n    const onClickShowMore = () => {\n      body.increaseBatchSize();\n    };\n\n    return (\n      <div data-testid=\"metrics-groupby-list\">\n        <body.Component model={body} />\n\n        {shouldDisplayShowMoreButton && (\n          <div className={styles.footer}>\n            <ShowMoreButton label={`\"${labelName}\" value`} batchSizes={batchSizes} onClick={onClickShowMore} />\n          </div>\n        )}\n\n        {/* required to trigger its activation handlers */}\n        <div className={styles.variable}>\n          <variable.Component key={variable.state.name} model={variable} />\n        </div>\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    footer: css({\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      margin: theme.spacing(3, 0, 1, 0),\n\n      '& button': {\n        height: '40px',\n      },\n    }),\n    variable: css({\n      display: 'none',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type SelectableValue } from '@grafana/data';\nimport {\n  EmbeddedScene,\n  SceneFlexItem,\n  SceneFlexLayout,\n  type SceneComponentProps,\n  type SceneObjectState,\n  type SceneReactObject,\n  type SceneVariableSet,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_FILTERED_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { VAR_METRICS_VARIABLE } from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\n\nimport { LayoutSwitcher } from './LayoutSwitcher';\nimport { MetricsSorter } from './MetricsSorter/MetricsSorter';\nimport { QuickSearch } from './QuickSearch/QuickSearch';\n\ninterface ListControlsState extends SceneObjectState {\n  $variables?: SceneVariableSet;\n  inputControls?: SceneReactObject;\n  onChange?: (value: SelectableValue<string>) => void; // Keeping for backward compatibility\n}\n\n// @ts-ignore to fix build error. Is there a Scenes friend way of doing this?\nexport class ListControls extends EmbeddedScene {\n  constructor(state: Partial<ListControlsState>) {\n    super({\n      ...state,\n      key: 'list-controls',\n      body: new SceneFlexLayout({\n        direction: 'row',\n        width: '100%',\n        maxHeight: '32px',\n        children: [\n          new SceneFlexItem({\n            body: new QuickSearch({\n              urlSearchParamName: 'search_txt',\n              targetName: 'metric',\n              variableNames: {\n                nonFiltered: VAR_METRICS_VARIABLE,\n                filtered: VAR_FILTERED_METRICS_VARIABLE,\n              },\n            }),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new MetricsSorter({}),\n          }),\n          new SceneFlexItem({\n            width: 'auto',\n            body: new LayoutSwitcher(),\n          }),\n        ],\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<ListControls>) => {\n    const styles = useStyles2(getStyles);\n    const { body } = model.useState();\n\n    return (\n      <div className={styles.headerWrapper}>\n        <body.Component model={body} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles() {\n  return {\n    headerWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      '& > div': {\n        display: 'flex',\n        alignItems: 'center',\n        '& > div': {\n          display: 'flex',\n          alignItems: 'center',\n        },\n      },\n    }),\n  };\n}\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventApplyFunctionPayload {\n  metricName: string;\n  prometheusFunction: string;\n}\n\nexport class EventApplyFunction extends BusEventWithPayload<EventApplyFunctionPayload> {\n  public static readonly type = 'apply-function';\n}\n","import { css } from '@emotion/css';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { type PrometheusFn } from './ConfigureAction';\nimport { EventApplyFunction } from './EventApplyFunction';\n\ninterface ApplyActionState extends SceneObjectState {\n  metricName: string;\n  prometheusFunction: PrometheusFn;\n  disabled?: boolean;\n}\n\nexport class ApplyAction extends SceneObjectBase<ApplyActionState> {\n  constructor({ metricName, prometheusFunction, disabled }: ApplyActionState) {\n    super({\n      key: `apply-action-${metricName}`,\n      metricName,\n      prometheusFunction,\n      disabled: Boolean(disabled),\n    });\n  }\n\n  public onClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    const { metricName, prometheusFunction } = this.state;\n\n    event.preventDefault();\n\n    this.publishEvent(\n      new EventApplyFunction({\n        metricName,\n        prometheusFunction,\n      }),\n      true\n    );\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<ApplyAction>) => {\n    const styles = useStyles2(getStyles);\n    const { disabled } = model.useState();\n\n    return (\n      <Button\n        variant=\"primary\"\n        fill=\"outline\"\n        size=\"sm\"\n        className={styles.selectButton}\n        onClick={model.onClick}\n        disabled={disabled}\n      >\n        Apply\n      </Button>\n    );\n  };\n}\n\nconst getStyles = () => ({\n  selectButton: css``,\n});\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventConfigureFunctionPayload {\n  metricName: string;\n}\n\nexport class EventConfigureFunction extends BusEventWithPayload<EventConfigureFunctionPayload> {\n  public static readonly type = 'configure-function';\n}\n","import { css } from '@emotion/css';\nimport { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { EventConfigureFunction } from './EventConfigureFunction';\n\ninterface ConfigureActionState extends SceneObjectState {\n  metricName: string;\n}\n\nexport class ConfigureAction extends SceneObjectBase<ConfigureActionState> {\n  static readonly PROMETHEUS_FN_OPTIONS = [\n    { label: 'Average', value: 'avg' },\n    { label: 'Sum', value: 'sum' },\n    { label: 'Minimum', value: 'min' },\n    { label: 'Maximum', value: 'max' },\n    { label: 'Rate', value: 'rate' },\n  ] as const;\n\n  constructor({ metricName }: { metricName: ConfigureActionState['metricName'] }) {\n    super({\n      key: `configure-action-${metricName}`,\n      metricName,\n    });\n  }\n\n  public onClick = () => {\n    this.publishEvent(new EventConfigureFunction({ metricName: this.state.metricName }), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<ConfigureAction>) => {\n    const styles = useStyles2(getStyles);\n\n    return (\n      <Button\n        className={styles.selectButton}\n        aria-label=\"Configure\"\n        variant=\"secondary\"\n        size=\"sm\"\n        fill=\"text\"\n        onClick={model.onClick}\n        icon=\"cog\"\n        tooltip=\"Configure the Prometheus function\"\n        tooltipPlacement=\"top\"\n      />\n    );\n  };\n}\n\nconst getStyles = () => ({\n  selectButton: css`\n    margin: 0;\n    padding: 0;\n  `,\n});\n\nexport type PrometheusFn = (typeof ConfigureAction.PROMETHEUS_FN_OPTIONS)[number]['value'];\n","import { SceneObjectBase, type SceneComponentProps, type SceneObject, type SceneObjectState } from '@grafana/scenes';\nimport { Drawer } from '@grafana/ui';\nimport React from 'react';\n\ninterface SceneDrawerState extends SceneObjectState {\n  key?: string;\n  isOpen?: boolean;\n  title?: string;\n  subTitle?: string;\n  body?: SceneObject;\n}\n\nexport class SceneDrawer extends SceneObjectBase<SceneDrawerState> {\n  constructor(state?: SceneDrawerState) {\n    super({\n      key: 'drawer',\n      isOpen: false,\n      ...state,\n    });\n  }\n\n  open = ({\n    title,\n    subTitle,\n    body,\n  }: {\n    title?: SceneDrawerState['title'];\n    subTitle?: SceneDrawerState['subTitle'];\n    body?: SceneDrawerState['body'];\n  }) => {\n    this.setState({ ...this.state, isOpen: true, title, subTitle, body });\n  };\n\n  close = () => {\n    this.setState({ isOpen: false });\n  };\n\n  static readonly Component = ({ model }: SceneComponentProps<SceneDrawer>) => {\n    const { isOpen, title, subTitle, body } = model.useState();\n\n    return (\n      <>\n        {body && isOpen && (\n          <Drawer size=\"lg\" title={title} subtitle={subTitle} closeOnMaskClick onClose={model.close}>\n            <body.Component model={body} />\n          </Drawer>\n        )}\n      </>\n    );\n  };\n}\n","// Constants for metric rule type labels\nexport const LABEL_METRICS = 'Non-rules metrics';\nexport const LABEL_RULES = 'Recording rules';\n\nexport const ruleGroupLabels = {\n  metrics: LABEL_METRICS,\n  rules: LABEL_RULES,\n} as const;\n\nexport type RuleGroupLabel = (typeof ruleGroupLabels)[keyof typeof ruleGroupLabels];\n","import { BusEventWithPayload } from '@grafana/data';\n\nexport interface EventSectionValueChangedPayload {\n  key: string;\n  values: string[];\n}\n\nexport class EventSectionValueChanged extends BusEventWithPayload<EventSectionValueChangedPayload> {\n  public static readonly type = 'section-value-changed';\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Checkbox, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nexport const CheckboxWithCount = ({\n  label,\n  count,\n  checked,\n  onChange,\n}: {\n  label: string;\n  count: number;\n  checked: boolean;\n  onChange: (e: React.ChangeEvent<HTMLInputElement>) => void;\n}) => {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <div className={styles.checkboxWrapper} title={label}>\n      <Checkbox label={label} value={checked} onChange={onChange} />\n      <span className={styles.count}>({count})</span>\n    </div>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    checkboxWrapper: css({\n      display: 'flex',\n      alignItems: 'center',\n      width: '100%',\n      '& label *': {\n        fontSize: '14px !important',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n      },\n    }),\n    count: css({\n      color: theme.colors.text.secondary,\n      marginLeft: theme.spacing(0.5),\n      display: 'inline-block',\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { type RuleGroupLabel } from 'WingmanDataTrail/MetricsVariables/metricLabels';\n\nimport { CheckboxWithCount } from './CheckboxWithCount';\nimport { type MetricsFilterSectionState } from './MetricsFilterSection';\n\ntype CheckBoxListProps = {\n  groups: MetricsFilterSectionState['groups'];\n  selectedGroups: MetricsFilterSectionState['selectedGroups'];\n  onSelectionChange: (newGroups: MetricsFilterSectionState['selectedGroups']) => void;\n};\n\nexport function CheckBoxList({ groups, selectedGroups, onSelectionChange }: Readonly<CheckBoxListProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <>\n      <div className={styles.checkboxListHeader}>\n        <div>{selectedGroups.length} selected</div>\n        <Button variant=\"secondary\" fill=\"text\" onClick={() => onSelectionChange([])} disabled={!selectedGroups.length}>\n          clear\n        </Button>\n      </div>\n\n      {!groups.length && <div className={styles.noResults}>No results.</div>}\n\n      {groups.length > 0 && (\n        <ul className={styles.checkboxList} data-testid=\"checkbox-filters-list\">\n          {groups.map((group) => (\n            <li key={group.value} className={styles.checkboxItem}>\n              <CheckboxWithCount\n                label={group.label}\n                count={group.count}\n                checked={selectedGroups.some((g) => g.value === group.value)}\n                onChange={(e) => {\n                  const newGroups = e.currentTarget.checked\n                    ? [...selectedGroups, { label: group.label as RuleGroupLabel, value: group.value }]\n                    : selectedGroups.filter((v) => v.value !== group.value);\n\n                  onSelectionChange(newGroups);\n                }}\n              />\n            </li>\n          ))}\n        </ul>\n      )}\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    checkboxListHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      color: theme.colors.text.secondary,\n      margin: theme.spacing(0),\n      padding: theme.spacing(0, 0, 0, 1),\n    }),\n    checkboxList: css({\n      height: '100%',\n      margin: 0,\n      padding: theme.spacing(0, 1, 1, 1),\n      overflowY: 'auto',\n      '& .css-1n4u71h-Label': {\n        fontSize: '14px !important',\n      },\n      '&::-webkit-scrollbar': {\n        '-webkit-appearance': 'none',\n        width: '7px',\n      },\n      '&::-webkit-scrollbar-thumb': {\n        borderRadius: '4px',\n        backgroundColor: theme.colors.secondary.main,\n        '-webkit-box-shadow': `0 0 1px ${theme.colors.secondary.shade}`,\n      },\n    }),\n    checkboxItem: css({\n      display: 'flex',\n      alignItems: 'center',\n      width: '100%',\n      padding: theme.spacing(0.5, 0),\n    }),\n    noResults: css({\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport {\n  sceneGraph,\n  SceneObjectBase,\n  SceneObjectUrlSyncConfig,\n  VariableDependencyConfig,\n  type MultiValueVariable,\n  type SceneComponentProps,\n  type SceneObjectUrlValues,\n} from '@grafana/scenes';\nimport { Icon, IconButton, Input, Spinner, Switch, useStyles2 } from '@grafana/ui';\nimport React, { useMemo, useState, type KeyboardEventHandler } from 'react';\n\nimport { logger } from 'tracking/logger/logger';\nimport { MetricsReducer } from 'WingmanDataTrail/MetricsReducer';\nimport {\n  VAR_FILTERED_METRICS_VARIABLE,\n  type FilteredMetricsVariable,\n} from 'WingmanDataTrail/MetricsVariables/FilteredMetricsVariable';\nimport { ruleGroupLabels, type RuleGroupLabel } from 'WingmanDataTrail/MetricsVariables/metricLabels';\nimport {\n  VAR_METRICS_VARIABLE,\n  type MetricOptions,\n  type MetricsVariable,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariable';\nimport {\n  MetricsVariableFilterEngine,\n  type MetricFilters,\n} from 'WingmanDataTrail/MetricsVariables/MetricsVariableFilterEngine';\n\nimport { reportExploreMetrics } from '../../../../interactions';\nimport { EventSectionValueChanged } from '../EventSectionValueChanged';\nimport { SectionTitle } from '../SectionTitle';\nimport { type SideBarSectionState } from '../types';\nimport { CheckBoxList } from './CheckBoxList';\nimport { EventFiltersChanged } from './EventFiltersChanged';\n\nexport interface MetricsFilterSectionState extends SideBarSectionState {\n  type: keyof MetricFilters;\n  computeGroups: (\n    options: Array<{ label: string; value: string }>\n  ) => Array<{ label: string; value: string; count: number }>;\n  showHideEmpty: boolean;\n  showSearch: boolean;\n  groups: Array<{ label: string; value: string; count: number }>;\n  selectedGroups: Array<{ label: RuleGroupLabel; value: string }>; // we need labels for displaying tooltips in `SideBar.tsx`\n  loading: boolean;\n}\n\nexport class MetricsFilterSection extends SceneObjectBase<MetricsFilterSectionState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_METRICS_VARIABLE, VAR_FILTERED_METRICS_VARIABLE],\n    onReferencedVariableValueChanged: (variable) => {\n      const { name, options } = (variable as MultiValueVariable).state;\n\n      if (name === VAR_METRICS_VARIABLE) {\n        this.updateLists(options as MetricOptions);\n        return;\n      }\n\n      if (name === VAR_FILTERED_METRICS_VARIABLE) {\n        this.updateCounts();\n      }\n    },\n  });\n\n  protected _urlSync = new SceneObjectUrlSyncConfig(this, { keys: [this.state.key] });\n\n  getUrlState() {\n    return {\n      [this.state.key]: this.state.selectedGroups.map((g) => g.value).join(','),\n    };\n  }\n\n  updateFromUrl(values: SceneObjectUrlValues) {\n    const stateUpdate: Partial<MetricsFilterSectionState> = {};\n\n    if (\n      typeof values[this.state.key] === 'string' &&\n      values[this.state.key] !== this.state.selectedGroups.map((g) => g.value).join(',')\n    ) {\n      stateUpdate.selectedGroups = (values[this.state.key] as string)\n        .split(',')\n        .map((v) => ({ label: v as RuleGroupLabel, value: v })) as Array<{ label: RuleGroupLabel; value: string }>;\n    }\n\n    this.setState(stateUpdate);\n  }\n\n  constructor({\n    key,\n    type,\n    title,\n    description,\n    icon,\n    computeGroups,\n    showHideEmpty,\n    showSearch,\n    disabled,\n    active,\n  }: {\n    key: MetricsFilterSectionState['key'];\n    type: MetricsFilterSectionState['type'];\n    title: MetricsFilterSectionState['title'];\n    description: MetricsFilterSectionState['description'];\n    icon: MetricsFilterSectionState['icon'];\n    computeGroups: MetricsFilterSectionState['computeGroups'];\n    showHideEmpty?: MetricsFilterSectionState['showHideEmpty'];\n    showSearch?: MetricsFilterSectionState['showSearch'];\n    disabled?: MetricsFilterSectionState['disabled'];\n    active?: MetricsFilterSectionState['active'];\n  }) {\n    super({\n      key,\n      type,\n      title,\n      description,\n      icon,\n      groups: [],\n      computeGroups,\n      selectedGroups: [],\n      loading: true,\n      showHideEmpty: showHideEmpty ?? true,\n      showSearch: showSearch ?? true,\n      disabled: disabled ?? false,\n      active: active ?? false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const metricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MetricsVariable;\n    const filteredMetricsVariable = sceneGraph.lookupVariable(\n      VAR_FILTERED_METRICS_VARIABLE,\n      this\n    ) as FilteredMetricsVariable;\n\n    this.updateLists(metricsVariable.state.options as MetricOptions);\n    this.updateCounts();\n\n    const { selectedGroups } = this.state;\n\n    this.setState({\n      loading: filteredMetricsVariable.state.loading,\n      active: selectedGroups.length > 0,\n    });\n  }\n\n  private updateLists(options: MetricOptions) {\n    this.setState({\n      groups: this.state.computeGroups(options),\n      loading: false,\n    });\n  }\n\n  private updateCounts() {\n    const { groups, computeGroups, type } = this.state;\n\n    // Access the original unfiltered options\n    const metricsVariable = sceneGraph.lookupVariable(VAR_METRICS_VARIABLE, this) as MetricsVariable;\n    const originalOptions = metricsVariable.state.options as MetricOptions;\n\n    const metricsReducer = sceneGraph.getAncestor(this, MetricsReducer);\n    const filterEngine = metricsReducer.state.enginesMap.get(VAR_FILTERED_METRICS_VARIABLE)?.filterEngine;\n\n    if (!filterEngine) {\n      logger.warn('MetricsFilterSection: No filter engine found');\n      return;\n    }\n\n    // Create a copy of current filters excluding the current filter type\n    const filtersWithoutCurrentType = { ...filterEngine.getFilters(), [type]: [] };\n\n    // Get options filtered by everything except the current filter type\n    const optionsForCounting = MetricsVariableFilterEngine.getFilteredOptions(\n      originalOptions,\n      filtersWithoutCurrentType\n    );\n\n    // Calculate counts based on these options\n    const newGroups = new Map<string, number>(\n      computeGroups(optionsForCounting).map((option) => [option.label, option.count])\n    );\n\n    const newGroupsWithCount = groups.map((group) => ({\n      ...group,\n      count: newGroups.get(group.label) ?? 0,\n    }));\n\n    this.setState({\n      groups: newGroupsWithCount,\n      loading: false,\n    });\n  }\n\n  private onSelectionChange = (selectedGroups: MetricsFilterSectionState['selectedGroups']) => {\n    this.setState({ selectedGroups, active: selectedGroups.length > 0 });\n\n    this.publishEvent(\n      new EventFiltersChanged({ type: this.state.type, filters: selectedGroups.map((g) => g.value) }),\n      true\n    );\n\n    this.publishEvent(\n      new EventSectionValueChanged({ key: this.state.key, values: selectedGroups.map((g) => g.label) }),\n      true\n    );\n\n    if (this.state.type === 'prefixes') {\n      reportExploreMetrics('sidebar_prefix_filter_applied', {\n        filter_count: selectedGroups.length,\n      });\n    } else if (this.state.type === 'suffixes') {\n      reportExploreMetrics('sidebar_suffix_filter_applied', {\n        filter_count: selectedGroups.length,\n      });\n    }\n\n    // Track rule filter selection events\n    if (this.state.key === 'filters-rule' && selectedGroups.length > 0) {\n      // Map the label to the appropriate filter_type for the event\n      selectedGroups.forEach((group) => {\n        let filterType: 'non_rules_metrics' | 'recording_rules' | 'alerting_rules';\n\n        switch (group.label) {\n          case ruleGroupLabels.metrics:\n            filterType = 'non_rules_metrics';\n            break;\n          case ruleGroupLabels.rules:\n            filterType = 'recording_rules';\n            break;\n          default:\n            return; // Skip if it's not a recognized rules filter\n        }\n\n        reportExploreMetrics('sidebar_rules_filter_selected', { filter_type: filterType });\n      });\n    }\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsFilterSection>) => {\n    const styles = useStyles2(getStyles);\n    const { groups, selectedGroups, loading, title, description, showHideEmpty, showSearch } = model.useState();\n\n    const [hideEmpty, setHideEmpty] = useState(false);\n    const [searchValue, setSearchValue] = useState('');\n\n    const filteredGroups = useMemo(() => {\n      const filters: Array<(item: { label: string; value: string; count: number }) => boolean> = [];\n\n      if (hideEmpty) {\n        filters.push((item) => item.count > 0);\n      }\n\n      filters.push((item) => item.label.toLowerCase().includes(searchValue.toLowerCase()));\n\n      return groups.filter((group) => filters.every((filter) => filter(group)));\n    }, [hideEmpty, groups, searchValue]);\n\n    const onKeyDown: KeyboardEventHandler<HTMLInputElement> = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        setSearchValue('');\n      }\n    };\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} />\n\n        {showHideEmpty && (\n          <div className={styles.switchContainer}>\n            <span className={styles.switchLabel}>Hide empty</span>\n            <Switch value={hideEmpty} onChange={(e) => setHideEmpty(e.currentTarget.checked)} />\n          </div>\n        )}\n\n        {showSearch && (\n          <Input\n            className={styles.searchInput}\n            prefix={<Icon name=\"search\" />}\n            placeholder=\"Search...\"\n            value={searchValue}\n            onChange={(e) => setSearchValue(e.currentTarget.value)}\n            onKeyDown={onKeyDown}\n            suffix={\n              <IconButton name=\"times\" variant=\"secondary\" tooltip=\"Clear search\" onClick={() => setSearchValue('')} />\n            }\n          />\n        )}\n\n        {loading && <Spinner inline />}\n\n        {!loading && (\n          <CheckBoxList\n            groups={filteredGroups}\n            selectedGroups={selectedGroups}\n            onSelectionChange={model.onSelectionChange}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n    switchContainer: css({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'flex-end',\n      gap: theme.spacing(1),\n    }),\n    switchLabel: css({\n      fontSize: '12px',\n      color: theme.colors.text.primary,\n    }),\n    searchInput: css({\n      flexBasis: '32px',\n      flexShrink: 0,\n      marginBottom: theme.spacing(1),\n      padding: theme.spacing(0, 0.5),\n    }),\n  };\n}\n","import { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nconst NONE_SUFFIX = '<none>';\n\nexport function computeMetricSuffixGroups(options: Array<{ label: string; value: string }>) {\n  const rawSuffixesMap = new Map<string, string[]>();\n\n  for (const option of options) {\n    const parts = option.value.split(/[^a-z0-9]/i);\n    const key = parts.length <= 1 ? option.value : parts[parts.length - 1];\n    const values = rawSuffixesMap.get(key) ?? [];\n\n    values.push(option.value);\n    rawSuffixesMap.set(key || NONE_SUFFIX, values);\n  }\n\n  const suffixesMap = new Map<string, number>();\n\n  for (const [suffix, values] of rawSuffixesMap) {\n    suffixesMap.set(suffix, values.length);\n  }\n\n  return Array.from(suffixesMap.entries())\n    .sort((a, b) => {\n      if (a[1] !== b[1]) {\n        return b[1] - a[1];\n      }\n\n      return localeCompare(a[0], b[0]);\n    })\n    .map(([value, count]) => ({\n      value,\n      count,\n      label: value,\n    }));\n}\n","import { ruleGroupLabels } from './metricLabels';\n\ntype MetricType = 'metrics' | 'rules';\n\nexport function computeRulesGroups(options: Array<{ label: string; value: string }>) {\n  const rulesMap = new Map<MetricType, string[]>([\n    ['metrics', []],\n    ['rules', []],\n  ]);\n\n  for (const option of options) {\n    const { value } = option;\n    const key: MetricType = /:/i.test(value) ? 'rules' : 'metrics';\n\n    const values = rulesMap.get(key) ?? [];\n    values.push(value);\n    rulesMap.set(key, values);\n  }\n\n  return [\n    { value: '^(?!.*:.*)', label: ruleGroupLabels.metrics, count: rulesMap.get('metrics')!.length },\n    { value: ':', label: ruleGroupLabels.rules, count: rulesMap.get('rules')!.length },\n  ];\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport { Button, RadioButtonList, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\n\ntype LabelsListProps = {\n  labels: Array<SelectableValue<string>>;\n  selectedLabel: string;\n  onClickLabel: (label: string) => void;\n  onClickClearSelection: () => void;\n};\n\nexport function LabelsList({ labels, selectedLabel, onClickLabel, onClickClearSelection }: Readonly<LabelsListProps>) {\n  const styles = useStyles2(getStyles);\n\n  return (\n    <>\n      <div className={styles.listHeader}>\n        <div className={styles.selected}>\n          {selectedLabel === NULL_GROUP_BY_VALUE ? 'No selection' : `Selected: \"${selectedLabel}\"`}\n        </div>\n        <Button\n          variant=\"secondary\"\n          fill=\"text\"\n          onClick={onClickClearSelection}\n          disabled={selectedLabel === NULL_GROUP_BY_VALUE}\n        >\n          clear\n        </Button>\n      </div>\n\n      {!labels.length && <div className={styles.noResults}>No results.</div>}\n\n      {labels.length > 0 && (\n        <div className={styles.list} data-testid=\"labels-list\">\n          {/* TODO: use a custom one to have option labels with ellipsis and title/tooltip when hovering\n      now we're customizing too much the component CSS */}\n          <RadioButtonList name=\"labels-list\" options={labels} onChange={onClickLabel} value={selectedLabel} />\n        </div>\n      )}\n    </>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    listHeader: css({\n      display: 'flex',\n      justifyContent: 'space-between',\n      alignItems: 'center',\n      color: theme.colors.text.secondary,\n      margin: theme.spacing(0),\n      padding: theme.spacing(0, 0, 0, 1),\n    }),\n    selected: css({\n      overflow: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n    }),\n    list: css({\n      display: 'flex',\n      flex: 1,\n      flexDirection: 'column',\n      gap: 0,\n      overflowY: 'auto',\n\n      '& [role=\"radiogroup\"]': {\n        gap: 0,\n      },\n\n      '& label': {\n        cursor: 'pointer',\n        padding: theme.spacing(0.5, 1),\n        '&:hover': {\n          background: theme.colors.background.secondary,\n        },\n      },\n\n      '& label div': {\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n      },\n    }),\n    noResults: css({\n      fontStyle: 'italic',\n      padding: theme.spacing(0, 1, 1, 1),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2, type SelectableValue } from '@grafana/data';\nimport { sceneGraph, SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { Icon, IconButton, Input, Spinner, useStyles2 } from '@grafana/ui';\nimport React, { useMemo, useState } from 'react';\n\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { type LabelsVariable } from 'WingmanDataTrail/Labels/LabelsVariable';\n\nimport { reportExploreMetrics } from '../../../../interactions';\nimport { EventSectionValueChanged } from '../EventSectionValueChanged';\nimport { SectionTitle } from '../SectionTitle';\nimport { type SideBarSectionState } from '../types';\nimport { LabelsList } from './LabelsList';\n\ninterface LabelsBrowserState extends SideBarSectionState {\n  variableName: string;\n}\n\nexport class LabelsBrowser extends SceneObjectBase<LabelsBrowserState> {\n  constructor({\n    key,\n    variableName,\n    title,\n    description,\n    icon,\n    disabled,\n    active,\n  }: {\n    key: LabelsBrowserState['key'];\n    variableName: LabelsBrowserState['variableName'];\n    title: LabelsBrowserState['title'];\n    description: LabelsBrowserState['description'];\n    icon: LabelsBrowserState['icon'];\n    disabled?: LabelsBrowserState['disabled'];\n    active?: LabelsBrowserState['active'];\n  }) {\n    super({\n      key,\n      variableName,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: active ?? false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const labelsVariable = sceneGraph.lookupVariable(this.state.variableName, this) as LabelsVariable;\n    const labelValue = labelsVariable.state.value;\n\n    this.setState({ active: Boolean(labelValue && labelValue !== NULL_GROUP_BY_VALUE) });\n\n    // Subscribe to variable changes to update active state when the variable is changed externally\n    this._subs.add(\n      labelsVariable.subscribeToState((newState) => {\n        const active = Boolean(newState.value && newState.value !== NULL_GROUP_BY_VALUE);\n        this.setState({ active });\n        this.publishEvent(new EventSectionValueChanged({ key: this.state.key, values: active ? [newState.value as string] : [] }), true);\n      })\n    );\n  }\n\n  private selectLabel(label: string) {\n    const labelsVariable = sceneGraph.lookupVariable(this.state.variableName, this) as LabelsVariable;\n    labelsVariable.changeValueTo(label);\n\n    const active = Boolean(label && label !== NULL_GROUP_BY_VALUE);\n\n    this.setState({ active });\n\n    this.publishEvent(new EventSectionValueChanged({ key: this.state.key, values: active ? [label] : [] }), true);\n  }\n\n  private onClickLabel = (label: string) => {\n    reportExploreMetrics('sidebar_group_by_label_filter_applied', { label });\n    this.selectLabel(label);\n  };\n\n  private onClickClearSelection = () => {\n    this.selectLabel(NULL_GROUP_BY_VALUE);\n  };\n\n  private useLabelsBrowser = () => {\n    const { variableName, title, description } = this.useState();\n\n    const labelsVariable = sceneGraph.lookupVariable(variableName, this) as LabelsVariable;\n    const { loading, options: labels, value: labelValue } = labelsVariable.useState();\n\n    const [searchValue, setSearchValue] = useState('');\n\n    const labelsList: Array<SelectableValue<string>> = useMemo(() => {\n      const filters = [\n        (item: string) => item !== NULL_GROUP_BY_VALUE,\n        (item: string) => item.toLowerCase().includes(searchValue.toLowerCase()),\n      ];\n\n      return labels.filter((item) => filters.every((filter) => filter(item.value as string))) as Array<\n        SelectableValue<string>\n      >;\n    }, [labels, searchValue]);\n\n    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n      setSearchValue(e.currentTarget.value);\n    };\n\n    const onInputKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        setSearchValue('');\n      }\n    };\n\n    const onInputClear = () => {\n      setSearchValue('');\n    };\n\n    return {\n      title,\n      description,\n      loading,\n      selectedLabel: labelValue as string,\n      labelsList,\n      searchValue,\n      onInputChange,\n      onInputKeyDown,\n      onInputClear,\n    };\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<LabelsBrowser>) => {\n    const styles = useStyles2(getStyles);\n\n    const {\n      title,\n      description,\n      loading,\n      labelsList,\n      selectedLabel,\n      searchValue,\n      onInputChange,\n      onInputKeyDown,\n      onInputClear,\n    } = model.useLabelsBrowser();\n\n    return (\n      <div className={styles.container} data-testid=\"labels-browser\">\n        <SectionTitle title={title} description={description} />\n\n        <Input\n          className={styles.search}\n          prefix={<Icon name=\"search\" />}\n          placeholder=\"Search...\"\n          value={searchValue}\n          onChange={onInputChange}\n          onKeyDown={onInputKeyDown}\n          suffix={<IconButton name=\"times\" variant=\"secondary\" tooltip=\"Clear search\" onClick={onInputClear} />}\n        />\n\n        {loading && <Spinner inline />}\n\n        {!loading && (\n          <LabelsList\n            labels={labelsList}\n            selectedLabel={selectedLabel}\n            onClickLabel={model.onClickLabel}\n            onClickClearSelection={model.onClickClearSelection}\n          />\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n    search: css({\n      marginBottom: theme.spacing(1),\n      padding: theme.spacing(0, 0.5),\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { type GrafanaTheme2 } from '@grafana/data';\nimport { SceneObjectBase, type SceneComponentProps } from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { SectionTitle } from './SectionTitle';\nimport { type SideBarSectionState } from './types';\n\nexport interface SettingsState extends SideBarSectionState {}\n\nexport class Settings extends SceneObjectBase<SettingsState> {\n  constructor({\n    key,\n    title,\n    description,\n    icon,\n    disabled,\n  }: {\n    key: SettingsState['key'];\n    title: SettingsState['title'];\n    description: SettingsState['description'];\n    icon: SettingsState['icon'];\n    disabled?: SettingsState['disabled'];\n  }) {\n    super({\n      key,\n      title,\n      description,\n      icon,\n      disabled: disabled ?? false,\n      active: false,\n    });\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {}\n\n  public static readonly Component = ({ model }: SceneComponentProps<Settings>) => {\n    const styles = useStyles2(getStyles);\n    const { title, description } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <SectionTitle title={title} description={description} />\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      display: 'flex',\n      flexDirection: 'column',\n      gap: theme.spacing(1),\n      height: '100%',\n      overflowY: 'hidden',\n    }),\n  };\n}\n","import { css, cx } from '@emotion/css';\nimport { availableIconsIndex, type GrafanaTheme2, type IconName } from '@grafana/data';\nimport { Button, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { GroupsIcon } from './custom-icons/GroupsIcon';\nimport { RulesIcon } from './custom-icons/RulesIcon';\n\nconst CustomIcons = new Map<string, React.FC>([\n  ['rules', RulesIcon],\n  ['groups', GroupsIcon],\n]);\n\ntype SideBarButtonProps = {\n  ariaLabel: string;\n  disabled: boolean;\n  visible: boolean;\n  active: boolean;\n  tooltip: string;\n  onClick: () => void;\n  iconOrText: string | IconName;\n};\n\nexport function SideBarButton({\n  ariaLabel,\n  disabled,\n  visible,\n  active,\n  tooltip,\n  iconOrText,\n  onClick,\n}: Readonly<SideBarButtonProps>) {\n  const styles = useStyles2(getStyles);\n\n  let buttonIcon;\n  let ButtonChild;\n\n  if (iconOrText in availableIconsIndex) {\n    buttonIcon = iconOrText as IconName;\n  } else if (CustomIcons.has(iconOrText)) {\n    // some icons are not available in the Saga Design System and have been added as SVG files to the code base\n    ButtonChild = CustomIcons.get(iconOrText);\n  } else {\n    ButtonChild = function ButtonChildText() {\n      return <>{iconOrText}</>;\n    };\n  }\n\n  return (\n    <Button\n      className={cx(styles.button, disabled && 'disabled', visible && 'visible', active && 'active')}\n      size=\"md\"\n      variant=\"secondary\"\n      fill=\"text\"\n      icon={buttonIcon}\n      aria-label={ariaLabel}\n      tooltip={tooltip}\n      tooltipPlacement=\"right\"\n      onClick={onClick}\n      disabled={disabled}\n    >\n      {ButtonChild && <ButtonChild />}\n    </Button>\n  );\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    button: css({\n      margin: 0,\n      color: theme.colors.text.secondary,\n      '&:hover': {\n        color: theme.colors.text.maxContrast,\n        background: 'transparent',\n      },\n      '&.disabled:hover': {\n        color: theme.colors.text.secondary,\n      },\n      '&.visible': {\n        color: theme.colors.text.maxContrast,\n      },\n      '&.active': {\n        color: theme.colors.text.maxContrast,\n      },\n    }),\n  };\n}\n","import React from 'react';\n\nexport function RulesIcon() {\n  return (\n    <svg stroke=\"currentColor\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n      <rect x=\"1.25\" y=\"1.625\" width=\"5.25\" height=\"5.25\" rx=\"1\" strokeWidth=\"1.5\" />\n      <circle cx=\"12.25\" cy=\"4.25\" r=\"2.75\" strokeWidth=\"1.5\" />\n      <circle cx=\"3.75\" cy=\"11.75\" r=\"2.75\" strokeWidth=\"1.5\" />\n      <rect x=\"9.5\" y=\"9.125\" width=\"5.25\" height=\"5.25\" rx=\"1\" strokeWidth=\"1.5\" />\n    </svg>\n  );\n}\n","import { css, cx } from '@emotion/css';\nimport { VariableHide, type GrafanaTheme2 } from '@grafana/data';\nimport {\n  AdHocFiltersVariable,\n  sceneGraph,\n  SceneObjectBase,\n  type AdHocFilterWithLabels,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { IconButton, useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { VAR_OTHER_METRIC_FILTERS } from 'shared';\nimport { getTrailFor } from 'utils';\nimport { isAdHocFiltersVariable } from 'utils/utils.variables';\nimport { NULL_GROUP_BY_VALUE } from 'WingmanDataTrail/Labels/LabelsDataSource';\nimport { VAR_WINGMAN_GROUP_BY } from 'WingmanDataTrail/Labels/LabelsVariable';\nimport { computeMetricPrefixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricPrefixGroups';\nimport { computeMetricSuffixGroups } from 'WingmanDataTrail/MetricsVariables/computeMetricSuffixGroups';\nimport { computeRulesGroups } from 'WingmanDataTrail/MetricsVariables/computeRulesGroups';\n\nimport { reportExploreMetrics } from '../../interactions';\nimport { BookmarksList } from './sections/BookmarksList';\nimport { EventSectionValueChanged } from './sections/EventSectionValueChanged';\nimport { LabelsBrowser } from './sections/LabelsBrowser/LabelsBrowser';\nimport { MetricsFilterSection } from './sections/MetricsFilterSection/MetricsFilterSection';\nimport { Settings } from './sections/Settings';\nimport { SideBarButton } from './SideBarButton';\n\ntype Section = MetricsFilterSection | LabelsBrowser | BookmarksList | Settings;\n\ninterface SideBarState extends SceneObjectState {\n  sections: Section[];\n  visibleSection: Section | null;\n  sectionValues: Map<string, string[]>;\n}\n\nexport const metricFiltersVariables = ['filters-rule', 'filters-prefix', 'filters-suffix'] as const;\ntype MetricFiltersVariable = (typeof metricFiltersVariables)[number];\n\nexport class SideBar extends SceneObjectBase<SideBarState> {\n  constructor(state: Partial<SideBarState>) {\n    const sectionValues = SideBar.getSectionValuesFromUrl();\n\n    super({\n      key: 'sidebar',\n      visibleSection: null,\n      sections: [\n        new MetricsFilterSection({\n          key: 'filters-rule',\n          type: 'categories',\n          title: 'Rules filters',\n          description: 'Filter metrics and recording rules',\n          icon: 'rules',\n          computeGroups: computeRulesGroups,\n          showHideEmpty: false,\n          showSearch: false,\n          active: Boolean(sectionValues.get('filters-rule')?.length),\n        }),\n        new MetricsFilterSection({\n          key: 'filters-prefix',\n          type: 'prefixes',\n          title: 'Prefix filters',\n          description: 'Filter metrics based on their name prefix (Prometheus namespace)',\n          icon: 'A_',\n          computeGroups: computeMetricPrefixGroups,\n          active: Boolean(sectionValues.get('filters-prefix')?.length),\n        }),\n        new MetricsFilterSection({\n          key: 'filters-suffix',\n          type: 'suffixes',\n          title: 'Suffix filters',\n          description: 'Filter metrics based on their name suffix',\n          icon: '_Z',\n          computeGroups: computeMetricSuffixGroups,\n          active: Boolean(sectionValues.get('filters-suffix')?.length),\n        }),\n        new LabelsBrowser({\n          key: 'groupby-labels',\n          variableName: VAR_WINGMAN_GROUP_BY,\n          title: 'Group by labels',\n          description: 'Group metrics by their label values',\n          icon: 'groups',\n          active: sectionValues.has('groupby-labels'),\n        }),\n        new BookmarksList({\n          key: 'bookmarks',\n          title: 'Bookmarks',\n          description: 'Access your saved metrics for quick reference',\n          icon: 'star',\n        }),\n        new Settings({\n          key: 'settings',\n          title: 'Settings',\n          description: 'Settings',\n          icon: 'cog',\n          disabled: true,\n        }),\n      ],\n      sectionValues,\n      ...state,\n    });\n\n    // FIXME: rule values are regexes, we do this only to disable adding the values to the button tooltip\n    // we need to provide the corresponding label instead\n    sectionValues.set('filters-rule', []);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const cleanupOtherMetricsVar = this.initOtherMetricsVar();\n\n    this._subs.add(\n      this.subscribeToEvent(EventSectionValueChanged, (event) => {\n        const { key, values } = event.payload;\n        const { sectionValues } = this.state;\n        const newSectionValues = new Map(sectionValues).set(key, values);\n        this.setOtherMetricFilters(newSectionValues);\n        this.setState({ sectionValues: newSectionValues });\n      })\n    );\n\n    return () => {\n      cleanupOtherMetricsVar();\n    };\n  }\n\n  private setOtherMetricFilters(sectionValues: Map<string, string[]>) {\n    const otherMetricFiltersVar = sceneGraph.lookupVariable(VAR_OTHER_METRIC_FILTERS, this);\n    if (!isAdHocFiltersVariable(otherMetricFiltersVar)) {\n      return;\n    }\n\n    const varToTextMap: Record<MetricFiltersVariable, string> = {\n      'filters-rule': 'rule group',\n      'filters-prefix': 'prefix',\n      'filters-suffix': 'suffix',\n    };\n\n    const newFilters = Array.from(sectionValues.entries()).reduce<Array<AdHocFilterWithLabels<{}>>>(\n      (acc, [key, value]) => {\n        if (value.length && metricFiltersVariables.includes(key as MetricFiltersVariable)) {\n          acc.push({\n            key,\n            operator: '=',\n            value: value.join(', '),\n            keyLabel: varToTextMap[key as MetricFiltersVariable],\n          });\n        }\n\n        return acc;\n      },\n      []\n    );\n\n    otherMetricFiltersVar.setState({\n      filters: newFilters,\n      hide: newFilters.length ? VariableHide.hideLabel : VariableHide.hideVariable,\n    });\n  }\n\n  /**\n   * Initialize the other metrics variable and set the filters from the current sidebar selections.\n   * This powers the read-only, \"other metric filters\" UI next to the label filters.\n   * The purpose of this is to provide users with at-a-glance feedback about the current sidebar\n   * selections, without needing to interact with the sidebar.\n   */\n  private initOtherMetricsVar() {\n    const currentVariableSet = getTrailFor(this).state.$variables;\n    if (!currentVariableSet) {\n      return () => {};\n    }\n\n    const otherMetricFiltersVar = new AdHocFiltersVariable({\n      name: VAR_OTHER_METRIC_FILTERS,\n      readOnly: true,\n      skipUrlSync: true,\n      datasource: null,\n      hide: VariableHide.hideVariable,\n      layout: 'combobox',\n      applyMode: 'manual',\n      allowCustomValue: true,\n    });\n\n    currentVariableSet.setState({\n      variables: [...currentVariableSet.state.variables, otherMetricFiltersVar],\n    });\n\n    this.setOtherMetricFilters(this.state.sectionValues);\n\n    return () => {\n      currentVariableSet.setState({\n        variables: [...currentVariableSet.state.variables.filter((v) => v !== otherMetricFiltersVar)],\n      });\n    };\n  }\n\n  private static getSectionValuesFromUrl() {\n    const urlSearchParams = new URLSearchParams(window.location.search);\n    const sectionValues = new Map();\n\n    for (const filterKey of metricFiltersVariables) {\n      const filterValueFromUrl = urlSearchParams.get(filterKey);\n      sectionValues.set(filterKey, filterValueFromUrl ? filterValueFromUrl.split(',').map((v) => v.trim()) : []);\n    }\n\n    const labelValue = urlSearchParams.get(`var-${VAR_WINGMAN_GROUP_BY}`);\n    const isLabelsBrowserActive = Boolean(labelValue && labelValue !== NULL_GROUP_BY_VALUE);\n    if (isLabelsBrowserActive) {\n      sectionValues.set('groupby-labels', [labelValue!]);\n    }\n\n    return sectionValues;\n  }\n\n  private setActiveSection(sectionKey: string) {\n    const { visibleSection, sections } = this.state;\n\n    if (!sectionKey || sectionKey === visibleSection?.state.key) {\n      // Report closing the sidebar\n      reportExploreMetrics('metrics_sidebar_toggled', {\n        action: 'closed',\n        section: visibleSection?.state.key,\n      });\n\n      this.setState({ visibleSection: null });\n      return;\n    }\n\n    // Report opening the sidebar with the selected section\n    reportExploreMetrics('metrics_sidebar_toggled', {\n      action: 'opened',\n      section: sectionKey,\n    });\n\n    if (sectionKey === 'filters-prefix') {\n      reportExploreMetrics('sidebar_prefix_filter_section_clicked', {});\n    } else if (sectionKey === 'filters-suffix') {\n      reportExploreMetrics('sidebar_suffix_filter_section_clicked', {});\n    }\n\n    this.setState({\n      visibleSection: sections.find((section) => section.state.key === sectionKey) ?? null,\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<SideBar>) => {\n    const styles = useStyles2(getStyles);\n    const { sections, visibleSection, sectionValues } = model.useState();\n\n    return (\n      <div className={styles.container}>\n        <div className={styles.buttonsBar} data-testid=\"sidebar-buttons\">\n          {sections.map((section) => {\n            const { key, title, icon: iconOrText, disabled, active } = section.state;\n            const visible = visibleSection?.state.key === key;\n            const tooltip = sectionValues.get(key)?.length ? `${title}: ${sectionValues.get(key)?.join(', ')}` : title;\n\n            return (\n              <div\n                key={key}\n                className={cx(styles.buttonContainer, visible && 'visible', active && 'active', disabled && 'disabled')}\n              >\n                <SideBarButton\n                  ariaLabel={title}\n                  disabled={disabled}\n                  visible={visible}\n                  active={active}\n                  tooltip={tooltip}\n                  onClick={() => model.setActiveSection(key)}\n                  iconOrText={iconOrText}\n                />\n              </div>\n            );\n          })}\n        </div>\n        {visibleSection && (\n          <div className={styles.content} data-testid=\"sidebar-content\">\n            <IconButton\n              className={styles.closeButton}\n              name=\"times\"\n              aria-label=\"Close\"\n              tooltip=\"Close\"\n              tooltipPlacement=\"top\"\n              onClick={() => model.setActiveSection('')}\n            />\n            {/* TODO: find a better way */}\n            {visibleSection instanceof MetricsFilterSection && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof LabelsBrowser && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof BookmarksList && <visibleSection.Component model={visibleSection} />}\n            {visibleSection instanceof Settings && <visibleSection.Component model={visibleSection} />}\n          </div>\n        )}\n      </div>\n    );\n  };\n}\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    container: css({\n      position: 'relative',\n      display: 'flex',\n      flexDirection: 'row',\n      height: '100%',\n      overflow: 'hidden',\n    }),\n    buttonsBar: css({\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      gap: 0,\n      width: '42px',\n      padding: 0,\n      margin: 0,\n      boxSizing: 'border-box',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderRadius: theme.shape.radius.default,\n      backgroundColor: theme.colors.background.primary,\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n      position: 'relative',\n    }),\n    buttonContainer: css({\n      marginTop: theme.spacing(1),\n      '&::before': {\n        transition: '0.5s ease',\n        content: '\"\"',\n        position: 'absolute',\n        left: 0,\n        height: '32px',\n        borderLeft: `2px solid ${theme.colors.action.selectedBorder}`,\n        boxSizing: 'border-box',\n        opacity: 0,\n        visibility: 'hidden',\n      },\n      '&:hover::before': {\n        opacity: 1,\n        visibility: 'visible',\n      },\n      '&.visible::before': {\n        opacity: 1,\n        visibility: 'visible',\n      },\n      '&.disabled::before': {\n        opacity: 0,\n        visibility: 'hidden',\n      },\n      '&.active::after': {\n        content: '\"\"',\n        position: 'absolute',\n        right: 0,\n        width: '8px',\n        height: '8px',\n        backgroundColor: theme.colors.action.selectedBorder,\n        borderRadius: '50%',\n        margin: '2px 4px 0 0',\n      },\n    }),\n    content: css({\n      width: 'calc(300px - 42px)', // we want 300px in total\n      boxSizing: 'border-box',\n      border: `1px solid ${theme.colors.border.weak}`,\n      borderLeft: 'none',\n      borderRadius: theme.shape.radius.default,\n      backgroundColor: theme.colors.background.canvas,\n      padding: theme.spacing(1.5),\n    }),\n    closeButton: css({\n      position: 'absolute',\n      top: theme.spacing(1.5),\n      right: theme.spacing(1),\n      margin: 0,\n    }),\n  };\n}\n","import { css } from '@emotion/css';\nimport { DashboardCursorSync, type GrafanaTheme2 } from '@grafana/data';\nimport { useChromeHeaderHeight } from '@grafana/runtime';\nimport {\n  behaviors,\n  SceneCSSGridItem,\n  SceneCSSGridLayout,\n  sceneGraph,\n  SceneObjectBase,\n  SceneVariableSet,\n  VariableDependencyConfig,\n  type CustomVariable,\n  type QueryVariable,\n  type SceneComponentProps,\n  type SceneObjectState,\n} from '@grafana/scenes';\nimport { useStyles2 } from '@grafana/ui';\nimport React from 'react';\n\nimport { reportExploreMetrics } from 'interactions';\nimport { getColorByIndex, getTrailFor } from 'utils';\n\nimport { MetricSelectedEvent } from '../shared';\nimport { MetricsGroupByList } from './GroupBy/MetricsGroupByList';\nimport { MetricsWithLabelValueDataSource } from './GroupBy/MetricsWithLabelValue/MetricsWithLabelValueDataSource';\nimport { registerRuntimeDataSources } from './helpers/registerRuntimeDataSources';\nimport { LabelsDataSource, NULL_GROUP_BY_VALUE } from './Labels/LabelsDataSource';\nimport { LabelsVariable, VAR_WINGMAN_GROUP_BY } from './Labels/LabelsVariable';\nimport { ListControls } from './ListControls/ListControls';\nimport { EventSortByChanged } from './ListControls/MetricsSorter/events/EventSortByChanged';\nimport {\n  addRecentMetric,\n  MetricsSorter,\n  VAR_WINGMAN_SORT_BY,\n  type SortingOption,\n} from './ListControls/MetricsSorter/MetricsSorter';\nimport { EventQuickSearchChanged } from './ListControls/QuickSearch/EventQuickSearchChanged';\nimport { QuickSearch } from './ListControls/QuickSearch/QuickSearch';\nimport { GRID_TEMPLATE_COLUMNS, MetricsList } from './MetricsList/MetricsList';\nimport { EventMetricsVariableActivated } from './MetricsVariables/EventMetricsVariableActivated';\nimport { EventMetricsVariableDeactivated } from './MetricsVariables/EventMetricsVariableDeactivated';\nimport { EventMetricsVariableLoaded } from './MetricsVariables/EventMetricsVariableLoaded';\nimport { FilteredMetricsVariable, VAR_FILTERED_METRICS_VARIABLE } from './MetricsVariables/FilteredMetricsVariable';\nimport { MetricsVariable } from './MetricsVariables/MetricsVariable';\nimport { MetricsVariableFilterEngine, type MetricFilters } from './MetricsVariables/MetricsVariableFilterEngine';\nimport { MetricsVariableSortEngine } from './MetricsVariables/MetricsVariableSortEngine';\nimport { ApplyAction } from './MetricVizPanel/actions/ApplyAction';\nimport { ConfigureAction } from './MetricVizPanel/actions/ConfigureAction';\nimport { EventApplyFunction } from './MetricVizPanel/actions/EventApplyFunction';\nimport { EventConfigureFunction } from './MetricVizPanel/actions/EventConfigureFunction';\nimport { METRICS_VIZ_PANEL_HEIGHT_SMALL, MetricVizPanel } from './MetricVizPanel/MetricVizPanel';\nimport { SceneDrawer } from './SceneDrawer';\nimport { EventFiltersChanged } from './SideBar/sections/MetricsFilterSection/EventFiltersChanged';\nimport { MetricsFilterSection } from './SideBar/sections/MetricsFilterSection/MetricsFilterSection';\nimport { SideBar } from './SideBar/SideBar';\n\ninterface MetricsReducerState extends SceneObjectState {\n  listControls: ListControls;\n  sidebar: SideBar;\n  body: SceneObjectBase;\n  drawer: SceneDrawer;\n  enginesMap: Map<string, { filterEngine: MetricsVariableFilterEngine; sortEngine: MetricsVariableSortEngine }>;\n}\n\nexport class MetricsReducer extends SceneObjectBase<MetricsReducerState> {\n  protected _variableDependency = new VariableDependencyConfig(this, {\n    variableNames: [VAR_WINGMAN_GROUP_BY],\n    onReferencedVariableValueChanged: (variable) => {\n      this.updateBasedOnGroupBy((variable as LabelsVariable).state.value as string);\n    },\n  });\n\n  public constructor() {\n    super({\n      $variables: new SceneVariableSet({\n        variables: [new MetricsVariable(), new FilteredMetricsVariable(), new LabelsVariable()],\n      }),\n      listControls: new ListControls({}),\n      sidebar: new SideBar({}),\n      body: new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }) as unknown as SceneObjectBase,\n      drawer: new SceneDrawer({}),\n      enginesMap: new Map(),\n    });\n\n    registerRuntimeDataSources([new LabelsDataSource(), new MetricsWithLabelValueDataSource()]);\n\n    this.addActivationHandler(this.onActivate.bind(this));\n  }\n\n  private onActivate() {\n    const groupByValue = (sceneGraph.lookupVariable(VAR_WINGMAN_GROUP_BY, this) as LabelsVariable).state\n      .value as string;\n\n    this.updateBasedOnGroupBy(groupByValue);\n\n    this.subscribeToEvents();\n  }\n\n  private updateBasedOnGroupBy(groupByValue: string) {\n    const hasGroupByValue = Boolean(groupByValue && groupByValue !== NULL_GROUP_BY_VALUE);\n\n    sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch).toggleCountsDisplay(!hasGroupByValue);\n\n    this.setState({\n      body: hasGroupByValue\n        ? (new MetricsGroupByList({ labelName: groupByValue }) as unknown as SceneObjectBase)\n        : (new MetricsList({ variableName: VAR_FILTERED_METRICS_VARIABLE }) as unknown as SceneObjectBase),\n    });\n  }\n\n  private subscribeToEvents() {\n    this.initVariablesFilteringAndSorting();\n\n    this._subs.add(\n      this.subscribeToEvent(EventConfigureFunction, (event) => {\n        this.openDrawer(event.payload.metricName);\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventApplyFunction, () => {\n        this.state.drawer.close();\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(MetricSelectedEvent, (event) => {\n        if (event.payload !== undefined) {\n          addRecentMetric(event.payload);\n        }\n      })\n    );\n  }\n\n  /**\n   * The centralized filtering and sorting mechanism implemented here is decoupled via the usage of events.\n   * In order to work, the variables to be filtered/sorted must emit lifecycle events.\n   * This is done via the `withLifecycleEvents` decorator function.\n   *\n   * For example, check the `FilteredMetricsVariable` class.\n   */\n  private initVariablesFilteringAndSorting() {\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableActivated, (event) => {\n        // register engines\n        const { key } = event.payload;\n        const filteredMetricsVariable = sceneGraph.findByKey(this, key) as QueryVariable;\n\n        this.state.enginesMap.set(key, {\n          filterEngine: new MetricsVariableFilterEngine(filteredMetricsVariable),\n          sortEngine: new MetricsVariableSortEngine(filteredMetricsVariable),\n        });\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableDeactivated, (event) => {\n        // unregister engines\n        this.state.enginesMap.delete(event.payload.key);\n      })\n    );\n\n    const quickSearch = sceneGraph.findByKeyAndType(this, 'quick-search', QuickSearch);\n    const filterSections = sceneGraph.findAllObjects(\n      this,\n      (o) => o instanceof MetricsFilterSection\n    ) as MetricsFilterSection[];\n    const metricsSorter = sceneGraph.findByKeyAndType(this, 'metrics-sorter', MetricsSorter);\n    const sortByVariable = metricsSorter.state.$variables.getByName(VAR_WINGMAN_SORT_BY) as CustomVariable;\n\n    this._subs.add(\n      this.subscribeToEvent(EventMetricsVariableLoaded, (event) => {\n        // filter and sort on initial load\n        const { key, options } = event.payload;\n        const { filterEngine, sortEngine } = this.state.enginesMap.get(key)!;\n\n        filterEngine.setInitOptions(options);\n\n        const filters: Partial<MetricFilters> = {\n          names: quickSearch.state.value ? [quickSearch.state.value] : [],\n        };\n\n        for (const filterSection of filterSections) {\n          filters[filterSection.state.type] = filterSection.state.selectedGroups.map((g) => g.value);\n        }\n\n        filterEngine.applyFilters(filters, { forceUpdate: true, notify: false });\n        sortEngine.sort(sortByVariable.state.value as SortingOption);\n      })\n    );\n\n    /* Filters */\n\n    this._subs.add(\n      this.subscribeToEvent(EventQuickSearchChanged, (event) => {\n        const { searchText } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of this.state.enginesMap) {\n          filterEngine.applyFilters({ names: searchText ? [searchText] : [] });\n          sortEngine.sort(sortByVariable.state.value as SortingOption);\n        }\n      })\n    );\n\n    this._subs.add(\n      this.subscribeToEvent(EventFiltersChanged, (event) => {\n        const { type, filters } = event.payload;\n\n        for (const [, { filterEngine, sortEngine }] of this.state.enginesMap) {\n          filterEngine.applyFilters({ [type]: filters });\n          sortEngine.sort(sortByVariable.state.value as SortingOption);\n        }\n      })\n    );\n\n    /* Sorting */\n\n    this._subs.add(\n      this.subscribeToEvent(EventSortByChanged, (event) => {\n        const { sortBy } = event.payload;\n        reportExploreMetrics('sorting_changed', { from: 'metrics-reducer', sortBy });\n\n        for (const [, { sortEngine }] of this.state.enginesMap) {\n          sortEngine.sort(sortBy);\n        }\n      })\n    );\n  }\n\n  private openDrawer(metricName: string) {\n    const trail = getTrailFor(this);\n    this.state.drawer.open({\n      title: 'Choose a new Prometheus function',\n      subTitle: metricName,\n      body: new SceneCSSGridLayout({\n        templateColumns: GRID_TEMPLATE_COLUMNS,\n        autoRows: METRICS_VIZ_PANEL_HEIGHT_SMALL,\n        isLazy: true,\n        $behaviors: [\n          new behaviors.CursorSync({\n            key: 'metricCrosshairSync',\n            sync: DashboardCursorSync.Crosshair,\n          }),\n        ],\n        children: ConfigureAction.PROMETHEUS_FN_OPTIONS.map((option, colorIndex) => {\n          return new SceneCSSGridItem({\n            body: new MetricVizPanel({\n              title: option.label,\n              metricName,\n              color: getColorByIndex(colorIndex),\n              prometheusFunction: option.value,\n              height: METRICS_VIZ_PANEL_HEIGHT_SMALL,\n              hideLegend: true,\n              highlight: colorIndex === 1,\n              isNativeHistogram: trail.isNativeHistogram(metricName),\n              headerActions: [\n                new ApplyAction({\n                  metricName,\n                  prometheusFunction: option.value,\n                  disabled: colorIndex === 1,\n                }),\n              ],\n            }),\n          });\n        }),\n      }),\n    });\n  }\n\n  public static readonly Component = ({ model }: SceneComponentProps<MetricsReducer>) => {\n    const chromeHeaderHeight = useChromeHeaderHeight() ?? 0;\n    const styles = useStyles2(getStyles, chromeHeaderHeight);\n\n    const { $variables, body, listControls, drawer, sidebar } = model.useState();\n\n    return (\n      <>\n        <div className={styles.listControls} data-testid=\"list-controls\">\n          <listControls.Component model={listControls} />\n        </div>\n        <div className={styles.body}>\n          <div className={styles.sidebar} data-testid=\"sidebar\">\n            <sidebar.Component model={sidebar} />\n          </div>\n          <div className={styles.list}>\n            <body.Component model={body} />\n          </div>\n        </div>\n        <div className={styles.variables}>\n          {$variables?.state.variables.map((variable) => (\n            <variable.Component key={variable.state.name} model={variable} />\n          ))}\n        </div>\n        <drawer.Component model={drawer} />\n      </>\n    );\n  };\n}\n\n// the height of header between Grafana's chrome header and the metrics list container.\nconst APP_HEADER_HEIGHT = 144;\n\nfunction getStyles(theme: GrafanaTheme2, chromeHeaderHeight: number) {\n  return {\n    listControls: css({\n      marginBottom: theme.spacing(1.5),\n    }),\n    body: css({\n      display: 'flex',\n      flexDirection: 'row',\n      gap: theme.spacing(1),\n      height: `calc(100vh - ${chromeHeaderHeight + APP_HEADER_HEIGHT}px)`,\n    }),\n    list: css({\n      width: '100%',\n      overflowY: 'auto',\n    }),\n    sidebar: css({\n      flex: '0 0 auto',\n      overflowY: 'auto',\n    }),\n    variables: css({\n      display: 'none',\n    }),\n  };\n}\n","import { registerRuntimeDataSource, type RuntimeDataSource } from '@grafana/scenes';\n\nimport { displayError } from './displayStatus';\n\nexport function registerRuntimeDataSources(dataSources: RuntimeDataSource[]) {\n  try {\n    for (const dataSource of dataSources) {\n      registerRuntimeDataSource({ dataSource });\n    }\n  } catch (error) {\n    const { message } = error as Error;\n\n    if (!/A runtime data source with uid (.+) has already been registered/.test(message)) {\n      displayError(error as Error, [\n        'Fail to register all the runtime data sources!',\n        'The application cannot work as expected, please try reloading the page or if the problem persists, contact your organization admin.',\n      ]);\n    }\n  }\n}\n","import { SceneObjectBase, type SceneComponentProps, type SceneObjectState } from '@grafana/scenes';\nimport { Button } from '@grafana/ui';\nimport React from 'react';\n\nimport { MetricSelectedEvent } from 'shared';\n\ninterface SelectActionState extends SceneObjectState {\n  metricName: string;\n  variant: 'primary' | 'secondary';\n  fill: 'solid' | 'outline' | 'text';\n}\n\nexport class SelectAction extends SceneObjectBase<SelectActionState> {\n  constructor({\n    metricName,\n    variant,\n    fill,\n  }: {\n    metricName: SelectActionState['metricName'];\n    variant?: SelectActionState['variant'];\n    fill?: SelectActionState['fill'];\n  }) {\n    super({\n      key: `select-action-${metricName}`,\n      metricName,\n      variant: variant || 'primary',\n      fill: fill || 'outline',\n    });\n  }\n\n  public onClick = () => {\n    this.publishEvent(new MetricSelectedEvent(this.state.metricName), true);\n  };\n\n  public static readonly Component = ({ model }: SceneComponentProps<SelectAction>) => {\n    const { variant, fill } = model.useState();\n\n    return (\n      <Button\n        variant={variant}\n        fill={fill}\n        size=\"sm\"\n        onClick={model.onClick}\n        data-testid={`select-action-${model.state.metricName}`}\n      >\n        Select\n      </Button>\n    );\n  };\n}\n","import { localeCompare } from 'WingmanDataTrail/helpers/localCompare';\n\nconst NONE_PREFIX = '<none>';\n\nexport function computeMetricPrefixGroups(options: Array<{ label: string; value: string }>) {\n  const rawPrefixesMap = new Map<string, string[]>();\n\n  for (const option of options) {\n    const parts = option.value.split(/[^a-z0-9]/i);\n    const key = parts.length <= 1 ? option.value : parts[0];\n    const values = rawPrefixesMap.get(key) ?? [];\n\n    values.push(option.value);\n    rawPrefixesMap.set(key || NONE_PREFIX, values);\n  }\n\n  const prefixesMap = new Map<string, number>();\n\n  for (const [prefix, values] of rawPrefixesMap) {\n    prefixesMap.set(prefix, values.length);\n  }\n\n  return Array.from(prefixesMap.entries())\n    .sort((a, b) => {\n      if (a[1] !== b[1]) {\n        return b[1] - a[1];\n      }\n\n      return localeCompare(a[0], b[0]);\n    })\n    .map(([value, count]) => ({\n      value,\n      count,\n      label: value,\n    }));\n}\n","import { MetricsVariable } from './MetricsVariable';\nimport { withLifecycleEvents } from './withLifecycleEvents';\n\nexport const VAR_FILTERED_METRICS_VARIABLE = 'filtered-metrics-wingman';\n\nexport class FilteredMetricsVariable extends MetricsVariable {\n  constructor() {\n    super({\n      key: VAR_FILTERED_METRICS_VARIABLE,\n      name: VAR_FILTERED_METRICS_VARIABLE,\n      label: 'Filtered Metrics',\n    });\n\n    // required for filtering and sorting\n    return withLifecycleEvents<FilteredMetricsVariable>(this);\n  }\n}\n"],"names":["EventFiltersChanged","BusEventWithPayload","type","extensionPointId","pluginJson","AddToExplorationButton","SceneObjectBase","getPanelConfigAndDataFrames","data","panel","findObjectOfType","this","o","VizPanel","sceneGraph","getData","fieldConfig","state","frames","series","constructor","super","queries","_onActivate","_subs","add","subscribeToState","getQueries","getContext","datasourceUid","interpolate","VAR_DATASOURCE_EXPR","setState","dsUid","queryRunner","findObject","isSceneQueryRunner","filter","frame","getFilter","map","q","expr","legendFormat","name","JSON","stringify","updateFieldConfigOverrides","length","field","fields","properties","Object","keys","config","key","id","value","existingOverride","overrides","find","matcher","options","displayNameFromDS","displayName","unshift","labelName","fieldName","timeRange","getTimeRange","ctx","origin","datasource","uid","url","window","location","href","title","logoPath","MimirLogo","drillDownLabel","context","addActivationHandler","bind","Component","model","useState","links","usePluginLinks","limitPerPlugin","link","pluginId","IconButton","tooltip","description","aria-label","icon","onClick","e","filterNameAndValueObj","labels","ADD_TO_INVESTIGATION_MENU_TEXT","ADD_TO_INVESTIGATION_MENU_DIVIDER_TEXT","ADD_TO_INVESTIGATION_MENU_GROUP_TEXT","PanelMenu","addItem","item","body","setItems","items","addExplorationsLink","exploreUrl","viz","getAncestor","panelData","Error","getQueryRunnerFor","forEach","query","getExploreURL","includes","replace","text","iconClassName","then","open","shortcut","VizPanelMenu","addToExplorationsButton","menu","addToExplorationButton","explorationsButton","getInvestigationLink","existingMenuItems","existingAddToExplorationLink","activate","addToExplorations","buildInfo","version","startsWith","getPluginLinkExtensions","undefined","extensions","logger","error","message","getObservablePluginLinks","firstValueFrom","AutoVizPanelQuerySelector","autoQuery","getMetricSceneFor","variants","label","variant","onChangeQuery","queryDef","RadioButtonGroup","size","onChange","AutoVizPanel","onActivate","metric","getVizPanelFor","main","def","trail","getTrailFor","metadata","getMetricMetadata","getMetricDescription","vizBuilder","setData","SceneQueryRunner","trailDS","maxDataPoints","MDP_METRIC_OVERVIEW","setDescription","setHeaderActions","setShowMenuAlways","setMenu","build","metricScene","UI_TEXT","OPEN_EXPLORE_LABEL","COPY_URL_LABEL","BOOKMARK_LABEL","SELECT_NEW_METRIC_TOOLTIP","METRIC_AUTOVIZPANEL_KEY","MetricGraphScene","topView","SceneFlexLayout","direction","$behaviors","behaviors","sync","DashboardCursorSync","Crosshair","children","SceneFlexItem","minHeight","maxHeight","ySizing","MetricActionBar","getStyles","theme","chromeHeaderHeight","container","css","display","flexDirection","position","flexGrow","sticky","background","isLight","colors","primary","canvas","paddingTop","spacing","marginTop","top","zIndex","nonSticky","selectedTab","stickyMainGraph","getTrailSettings","useChromeHeaderHeight","styles","useStyles2","embedded","div","className","data-testid","METRIC_PREFIX_ALL_OPTION","PrefixFilterDropdown","getUrlState","metricPrefix","updateFromUrl","values","parseMetricPrefixes","_variableDependency","hasDependencyInLoadingState","loading","filteredMetricsVariable","lookupVariable","VAR_METRICS_VARIABLE","prefixGroups","computeMetricPrefixGroups","getMultiVariableValues","newOptions","g","count","newValue","selectOption","VariableDependencyConfig","variableNames","onVariableUpdateCompleted","_urlSync","SceneObjectUrlSyncConfig","option","publishEvent","filters","border","medium","tooltipIcon","InlineField","disabled","toString","InlineLabel","width","span","Tooltip","content","placement","Icon","Combobox","RelatedListControls","EmbeddedScene","QuickSearch","urlSearchParamName","targetName","nonFiltered","filtered","VAR_FILTERED_METRICS_VARIABLE","displayCounts","LayoutSwitcher","headerWrapper","alignItems","RelatedMetricsScene","subscribeToEvents","initVariablesFilteringAndSorting","enginesMap","Map","subscribeToEvent","EventMetricsVariableActivated","event","payload","findByKey","set","filterEngine","MetricsVariableFilterEngine","sortEngine","MetricsVariableSortEngine","EventMetricsVariableDeactivated","delete","quickSearch","findByKeyAndType","EventMetricsVariableLoaded","get","setInitOptions","names","applyFilters","forceUpdate","notify","sort","EventQuickSearchChanged","searchText","$variables","SceneVariableSet","variables","MetricsVariable","FilteredMetricsVariable","MetricsList","variableName","listControls","list","margin","variable","COPY_LABEL","ShareTrailButton","setTooltip","ToolbarButton","navigator","clipboard","reportExploreMetrics","action","appUrl","endsWith","slice","PLUGIN_BASE_URL","getUrlForTrail","writeText","setTimeout","BASE_QUERY_TEMPLATE","VAR_METRIC_EXPR","VAR_FILTERS_EXPR","RATE_BASE_QUERY_TEMPLATE","BASE_QUERY_UTF8_METRIC_TEMPLATE","RATE_BASE_QUERY_UTF8_METRIC_TEMPLATE","generateBaseQuery","isRateQuery","groupings","isUtf8Metric","baseQuery","join","simpleGraphBuilder","unit","PanelBuilders","timeseries","setTitle","setUnit","setOption","showLegend","mode","TooltipDisplayMode","Multi","SortOrder","Descending","setCustomFieldConfig","generateCommonAutoQueryInfo","mainQueryExpr","breakdownQueryExpr","common","mainQuery","refId","fromExploreMetrics","preview","breakdown","VAR_GROUP_BY_EXP","RATE_SUFFIXES","Set","SPECIFIC_AGGREGATIONS_FOR_SUFFIX","total","aggLabels","avg","sum","createDefaultMetricQueryDefs","metricParts","suffix","unitSuffix","at","has","aggregation","getPerSecondRateUnit","getUnit","aggregationDescription","agg","createHistogramMetricQueryDefs","nativeHistogram","p50","percentileQuery","percentiles","p","percentilesGraphBuilder","heatmap","format","HeatmapColorMode","Scheme","exponent","scheme","steps","reverse","heatmapGraphBuilder","percentile","percent","createMeanExpr","subMetric","getAutoQueriesForMetric","isValidLegacyName","split","createSummaryMetricQueryDefs","BreakdownLabelSelector","select","opt","selected","maxWidth","AddToFiltersGraphAction","isAdHocFiltersVariable","cause","operator","addFilterWithoutReportingInteraction","findSceneObjectsByType","scene","sceneType","isSceneType","findAllObjects","Button","fill","uf","uFuzzy","intraMode","intraIns","intraSub","intraTrn","intraDel","fuzzySearch","haystack","callback","idxs","info","order","search","haystackOrder","matchesSet","mark","part","matched","i","infoIdx","highlight","idx","ranges","push","debounceLodash","ByFrameRepeater","performRepeat","newChildren","sortedSeries","sortSeries","sortBy","seriesIndex","layoutChild","getLayoutChild","unfilteredChildren","filterByString","iterateFrames","labelValue","getLabelValue","filterFrames","filterFn","clearFilter","SceneReactObject","reactNode","alertContainer","Alert","severity","noResultsAlert","clearButton","BreakdownSearchReset","newState","oldState","newData","SceneDataNode","dataNode","LoadingState","Done","justifyContent","minWidth","marginLeft","getLabelValueFromDataFrame","SearchInput","placeholder","onClear","rest","Input","clearIcon","prefix","cursor","BusEventBase","recentFilters","BreakdownSearchScene","filterValues","parent","LabelBreakdownScene","cacheKey","forEachChild","child","isActive","onValueFilterChange","target","clearValueFilter","reset","getSortByPreference","defaultSortBy","localStorage","parts","getItem","TRAIL_BREAKDOWN_SORT_KEY","BREAKDOWN_LAYOUT_TYPES","isBreakdownLayoutType","breakdownLayoutType","breakdownLayout","activeBreakdownLayout","newBreakdownLayout","Selector","breakdownLayoutOptions","onLayoutChange","storedBreakdownLayout","TRAIL_BREAKDOWN_VIEW_KEY","active","layout","setItem","setVewByPreference","onBreakdownLayoutChange","breakdownLayouts","index","findIndex","SortCriteriaChanged","sortingOptions","SortByScene","onCriteriaChange","criteria","setSortByPreference","sortByTooltip","gap","Field","htmlFor","isClearable","BreakdownAxisChangeEvent","yAxisSyncBehavior","sceneObject","breakdownScene","registerDataProvider","dataProvider","reportBreakdownPanelData","vizPanel","$data","axisChangeSubscription","unsubscribe","FieldConfigBuilders","min","max","update","onFieldConfigChange","ALL_VARIABLE_VALUE","StatusWrapper","blockingMessage","isLoading","LoadingPlaceholder","statusMessage","fontStyle","textAlign","EventTimeseriesDataReceived","syncYAxis","vizPanelsParent","Number","NEGATIVE_INFINITY","POSITIVE_INFINITY","timeRangeSub","eventSub","newMax","newMin","s","Boolean","Math","t","clearFieldConfigCache","merge","cloneDeep","defaults","updateTimeseriesAxis","addRefId","source","pipe","d","SERIES_COUNT_STATS_NAME","sliceSeries","start","end","meta","stats","LABELS_VIZ_PANEL_HEIGHT","LabelVizPanel","buildVizPanel","SceneDataTransformer","MDP_METRIC_PREVIEW","transformations","setBehaviors","prevState","SelectLabelAction","getAllValuesConfig","seriesCountStats","seriesCount","getOverrides","startColorIndex","FieldMatcherID","byFrameRefID","fixedColor","getColorByIndex","height","MetricLabelsList","subscribeToLayoutChange","layoutSwitcher","onChangeState","templateColumns","LayoutType","ROWS","GRID_TEMPLATE_ROWS","GRID_TEMPLATE_COLUMNS","SceneByVariableRepeater","VAR_GROUP_BY","initialPageSize","pageSizeIncrement","SceneCSSGridLayout","isLazy","autoRows","getLayoutLoading","Spinner","inline","getLayoutEmpty","InlineBanner","getLayoutError","replaceAll","utf8Support","String","SceneCSSGridItem","footer","borderRadius","batchSizes","useSizes","shouldDisplayShowMoreButton","current","ShowMoreButton","increaseBatchSize","init","debug","getVariable","featureToggles","enableScopesInMetricsExplore","RefreshMetricsEvent","updateBody","handleSortByChange","MetricScene","_query","$timeRange","clearBreakdownPanelAxisValues","breakdownPanelMinValue","breakdownPanelMaxValue","dataFrame","breakdownData","FieldType","number","isNumber","maxValue","minValue","isFinite","_triggerAxisChangedEvent","isQueryVariable","onReferencedVariableValueChanged","changeValueTo","scenObject","labelFilters","VAR_FILTERS","labelOptions","getOptionsForSelect","filterExists","f","getLabelOptions","stateUpdate","hasAllValue","searchScene","frameIndex","setColor","isHidden","METRICS_VIZ_PANEL_HEIGHT","buildNormalLayout","throttle","from","searchField","controls","getBreakdownSceneFor","actionViews","actionViewsDefinitions","getScene","createRelatedLogsScene","getLinkToExplore","autoVizPanel","openExploreLink","actions","breakpoints","up","md","right","customTabsBar","paddingBottom","isBookmarked","toggleBookmark","getBookmarkIndex","getTrailStore","indexOnRender","bookmarkIndex","setBookmarkIndex","useEffect","sub","SceneObjectStateChangedEvent","indexToRemove","removeBookmark","addBookmark","useBookmarkState","actionView","Box","paddingY","Stack","MetricSelectedEvent","LinkButton","TabsBar","tab","counter","relatedLogsCount","tabRender","Tab","onChangeTab","view","related_logs_count","relatedLogsOrchestrator","checkConditionsMetForRelatedLogs","setActionView","knownLabelNameDiscrepancies","job","instance","replaceKnownLabelNames","createLabelsCrossReferenceConnector","conditionsMetForRelatedLogs","getDataSources","filtersVariable","lokiDataSources","getDataSourceFetcher","getHealthyDataSources","results","Promise","all","hasLabels","ds","getDataSourceSrv","labelKeys","getTagKeys","Array","isArray","availableLabels","every","lokiLabelName","getTagValues","some","v","hasMatchingLabels","getLokiQueryExpr","getLokiQueryForRelatedMetric","metricName","dataSourceUid","extractedRecordingRules","targetRule","rule","trim","hasMetricExpr","tree","parser","parse","iterate","enter","MetricExpr","isLogsQuery","selectorNode","getNodeFromQuery","selector","substring","to","pipelineExprNode","PipelineExpr","pipelineExpr","getLogQueryFromMetricsQuery","fetchAndExtractLokiRecordingRules","dataSource","extractedRules","ruleGroups","rg","rules","r","existingRule","hasMultipleOccurrences","extractRecordingRulesFromRuleGroups","datasourceSettings","recordingRules","showErrorAlert","showSuccessAlert","res","lastValueFrom","getBackendSrv","fetch","ok","groups","warn","err","createLokiRecordingRulesConnector","lokiRecordingRules","selectedMetric","foundLokiDataSources","recRules","rr","getDataSourcesWithRecordingRulesContainingMetric","nodeType","foundNode","node","RelatedLogsOrchestrator","_internalState","dataSources","currentDataSourcesSignature","newDataSourcesSignature","_changeHandlers","handler","addLokiDataSourcesChangeHandler","addRelatedLogsCountChangeHandler","findAndCheckAllDatasources","allLokiDatasources","_dataSourceFetcher","checkLogsInDataSources","maxLines","_metricScene","queriesByConnector","_logsConnectors","reduce","acc","connector","lokiExpr","connectorName","supportingQueryType","datasources","datasourcesWithLogs","totalLogsCount","totalChecked","getLokiQueries","rowCount","NoRelatedLogs","Text","ul","li","TextLink","external","color","paddingLeft","LOGS_PANEL_CONTAINER_KEY","RelatedLogsScene","orchestrator","setupLogsPanel","showNoLogsFound","component","_queryRunner","VAR_LOGS_DATASOURCE_EXPR","logs","logsDataSourceVariable","CustomVariable","VAR_LOGS_DATASOURCE","VariableValueSelectors","updateLokiQuery","selectedDatasourceVar","selectedDatasourceUid","isCustomVariable","getValue","props","handleFiltersChange","grow","control","appSubUrl","actionViewDef","actionViewType","getVariablesWithMetricConstant","QueryVariable","includeAll","defaultToAll","SectionTitle","h6","infoIcon","fontSize","fontWeight","typography","fontWeightLight","borderBottom","weak","secondary","areArraysEqual","array1","array2","isEqual","extractMetricNames","promqlExpression","metricNames","is","firstChild","nextSibling","next","usageRequestOptions","fetchAlertingMetrics","alertingRules","metricCounts","relevantRules","prometheusQueries","metrics","parseAlertingRules","dashboardRequestMap","getDashboardLimited","limitFunction","dashboardUid","dashboardRequestsFailedCount","promise","dashboard","catch","resolve","finally","concurrency","fetchDashboardMetrics","dashboards","limit","parseDashboardSearchResponse","dashboardSearchResponse","counts","relevantDashboards","panels","relevantPanels","isPrometheusDataSource","targets","MetricUsageFetcher","getUsageMetrics","usageType","_usageState","metricsPromise","fetcher","getUsageForMetric","RECENT_METRICS_STORAGE_KEY","MAX_RECENT_METRICS","RECENT_METRICS_EXPIRY_DAYS","addRecentMetric","recentMetrics","getRecentMetrics","now","Date","filteredMetrics","m","timestamp","updatedMetrics","errorObject","stored","thirtyDaysAgo","validMetrics","sortByOptions","VAR_WINGMAN_SORT_BY","MetricsSorter","activationHandler","sortByVar","getVariables","getByName","supportedSortByOptions","EventSortByChanged","usageFetcher","inputControls","initialized","sortMetricsByCount","a","b","scoreA","scoreB","localeCompare","sortMetricsWithRecentFirst","allRecentMetrics","allRecentMetricsSet","recent","nonRecent","sortedNonRecent","sortMetricsAlphabetically","withLifecycleEvents","TypeError","MetricsDrilldownDataSourceVariable","DataSourceVariable","skipUrlSync","LOCAL_STORAGE_KEY","getCurrentDataSource","prometheusDataSources","uidFromUrl","URL","searchParams","VAR_DATASOURCE","uidFromLocalStorage","currentDataSource","isDefault","initialDS","PluginLogo","memo","img","cx","logo","src","pluginCommitSha","GIT_COMMIT","pluginCommitURL","grafanaBuildInfo","InfoMenuHeader","updated","usePluginContext","menuHeader","h5","subTitle","InfoMenu","isDev","shortCommitSha","Menu","header","Item","Divider","edition","env","commit","PluginInfo","Dropdown","overlay","tooltipPlacement","button","bodySmall","DataTrailSettings","isOpen","onToggleStickyMainGraph","onToggleOpen","popover","padding","boxShadow","shadows","z3","shape","radius","default","marginRight","heading","fontWeightMedium","gridTemplateColumns","rowGap","columnGap","topScene","evt","stopPropagation","Switch","onVisibleChange","DataTrail","trailActivated","getTopSceneFor","_handleMetricSelectedEvent","_addingFilterWithoutReportingInteraction","reportChangeInLabelFilters","saveRecentTrail","hasFilters","setRecentTrail","addEventListener","removeEventListener","datasourceHelper","getMetadataForMetric","isNativeHistogram","initializeHistograms","histogramsLoaded","displayWarning","nativeHistograms","listNativeHistograms","resetNativeHistograms","getCurrentMetricMetadata","nativeHistogramMetric","performBrowserHistoryAction","getSceneUpdatesForNewMetricValue","filterVar","baseFilters","getBaseFiltersForMetric","metricSearch","assign","MetricsReducer","sqr","initialFilters","SceneTimeRange","AdHocFiltersVariable","addFilterButtonText","hide","VariableHide","dontHide","applyMode","allowCustomValue","expressionBuilder","filtersWithoutMetricName","SceneControlsSpacer","SceneTimePicker","SceneRefreshPicker","settings","pluginInfo","createdAt","getTime","dashboardMetrics","alertingMetrics","MetricDatasourceHelper","flexWrap","isDark","navbarFixed","settingsInfo","limitAdhocProviders","UrlSyncContextProvider","createBrowserHistorySteps","updateUrlOnInit","increment","HOME_ROUTE","VAR_METRIC","VAR_OTHER_METRIC_FILTERS","LOGS_METRIC","RECENT_TRAILS_KEY","TRAIL_BOOKMARKS_KEY","ConstantVariable","hideVariable","TrailStore","_loadRecentTrailsFromStorage","storageItem","serializedTrails","_deserializeTrail","getRef","_loadBookmarksFromStorage","serialized","step","currentStep","history","urlValues","urlSerializedTrail","_loadFromUrl","sceneUtils","cloneSceneObjectState","_serializeTrail","getTrailForBookmarkIndex","bookmark","_bookmarks","getTrailForBookmark","newMetricsTrail","getBookmarkKey","_recent","urlState","urlUtil","renderUrl","syncStateFromSearchParams","URLSearchParams","lastModified","_lastModified","load","_refreshBookmarkIndexMap","recentTrail","recentUrlState","getUrlStateForComparison","_save","bookmarks","bookmarkState","appEvents","getAppEvents","isSidebarView","currentPathIncludes","ROUTES","Drilldown","infoText","publish","AppEvents","alertSuccess","createBookmarkSavedNotification","splice","bookmarkKey","_bookmarkIndexMap","clear","bookmarked","doSave","serializedRecent","debounce","correctUrlStateForComparison","refresh","store","memoize","sortSeriesByName","initOutlierDetector","reducer","fieldReducer","calculateOutlierValue","ReducerID","stdDev","fieldReducers","doStandardCalcs","seriesCalcs","firstTimestamp","seriesIsNotEmpty","lastTimestamp","wasmSupported","joined","outerJoinDataFrames","points","Float64Array","detector","OutlierDetector","dbscan","sensitivity","preprocess","outliers","detect","indexOf","seriesResults","isOutlier","outlierIntervals","valueA","valueB","support","WebAssembly","INTERACTION_NAME_PREFIX","reportInteraction","appRelease","apps","PLUGIN_ID","appVersion","reportLabelFilterChange","newFilters","oldFilters","oldFilter","newFilter","detectChangedFilters","detectRemovedFilters","detectAddedFilters","displayError","msgs","msg","handheldBy","alertError","alertWarning","loadingLayout","errorLayout","emptyLayout","currentBatchSize","MultiValueVariable","newBatchSize","remaining","getClosestScopesFacade","ScopesFacade","getSelectedScopes","selectedScopes","getSelectedScopesNames","scope","setSelectedScopes","scopes","notifySubscribers","onScopesChange","onScopesChangeCallbacks","cb","params","path","pathname","getMetricName","visTheme","theme2","visualization","getColorByName","palette","MAX_ADHOC_VARIABLE_OPTIONS","dataTrail","limitedFilterVariable","getTagKeysProvider","opts","getTagValuesProvider","_","check","returnType","obj","Intl","Collator","compare","initOptions","getFilteredOptions","filteredOptions","categories","applyCategoryFilters","prefixes","applyPrefixFilters","suffixes","applySuffixFilters","applyNameFilters","updatedFilters","notifyUpdate","category","categoryRegex","buildRegex","concat","test","pattern","prefixesRegex","suffixesRegex","namePatterns","regexes","RegExp","regex","flags","SceneVariableValueChangedEvent","WithUsageDataPreviewPanel","metricsReducer","metricsSorter","updateSortBy","gridLayout","currentGridLayoutHeight","usage","METRICS_VIZ_PANEL_HEIGHT_WITH_USAGE_DATA_PREVIEW","UsageData","usageCount","singularUsageType","pluralUsageType","usageContainer","usageItem","borderTopWidth","backgroundColor","opacity","vizPanelInGridItem","metricUsedInAlertingRulesCount","metricUsedInDashboardsCount","log","usageDetails","truncateValue","maxLength","DataTrailCard","onSelect","onDelete","useMemo","cardHeightClassName","compactHeight","cardTall","cardClassName","card","wide","cardWide","article","Card","Heading","metricValue","Meta","secondaryFont","primaryFont","deleteButton","SecondaryActions","date","dateTimeFormat","wordBreak","marginBottom","borderTop","borderRight","borderLeft","overflow","textOverflow","gridArea","whiteSpace","letterSpacing","lineHeight","bottom","navigationEvents","listeners","emit","listener","subscribe","BookmarksList","bookmarksList","overflowY","paddingRight","emptyState","setLastDelete","goToUrlForTrail","VariableRefresh","onTimeRangeChanged","VariableSort","alphabeticalAsc","colorIndex","matchers","MetricVizPanel","_datasource","_metricsMetadata","_classicHistograms","_nativeHistograms","getDatasource","__sceneObject","_trail","_ensureMetricsMetadata","_getMetricsMetadata","queryMetadata","languageProvider","queryMetricsMetadata","metricsMetadata","loadMetadata","retrieveMetricsMetadata","loadMetricsMetadata","classicHistogramsCall","metricFindQuery","allMetricsCall","classicHistograms","allMetrics","addNativeHistogram","notClassic","pop","isWrappedInQuotes","unwrapQuotes","datasourceUsesTimeRangeInLanguageProviderMethods","fetchLabelValues","fetchLabels","queryLabelKeys","fetchLabelsWithMatch","queryLabelValues","fetchLabelValuesWithOptionalMatcher","fetchSeriesValuesWithMatch","getPrometheusDataSourceForScene","dsVariable","help","metricToTargetLevenDistances","getLevenDistances","targetMetric","targetToDistances","distances","metricSplit","metricHalf","halfLeven","leven","wholeLeven","lastMetrics","sortedMetrics","sortByUsage","metricList","aValue","bValue","usageMetrics","errorContext","bannerTitle","br","filteredVariable","nonFilteredVariable","toggleCountsDisplay","updateValue","notifyValueChange","getHumanFriendlyCountsMessage","tagName","tooltipContent","currentTarget","onKeyDown","preventDefault","Tag","input","DEFAULT_UNIT","DEFAULT_RATE_UNIT","UNIT_BYTES","UNIT_SECONDS","UNIT_PERCENT","UNIT_COUNT","UNIT_MAP","UNIT_LIST","RATE_UNIT_MAP","getUnitFromMetric","toLowerCase","metricPart","PROMETHEUS_DATA_SOURCE_REGEX","DataSourceFetcher","cachedDataSources","cache","pendingRequest","pendingRequests","fetchHealthyDataSources","allDataSourcesOfType","getList","healthyDataSources","unhealthyDataSources","health","status","dataSourceFetcherSingleton","getPromqlFunction","nonRateQueryFunction","buildPrometheusQuery","ignoreUsage","metricPartString","Expression","defaultOperator","MatchingOperator","equal","defaultSelectors","promql","rate","interval","by","MATCHER_REGEX","parseMatcher","rawKey","rawOperator","rawValue","match","METRICS_VIZ_PANEL_HEIGHT_SMALL","rateQueryMetricSuffixes","prometheusFunction","hideLegend","headerActions","panelTitle","isHistogram","statushistory","clone","setMappings","MappingType","ValueToText","setThresholds","ThresholdsMode","Absolute","VisibilityMode","Never","buildStatusHistoryPanel","buildQueryRunner","show","buildHeatmapPanel","queryOptions","buildTimeseriesPanel","determineQueryProperties","MAX_DATA_POINTS","stateWithDefaults","SelectAction","nativeHistogramStyles","left","pill","transparent","ErrorView","navigate","useNavigate","useLocation","onClickReload","useCallback","newSearchParams","reload","Onboarding","useTheme2","wrap","graphicContainer","SVG","h3","locationUtil","assureBaseUrl","rel","alignSelf","MetricsContext","createContext","Wingman","lazy","TrailRedirect","Navigate","AppRoutes","useContext","Routes","Route","element","Trail","ensureErrorObject","defaultMessage","PluginPropsContext","initFaro","prometheusDatasources","App","setError","onError","errorEvent","onUnHandledRejection","reason","useCatchExceptions","setTrail","locationService","useTrail","initRef","useRef","useReportAppInitialized","appContainer","Provider","DEFAULT_LAYOUT","OPTIONS","fullWidth","NULL_GROUP_BY_VALUE","LabelsDataSource","RuntimeDataSource","other","scopedVars","valueOf","getLabelsMatchAPISupport","getFiltersFromVariable","response","processLabelOptions","hasLabelsMatchAPISupport","testDatasource","VAR_LABEL_VALUES","LabelValuesVariable","isMulti","VAR_WINGMAN_GROUP_BY","LabelsVariable","refreshOptions","filterExpression","updateQuery","Label","GroupsIcon","svg","stroke","viewBox","circle","cy","strokeWidth","MetricsWithLabelValueDataSource","metricsList","removeRules","isPrometheusRule","VAR_METRIC_WITH_LABEL_VALUE","MetricsWithLabelValueVariable","adHocFiltersVariable","buildQuery","MetricsGroupByRow","labelCardinality","containerHeader","headerButtons","selectButton","collapsableSectionBody","groupName","isCollapsed","setIsCollapsed","CollapsableSection","onToggle","MetricsGroupByList","ListControls","EventApplyFunction","ApplyAction","EventConfigureFunction","ConfigureAction","PROMETHEUS_FN_OPTIONS","SceneDrawer","close","Drawer","subtitle","closeOnMaskClick","onClose","ruleGroupLabels","EventSectionValueChanged","CheckboxWithCount","checked","checkboxWrapper","Checkbox","CheckBoxList","selectedGroups","onSelectionChange","checkboxListHeader","noResults","checkboxList","group","checkboxItem","newGroups","shade","MetricsFilterSection","metricsVariable","updateLists","updateCounts","computeGroups","originalOptions","filtersWithoutCurrentType","getFilters","optionsForCounting","newGroupsWithCount","showHideEmpty","showSearch","filter_count","filterType","filter_type","switchContainer","switchLabel","searchInput","flexBasis","flexShrink","hideEmpty","setHideEmpty","searchValue","setSearchValue","filteredGroups","computeMetricSuffixGroups","rawSuffixesMap","suffixesMap","entries","computeRulesGroups","rulesMap","LabelsList","selectedLabel","onClickLabel","onClickClearSelection","listHeader","RadioButtonList","flex","LabelsBrowser","labelsVariable","selectLabel","useLabelsBrowser","labelsList","onInputChange","onInputKeyDown","onInputClear","Settings","CustomIcons","rect","x","y","rx","SideBarButton","ariaLabel","visible","iconOrText","buttonIcon","ButtonChild","availableIconsIndex","maxContrast","metricFiltersVariables","SideBar","cleanupOtherMetricsVar","initOtherMetricsVar","sectionValues","newSectionValues","setOtherMetricFilters","otherMetricFiltersVar","varToTextMap","keyLabel","hideLabel","currentVariableSet","readOnly","getSectionValuesFromUrl","urlSearchParams","filterKey","filterValueFromUrl","setActiveSection","sectionKey","visibleSection","sections","section","buttonsBar","boxSizing","borderTopLeftRadius","borderBottomLeftRadius","buttonContainer","transition","selectedBorder","visibility","closeButton","groupByValue","updateBasedOnGroupBy","hasGroupByValue","openDrawer","drawer","filterSections","sortByVariable","filterSection","sidebar","registerRuntimeDataSource","registerRuntimeDataSources","APP_HEADER_HEIGHT","NONE_PREFIX","rawPrefixesMap","prefixesMap"],"sourceRoot":""}